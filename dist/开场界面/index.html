<head><style>html{width:100%;height:auto;margin:0;padding:0;overflow:visible;background:0 0}body{width:100%;height:auto;margin:0;padding:0;overflow-x:hidden;background:0 0}#app{width:100%;min-height:100vh;display:flex;justify-content:center;align-items:flex-start;background:0 0}</style><script type="module">import'https://testingcf.jsdelivr.net/npm/klona/+esm';var e={426:(e,t)=>{t.A=(e,t)=>{const n=e.__vccOpts||e;for(const[e,a]of t)n[e]=a;return n}}},t={};function n(a){var l=t[a];if(void 0!==l)return l.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const a=Vue,l=toastr;var o=n.n(l);const c=[{id:'spring',title:'春之邂逅',description:'樱花飘落的季节，命运的相遇悄然开始...',image:'',message:'樱花飘落的季节，我在樱花树下与你相遇...'},{id:'summer',title:'夏之约定',description:'蝉鸣声中，许下永不忘记的誓言...',image:'',message:'夏日的午后，我们许下了永不忘记的约定...'},{id:'autumn',title:'秋之离别',description:'红叶纷飞，不舍的泪水模糊了视线...',image:'',message:'秋天的风带走了你，却带不走我的思念...'},{id:'winter',title:'冬之重逢',description:'白雪皑皑，终于再次见到思念的人...',image:'',message:'雪花飘落，我们终于在冬天再次相遇...'}],s=[{name:'樱井 美月',role:'女主角',desc:'温柔善良的少女，拥有感知星光的神秘能力。在一次偶然中与命运相遇，开启了一段跨越时空的旅程。',image:'',colorClass:''},{name:'星野 苍',role:'男主角',desc:'神秘的转学生，似乎隐藏着不为人知的过去。冷淡的外表下，有着温暖的内心。',image:'',colorClass:'blue'},{name:'日向 心',role:'好友',desc:'美月的青梅竹马，活泼开朗的性格总能带给周围人欢笑。暗中守护着美月。',image:'',colorClass:'orange'},{name:'月见 透',role:'神秘人物',desc:'在关键时刻出现的神秘人物，似乎知道所有事情的真相。身份成谜。',image:'',colorClass:'gray'}],i='开场界面-模型数据',r=['models/','model/',''],m=['model3.json','model.json'],u={count:20,minDuration:5,maxDuration:10,maxDelay:5};function d(){try{const e=function(){if(document.querySelector('.opening-interface')){const e=800,t=window.innerWidth,n=window.innerHeight,a=1200,l=20,o=Math.max(t-2*l,0),c=Math.max(n-2*l,0);if(o>0&&c>0){const t=o/a,n=c/e,l=e*Math.min(t,n,1);return Math.max(400,Math.min(1.1*l,2e3))}}const e=document.body,t=document.documentElement,n=document.getElementById('app'),a=[e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight,n?.scrollHeight||0,n?.offsetHeight||0],l=Math.max(...a.filter(e=>e>0));return Math.max(400,Math.min(l,2e3))}(),t=window.frameElement;t?(t.style.height=`${e}px`,console.info(`[开场界面] 调整 iframe 高度: ${e}px`)):(document.body.style.minHeight=`${e}px`,console.info(`[开场界面] 调整 body 高度: ${e}px`))}catch(e){console.warn('[开场界面] 调整高度失败:',e)}}const p={class:'collapsible-section'},f={class:'header-title'},v={key:1,class:'badge'},g={class:'collapsible-content'},h=(0,a.defineComponent)({__name:'CollapsibleSection',props:{title:{},icon:{},badge:{},defaultExpanded:{type:Boolean,default:!1}},setup(e,{expose:t}){const n=e,l=(0,a.ref)(n.defaultExpanded);function o(){l.value=!l.value}return t({toggle:o,isExpanded:()=>l.value}),(t,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',p,[(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)(['collapsible-header',{expanded:l.value}]),onClick:o},[(0,a.createElementVNode)('span',f,[e.icon?((0,a.openBlock)(),(0,a.createBlock)((0,a.resolveDynamicComponent)(e.icon),{key:0,class:'icon-sm'})):(0,a.createCommentVNode)('v-if',!0),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.title)+' ',1),e.badge?((0,a.openBlock)(),(0,a.createElementBlock)('span',v,(0,a.toDisplayString)(e.badge),1)):(0,a.createCommentVNode)('v-if',!0)]),((0,a.openBlock)(),(0,a.createElementBlock)('svg',{class:(0,a.normalizeClass)(['chevron-icon',{rotated:l.value}]),fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[...n[0]||(n[0]=[(0,a.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 9l-7 7-7-7'},null,-1)])],2))],2),(0,a.createVNode)(a.Transition,{name:'slide',persisted:''},{default:(0,a.withCtx)(()=>[(0,a.withDirectives)((0,a.createElementVNode)('div',g,[(0,a.renderSlot)(t.$slots,'default')],512),[[a.vShow,l.value]])]),_:3})]))}});var y=n(426);const k=(0,y.A)(h,[['__scopeId','data-v-379bada6']]),b={class:'icon icon-sm',viewBox:'0 0 24 24'};const N={},E=(0,y.A)(N,[['render',function(e,t){return(0,a.openBlock)(),(0,a.createElementBlock)('svg',b,[...t[0]||(t[0]=[(0,a.createElementVNode)('line',{x1:'19',y1:'12',x2:'5',y2:'12'},null,-1),(0,a.createElementVNode)('polyline',{points:'12 19 5 12 12 5'},null,-1)])])}]]),V={class:'icon icon-sm',viewBox:'0 0 24 24'};const x={},B=(0,y.A)(x,[['render',function(e,t){return(0,a.openBlock)(),(0,a.createElementBlock)('svg',V,[...t[0]||(t[0]=[(0,a.createElementVNode)('polyline',{points:'20 6 9 17 4 12'},null,-1)])])}]]),w={class:'icon icon-lg',viewBox:'0 0 24 24'};const C={},M=(0,y.A)(C,[['render',function(e,t){return(0,a.openBlock)(),(0,a.createElementBlock)('svg',w,[...t[0]||(t[0]=[(0,a.createElementVNode)('polyline',{points:'15 18 9 12 15 6'},null,-1)])])}]]),S={class:'icon icon-lg',viewBox:'0 0 24 24'};const D={},j=(0,y.A)(D,[['render',function(e,t){return(0,a.openBlock)(),(0,a.createElementBlock)('svg',S,[...t[0]||(t[0]=[(0,a.createElementVNode)('polyline',{points:'9 18 15 12 9 6'},null,-1)])])}]]),L={class:'icon icon-sm',viewBox:'0 0 24 24'};const T={},U=(0,y.A)(T,[['render',function(e,t){return(0,a.openBlock)(),(0,a.createElementBlock)('svg',L,[...t[0]||(t[0]=[(0,a.createElementVNode)('line',{x1:'18',y1:'6',x2:'6',y2:'18'},null,-1),(0,a.createElementVNode)('line',{x1:'6',y1:'6',x2:'18',y2:'18'},null,-1)])])}]]);const I={class:'icon',viewBox:'0 0 24 24'};const R={},F=(0,y.A)(R,[['render',function(e,t){return(0,a.openBlock)(),(0,a.createElementBlock)('svg',I,[...t[0]||(t[0]=[(0,a.createElementVNode)('polygon',{points:'5 3 19 12 5 21 5 3'},null,-1)])])}]]),A={class:'icon',viewBox:'0 0 24 24'};const O={},W=(0,y.A)(O,[['render',function(e,t){return(0,a.openBlock)(),(0,a.createElementBlock)('svg',A,[...t[0]||(t[0]=[(0,a.createElementVNode)('circle',{cx:'12',cy:'12',r:'3'},null,-1),(0,a.createElementVNode)('path',{d:'M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z'},null,-1)])])}]]),G={class:'icon',viewBox:'0 0 24 24'};const H={},K=(0,y.A)(H,[['render',function(e,t){return(0,a.openBlock)(),(0,a.createElementBlock)('svg',G,[...t[0]||(t[0]=[(0,a.createElementVNode)('path',{d:'M12 3l1.912 5.813L20 9.5l-4.562 3.937L17 19l-5-3.5L7 19l1.563-5.563L4 9.5l6.088-.687L12 3z',fill:'currentColor',stroke:'none'},null,-1)])])}]]),P={class:'icon',viewBox:'0 0 24 24'};const q={},J=(0,y.A)(q,[['render',function(e,t){return(0,a.openBlock)(),(0,a.createElementBlock)('svg',P,[...t[0]||(t[0]=[(0,a.createElementVNode)('path',{d:'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4'},null,-1),(0,a.createElementVNode)('polyline',{points:'17 8 12 3 7 8'},null,-1),(0,a.createElementVNode)('line',{x1:'12',y1:'3',x2:'12',y2:'15'},null,-1)])])}]]),Q={class:'icon',viewBox:'0 0 24 24'};const X={},Y=(0,y.A)(X,[['render',function(e,t){return(0,a.openBlock)(),(0,a.createElementBlock)('svg',Q,[...t[0]||(t[0]=[(0,a.createElementVNode)('path',{d:'M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2'},null,-1),(0,a.createElementVNode)('circle',{cx:'9',cy:'7',r:'4'},null,-1),(0,a.createElementVNode)('path',{d:'M23 21v-2a4 4 0 0 0-3-3.87'},null,-1),(0,a.createElementVNode)('path',{d:'M16 3.13a4 4 0 0 1 0 7.75'},null,-1)])])}]]),Z='model-files';function ee(){return new Promise((e,t)=>{const n=indexedDB.open('live2d-models-db',1);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(Z)||t.createObjectStore(Z,{keyPath:'id'})}})}async function te(e,t,n){const a=await ee(),l=function(e,t){return`${e}::${t}`}(e,t);return new Promise((o,c)=>{const s=a.transaction([Z],'readwrite').objectStore(Z),i=new FileReader;i.onload=()=>{const a={id:l,modelName:e,filename:t,data:i.result,type:n.type,size:n.size,lastModified:n.lastModified},r=s.put(a);r.onsuccess=()=>{console.info(`[IndexedDB] 已存储文件: ${t} (${(n.size/1024).toFixed(2)}KB)`),o(l)},r.onerror=()=>c(r.error)},i.onerror=()=>c(i.error),i.readAsArrayBuffer(n)})}function ne(e,t){return{name:e?`[立绘资源] ${e}`:'[立绘资源]',enabled:!0,strategy:{type:'selective',keys:e?[e,`${e}的立绘`]:['立绘','角色立绘'],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'after_character_definition',role:'system',depth:0,order:1},content:`\`\`\`json\n${JSON.stringify(t,null,2)}\n\`\`\`\n`,probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}}}const ae={class:'model-upload-wizard'},le={class:'steps-indicator'},oe={class:'step-number'},ce={class:'step-label'},se={class:'step-content'},ie={key:0,class:'uploaded-files-preview'},re={class:'files-summary'},me={key:0,class:'hint'},ue={class:'files-list'},de={class:'file-name'},pe={key:0,class:'file-source-badge',title:'URL导入'},fe=['onClick'],ve={class:'upload-methods-container'},ge={class:'upload-method-section'},he={class:'upload-area-inner'},ye={class:'upload-placeholder'},ke={class:'upload-method-section'},be={class:'url-upload-area'},Ne={class:'url-input-group'},Ee=['disabled'],Ve={class:'step-actions'},xe=['disabled'],Be={class:'step-content'},we={key:0,class:'classifying-status'},Ce={key:1,class:'classified-files'},$e={class:'settings-card'},Me={class:'files-categories'},Se={key:0,class:'category-section'},_e={class:'file-category'},De={key:0,class:'category-item'},je={key:1,class:'category-item'},Le={key:1,class:'category-section'},Te={class:'file-category'},Ue={class:'file-name'},Ie=['onChange'],Re={key:2,class:'category-section'},Fe={class:'file-category'},Ae=['onClick'],Oe={key:3,class:'category-section'},We={class:'file-category'},Ge={class:'file-name'},He={key:0,class:'character-name-badge'},ze=['onChange'],Ke={key:4,class:'category-section'},Pe={class:'file-category'},qe={class:'file-name'},Je=['onChange'],Qe={key:5,class:'category-section'},Xe={class:'file-category'},Ye={class:'file-name'},Ze=['onChange'],et={key:6,class:'category-section'},tt={class:'file-category'},nt={class:'file-name'},at=['onChange'],lt={key:7,class:'category-section'},ot={class:'file-category'},ct={class:'step-actions'},st=['disabled'],it={class:'step-content'},rt={key:0,class:'model-settings'},mt={class:'settings-card'},ut={class:'setting-item'},dt={class:'setting-item'},pt={key:1,class:'settings-card'},ft={class:'step-actions'},vt={class:'step-content'},gt={class:'resource-settings-wrapper'},ht={class:'animation-settings'},yt={class:'setting-item'},kt=['value'],bt={class:'setting-item'},Nt=['value'],Et={class:'setting-item'},Vt={class:'text-mapping-section'},xt={class:'text-mapping-header'},Bt={class:'mapping-list'},wt={class:'mapping-inputs'},Ct={class:'text-tags-input-wrapper'},$t=['value','onBlur','onKeydown'],Mt={key:0,class:'text-tags'},St=['onClick'],_t=['onUpdate:modelValue'],Dt=['value'],jt=['onUpdate:modelValue'],Lt=['value'],Tt=['onClick'],Ut={class:'sprite-settings'},It={class:'sprite-header'},Rt={class:'sprite-name'},Ft={key:0,class:'character-name-badge'},At=['onClick'],Ot={class:'text-mapping-section compact'},Wt={class:'mapping-list'},Gt={class:'mapping-inputs'},Ht={class:'text-tags-input-wrapper'},zt=['value','onBlur','onKeydown'],Kt={key:0,class:'text-tags'},Pt=['onClick'],qt=['onClick'],Jt={class:'background-settings'},Qt={class:'resource-header'},Xt={class:'resource-name'},Yt=['onClick'],Zt={class:'text-mapping-section compact'},en={class:'mapping-list'},tn={class:'mapping-inputs'},nn={class:'text-tags-input-wrapper'},an=['value','onBlur','onKeydown'],ln={key:0,class:'text-tags'},on=['onClick'],cn=['onClick'],sn={class:'cg-settings'},rn={class:'resource-header'},mn={class:'resource-name'},un={class:'text-mapping-section'},dn={class:'mapping-list'},pn=['onUpdate:modelValue'],fn=['onClick'],vn=['onClick'],gn={class:'step-content'},hn={class:'completion-summary'},yn={class:'summary-details'},kn={class:'step-actions'},bn=['disabled'],Nn={key:0},En={key:1},Vn=(0,a.defineComponent)({__name:'ModelUploadWizard',emits:['close','complete'],setup(e,{emit:t}){const n=t,l=[{label:'上传文件'},{label:'分类文件'},{label:'模型设置'},{label:'资源设置'},{label:'完成'}],c=(0,a.ref)(0),s=(0,a.ref)(),u=(0,a.ref)([]),d=(0,a.ref)(''),p=(0,a.ref)(!1),f=(0,a.ref)(!1),v=(0,a.ref)(3),g=(0,a.ref)(''),h=(0,a.ref)(!1),y=(0,a.ref)({textures:[],moc3:null,model3:null,cdi3:null,motions:[],sprites:[],backgrounds:[],cgs:[],unclassifiedImages:[],others:[]}),b=(0,a.computed)(()=>y.value.moc3||y.value.model3),N=(0,a.computed)(()=>y.value.motions.filter(e=>'motion'===e.type).length),E=(0,a.computed)(()=>y.value.motions.filter(e=>'expression'===e.type).length),V=(0,a.computed)(()=>{const e=y.value.moc3||y.value.model3,t=y.value.sprites.length>0||y.value.backgrounds.length>0||y.value.cgs.length>0||y.value.textures.length>0,n=y.value.unclassifiedImages.length>0;return''!==d.value.trim()&&(e||t)&&!n});function x(){s.value?.click()}function w(e){const t=e.target,n=t.files;if(n&&n.length>0){const e=Array.from(n),t=new Set(u.value.map(e=>e.file.name)),a=e.filter(e=>!t.has(e.name));u.value.push(...a.map(e=>({file:e,sourceUrl:void 0}))),a.length<e.length&&o().info(`已跳过 ${e.length-a.length} 个重复文件`)}t.value=''}function C(e){const t=e.dataTransfer?.files;if(t&&t.length>0){const e=Array.from(t),n=new Set(u.value.map(e=>e.file.name)),a=e.filter(e=>!n.has(e.name));u.value.push(...a.map(e=>({file:e,sourceUrl:void 0}))),a.length<e.length&&o().info(`已跳过 ${e.length-a.length} 个重复文件`)}}function M(){u.value=[]}async function S(){const e=g.value.trim();if(e){h.value=!0;try{const t=e.split(/[,\n;]/).map(e=>e.trim()).filter(e=>e.length>0);if(1===t.length&&function(e){try{const t=new URL(e);return'github.com'===t.hostname||'raw.githubusercontent.com'===t.hostname||t.hostname.endsWith('.github.io')}catch{return!1}}(t[0]))try{return await async function(e){let t=e.trim();t.endsWith('/')||(t+='/');try{const e=new URL(t);if('github.com'===e.hostname){const n=e.pathname.split('/').filter(e=>e);if(n.length>=2){const[e,a,...l]=n;if(0===l.length||'tree'===l[0]||'blob'===l[0]){const n=l.length>2?l.slice(2).join('/')+'/':'';t=`https://${e}.github.io/${a}/${n.replace(/[^/]+\.(json|moc3|png)$/,'')}`}}}if('raw.githubusercontent.com'===e.hostname){const n=e.pathname.split('/').filter(e=>e);if(n.length>=3){const[e,a,l,...o]=n;if(o.length>0){(t.includes('.json')||t.includes('.moc3')||t.includes('.png'))&&o.pop();t=`https://${e}.github.io/${a}/${o.length>0?o.join('/')+'/':''}`}else t=`https://${e}.github.io/${a}/`}}}catch(e){console.warn('URL 规范化失败，使用原始 URL:',e)}o().info('正在解析GitHub仓库结构...');let n='',a='',l=!0;for(const e of r){for(const o of m){const c=new URL(t).pathname.split('/').filter(e=>e&&'models'!==e&&'model'!==e);if(c.length>0){const s=c[c.length-1].replace(/\/$/,''),i=`${t}${e}${s}.${o}`;try{if((await fetch(i,{method:'HEAD'})).ok){n=i,a=s,l='model3.json'===o;break}}catch{}}}if(n)break}if(!n)for(const e of['model','character','live2d']){for(const o of m){const c=`${t}${e}.${o}`;try{if((await fetch(c,{method:'HEAD'})).ok){n=c,a=e,l='model3.json'===o;break}}catch{}}if(n)break}if(!n)throw new Error('未能自动找到模型配置文件，请直接输入 model3.json 的完整URL');const c=await fetch(n);if(!c.ok)throw new Error(`无法加载模型配置文件: ${c.statusText}`);const s=await c.json(),i=n.substring(0,n.lastIndexOf('/')+1);if(!a||'model'===a){const e=s.FileReferences;if(e?.Moc){const t=e.Moc.match(/[\\/]([^\\/]+)\.moc3?$/);t&&(a=t[1])}a&&'model'!==a||(a=n.split('/').pop()?.replace(/\.(model3|model)\.json$/,'')||'unknown')}const d=[{url:n,filename:n.split('/').pop()||'model3.json'}],p=s.FileReferences;if(p){if(p.Moc){const e=p.Moc,t=e.startsWith('http')?e:new URL(e,i).href;d.push({url:t,filename:e.split('/').pop()||'model.moc3'})}if(Array.isArray(p.Textures))for(const e of p.Textures){const t=e.startsWith('http')?e:new URL(e,i).href;d.push({url:t,filename:e.split('/').pop()||'texture.png'})}if(p.DisplayInfo){const e=p.DisplayInfo,t=e.startsWith('http')?e:new URL(e,i).href;d.push({url:t,filename:e.split('/').pop()||'cdi3.json'})}if(l&&p.Groups&&Array.isArray(p.Groups)){const e=p.Groups;for(const t of e)if(Array.isArray(t.Files))for(const e of t.Files){const t=e.startsWith('http')?e:new URL(e,i).href;d.push({url:t,filename:e.split('/').pop()||'motion.json'})}else if(t.File&&'string'==typeof t.File){const e=t.File,n=e.startsWith('http')?e:new URL(e,i).href;d.push({url:n,filename:e.split('/').pop()||'motion.json'})}}}const f=new Set(u.value.map(e=>e.file.name));let v=0,h=0;for(const e of d)try{if(f.has(e.filename)){console.info(`已跳过重复文件: ${e.filename}`);continue}const t=await fetch(e.url);if(!t.ok){console.warn(`无法下载文件: ${e.url}`),h++;continue}const n=await t.blob(),a=new File([n],e.filename,{type:n.type});u.value.push({file:a,sourceUrl:e.url}),f.add(e.filename),v++}catch(t){console.warn(`下载文件失败 ${e.url}:`,t),h++}g.value='',v>0&&o().success(`成功从GitHub仓库导入 ${v} 个文件`);h>0&&o().warning(`导入失败 ${h} 个文件`);if(0===v)throw new Error('未能导入任何文件')}(t[0]),void(g.value='')}catch(e){console.warn('GitHub仓库解析失败，降级为普通URL导入:',e),o().info('GitHub仓库解析失败，尝试作为普通URL导入...')}const n=new Set(u.value.map(e=>e.file.name));let a=0,l=0;for(const e of t)try{const t=await fetch(e);if(!t.ok){console.error(`无法下载文件: ${e}`,t.statusText),l++;continue}const o=await t.blob();let c=e.split('/').pop()||'unknown';const s=t.headers.get('Content-Disposition');if(s){const e=s.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);e&&e[1]&&(c=e[1].replace(/['"]/g,''))}if(!c.match(/\.[a-z0-9]+$/i)){const e=t.headers.get('Content-Type');if(e){c+={'image/png':'.png','image/jpeg':'.jpg','image/jpg':'.jpg','application/json':'.json','application/octet-stream':'.moc3'}[e]||''}}if(n.has(c)){console.info(`已跳过重复文件: ${c}`);continue}const i=new File([o],c,{type:o.type});u.value.push({file:i,sourceUrl:e}),n.add(c),a++}catch(t){console.error(`导入URL失败: ${e}`,t),l++}g.value='',a>0&&o().success(`成功导入 ${a} 个文件`),l>0&&o().warning(`导入失败 ${l} 个文件，请检查URL是否正确`)}catch(e){console.error('URL导入失败:',e),o().error('URL导入失败，请检查网络连接和URL格式')}finally{h.value=!1}}else o().warning('请输入URL')}function D(e){const t=(e instanceof File?e.name:e.file.name).toLowerCase();return t.endsWith('.moc3')?'type-moc3':t.endsWith('.model3.json')?'type-model3':t.endsWith('.cdi3.json')?'type-cdi3':t.endsWith('.motion3.json')?'type-motion':t.match(/\.(png|jpg|jpeg)$/)?'type-image':'type-other'}function j(e){const t=(e instanceof File?e.name:e.file.name).toLowerCase();return t.endsWith('.moc3')?'MOC':t.endsWith('.model3.json')?'模型配置':t.endsWith('.cdi3.json')?'显示信息':t.endsWith('.motion3.json')?'动作/表情':t.match(/\.(png|jpg|jpeg)$/)?'图片':'其他'}async function L(){0!==u.value.length&&(await R(),c.value<l.length-1&&c.value++)}async function T(){if(0===c.value){if(0===u.value.length)return;await R()}c.value<l.length-1&&c.value++}function I(){c.value>0&&c.value--}async function R(){p.value=!0;try{if(!d.value){const e=u.value.find(e=>e.file.name.endsWith('.model3.json')||e.file.name.endsWith('.moc3'));if(e)d.value=e.file.name.replace(/\.(model3\.json|moc3)$/,'');else{const e=u.value[0];d.value=e&&e.file.name.replace(/\.[^.]*$/,'')||'新资源'}}const e=u.value.map(e=>{const t=e.file,n=t.name.toLowerCase();let a='other',l=!1;return n.endsWith('.moc3')?a='moc3':n.endsWith('.model3.json')?a='model3':n.endsWith('.cdi3.json')?a='cdi3':n.endsWith('.motion3.json')?(a=function(e){const t=e.toLowerCase(),n=[/_e\./i,/\.e\./i,/expression/i,/表情/i,/exp/i,/f\d+/i,/^expr/i],a=[/_m\./i,/\.m\./i,/motion/i,/动作/i,/mot/i,/idle/i,/tap/i,/touch/i];for(const e of n)if(e.test(t))return'expression';for(const e of a)if(e.test(t))return'motion';return'motion'}(t.name),l=!/_e\.|\.e\.|expression|表情|_m\.|\.m\.|motion|动作/i.test(t.name)):n.match(/\.(png|jpg|jpeg)$/)&&(a='unclassified_image'),{name:t.name,file:t,sourceUrl:e.sourceUrl,type:a,canToggle:l,characterName:undefined}});y.value={textures:[],moc3:e.find(e=>'moc3'===e.type)||null,model3:e.find(e=>'model3'===e.type)||null,cdi3:e.find(e=>'cdi3'===e.type)||null,motions:e.filter(e=>'motion'===e.type||'expression'===e.type),sprites:[],backgrounds:[],cgs:[],unclassifiedImages:e.filter(e=>'unclassified_image'===e.type),others:e.filter(e=>'other'===e.type)},Q.value=y.value.sprites.map(e=>({name:e.name,file:e.file,characterName:e.characterName,textMappings:[]})),X.value=y.value.backgrounds.map(e=>({name:e.name,file:e.file,textMappings:[]})),Y.value=y.value.cgs.map(e=>({name:e.name,file:e.file,textMappings:[]}))}catch(e){console.error('分类文件失败:',e),o().error('分类文件失败')}finally{p.value=!1}}function F(e,t,n){if(n===e)return;let a,l;if('sprite'===e){if(l=y.value.sprites.findIndex(e=>e.name===t),-1!==l){a=y.value.sprites[l],y.value.sprites.splice(l,1);const e=Q.value.findIndex(e=>e.name===t);e>=0&&Q.value.splice(e,1)}}else if('background'===e){if(l=y.value.backgrounds.findIndex(e=>e.name===t),-1!==l){a=y.value.backgrounds[l],y.value.backgrounds.splice(l,1);const e=X.value.findIndex(e=>e.name===t);e>=0&&X.value.splice(e,1)}}else if('cg'===e){if(l=y.value.cgs.findIndex(e=>e.name===t),-1!==l){a=y.value.cgs[l],y.value.cgs.splice(l,1);const e=Y.value.findIndex(e=>e.name===t);e>=0&&Y.value.splice(e,1)}}else'texture'===e&&(l=y.value.textures.findIndex(e=>e.name===t),-1!==l&&(a=y.value.textures[l],y.value.textures.splice(l,1)));if(a)if(a.type='unclassified_image',a.characterName&&'sprite'!==n&&(a.characterName=void 0),'unclassified'===n)y.value.unclassifiedImages.push(a),o().info(`已将 "${a.name}" 移回待分类`);else{if(a.type=n,'sprite'===n){const e=a.name.match(/([^_/\\]+?)[_-]?(sprite|立绘|stand|portrait)/i);e&&e[1]&&(a.characterName=e[1])}'sprite'===n?(y.value.sprites.push(a),Q.value.push({name:a.name,file:a.file,characterName:a.characterName,textMappings:[]})):'background'===n?(y.value.backgrounds.push(a),X.value.push({name:a.name,file:a.file,textMappings:[]})):'cg'===n?(y.value.cgs.push(a),Y.value.push({name:a.name,file:a.file,textMappings:[]})):'texture'===n&&y.value.textures.push(a),o().success(`已将 "${a.name}" 重新分类为${'sprite'===n?'立绘':'background'===n?'背景':'cg'===n?'CG':'纹理'}`)}else console.warn(`未找到文件: ${t} 在分类 ${e} 中`)}const A=(0,a.ref)('none'),O=(0,a.ref)('none'),W=(0,a.ref)(!0),G=(0,a.ref)([]),H=(0,a.computed)(()=>y.value.motions.filter(e=>'motion'===e.type).map(e=>({name:ee(e.name),file:e.file}))),K=(0,a.computed)(()=>y.value.motions.filter(e=>'expression'===e.type).map(e=>({name:ee(e.name),file:e.file})));function P(){G.value.push({text:'',textTags:[],expression:'none',motion:'none'})}function q(e){return e.split(';').map(e=>e.trim()).filter(e=>e.length>0)}const Q=(0,a.ref)([]),X=(0,a.ref)([]),Y=(0,a.ref)([]);async function Z(){if(!V.value)return void o().warning('请先完成所有必填项');f.value=!0;const e=[],t=[];let a=0,l=0;try{o().info('正在保存文件并创建世界书条目...');const c=[];for(const e of y.value.textures)try{if(e.sourceUrl)c.push({type:'texture',filename:e.file.name,url:e.sourceUrl}),a++;else{const t=await te(d.value,e.file.name,e.file);c.push({type:'texture',fileId:t,filename:e.file.name}),a++}}catch(n){const a=n instanceof Error?n.message:String(n);t.push(`纹理文件 "${e.file.name}": ${a}`),console.error(`存储纹理文件失败: ${e.file.name}`,n),l++}if(y.value.moc3)try{if(y.value.moc3.sourceUrl)c.push({type:'moc3',filename:y.value.moc3.file.name,url:y.value.moc3.sourceUrl}),a++;else{const e=await te(d.value,y.value.moc3.file.name,y.value.moc3.file);c.push({type:'moc3',fileId:e,filename:y.value.moc3.file.name}),a++}}catch(e){const n=e instanceof Error?e.message:String(e);t.push(`模型文件 "${y.value.moc3.file.name}": ${n}`),console.error(`存储 moc3 文件失败: ${y.value.moc3.file.name}`,e),l++}if(y.value.model3)try{if(y.value.model3.sourceUrl)c.push({type:'model3',filename:y.value.model3.file.name,url:y.value.model3.sourceUrl}),a++;else{const e=await te(d.value,y.value.model3.file.name,y.value.model3.file);c.push({type:'model3',fileId:e,filename:y.value.model3.file.name}),a++}}catch(e){const n=e instanceof Error?e.message:String(e);t.push(`模型文件 "${y.value.model3.file.name}": ${n}`),console.error(`存储 model3 文件失败: ${y.value.model3.file.name}`,e),l++}if(y.value.cdi3)try{if(y.value.cdi3.sourceUrl)c.push({type:'cdi3',filename:y.value.cdi3.file.name,url:y.value.cdi3.sourceUrl}),a++;else{const e=await te(d.value,y.value.cdi3.file.name,y.value.cdi3.file);c.push({type:'cdi3',fileId:e,filename:y.value.cdi3.file.name}),a++}}catch(e){const n=e instanceof Error?e.message:String(e);t.push(`显示信息文件 "${y.value.cdi3.file.name}": ${n}`),console.error(`存储 cdi3 文件失败: ${y.value.cdi3.file.name}`,e),l++}const s=[];for(const e of y.value.motions.filter(e=>'motion'===e.type||'expression'===e.type))try{if(e.sourceUrl)s.push({name:ee(e.name),filename:e.file.name,url:e.sourceUrl,type:e.type}),a++;else{const t=await te(d.value,e.file.name,e.file);s.push({name:ee(e.name),fileId:t,filename:e.file.name,type:e.type}),a++}}catch(n){const a=n instanceof Error?n.message:String(n);t.push(`${'motion'===e.type?'动作':'表情'}文件 "${e.file.name}": ${a}`),console.error(`存储动作文件失败: ${e.file.name}`,n),l++}const r=new Map;for(const e of Q.value)try{const t=y.value.sprites.find(t=>t.name===e.name),n=e.characterName||'default';r.has(n)||r.set(n,[]);const l=(e.textMappings||[]).map(e=>e.text.trim()).filter(e=>e.length>0);if(t?.sourceUrl)r.get(n).push({name:e.name,filename:e.file.name,url:t.sourceUrl,textMappings:l}),a++;else{const t=await te(d.value,e.file.name,e.file);r.get(n).push({name:e.name,fileId:t,filename:e.file.name,textMappings:l}),a++}}catch(n){const a=n instanceof Error?n.message:String(n);t.push(`立绘文件 "${e.file.name}": ${a}`),console.error(`存储立绘文件失败: ${e.file.name}`,n),l++}const m=[];for(const e of X.value)try{const t=y.value.backgrounds.find(t=>t.name===e.name),n=(e.textMappings||[]).map(e=>e.text.trim()).filter(e=>e.length>0);if(t?.sourceUrl)m.push({name:e.name,filename:e.file.name,url:t.sourceUrl,textMappings:n}),a++;else{const t=await te(d.value,e.file.name,e.file);m.push({name:e.name,fileId:t,filename:e.file.name,textMappings:n}),a++}}catch(n){const a=n instanceof Error?n.message:String(n);t.push(`背景文件 "${e.file.name}": ${a}`),console.error(`存储背景文件失败: ${e.file.name}`,n),l++}const u=[];for(const e of Y.value)try{const t=y.value.cgs.find(t=>t.name===e.name),n=(e.textMappings||[]).map(e=>e.text.trim()).filter(e=>e.length>0);if(t?.sourceUrl)u.push({name:e.name,filename:e.file.name,url:t.sourceUrl,textMappings:n}),a++;else{const t=await te(d.value,e.file.name,e.file);u.push({name:e.name,fileId:t,filename:e.file.name,textMappings:n}),a++}}catch(n){const a=n instanceof Error?n.message:String(n);t.push(`CG文件 "${e.file.name}": ${a}`),console.error(`存储CG文件失败: ${e.file.name}`,n),l++}const p=[];if(c.some(e=>'model3'===e.type||'moc3'===e.type))try{const e=c.find(e=>'model3'===e.type),t=c.find(e=>'moc3'===e.type),n=c.find(e=>'cdi3'===e.type),a=c.filter(e=>'texture'===e.type),l=s.filter(e=>'motion'===e.type).map(e=>({name:e.name,file:e.url||`indexeddb://${d.value}/${e.filename}`,group:'default'})),o=s.filter(e=>'expression'===e.type).map(e=>({name:e.name,file:e.url||`indexeddb://${d.value}/${e.filename}`})),i={};A.value&&'none'!==A.value&&(i.expression=A.value),O.value&&'none'!==O.value&&(i.motion=O.value,i.autoLoop=W.value);const r={},m={},u={};for(const e of G.value){const t=e.text.trim();if(t){if(e.expression&&'none'!==e.expression){const n=o.find(t=>t.name===e.expression);if(n){m[n.file.split('/').pop()||`${e.expression}.exp3.json`]=t}}if(e.motion&&'none'!==e.motion){const n=l.find(t=>t.name===e.motion);if(n){u[n.file.split('/').pop()||`${e.motion}.motion3.json`]=t}}}}Object.keys(m).length>0&&(r.expression=m),Object.keys(u).length>0&&(r.motion=u);const f=function(e,t){return{name:`[模型资源] ${e}`,enabled:!0,strategy:{type:'selective',keys:[`__MODEL_RESOURCE_${e}_${Date.now()}__`],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'after_character_definition',role:'system',depth:0,order:0},content:`\`\`\`json\n${JSON.stringify(t,null,2)}\n\`\`\`\n`,probability:100,recursion:{prevent_incoming:!0,prevent_outgoing:!0,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}}}(d.value,{type:'live2d_model',modelName:d.value,files:{model3:e?e.url||`indexeddb://${d.value}/${e.filename}`:void 0,moc3:t?t.url||`indexeddb://${d.value}/${t.filename}`:void 0,textures:a.map(e=>e.url||`indexeddb://${d.value}/${e.filename}`),cdi3:n?n.url||`indexeddb://${d.value}/${n.filename}`:void 0},motions:l,expressions:o,defaultAnimation:Object.keys(i).length>0?i:void 0,textMappings:Object.keys(r).length>0?r:void 0});p.push(f)}catch(e){const n=e instanceof Error?e.message:String(e);t.push(`创建模型资源世界书条目失败: ${n}`),console.error('创建模型资源世界书条目失败:',e)}for(const[e,t]of r.entries())if(t.length>0){const n=ne('default'===e?'':e,{type:'sprite',characterName:'default'===e?void 0:e,sprites:t.map(t=>({name:t.name,file:t.url?t.url:e&&'default'!==e?`indexeddb://${e}/${t.filename}`:`indexeddb://${d.value}/${t.filename}`,textMappings:t.textMappings.length>0?t.textMappings:void 0}))});p.push(n)}if(m.length>0){const e=function(e){const t=['背景','场景'];for(const n of e.backgrounds)n.textMappings&&t.push(...n.textMappings),t.push(n.name);return{name:'[背景资源]',enabled:!0,strategy:{type:'selective',keys:[...new Set(t)],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'after_character_definition',role:'system',depth:0,order:2},content:`\`\`\`json\n${JSON.stringify(e,null,2)}\n\`\`\`\n`,probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}}}({type:'background',backgrounds:m.map(e=>({name:e.name,file:e.url||`indexeddb://backgrounds/${e.filename}`,textMappings:e.textMappings.length>0?e.textMappings:void 0}))});p.push(e)}if(u.length>0){const e=function(e){const t=['CG','cg'];for(const n of e.cgs)n.textMappings&&t.push(...n.textMappings),t.push(n.name);return{name:'[CG资源]',enabled:!0,strategy:{type:'selective',keys:[...new Set(t)],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'after_character_definition',role:'system',depth:0,order:3},content:`\`\`\`json\n${JSON.stringify(e,null,2)}\n\`\`\`\n`,probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}}}({type:'cg',cgs:u.map(e=>({name:e.name,file:e.url||`indexeddb://cgs/${e.filename}`,textMappings:e.textMappings.length>0?e.textMappings:void 0}))});p.push(e)}if(p.length>0)try{let e=null;try{const t=getCharWorldbookNames('current');e=t.primary||t.additional[0]||null}catch(e){console.warn('获取角色卡世界书失败，使用默认世界书:',e)}e||(e=i);try{await getWorldbook(e)}catch{try{await createWorldbook(e,[])}catch(t){if(console.warn(`创建世界书 ${e} 失败:`,t),e===i)throw t;e=i;try{await getWorldbook(i)}catch{await createWorldbook(i,[])}}}await createWorldbookEntries(e,p),console.info(`已在世界书 ${e} 中创建 ${p.length} 个资源世界书条目`)}catch(e){const n=e instanceof Error?e.message:String(e);t.push(`创建资源世界书条目失败: ${n}`),console.error('创建资源世界书条目失败:',e),o().warning('创建资源世界书条目时出现问题，但文件已保存')}const v={name:d.value,files:c.map(e=>({type:e.type,url:e.url||'',filename:e.filename,fileId:e.fileId,isLocal:!e.url})),motions:s.map(e=>({name:e.name,url:e.url||'',type:e.type,fileId:e.fileId,isLocal:!e.url}))};for(const t of e)try{URL.revokeObjectURL(t)}catch(e){console.warn('清理 Object URL 失败:',e)}const g=Q.value.length+X.value.length+Y.value.length,h=g>0?`，包含 ${g} 个资源文件`:'';if(0===l)o().success(`模型 "${d.value}" 已成功创建世界书条目并保存文件${h}`);else{if(!(a>0))return o().error('保存失败：所有文件都未能成功保存'),t.length>0&&(console.group('文件保存错误详情'),t.forEach((e,t)=>{console.error(`${t+1}. ${e}`)}),console.groupEnd()),void(f.value=!1);o().warning(`模型 "${d.value}" 已部分完成：成功 ${a} 个，失败 ${l} 个${h}`),t.length>0&&(console.group('文件保存错误详情'),t.forEach((e,t)=>{console.error(`${t+1}. ${e}`)}),console.groupEnd())}setTimeout(()=>{n('complete',v)},500)}catch(n){for(const t of e)try{URL.revokeObjectURL(t)}catch(e){console.warn('清理 Object URL 失败:',e)}const a=n instanceof Error?n.message:String(n);console.error('创建世界书条目失败:',n),o().error(`创建世界书条目失败: ${a}`),t.length>0&&(console.group('错误详情'),t.forEach((e,t)=>{console.error(`${t+1}. ${e}`)}),console.groupEnd())}finally{f.value=!1}}function ee(e){return e.replace(/\.motion3?\.json$/i,'').replace(/^\d+_/,'').replace(/_m$/i,'').replace(/_e$/i,'').replace(/_motion$/i,'').replace(/_expression$/i,'')}return(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',ae,[(0,a.createVNode)((0,a.unref)(wn),{title:'游戏设置',onBack:t[0]||(t[0]=t=>e.$emit('close'))},{default:(0,a.withCtx)(()=>[(0,a.createVNode)((0,a.unref)(J))]),_:1}),(0,a.createCommentVNode)(' 步骤指示器 '),(0,a.createElementVNode)('div',le,[((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(l,(e,t)=>(0,a.createElementVNode)('div',{key:t,class:(0,a.normalizeClass)(['step-item',{active:c.value===t,completed:c.value>t}])},[(0,a.createElementVNode)('div',oe,(0,a.toDisplayString)(t+1),1),(0,a.createElementVNode)('div',ce,(0,a.toDisplayString)(e.label),1)],2)),64))]),(0,a.createCommentVNode)(' 步骤1: 上传文件 '),(0,a.withDirectives)((0,a.createElementVNode)('div',se,[(0,a.createCommentVNode)(' 统一显示所有已上传文件列表 '),u.value.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',ie,[(0,a.createElementVNode)('div',re,[(0,a.createElementVNode)('p',null,[(0,a.createTextVNode)(' 已选择 '+(0,a.toDisplayString)(u.value.length)+' 个文件（可混合使用本地文件和URL导入） ',1),u.value.some(e=>e.sourceUrl)?((0,a.openBlock)(),(0,a.createElementBlock)('span',me,' - '+(0,a.toDisplayString)(u.value.filter(e=>e.sourceUrl).length)+' 个来自URL ',1)):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-sm',onClick:M},'清空')]),(0,a.createElementVNode)('div',ue,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(u.value,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:`${e.file.name}-${t}`,class:'file-item'},[(0,a.createElementVNode)('span',de,(0,a.toDisplayString)(e.file.name),1),e.sourceUrl?((0,a.openBlock)(),(0,a.createElementBlock)('span',pe,'URL')):(0,a.createCommentVNode)('v-if',!0),(0,a.createElementVNode)('span',{class:(0,a.normalizeClass)(['file-type-badge',D(e.file)])},(0,a.toDisplayString)(j(e.file)),3),(0,a.createElementVNode)('button',{class:'remove-file-btn',title:'移除',onClick:(0,a.withModifiers)(e=>function(e){u.value.splice(e,1)}(t),['stop'])},[(0,a.createVNode)((0,a.unref)(U),{class:'icon-sm'})],8,fe)]))),128))])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 上传方式：本地文件和URL导入并排显示 '),(0,a.createElementVNode)('div',ve,[(0,a.createCommentVNode)(' 本地文件上传 '),(0,a.createElementVNode)('div',ge,[t[13]||(t[13]=(0,a.createElementVNode)('h3',{class:'method-title'},'本地文件上传',-1)),(0,a.createElementVNode)('div',{class:'upload-area',onClick:x,onDragover:t[1]||(t[1]=(0,a.withModifiers)(()=>{},['prevent'])),onDrop:(0,a.withModifiers)(C,['prevent'])},[(0,a.createElementVNode)('input',{ref_key:'fileInputRef',ref:s,type:'file',class:'hidden-input',accept:'.png,.jpg,.jpeg,.moc3,.model3.json,.cdi3.json,.motion3.json,.physics3.json',multiple:'',onChange:w},null,544),(0,a.createElementVNode)('div',he,[(0,a.createElementVNode)('div',ye,[(0,a.createVNode)((0,a.unref)(J),{class:'icon-lg'}),t[10]||(t[10]=(0,a.createElementVNode)('p',null,'点击或拖拽文件到这里上传',-1)),t[11]||(t[11]=(0,a.createElementVNode)('p',{class:'hint'},'支持模型文件（.moc3, .model3.json等）',-1)),t[12]||(t[12]=(0,a.createElementVNode)('p',{class:'hint'},'支持图片文件（.png, .jpg等）',-1))])])],32)]),(0,a.createCommentVNode)(' URL导入 '),(0,a.createElementVNode)('div',ke,[t[17]||(t[17]=(0,a.createElementVNode)('h3',{class:'method-title'},'URL导入',-1)),(0,a.createElementVNode)('div',be,[(0,a.createElementVNode)('div',Ne,[(0,a.withDirectives)((0,a.createElementVNode)('input',{'onUpdate:modelValue':t[2]||(t[2]=e=>g.value=e),type:'text',class:'url-input',placeholder:'请输入文件URL（支持图片和模型文件）',onKeyup:(0,a.withKeys)(S,['enter'])},null,544),[[a.vModelText,g.value]]),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-primary',disabled:!g.value.trim()||h.value,onClick:S},(0,a.toDisplayString)(h.value?'导入中...':'导入'),9,Ee)]),t[14]||(t[14]=(0,a.createElementVNode)('p',{class:'hint'},'可以输入多个URL，每行一个，或使用逗号/分号分隔',-1)),t[15]||(t[15]=(0,a.createElementVNode)('p',{class:'hint'},'支持 GitHub 仓库，自动解析文件结构',-1)),t[16]||(t[16]=(0,a.createElementVNode)('p',{class:'hint'},'导入的文件会与本地文件合并显示',-1))])])]),(0,a.createElementVNode)('div',Ve,[(0,a.createElementVNode)('button',{class:'bubble-btn',onClick:t[3]||(t[3]=t=>e.$emit('close'))},'取消'),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-primary',disabled:0===u.value.length,onClick:L},' 完成上传并分类文件 ',8,xe)])],512),[[a.vShow,0===c.value]]),(0,a.createCommentVNode)(' 步骤2: 分类和确认 '),(0,a.withDirectives)((0,a.createElementVNode)('div',Be,[p.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',we,[...t[18]||(t[18]=[(0,a.createElementVNode)('p',null,'正在自动分类文件...',-1)])])):((0,a.openBlock)(),(0,a.createElementBlock)('div',Ce,[(0,a.createCommentVNode)(' 资源名称输入 '),(0,a.createElementVNode)('div',$e,[t[19]||(t[19]=(0,a.createElementVNode)('h3',null,'资源名称',-1)),(0,a.withDirectives)((0,a.createElementVNode)('input',{'onUpdate:modelValue':t[4]||(t[4]=e=>d.value=e),type:'text',placeholder:'请输入资源名称',class:'model-name-input'},null,512),[[a.vModelText,d.value]]),t[20]||(t[20]=(0,a.createElementVNode)('p',{class:'hint'},'资源名称将用于世界书条目和配置（可以是模型名、角色名等）',-1))]),(0,a.createCommentVNode)(' 文件分类显示 '),(0,a.createElementVNode)('div',Me,[(0,a.createCommentVNode)(' 模型文件 '),y.value.moc3||y.value.model3?((0,a.openBlock)(),(0,a.createElementBlock)('div',Se,[t[21]||(t[21]=(0,a.createElementVNode)('h3',null,'模型文件',-1)),(0,a.createElementVNode)('div',_e,[y.value.model3?((0,a.openBlock)(),(0,a.createElementBlock)('div',De,[(0,a.createVNode)((0,a.unref)(B),{class:'icon-sm'}),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(y.value.model3.name),1)])):(0,a.createCommentVNode)('v-if',!0),y.value.moc3?((0,a.openBlock)(),(0,a.createElementBlock)('div',je,[(0,a.createVNode)((0,a.unref)(B),{class:'icon-sm'}),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(y.value.moc3.name),1)])):(0,a.createCommentVNode)('v-if',!0)])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 纹理文件 '),y.value.textures.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',Le,[(0,a.createElementVNode)('h3',null,'纹理文件 ('+(0,a.toDisplayString)(y.value.textures.length)+')',1),(0,a.createElementVNode)('div',Te,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(y.value.textures,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.name,class:'category-item category-item-with-select'},[(0,a.createVNode)((0,a.unref)(B),{class:'icon-sm'}),(0,a.createElementVNode)('span',Ue,(0,a.toDisplayString)(e.name),1),(0,a.createElementVNode)('select',{value:'texture',class:'classify-select',onChange:t=>F('texture',e.name,t.target.value)},[...t[22]||(t[22]=[(0,a.createStaticVNode)('<option value="texture" data-v-92ad8c6e>纹理</option><option value="sprite" data-v-92ad8c6e>立绘</option><option value="background" data-v-92ad8c6e>背景</option><option value="cg" data-v-92ad8c6e>CG</option><option value="unclassified" data-v-92ad8c6e>待分类</option>',5)])],40,Ie)]))),128))])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 动作文件 '),y.value.motions.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',Re,[(0,a.createElementVNode)('h3',null,'动作文件 ('+(0,a.toDisplayString)(y.value.motions.length)+')',1),(0,a.createElementVNode)('div',Fe,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(y.value.motions,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.name,class:'category-item'},[(0,a.createVNode)((0,a.unref)(B),{class:'icon-sm'}),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(e.name),1),e.canToggle?((0,a.openBlock)(),(0,a.createElementBlock)('button',{key:0,class:'toggle-type-btn',onClick:t=>function(e){'motion'===e.type?e.type='expression':e.type='motion'}(e)},(0,a.toDisplayString)('motion'===e.type?'改为表情':'改为动作'),9,Ae)):(0,a.createCommentVNode)('v-if',!0)]))),128))])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 立绘文件 '),y.value.sprites.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',Oe,[(0,a.createElementVNode)('h3',null,'角色立绘 ('+(0,a.toDisplayString)(y.value.sprites.length)+')',1),(0,a.createElementVNode)('div',We,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(y.value.sprites,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.name,class:'category-item category-item-with-select'},[(0,a.createVNode)((0,a.unref)(B),{class:'icon-sm'}),(0,a.createElementVNode)('span',Ge,(0,a.toDisplayString)(e.name),1),e.characterName?((0,a.openBlock)(),(0,a.createElementBlock)('span',He,(0,a.toDisplayString)(e.characterName),1)):(0,a.createCommentVNode)('v-if',!0),(0,a.createElementVNode)('select',{value:'sprite',class:'classify-select',onChange:t=>F('sprite',e.name,t.target.value)},[...t[23]||(t[23]=[(0,a.createStaticVNode)('<option value="sprite" data-v-92ad8c6e>立绘</option><option value="background" data-v-92ad8c6e>背景</option><option value="cg" data-v-92ad8c6e>CG</option><option value="texture" data-v-92ad8c6e>纹理</option><option value="unclassified" data-v-92ad8c6e>待分类</option>',5)])],40,ze)]))),128))])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 背景文件 '),y.value.backgrounds.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',Ke,[(0,a.createElementVNode)('h3',null,'背景 ('+(0,a.toDisplayString)(y.value.backgrounds.length)+')',1),(0,a.createElementVNode)('div',Pe,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(y.value.backgrounds,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.name,class:'category-item category-item-with-select'},[(0,a.createVNode)((0,a.unref)(B),{class:'icon-sm'}),(0,a.createElementVNode)('span',qe,(0,a.toDisplayString)(e.name),1),(0,a.createElementVNode)('select',{value:'background',class:'classify-select',onChange:t=>F('background',e.name,t.target.value)},[...t[24]||(t[24]=[(0,a.createStaticVNode)('<option value="background" data-v-92ad8c6e>背景</option><option value="sprite" data-v-92ad8c6e>立绘</option><option value="cg" data-v-92ad8c6e>CG</option><option value="texture" data-v-92ad8c6e>纹理</option><option value="unclassified" data-v-92ad8c6e>待分类</option>',5)])],40,Je)]))),128))])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' CG文件 '),y.value.cgs.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',Qe,[(0,a.createElementVNode)('h3',null,'CG ('+(0,a.toDisplayString)(y.value.cgs.length)+')',1),(0,a.createElementVNode)('div',Xe,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(y.value.cgs,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.name,class:'category-item category-item-with-select'},[(0,a.createVNode)((0,a.unref)(B),{class:'icon-sm'}),(0,a.createElementVNode)('span',Ye,(0,a.toDisplayString)(e.name),1),(0,a.createElementVNode)('select',{value:'cg',class:'classify-select',onChange:t=>F('cg',e.name,t.target.value)},[...t[25]||(t[25]=[(0,a.createStaticVNode)('<option value="cg" data-v-92ad8c6e>CG</option><option value="sprite" data-v-92ad8c6e>立绘</option><option value="background" data-v-92ad8c6e>背景</option><option value="texture" data-v-92ad8c6e>纹理</option><option value="unclassified" data-v-92ad8c6e>待分类</option>',5)])],40,Ze)]))),128))])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 待分类图片 '),y.value.unclassifiedImages.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',et,[(0,a.createElementVNode)('h3',null,'待分类图片 ('+(0,a.toDisplayString)(y.value.unclassifiedImages.length)+')',1),t[27]||(t[27]=(0,a.createElementVNode)('p',{class:'hint'},'点击选择框将图片分类为立绘、背景、CG或纹理',-1)),(0,a.createElementVNode)('div',tt,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(y.value.unclassifiedImages,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.name,class:'category-item category-item-with-select'},[(0,a.createVNode)((0,a.unref)(B),{class:'icon-sm'}),(0,a.createElementVNode)('span',nt,(0,a.toDisplayString)(e.name),1),(0,a.createElementVNode)('select',{value:'',class:'classify-select',onChange:t=>function(e,t){const n=y.value.unclassifiedImages.findIndex(t=>t.name===e);if(-1===n)return void console.warn(`未找到文件: ${e}`);const a=y.value.unclassifiedImages[n];if(a){if(y.value.unclassifiedImages.splice(n,1),a.type=t,'sprite'===t){const e=a.name.match(/([^_/\\]+?)[_-]?(sprite|立绘|stand|portrait)/i);e&&e[1]&&(a.characterName=e[1])}'sprite'===t?(y.value.sprites.push(a),Q.value.push({name:a.name,file:a.file,characterName:a.characterName,textMappings:[]})):'background'===t?(y.value.backgrounds.push(a),X.value.push({name:a.name,file:a.file,textMappings:[]})):'cg'===t?(y.value.cgs.push(a),Y.value.push({name:a.name,file:a.file,textMappings:[]})):'texture'===t&&y.value.textures.push(a),o().success(`已将 "${a.name}" 分类为${'sprite'===t?'立绘':'background'===t?'背景':'cg'===t?'CG':'纹理'}`)}}(e.name,t.target.value)},[...t[26]||(t[26]=[(0,a.createStaticVNode)('<option value="" disabled data-v-92ad8c6e>选择分类...</option><option value="sprite" data-v-92ad8c6e>立绘</option><option value="background" data-v-92ad8c6e>背景</option><option value="cg" data-v-92ad8c6e>CG</option><option value="texture" data-v-92ad8c6e>纹理</option>',5)])],40,at)]))),128))])])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 其他文件 '),y.value.others.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',lt,[(0,a.createElementVNode)('h3',null,'其他文件 ('+(0,a.toDisplayString)(y.value.others.length)+')',1),(0,a.createElementVNode)('div',ot,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(y.value.others,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.name,class:'category-item'},[(0,a.createVNode)((0,a.unref)(B),{class:'icon-sm'}),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(e.name),1)]))),128))])])):(0,a.createCommentVNode)('v-if',!0)])])),(0,a.createElementVNode)('div',ct,[(0,a.createElementVNode)('button',{class:'bubble-btn',onClick:I},'上一步'),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-primary',disabled:!V.value,onClick:T},'下一步',8,st)])],512),[[a.vShow,1===c.value]]),(0,a.createCommentVNode)(' 步骤3: 模型设置（可选，只在有模型时显示） '),(0,a.withDirectives)((0,a.createElementVNode)('div',it,[b.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',rt,[(0,a.createElementVNode)('div',mt,[t[31]||(t[31]=(0,a.createElementVNode)('h3',null,'模型设置',-1)),(0,a.createElementVNode)('div',ut,[t[28]||(t[28]=(0,a.createElementVNode)('label',null,'模型名称',-1)),(0,a.withDirectives)((0,a.createElementVNode)('input',{'onUpdate:modelValue':t[5]||(t[5]=e=>d.value=e),type:'text'},null,512),[[a.vModelText,d.value]])]),(0,a.createElementVNode)('div',dt,[t[30]||(t[30]=(0,a.createElementVNode)('label',null,'模型版本',-1)),(0,a.withDirectives)((0,a.createElementVNode)('select',{'onUpdate:modelValue':t[6]||(t[6]=e=>v.value=e)},[...t[29]||(t[29]=[(0,a.createElementVNode)('option',{value:3},'3 (model3.json)',-1),(0,a.createElementVNode)('option',{value:2},'2 (model.json)',-1)])],512),[[a.vModelSelect,v.value]])])])])):((0,a.openBlock)(),(0,a.createElementBlock)('div',pt,[...t[32]||(t[32]=[(0,a.createElementVNode)('p',{class:'hint'},'未检测到模型文件，将跳过此步骤',-1)])])),(0,a.createElementVNode)('div',ft,[(0,a.createElementVNode)('button',{class:'bubble-btn',onClick:I},'上一步'),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-primary',onClick:T},(0,a.toDisplayString)(b.value?'下一步：资源设置':'下一步'),1)])],512),[[a.vShow,2===c.value]]),(0,a.createCommentVNode)(' 步骤4: 资源设置（折叠界面） '),(0,a.withDirectives)((0,a.createElementVNode)('div',vt,[(0,a.createElementVNode)('div',gt,[(0,a.createCommentVNode)(' 动画和表情设置 '),b.value&&(N.value>0||E.value>0)?((0,a.openBlock)(),(0,a.createBlock)((0,a.unref)(k),{key:0,title:'动画和表情设置',badge:`${N.value+E.value}`,'default-expanded':!0},{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)('div',ht,[(0,a.createElementVNode)('div',yt,[t[34]||(t[34]=(0,a.createElementVNode)('label',null,'默认表情',-1)),(0,a.withDirectives)((0,a.createElementVNode)('select',{'onUpdate:modelValue':t[7]||(t[7]=e=>A.value=e),class:'select-with-scroll'},[t[33]||(t[33]=(0,a.createElementVNode)('option',{value:'none'},'无',-1)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(K.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)('option',{key:e.name,value:e.name},(0,a.toDisplayString)(e.name),9,kt))),128))],512),[[a.vModelSelect,A.value]])]),(0,a.createElementVNode)('div',bt,[t[36]||(t[36]=(0,a.createElementVNode)('label',null,'默认动作（Idle）',-1)),(0,a.withDirectives)((0,a.createElementVNode)('select',{'onUpdate:modelValue':t[8]||(t[8]=e=>O.value=e),class:'select-with-scroll'},[t[35]||(t[35]=(0,a.createElementVNode)('option',{value:'none'},'无',-1)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(H.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)('option',{key:e.name,value:e.name},(0,a.toDisplayString)(e.name),9,Nt))),128))],512),[[a.vModelSelect,O.value]])]),(0,a.createElementVNode)('div',Et,[(0,a.createElementVNode)('label',null,[(0,a.withDirectives)((0,a.createElementVNode)('input',{'onUpdate:modelValue':t[9]||(t[9]=e=>W.value=e),type:'checkbox'},null,512),[[a.vModelCheckbox,W.value]]),t[37]||(t[37]=(0,a.createTextVNode)(' 自动循环默认动作 ',-1))]),t[38]||(t[38]=(0,a.createElementVNode)('p',{class:'hint'},'当没有检测到特定文本时，将自动循环播放默认动作',-1))]),(0,a.createCommentVNode)(' 文本到动作/表情映射 '),(0,a.createElementVNode)('div',Vt,[(0,a.createElementVNode)('div',xt,[t[40]||(t[40]=(0,a.createElementVNode)('h4',null,'文本映射',-1)),t[41]||(t[41]=(0,a.createElementVNode)('p',{class:'hint'},'当检测到特定文本时，自动播放对应的动作和表情（多个文本用分号分隔）',-1)),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-sm add-mapping-btn',onClick:P},[(0,a.createVNode)((0,a.unref)(J),{class:'icon-sm'}),t[39]||(t[39]=(0,a.createTextVNode)(' 添加映射 ',-1))])]),(0,a.createElementVNode)('div',Bt,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(G.value,(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:n,class:'mapping-item'},[(0,a.createElementVNode)('div',wt,[(0,a.createElementVNode)('div',Ct,[(0,a.createElementVNode)('input',{value:e.text,type:'text',placeholder:'输入触发文本，多个用分号(;)分隔',class:'mapping-text-input tags-input',onBlur:e=>function(e,t){const n=q(t.target.value.trim());G.value[e].text=n.join(';'),G.value[e].textTags=n}(n,e),onKeydown:(0,a.withKeys)(e=>{return(t=e).preventDefault(),void t.target.blur();var t},['enter'])},null,40,$t),e.textTags&&e.textTags.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',Mt,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.textTags,(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:t,class:'text-tag'},[(0,a.createTextVNode)((0,a.toDisplayString)(e)+' ',1),(0,a.createElementVNode)('button',{class:'tag-remove',onClick:e=>function(e,t){G.value[e].textTags&&(G.value[e].textTags.splice(t,1),G.value[e].text=G.value[e].textTags.join(';'))}(n,t)},'×',8,St)]))),128))])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.withDirectives)((0,a.createElementVNode)('select',{'onUpdate:modelValue':t=>e.expression=t,class:'mapping-select select-with-scroll'},[t[42]||(t[42]=(0,a.createElementVNode)('option',{value:'none'},'无表情',-1)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(K.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)('option',{key:e.name,value:e.name},(0,a.toDisplayString)(e.name),9,Dt))),128))],8,_t),[[a.vModelSelect,e.expression]]),(0,a.withDirectives)((0,a.createElementVNode)('select',{'onUpdate:modelValue':t=>e.motion=t,class:'mapping-select select-with-scroll'},[t[43]||(t[43]=(0,a.createElementVNode)('option',{value:'none'},'无动作',-1)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(H.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)('option',{key:e.name,value:e.name},(0,a.toDisplayString)(e.name),9,Lt))),128))],8,jt),[[a.vModelSelect,e.motion]]),(0,a.createElementVNode)('button',{class:'remove-mapping-btn',title:'删除',onClick:e=>function(e){G.value.splice(e,1)}(n)},[(0,a.createVNode)((0,a.unref)(U),{class:'icon-sm'})],8,Tt)])]))),128))])])])]),_:1},8,['badge'])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 角色立绘设置 '),y.value.sprites.length>0?((0,a.openBlock)(),(0,a.createBlock)((0,a.unref)(k),{key:1,title:'角色立绘设置',badge:y.value.sprites.length},{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)('div',Ut,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(Q.value,(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:n,class:'sprite-item'},[(0,a.createElementVNode)('div',It,[(0,a.createElementVNode)('span',Rt,(0,a.toDisplayString)(e.name),1),e.characterName?((0,a.openBlock)(),(0,a.createElementBlock)('span',Ft,(0,a.toDisplayString)(e.characterName),1)):(0,a.createCommentVNode)('v-if',!0),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-sm add-mapping-btn-inline',onClick:e=>function(e){Q.value[e].textMappings||(Q.value[e].textMappings=[]),Q.value[e].textMappings.push({text:'',textTags:[]})}(n)},[(0,a.createVNode)((0,a.unref)(J),{class:'icon-sm'}),t[44]||(t[44]=(0,a.createTextVNode)(' 添加映射 ',-1))],8,At)]),(0,a.createElementVNode)('div',Ot,[(0,a.createElementVNode)('div',Wt,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.textMappings||[],(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t,class:'mapping-item'},[(0,a.createElementVNode)('div',Gt,[(0,a.createElementVNode)('div',Ht,[(0,a.createElementVNode)('input',{value:e.text,type:'text',placeholder:'输入触发文本，多个用分号(;)分隔',class:'mapping-text-input tags-input',onBlur:e=>function(e,t,n){const a=q(n.target.value.trim());Q.value[e].textMappings&&(Q.value[e].textMappings[t].text=a.join(';'),Q.value[e].textMappings[t].textTags=a)}(n,t,e),onKeydown:(0,a.withKeys)(e=>{return(t=e).preventDefault(),void t.target.blur();var t},['enter'])},null,40,zt),e.textTags&&e.textTags.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',Kt,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.textTags,(e,l)=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:l,class:'text-tag'},[(0,a.createTextVNode)((0,a.toDisplayString)(e)+' ',1),(0,a.createElementVNode)('button',{class:'tag-remove',onClick:e=>function(e,t,n){Q.value[e].textMappings?.[t].textTags&&(Q.value[e].textMappings[t].textTags.splice(n,1),Q.value[e].textMappings[t].text=Q.value[e].textMappings[t].textTags.join(';'))}(n,t,l)},' × ',8,Pt)]))),128))])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createElementVNode)('button',{class:'remove-mapping-btn',title:'删除',onClick:e=>{return a=n,l=t,void(Q.value[a].textMappings&&Q.value[a].textMappings.splice(l,1));var a,l}},[(0,a.createVNode)((0,a.unref)(U),{class:'icon-sm'})],8,qt)])]))),128))])])]))),128))])]),_:1},8,['badge'])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 背景设置 '),y.value.backgrounds.length>0?((0,a.openBlock)(),(0,a.createBlock)((0,a.unref)(k),{key:2,title:'背景设置',badge:y.value.backgrounds.length},{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)('div',Jt,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(X.value,(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:n,class:'background-item'},[(0,a.createElementVNode)('div',Qt,[(0,a.createElementVNode)('span',Xt,(0,a.toDisplayString)(e.name),1),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-sm add-mapping-btn-inline',onClick:e=>function(e){X.value[e].textMappings||(X.value[e].textMappings=[]),X.value[e].textMappings.push({text:'',textTags:[]})}(n)},[(0,a.createVNode)((0,a.unref)(J),{class:'icon-sm'}),t[45]||(t[45]=(0,a.createTextVNode)(' 添加映射 ',-1))],8,Yt)]),(0,a.createElementVNode)('div',Zt,[(0,a.createElementVNode)('div',en,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.textMappings||[],(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t,class:'mapping-item'},[(0,a.createElementVNode)('div',tn,[(0,a.createElementVNode)('div',nn,[(0,a.createElementVNode)('input',{value:e.text,type:'text',placeholder:'输入触发文本，多个用分号(;)分隔',class:'mapping-text-input tags-input',onBlur:e=>function(e,t,n){const a=q(n.target.value.trim());X.value[e].textMappings&&(X.value[e].textMappings[t].text=a.join(';'),X.value[e].textMappings[t].textTags=a)}(n,t,e),onKeydown:(0,a.withKeys)(e=>{return(t=e).preventDefault(),void t.target.blur();var t},['enter'])},null,40,an),e.textTags&&e.textTags.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',ln,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.textTags,(e,l)=>((0,a.openBlock)(),(0,a.createElementBlock)('span',{key:l,class:'text-tag'},[(0,a.createTextVNode)((0,a.toDisplayString)(e)+' ',1),(0,a.createElementVNode)('button',{class:'tag-remove',onClick:e=>function(e,t,n){X.value[e].textMappings?.[t].textTags&&(X.value[e].textMappings[t].textTags.splice(n,1),X.value[e].textMappings[t].text=X.value[e].textMappings[t].textTags.join(';'))}(n,t,l)},' × ',8,on)]))),128))])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createElementVNode)('button',{class:'remove-mapping-btn',title:'删除',onClick:e=>{return a=n,l=t,void(X.value[a].textMappings&&X.value[a].textMappings.splice(l,1));var a,l}},[(0,a.createVNode)((0,a.unref)(U),{class:'icon-sm'})],8,cn)])]))),128))])])]))),128))])]),_:1},8,['badge'])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' CG设置 '),y.value.cgs.length>0?((0,a.openBlock)(),(0,a.createBlock)((0,a.unref)(k),{key:3,title:'CG设置',badge:y.value.cgs.length},{default:(0,a.withCtx)(()=>[(0,a.createElementVNode)('div',sn,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(Y.value,(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:n,class:'cg-item'},[(0,a.createElementVNode)('div',rn,[(0,a.createElementVNode)('span',mn,(0,a.toDisplayString)(e.name),1)]),(0,a.createElementVNode)('div',un,[t[47]||(t[47]=(0,a.createElementVNode)('h4',null,'文本映射',-1)),(0,a.createElementVNode)('div',dn,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.textMappings||[],(e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:t,class:'mapping-item'},[(0,a.withDirectives)((0,a.createElementVNode)('input',{'onUpdate:modelValue':t=>e.text=t,type:'text',placeholder:'输入触发文本',class:'mapping-text-input'},null,8,pn),[[a.vModelText,e.text]]),(0,a.createElementVNode)('button',{class:'remove-mapping-btn',title:'删除',onClick:e=>{return a=n,l=t,void(Y.value[a].textMappings&&Y.value[a].textMappings.splice(l,1));var a,l}},[(0,a.createVNode)((0,a.unref)(U),{class:'icon-sm'})],8,fn)]))),128))]),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-sm',onClick:e=>function(e){Y.value[e].textMappings||(Y.value[e].textMappings=[]),Y.value[e].textMappings.push({text:'',textTags:[]})}(n)},[(0,a.createVNode)((0,a.unref)(J),{class:'icon-sm'}),t[46]||(t[46]=(0,a.createTextVNode)(' 添加映射 ',-1))],8,vn)])]))),128))])]),_:1},8,['badge'])):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createElementVNode)('div',{class:'step-actions'},[(0,a.createElementVNode)('button',{class:'bubble-btn',onClick:I},'上一步'),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-primary',onClick:T},'下一步：完成')])],512),[[a.vShow,3===c.value]]),(0,a.createCommentVNode)(' 步骤5: 完成 '),(0,a.withDirectives)((0,a.createElementVNode)('div',gn,[(0,a.createElementVNode)('div',hn,[(0,a.createVNode)((0,a.unref)(B),{class:'icon-lg success-icon'}),t[48]||(t[48]=(0,a.createElementVNode)('h2',null,'准备完成',-1)),(0,a.createElementVNode)('p',null,'模型 "'+(0,a.toDisplayString)(d.value)+'" 已准备就绪',1),(0,a.createElementVNode)('div',yn,[(0,a.createElementVNode)('p',null,'模型文件: '+(0,a.toDisplayString)(b.value?'✓':'✗'),1),(0,a.createElementVNode)('p',null,'纹理文件: '+(0,a.toDisplayString)(y.value.textures.length)+' 个',1),(0,a.createElementVNode)('p',null,'动作文件: '+(0,a.toDisplayString)(N.value)+' 个',1),(0,a.createElementVNode)('p',null,'表情文件: '+(0,a.toDisplayString)(E.value)+' 个',1)])]),(0,a.createElementVNode)('div',kn,[(0,a.createElementVNode)('button',{class:'bubble-btn',onClick:I},'上一步'),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-primary',disabled:f.value,onClick:Z},[f.value?((0,a.openBlock)(),(0,a.createElementBlock)('span',Nn,'正在创建...')):((0,a.openBlock)(),(0,a.createElementBlock)('span',En,'完成并创建世界书条目'))],8,bn)])],512),[[a.vShow,4===c.value]])]))}}),xn=(0,y.A)(Vn,[['__scopeId','data-v-92ad8c6e']]),Bn={class:'page-header'},wn=(0,a.defineComponent)({__name:'PageHeader',props:{title:{}},emits:['back'],setup:e=>(t,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',Bn,[(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-sm',onClick:n[0]||(n[0]=e=>t.$emit('back'))},[(0,a.createVNode)(E),n[1]||(n[1]=(0,a.createTextVNode)(' 返回 ',-1))]),(0,a.createElementVNode)('h2',null,[(0,a.renderSlot)(t.$slots,'default'),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.title),1)]),n[2]||(n[2]=(0,a.createElementVNode)('div',{class:'spacer'},null,-1))]))}),Cn={class:'opening-interface-wrapper'},$n={class:'opening-interface'},Mn={class:'page main-menu'},Sn={class:'menu-buttons'},_n={class:'page start-game'},Dn={class:'openings-grid'},jn=['onClick'],Ln={class:'image-wrapper'},Tn=['src','alt'],Un={class:'content'},In={class:'hover-icon'},Rn={class:'page settings'},Fn={class:'page character-intro'},An={class:'character-display'},On={class:'character-card-inner'},Wn={class:'character-image'},Gn=['src','alt'],Hn={class:'character-info'},zn={class:'character-role'},Kn={class:'character-name'},Pn={class:'character-desc'},qn={class:'character-dots'},Jn=['onClick'],Qn=(0,a.defineComponent)({__name:'app',setup(e){const{currentPage:t,showPage:n}=function(){const e=(0,a.ref)('main-menu');return{currentPage:e,showPage:function(t){e.value=t}}}(),l=(0,a.ref)(c),i=(0,a.ref)(s),{currentIndex:r,currentItem:m,prev:p,next:f,goTo:v}=function(e){const t=(0,a.ref)(0),n=(0,a.computed)(()=>e[t.value]);return{currentIndex:t,currentItem:n,prev:function(){t.value=0===t.value?e.length-1:t.value-1},next:function(){t.value=t.value===e.length-1?0:t.value+1},goTo:function(n){n>=0&&n<e.length&&(t.value=n)}}}(i.value),g=(0,a.ref)();async function h(e){await async function(e){try{await createChatMessages([{role:'system',message:e.message}],{refresh:'all'}),await triggerSlash('/trigger'),o().success(`已选择开场：${e.title}`)}catch(e){throw console.error('选择开场失败:',e),o().error('选择开场失败'),e}}(e)}function y(){}return(0,a.onMounted)(()=>{(0,a.nextTick)(()=>{!function(e){if(!e)return;const{count:t,minDuration:n,maxDuration:a,maxDelay:l}=u;for(let o=0;o<t;o++){const t=document.createElement('div');t.className='particle',t.style.left=100*Math.random()+'%',t.style.top=100*Math.random()+'%',t.style.animationDelay=Math.random()*l+'s',t.style.animationDuration=`${n+Math.random()*(a-n)}s`,e.appendChild(t)}}(g.value),d()})}),(0,a.watch)(t,()=>{(0,a.nextTick)(()=>{const e=window.__applyScale;e&&e(),d()})}),(e,o)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',Cn,[(0,a.createElementVNode)('div',$n,[(0,a.createCommentVNode)(' 背景 '),o[15]||(o[15]=(0,a.createElementVNode)('div',{class:'background'},null,-1)),o[16]||(o[16]=(0,a.createElementVNode)('div',{class:'overlay'},null,-1)),(0,a.createCommentVNode)(' 粒子效果 '),(0,a.createElementVNode)('div',{ref_key:'particlesRef',ref:g,class:'particles'},null,512),(0,a.createCommentVNode)(' 主菜单 '),(0,a.withDirectives)((0,a.createElementVNode)('div',Mn,[o[11]||(o[11]=(0,a.createElementVNode)('div',{class:'title-section'},[(0,a.createElementVNode)('h1',null,'星之轨迹'),(0,a.createElementVNode)('p',{class:'subtitle'},'Starlight Trail'),(0,a.createElementVNode)('p',{class:'tagline'},'— 一段跨越时空的浪漫物语 —')],-1)),(0,a.createElementVNode)('div',Sn,[(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-lg',onClick:o[0]||(o[0]=e=>(0,a.unref)(n)('start-game'))},[(0,a.createVNode)((0,a.unref)(F)),o[8]||(o[8]=(0,a.createTextVNode)(' 开始游戏 ',-1))]),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-lg',onClick:o[1]||(o[1]=e=>(0,a.unref)(n)('settings'))},[(0,a.createVNode)((0,a.unref)(W)),o[9]||(o[9]=(0,a.createTextVNode)(' 游戏设置 ',-1))]),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-lg',onClick:o[2]||(o[2]=e=>(0,a.unref)(n)('character-intro'))},[(0,a.createVNode)((0,a.unref)(Y)),o[10]||(o[10]=(0,a.createTextVNode)(' 角色介绍 ',-1))])]),o[12]||(o[12]=(0,a.createElementVNode)('div',{class:'footer'},[(0,a.createElementVNode)('p',null,'© 2025 Per Aspera Ad Astra. By sixue')],-1))],512),[[a.vShow,'main-menu'===(0,a.unref)(t)]]),(0,a.createCommentVNode)(' 开始游戏页面 '),(0,a.withDirectives)((0,a.createElementVNode)('div',_n,[(0,a.createVNode)((0,a.unref)(wn),{title:'选择开场',onBack:o[3]||(o[3]=e=>(0,a.unref)(n)('main-menu'))},{default:(0,a.withCtx)(()=>[(0,a.createVNode)((0,a.unref)(K))]),_:1}),(0,a.createElementVNode)('div',Dn,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(l.value,e=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:e.id,class:'opening-card',onClick:t=>h(e)},[(0,a.createElementVNode)('div',Ln,[(0,a.createElementVNode)('img',{src:e.image||'',alt:e.title},null,8,Tn)]),(0,a.createElementVNode)('div',Un,[(0,a.createElementVNode)('h3',null,(0,a.toDisplayString)(e.title),1),(0,a.createElementVNode)('p',null,(0,a.toDisplayString)(e.description),1)]),(0,a.createElementVNode)('div',In,[(0,a.createVNode)((0,a.unref)(K),{class:'icon-sm'})])],8,jn))),128))]),o[13]||(o[13]=(0,a.createElementVNode)('p',{class:'hint-text'},'选择一个开场，开启你的专属故事',-1))],512),[[a.vShow,'start-game'===(0,a.unref)(t)]]),(0,a.createCommentVNode)(' 设置页面（整合了上传向导） '),(0,a.withDirectives)((0,a.createElementVNode)('div',Rn,[(0,a.createVNode)((0,a.unref)(xn),{onClose:o[4]||(o[4]=e=>(0,a.unref)(n)('main-menu')),onComplete:y})],512),[[a.vShow,'settings'===(0,a.unref)(t)]]),(0,a.createCommentVNode)(' 角色介绍页面 '),(0,a.withDirectives)((0,a.createElementVNode)('div',Fn,[(0,a.createVNode)((0,a.unref)(wn),{title:'角色介绍',onBack:o[5]||(o[5]=e=>(0,a.unref)(n)('main-menu'))}),(0,a.createElementVNode)('div',An,[(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-round nav-btn',onClick:o[6]||(o[6]=(...e)=>(0,a.unref)(p)&&(0,a.unref)(p)(...e))},[(0,a.createVNode)((0,a.unref)(M),{class:'icon-lg'})]),(0,a.createElementVNode)('div',{class:(0,a.normalizeClass)(['character-card',(0,a.unref)(m).colorClass])},[(0,a.createElementVNode)('div',On,[(0,a.createElementVNode)('div',Wn,[(0,a.createElementVNode)('img',{src:(0,a.unref)(m).image||'',alt:(0,a.unref)(m).name},null,8,Gn)]),(0,a.createElementVNode)('div',Hn,[(0,a.createElementVNode)('span',zn,(0,a.toDisplayString)((0,a.unref)(m).role),1),(0,a.createElementVNode)('h3',Kn,(0,a.toDisplayString)((0,a.unref)(m).name),1),(0,a.createElementVNode)('p',Pn,(0,a.toDisplayString)((0,a.unref)(m).desc),1),(0,a.createElementVNode)('div',qn,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(i.value,(_,e)=>((0,a.openBlock)(),(0,a.createElementBlock)('button',{key:e,class:(0,a.normalizeClass)(['dot',{active:e===(0,a.unref)(r)}]),onClick:t=>(0,a.unref)(v)(e)},null,10,Jn))),128))])])])],2),(0,a.createElementVNode)('button',{class:'bubble-btn bubble-btn-round nav-btn',onClick:o[7]||(o[7]=(...e)=>(0,a.unref)(f)&&(0,a.unref)(f)(...e))},[(0,a.createVNode)((0,a.unref)(j),{class:'icon-lg'})])]),o[14]||(o[14]=(0,a.createElementVNode)('p',{class:'hint-text'},'点击左右按钮或底部指示器切换角色',-1))],512),[[a.vShow,'character-intro'===(0,a.unref)(t)]])])]))}}),Xn=(0,y.A)(Qn,[['__scopeId','data-v-3b82153e']]);function Yn(){const e=document.querySelector('.opening-interface');if(!e)return;if(e.querySelector('.main-menu')){e.classList.add('main-menu-active');const t=1200,n=800,a=window.innerWidth,l=window.innerHeight,o=20,c=Math.max(a-2*o,0),s=Math.max(l-2*o,0);if(c<=0||s<=0)return;const i=c/t,r=s/n,m=Math.min(i,r,1);e.style.transform=`scale(${m})`,e.style.transformOrigin='top center',console.info(`[开场界面] 主菜单应用缩放比例: ${m.toFixed(3)} (容器: ${a}x${l})`)}else e.classList.remove('main-menu-active'),e.style.transform='',e.style.transformOrigin='',console.info('[开场界面] 其他页面，移除缩放限制')}$(()=>{try{console.info('[开场界面] 开始初始化...');if(!document.getElementById('app'))throw new Error('找不到 #app 元素');console.info('[开场界面] 创建 Vue 应用实例...');const e=(0,a.createApp)(Xn);console.info('[开场界面] 挂载到 #app...'),e.mount('#app'),console.info('[开场界面] Vue 应用挂载成功，初始化缩放和自适应高度...'),window.__applyScale=Yn,setTimeout(()=>{!function(){let e;Yn(),window.addEventListener('resize',()=>{clearTimeout(e),e=setTimeout(()=>{Yn(),d()},100)});const t=document.querySelector('.opening-interface-wrapper');if(t&&'undefined'!=typeof ResizeObserver){const e=new ResizeObserver(()=>{Yn(),d()});e.observe(t);const n=document.querySelector('.opening-interface');n&&e.observe(n)}setTimeout(()=>{Yn(),d()},100),setTimeout(()=>{Yn(),d()},300),setTimeout(()=>{Yn(),d()},500),setTimeout(()=>{Yn(),d()},1e3)}(),function(){if(d(),'undefined'!=typeof ResizeObserver){const e=new ResizeObserver(()=>{clearTimeout(window.__heightAdjustTimeout),window.__heightAdjustTimeout=setTimeout(()=>{d()},100)}),t=document.getElementById('app');t&&e.observe(t),e.observe(document.body),e.observe(document.documentElement),window.addEventListener('resize',()=>{d()}),console.info('[开场界面] 已启用 ResizeObserver 自动高度调整')}else new MutationObserver(()=>{d()}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:['style','class']}),setInterval(()=>{d()},500),console.info('[开场界面] 已启用 MutationObserver 自动高度调整（降级方案）');setTimeout(()=>{d()},100),setTimeout(()=>{d()},500),setTimeout(()=>{d()},1e3)}()},100),console.info('[开场界面] 初始化成功！')}catch(e){console.error('[开场界面] 初始化失败:',e);const t=document.getElementById('app');t&&(t.innerHTML=`\n        <div style="padding: 20px; color: red; background: white; font-family: monospace;">\n          <h2>❌ 开场界面初始化错误</h2>\n          <p><strong>错误信息:</strong></p>\n          <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto;">${e instanceof Error?e.message:String(e)}</pre>\n          ${e instanceof Error&&e.stack?`<p><strong>堆栈跟踪:</strong></p><pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto; font-size: 12px;">${e.stack}</pre>`:''}\n        </div>\n      `)}});
//# sourceMappingURL=index.js.map</script><style>.collapsible-section[data-v-379bada6]{background:hsla(0,0%,100%,.6);border-radius:12px;overflow:hidden;backdrop-filter:blur(10px)}.collapsible-header[data-v-379bada6]{width:100%;display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:rgba(0,0,0,0);border:none;cursor:pointer;transition:all .3s;text-align:left}.collapsible-header[data-v-379bada6]:hover{background:rgba(0,0,0,.05)}.collapsible-header.expanded[data-v-379bada6]{border-bottom:1px solid rgba(0,0,0,.1)}.header-title[data-v-379bada6]{display:flex;align-items:center;gap:8px;font-size:16px;font-weight:600;color:var(--foreground)}.badge[data-v-379bada6]{padding:2px 8px;background:rgba(236,72,153,.2);color:var(--primary-color,#ec4899);border-radius:12px;font-size:12px;font-weight:500}.chevron-icon[data-v-379bada6]{width:20px;height:20px;transition:transform .3s;color:var(--muted-foreground)}.chevron-icon.rotated[data-v-379bada6]{transform:rotate(180deg)}.collapsible-content[data-v-379bada6]{padding:16px;animation:slideDown-379bada6 .3s ease-out;overflow:visible;max-height:none}@keyframes slideDown-379bada6{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.slide-enter-active[data-v-379bada6],.slide-leave-active[data-v-379bada6]{transition:all .3s ease;overflow:hidden}.slide-enter-from[data-v-379bada6],.slide-leave-to[data-v-379bada6]{max-height:0;opacity:0;padding-top:0;padding-bottom:0}.slide-enter-to[data-v-379bada6],.slide-leave-from[data-v-379bada6]{max-height:2000px;opacity:1}
.model-upload-wizard[data-v-92ad8c6e]{width:100%;max-width:800px;margin:0 auto;height:100%;display:flex;flex-direction:column;overflow:hidden}.steps-indicator[data-v-92ad8c6e]{display:flex;justify-content:space-between;margin:16px 0;padding:0 20px;flex-shrink:0}.step-item[data-v-92ad8c6e]{flex:1;display:flex;flex-direction:column;align-items:center;position:relative}.step-item[data-v-92ad8c6e]::after{content:"";position:absolute;top:20px;left:50%;width:100%;height:2px;background:rgba(0,0,0,.1);z-index:-1}.step-item[data-v-92ad8c6e]:last-child::after{display:none}.step-item.active .step-number[data-v-92ad8c6e]{background:var(--primary-color,#ec4899);color:#fff}.step-item.completed .step-number[data-v-92ad8c6e]{background:#10b981;color:#fff}.step-number[data-v-92ad8c6e]{width:40px;height:40px;border-radius:50%;background:rgba(0,0,0,.1);display:flex;align-items:center;justify-content:center;font-weight:bold;margin-bottom:8px}.step-label[data-v-92ad8c6e]{font-size:14px;color:var(--muted-foreground)}.step-content[data-v-92ad8c6e]{flex:1;display:flex;flex-direction:column;overflow:hidden;padding:16px;min-height:0}.step-content[data-v-92ad8c6e]>*:not(.step-actions){flex:1;overflow-y:auto;overflow-x:hidden;min-height:0;scrollbar-width:none;-ms-overflow-style:none}.step-content[data-v-92ad8c6e]>*:not(.step-actions)::-webkit-scrollbar{display:none}.step-content .step-actions[data-v-92ad8c6e]{flex-shrink:0;margin-top:auto;padding-top:16px}.upload-area[data-v-92ad8c6e]{border:2px dashed rgba(0,0,0,.2);border-radius:12px;padding:40px;text-align:center;cursor:pointer;transition:all .3s;min-height:300px;display:flex;flex-direction:column;justify-content:center}.upload-area[data-v-92ad8c6e]:hover{border-color:var(--primary-color,#ec4899);background:rgba(236,72,153,.05)}.upload-area-inner[data-v-92ad8c6e]{width:100%;height:100%}.upload-area-inner[data-v-92ad8c6e]{width:100%;height:100%}.upload-placeholder[data-v-92ad8c6e]{display:flex;flex-direction:column;align-items:center;gap:16px}.uploaded-files-preview[data-v-92ad8c6e]{width:100%;cursor:default}.uploaded-files-preview[data-v-92ad8c6e] *{pointer-events:auto}.files-summary[data-v-92ad8c6e]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:12px}.summary-actions[data-v-92ad8c6e]{display:flex;gap:8px}.files-list[data-v-92ad8c6e]{display:flex;flex-direction:column;gap:8px;max-height:200px;overflow-y:auto;overflow-x:hidden;scrollbar-width:none;-ms-overflow-style:none}.files-list[data-v-92ad8c6e]::-webkit-scrollbar{display:none}.file-item[data-v-92ad8c6e]{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px 12px;background:rgba(0,0,0,.05);border-radius:8px;transition:background .2s}.file-item[data-v-92ad8c6e]:hover{background:rgba(0,0,0,.1)}.file-name[data-v-92ad8c6e]{flex:1;text-align:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.remove-file-btn[data-v-92ad8c6e]{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:0;border:none;background:rgba(239,68,68,.1);color:#ef4444;border-radius:4px;cursor:pointer;transition:all .2s}.remove-file-btn[data-v-92ad8c6e]:hover{background:rgba(239,68,68,.2)}.file-source-badge[data-v-92ad8c6e]{padding:2px 6px;border-radius:4px;font-size:11px;font-weight:500;background:rgba(59,130,246,.1);color:#3b82f6}.file-type-badge[data-v-92ad8c6e]{padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500}.file-type-badge.type-texture[data-v-92ad8c6e]{background:#e0f2fe;color:#0369a1}.file-type-badge.type-moc3[data-v-92ad8c6e],.file-type-badge.type-model3[data-v-92ad8c6e]{background:#fef3c7;color:#92400e}.file-type-badge.type-motion[data-v-92ad8c6e]{background:#dbeafe;color:#1e40af}.file-type-badge.type-image[data-v-92ad8c6e]{background:#fce7f3;color:#9f1239}.file-type-badge.type-other[data-v-92ad8c6e]{background:#f3f4f6;color:#6b7280}.classifying-status[data-v-92ad8c6e]{text-align:center;padding:20px}.classified-files[data-v-92ad8c6e]{display:flex;flex-direction:column;gap:16px;overflow-y:auto;overflow-x:hidden;scrollbar-width:none;-ms-overflow-style:none}.classified-files[data-v-92ad8c6e]::-webkit-scrollbar{display:none}.settings-card[data-v-92ad8c6e]{background:hsla(0,0%,100%,.6);border-radius:12px;padding:16px;backdrop-filter:blur(10px)}.model-name-input[data-v-92ad8c6e]{width:100%;padding:12px;border:1px solid rgba(0,0,0,.2);border-radius:8px;font-size:16px;margin-top:8px}.files-categories[data-v-92ad8c6e]{display:flex;flex-direction:column;gap:12px}.category-section[data-v-92ad8c6e]{background:hsla(0,0%,100%,.6);border-radius:12px;padding:16px;backdrop-filter:blur(10px)}.file-category[data-v-92ad8c6e]{display:flex;flex-direction:column;gap:8px;margin-top:12px;max-height:300px;overflow-y:auto;overflow-x:hidden;scrollbar-width:none;-ms-overflow-style:none}.file-category[data-v-92ad8c6e]::-webkit-scrollbar{display:none}.category-item[data-v-92ad8c6e]{display:flex;align-items:center;gap:8px;padding:8px;background:rgba(0,0,0,.05);border-radius:8px}.toggle-type-btn[data-v-92ad8c6e]{margin-left:auto;padding:4px 8px;font-size:12px;background:rgba(0,0,0,.1);border:none;border-radius:4px;cursor:pointer}.step-actions[data-v-92ad8c6e]{display:flex;justify-content:space-between;gap:16px;margin-top:16px;padding-top:16px;border-top:1px solid rgba(0,0,0,.1);flex-shrink:0}.character-name-badge[data-v-92ad8c6e]{padding:2px 8px;background:rgba(99,102,241,.2);color:#6366f1;border-radius:12px;font-size:12px;font-weight:500;margin-left:auto}.upload-methods-container[data-v-92ad8c6e]{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:24px}@media (max-width:768px){.upload-methods-container[data-v-92ad8c6e]{grid-template-columns:1fr}}.upload-method-section[data-v-92ad8c6e]{display:flex;flex-direction:column;gap:12px}.method-title[data-v-92ad8c6e]{font-size:16px;font-weight:600;margin:0;color:var(--foreground)}.url-upload-area[data-v-92ad8c6e]{display:flex;flex-direction:column;gap:16px}.url-input-group[data-v-92ad8c6e]{display:flex;gap:12px;align-items:stretch}.url-input[data-v-92ad8c6e]{flex:1;padding:12px;border:1px solid rgba(0,0,0,.2);border-radius:8px;font-size:14px;background:#fff}.category-item-with-select[data-v-92ad8c6e]{padding:12px}.classify-select[data-v-92ad8c6e]{margin-left:auto;min-width:140px;padding:8px 12px;border:1px solid rgba(0,0,0,.2);border-radius:8px;font-size:14px;background:#fff;cursor:pointer;transition:all .2s}.classify-select[data-v-92ad8c6e]:hover{border-color:rgba(0,0,0,.3)}.classify-select[data-v-92ad8c6e]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px rgba(99,102,241,.1)}.completion-summary[data-v-92ad8c6e]{text-align:center;padding:40px}.success-icon[data-v-92ad8c6e]{width:64px;height:64px;color:#10b981;margin-bottom:16px}.summary-details[data-v-92ad8c6e]{margin-top:24px;display:flex;flex-direction:column;gap:8px;text-align:left;max-width:300px;margin-left:auto;margin-right:auto}.hidden-input[data-v-92ad8c6e]{display:none}.resource-settings-wrapper[data-v-92ad8c6e]{display:flex;flex-direction:column;gap:12px;overflow-y:auto;overflow-x:hidden;flex:1;scrollbar-width:none;-ms-overflow-style:none}.resource-settings-wrapper[data-v-92ad8c6e]::-webkit-scrollbar{display:none}.animation-settings[data-v-92ad8c6e]{display:flex;flex-direction:column;gap:16px}.setting-item[data-v-92ad8c6e]{margin-bottom:10px}.setting-item label[data-v-92ad8c6e]{display:block;margin-bottom:6px;font-weight:500;font-size:14px;color:var(--foreground)}.setting-item input[type=text][data-v-92ad8c6e],.setting-item select[data-v-92ad8c6e]{width:100%;padding:8px 12px;border:1px solid rgba(0,0,0,.2);border-radius:8px;font-size:14px;background:#fff}.setting-item input[type=checkbox][data-v-92ad8c6e]{margin-right:8px}.select-with-scroll[data-v-92ad8c6e]{max-height:200px;overflow-y:auto}.text-mapping-section[data-v-92ad8c6e]{margin-top:12px;padding-top:12px;border-top:1px solid rgba(0,0,0,.1)}.text-mapping-section.compact[data-v-92ad8c6e]{margin-top:8px;padding-top:8px}.text-mapping-section h4[data-v-92ad8c6e]{margin-bottom:8px;font-size:14px;font-weight:600}.text-mapping-section .text-mapping-header[data-v-92ad8c6e]{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:12px}.text-mapping-section .text-mapping-header h4[data-v-92ad8c6e]{margin:0;flex-shrink:0}.text-mapping-section .text-mapping-header .hint[data-v-92ad8c6e]{flex:1;margin:0;font-size:12px;color:var(--muted-foreground);line-height:1.4}.text-mapping-section .text-mapping-header .add-mapping-btn[data-v-92ad8c6e]{flex-shrink:0}.mapping-list[data-v-92ad8c6e]{display:flex;flex-direction:column;gap:8px;max-height:400px;overflow-y:auto;overflow-x:hidden;scrollbar-width:none;-ms-overflow-style:none}.mapping-list[data-v-92ad8c6e]::-webkit-scrollbar{display:none}.mapping-item[data-v-92ad8c6e]{padding:10px;background:rgba(0,0,0,.05);border-radius:8px}.mapping-inputs[data-v-92ad8c6e]{display:flex;gap:8px;align-items:flex-start;flex-wrap:wrap}.text-tags-input-wrapper[data-v-92ad8c6e]{flex:1;min-width:200px;display:flex;flex-direction:column;gap:6px}.mapping-text-input[data-v-92ad8c6e]{width:100%;padding:8px 12px;border:1px solid rgba(0,0,0,.2);border-radius:8px;font-size:14px}.mapping-text-input.tags-input[data-v-92ad8c6e]{padding-bottom:6px}.mapping-text-input[data-v-92ad8c6e]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px rgba(99,102,241,.1)}.text-tags[data-v-92ad8c6e]{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}.text-tag[data-v-92ad8c6e]{display:inline-flex;align-items:center;gap:4px;padding:4px 8px;background:rgba(99,102,241,.1);color:#6366f1;border-radius:6px;font-size:12px;font-weight:500}.text-tag .tag-remove[data-v-92ad8c6e]{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;padding:0;margin-left:2px;border:none;background:rgba(99,102,241,.2);color:#6366f1;border-radius:50%;cursor:pointer;font-size:14px;line-height:1;transition:all .2s}.text-tag .tag-remove[data-v-92ad8c6e]:hover{background:rgba(99,102,241,.3)}.mapping-select[data-v-92ad8c6e]{min-width:120px;padding:8px 12px;border:1px solid rgba(0,0,0,.2);border-radius:8px;font-size:14px}.remove-mapping-btn[data-v-92ad8c6e]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;padding:0;border:none;background:rgba(239,68,68,.1);color:#ef4444;border-radius:4px;cursor:pointer;transition:all .2s}.remove-mapping-btn[data-v-92ad8c6e]:hover{background:rgba(239,68,68,.2)}.sprite-settings[data-v-92ad8c6e],.background-settings[data-v-92ad8c6e],.cg-settings[data-v-92ad8c6e]{display:flex;flex-direction:column;gap:12px}.sprite-item[data-v-92ad8c6e],.background-item[data-v-92ad8c6e],.cg-item[data-v-92ad8c6e]{padding:12px;background:rgba(0,0,0,.05);border-radius:8px}.sprite-header[data-v-92ad8c6e],.resource-header[data-v-92ad8c6e]{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px;flex-wrap:wrap}.sprite-name[data-v-92ad8c6e],.resource-name[data-v-92ad8c6e]{font-weight:500;color:var(--foreground);flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.add-mapping-btn-inline[data-v-92ad8c6e]{flex-shrink:0}

:root{--foreground:#1a1a2e;--muted-foreground:#4a4a6a;--background:#fdf2f8}*{box-sizing:border-box;margin:0;padding:0}html,body{margin:0;padding:0;width:100%;height:auto;overflow-x:hidden;background:rgba(0,0,0,0)}#app{width:100%;height:auto;background:rgba(0,0,0,0);display:flex;justify-content:center;align-items:flex-start}.opening-interface-wrapper{width:100%;min-height:100vh;display:flex;justify-content:center;align-items:flex-start;background:rgba(0,0,0,0);padding:0;overflow:auto}.opening-interface{position:relative;display:flex;flex-direction:column;color:var(--foreground);font-family:"Segoe UI","Microsoft YaHei",sans-serif;background:rgba(0,0,0,0);transform-origin:top center;will-change:transform;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;width:100%;max-width:1200px;min-height:0;flex-shrink:1}.opening-interface.main-menu-active{width:1200px;height:800px;min-width:1200px;min-height:800px;flex-shrink:0}.background{position:absolute;inset:0;background:linear-gradient(135deg,#fce7f3 0%,#fdf2f8 50%,#f3e8ff 100%);z-index:-2}.background::before{content:"";position:absolute;inset:0;background-image:url("https://images.unsplash.com/photo-1522383225653-a7e3ad22d696?w=1920&q=80");background-size:cover;background-position:center;opacity:.4}.overlay{position:absolute;inset:0;background:linear-gradient(to bottom,rgba(253,242,248,0.3),transparent,rgba(253,242,248,0.4));z-index:-1}.particles{position:absolute;inset:0;pointer-events:none;z-index:0}.particle{position:absolute;width:8px;height:8px;background:hsla(0,0%,100%,.5);border-radius:50%;animation:float linear infinite}@keyframes float{0%,100%{transform:translateY(0) translateX(0);opacity:0}10%{opacity:.6}90%{opacity:.6}100%{transform:translateY(-100%) translateX(20px);opacity:0}}.page{position:relative;z-index:1;padding:20px;width:100%;height:100%;display:flex;flex-direction:column;flex:1;box-sizing:border-box;overflow:hidden}.upload-wizard-page{overflow:hidden}.upload-wizard-page .opening-interface{overflow:hidden}.main-menu{align-items:center;justify-content:center;text-align:center;padding-bottom:80px}.title-section{margin-bottom:80px}.title-section h1{font-size:clamp(3rem,8vw,5rem);font-weight:bold;color:var(--foreground);margin:0 0 16px 0;text-shadow:0 4px 20px hsla(0,0%,100%,.5)}.title-section .subtitle{font-size:clamp(1.2rem,3vw,1.5rem);color:var(--foreground);opacity:.8;letter-spacing:4px;margin:0}.title-section .tagline{margin-top:16px;font-size:clamp(.9rem,2vw,1.1rem);color:var(--foreground);opacity:.7;font-style:italic;margin:16px 0 0 0}.menu-buttons{display:flex;flex-direction:column;gap:20px;margin-bottom:80px}.footer{margin-top:auto;padding-top:40px;opacity:.6;font-size:14px}.bubble-btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:14px 32px;background:hsla(0,0%,100%,.4);backdrop-filter:blur(12px);border:1px solid hsla(0,0%,100%,.6);border-radius:9999px;color:var(--foreground);font-size:16px;font-weight:500;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 20px hsla(0,0%,100%,.3);text-decoration:none;font-family:inherit}.bubble-btn:hover{background:hsla(0,0%,100%,.6);transform:translateY(-2px);box-shadow:0 8px 30px hsla(0,0%,100%,.4)}.bubble-btn:active{transform:translateY(0)}.bubble-btn-sm{padding:10px 20px;font-size:14px}.bubble-btn-lg{padding:16px 40px;font-size:18px;min-width:200px}.bubble-btn-round{width:50px;height:50px;padding:0;border-radius:50%}.full-width-btn{width:100%}.upload-buttons{display:flex;flex-direction:column;gap:12px;margin-top:16px}.bubble-btn-secondary{background:hsla(0,0%,100%,.6);color:var(--foreground)}.bubble-btn-secondary:hover{background:hsla(0,0%,100%,.8)}.icon{width:20px;height:20px;stroke:currentColor;stroke-width:2;fill:none}.icon-sm{width:16px;height:16px}.icon-lg{width:24px;height:24px}.start-game{width:100%;margin:0 auto;overflow-y:auto;overflow-x:hidden}.openings-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:24px;margin-bottom:24px}.opening-card{position:relative;background:hsla(0,0%,100%,.3);backdrop-filter:blur(12px);border:1px solid hsla(0,0%,100%,.5);border-radius:20px;overflow:hidden;cursor:pointer;transition:all .3s ease}.opening-card:hover{background:hsla(0,0%,100%,.5);transform:scale(1.02);box-shadow:0 10px 40px hsla(0,0%,100%,.3)}.opening-card .image-wrapper{position:relative;width:100%;aspect-ratio:16/9;overflow:hidden}.opening-card .image-wrapper::after{content:"";position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.4),transparent)}.opening-card img{width:100%;height:100%;object-fit:cover;transition:transform .5s ease}.opening-card:hover img{transform:scale(1.1)}.opening-card img{width:100%;height:100%;object-fit:cover}.opening-card .content{padding:16px;text-align:left}.opening-card h3{font-size:1.25rem;font-weight:bold;color:var(--foreground);margin-bottom:8px;margin:0 0 8px 0}.opening-card p{font-size:.875rem;color:var(--muted-foreground);margin:0}.opening-card .hover-icon{position:absolute;top:16px;right:16px;width:32px;height:32px;background:hsla(0,0%,100%,.5);backdrop-filter:blur(8px);border-radius:50%;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .3s ease}.opening-card:hover .hover-icon{opacity:1}.hint-text{text-align:center;color:var(--foreground);opacity:.7;font-size:14px;margin-top:24px}.settings{width:100%;max-width:800px;margin:0 auto;overflow-y:auto;overflow-x:hidden}.settings-content{display:flex;flex-direction:column;gap:24px}.settings-card{background:hsla(0,0%,100%,.3);backdrop-filter:blur(12px);border:1px solid hsla(0,0%,100%,.5);border-radius:20px;padding:24px}.settings-card-header{display:flex;align-items:flex-start;gap:16px;margin-bottom:16px}.settings-card-icon{width:40px;height:40px;background:hsla(0,0%,100%,.5);border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0}.settings-card-header h3{margin:0 0 4px 0;font-size:18px;font-weight:600;color:var(--foreground)}.settings-card-header .desc{font-size:.875rem;color:var(--muted-foreground);margin:0;line-height:1.5}.url-input-group{display:flex;gap:12px}.url-input-group input{flex:1;padding:12px 20px;background:hsla(0,0%,100%,.5);border:1px solid hsla(0,0%,100%,.5);border-radius:9999px;color:var(--foreground);font-size:14px;outline:none;font-family:inherit}.url-input-group input:focus{box-shadow:0 0 0 2px hsla(0,0%,100%,.5)}.url-input-group input::placeholder{color:var(--muted-foreground)}.hidden-input{display:none}.config-list{display:flex;flex-direction:column;gap:12px}.config-item{display:flex;align-items:center;justify-content:space-between;background:hsla(0,0%,100%,.4);border-radius:12px;padding:12px 16px}.config-item-left{display:flex;align-items:center;gap:12px}.config-item-name{font-size:.875rem;color:var(--foreground);max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.config-item-right{display:flex;align-items:center;gap:12px}.check-icon{color:#16a34a}.remove-btn{width:24px;height:24px;background:hsla(0,0%,100%,.5);border:none;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background .2s ease;padding:0}.remove-btn:hover{background:hsla(0,0%,100%,.7)}.character-intro{width:100%;max-width:1200px;margin:0 auto;overflow-y:auto;overflow-x:hidden;padding:0 10px;box-sizing:border-box}.character-display{display:flex;align-items:center;justify-content:space-between;gap:24px;margin-bottom:24px;width:100%;position:relative;padding:0 10px;box-sizing:border-box}.nav-btn{flex-shrink:0;position:relative;z-index:10}.character-display .character-card{flex:1;max-width:calc(100% - 148px);min-width:0}.character-card{flex:1;background:linear-gradient(135deg,rgba(251,207,232,0.5),rgba(244,114,182,0.3));backdrop-filter:blur(12px);border:1px solid hsla(0,0%,100%,.5);border-radius:24px;overflow:hidden;box-shadow:0 10px 40px hsla(0,0%,100%,.2);transition:all .5s ease}.character-card.blue{background:linear-gradient(135deg,rgba(191,219,254,0.5),rgba(99,102,241,0.3))}.character-card.orange{background:linear-gradient(135deg,rgba(254,215,170,0.5),rgba(251,146,60,0.3))}.character-card.gray{background:linear-gradient(135deg,rgba(226,232,240,0.5),rgba(148,163,184,0.3))}.character-card-inner{display:flex;flex-direction:column}@media (min-width:768px){.character-card-inner{flex-direction:row}}.character-image{position:relative;flex:1;min-height:300px}.character-image img{width:100%;height:100%;object-fit:cover;min-height:300px}.character-image::after{content:"";position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,0.3),transparent)}@media (min-width:768px){.character-image::after{background:linear-gradient(to right,transparent,rgba(0,0,0,0.2))}}.character-info{flex:1;padding:24px;display:flex;flex-direction:column;justify-content:center}.character-role{display:inline-block;align-self:flex-start;padding:6px 12px;background:hsla(0,0%,100%,.5);border-radius:9999px;font-size:.75rem;font-weight:500;color:var(--foreground);margin-bottom:12px}.character-name{font-size:clamp(1.8rem,5vw,2.5rem);font-weight:bold;color:var(--foreground);margin-bottom:16px;margin:0 0 16px 0}.character-desc{color:var(--muted-foreground);line-height:1.7;margin:0}.character-dots{display:flex;align-items:center;gap:8px;margin-top:32px}.character-dots .dot{width:8px;height:8px;border-radius:9999px;background:rgba(26,26,46,.3);border:none;cursor:pointer;transition:all .3s ease;padding:0}.character-dots .dot:hover{background:rgba(26,26,46,.5)}.character-dots .dot.active{width:24px;background:var(--foreground)}.page-header{width:100%;max-width:1000px;display:flex;align-items:center;justify-content:space-between;padding:20px;margin-bottom:20px;position:relative}.page-header h2{font-size:clamp(1.5rem,4vw,2rem);font-weight:bold;color:var(--foreground);display:flex;align-items:center;gap:10px;margin:0;position:absolute;left:50%;transform:translateX(-50%);white-space:nowrap}.spacer{width:80px;flex-shrink:0}@media (max-width:768px){.opening-interface{padding:10px}.title-section h1{font-size:clamp(2rem,6vw,3rem)}.title-section .subtitle{font-size:clamp(1rem,3vw,1.2rem)}.bubble-btn-lg{padding:12px 24px;font-size:16px;min-width:160px}.openings-grid{grid-template-columns:repeat(2,1fr);gap:16px}.character-display{flex-direction:column;gap:16px}.nav-btn{order:2}.character-card{order:1;width:100%}.page-header{padding:12px}.page-header h2{font-size:clamp(1.2rem,4vw,1.5rem)}.settings-card{padding:16px}}@media (max-width:480px){.opening-interface{padding:8px}.menu-buttons{gap:12px}.bubble-btn{padding:10px 20px;font-size:14px}.settings-card-header{flex-direction:column;align-items:flex-start;gap:8px}}

/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div></body>