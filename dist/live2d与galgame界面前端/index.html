<head><script src="https://cdn.jsdelivr.net/gh/dylanNew/live2d/webgl/Live2D/lib/live2d.min.js"></script><script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script><script type="module">/*! For license information please see index.js.LICENSE.txt */
import*as e from'https://testingcf.jsdelivr.net/npm/pinia/+esm';import{default as t}from'https://testingcf.jsdelivr.net/npm/ismobilejs/+esm';import{default as s}from'https://testingcf.jsdelivr.net/npm/eventemitter3/+esm';import{default as i}from'https://testingcf.jsdelivr.net/npm/earcut/+esm';import{format as r,parse as n,resolve as o}from'https://testingcf.jsdelivr.net/npm/url/+esm';var a={35(t,s,i){t.exports=(e=>{var t={};return i.d(t,e),t})({createPinia:()=>e.createPinia,defineStore:()=>e.defineStore})},165(e,t,s){s.d(t,{ALPHA_MODES:()=>i.Gk,AbstractMultiResource:()=>i.CI,AccessibilityManager:()=>B,AlphaFilter:()=>u,AnimatedSprite:()=>Zs,Application:()=>O,ArrayResource:()=>i.aV,Assets:()=>Se,AssetsClass:()=>Ce,Attribute:()=>i.nW,BLEND_MODES:()=>i.B9,BUFFER_BITS:()=>i.wn,BUFFER_TYPE:()=>i.yw,BackgroundSystem:()=>i.sN,BaseImageResource:()=>i.jH,BasePrepare:()=>js,BaseRenderTexture:()=>i.LE,BaseTexture:()=>i.t5,BatchDrawCall:()=>i.hq,BatchGeometry:()=>i.JH,BatchRenderer:()=>i.ch,BatchShaderGenerator:()=>i.LQ,BatchSystem:()=>i.A6,BatchTextureArray:()=>i.cc,BitmapFont:()=>yi,BitmapFontData:()=>hi,BitmapText:()=>Ei,BlobResource:()=>je,BlurFilter:()=>f,BlurFilterPass:()=>p,Bounds:()=>r.cz,BrowserAdapter:()=>i.OF,Buffer:()=>i.hp,BufferResource:()=>i.dZ,BufferSystem:()=>i.yn,CLEAR_MODES:()=>i.fr,COLOR_MASK_BITS:()=>i.Eq,Cache:()=>W,CanvasResource:()=>i.Bu,Circle:()=>i.jl,Color:()=>i.Q1,ColorMatrixFilter:()=>g,CompressedTextureResource:()=>ze,Container:()=>r.mc,ContextSystem:()=>i.bD,CountLimiter:()=>Os,CubeResource:()=>i.WQ,DEG_TO_RAD:()=>i.Td,DRAW_MODES:()=>i._4,DisplacementFilter:()=>m,DisplayObject:()=>r.q9,ENV:()=>i.Km,Ellipse:()=>i.Pp,EventBoundary:()=>M,EventSystem:()=>R,ExtensionType:()=>i.Ag,Extract:()=>kt,FORMATS:()=>i.hR,FORMATS_TO_COMPONENTS:()=>wt,FXAAFilter:()=>v,FederatedDisplayObject:()=>k,FederatedEvent:()=>T,FederatedMouseEvent:()=>w,FederatedPointerEvent:()=>E,FederatedWheelEvent:()=>C,FillStyle:()=>is,Filter:()=>i.dJ,FilterState:()=>i.OO,FilterSystem:()=>i.u9,Framebuffer:()=>i.GW,FramebufferSystem:()=>i.nj,GC_MODES:()=>i.OS,GLFramebuffer:()=>i.pq,GLProgram:()=>i._H,GLTexture:()=>i.Ru,GRAPHICS_CURVES:()=>Ht,GenerateTextureSystem:()=>i.yI,Geometry:()=>i.V2,GeometrySystem:()=>i.kb,Graphics:()=>as,GraphicsData:()=>Zt,GraphicsGeometry:()=>ss,HTMLText:()=>Ii,HTMLTextStyle:()=>Mi,IGLUniformData:()=>i.n1,INSTALLED:()=>i.Ln,INTERNAL_FORMATS:()=>Ge,INTERNAL_FORMAT_TO_BYTES_PER_PIXEL:()=>Ve,ImageBitmapResource:()=>i.di,ImageResource:()=>i.Gj,LINE_CAP:()=>Gt,LINE_JOIN:()=>Ut,LineStyle:()=>rs,LoaderParserPriority:()=>Y,MASK_TYPES:()=>i.vg,MIPMAP_MODES:()=>i.E8,MSAA_QUALITY:()=>i.he,MaskData:()=>i.XN,MaskSystem:()=>i.iW,Matrix:()=>i.uq,Mesh:()=>ps,MeshBatchUvs:()=>hs,MeshGeometry:()=>fs,MeshMaterial:()=>gs,MultisampleSystem:()=>i.DT,NineSlicePlane:()=>ys,NoiseFilter:()=>y,ObjectRenderer:()=>i.Pt,ObjectRendererSystem:()=>i.IH,ObservablePoint:()=>i.oA,PI_2:()=>i.TO,PRECISION:()=>i.Pk,ParticleContainer:()=>Ts,ParticleRenderer:()=>Es,PlaneGeometry:()=>ms,PluginSystem:()=>i.$o,Point:()=>i.bR,Polygon:()=>i.tS,Prepare:()=>Qs,Program:()=>i.BP,ProjectionSystem:()=>i.hk,Quad:()=>i.kO,QuadUv:()=>i.X1,RAD_TO_DEG:()=>i.bO,RENDERER_TYPE:()=>i.h3,Rectangle:()=>i.M_,RenderTexture:()=>i.Y7,RenderTexturePool:()=>i.O1,RenderTextureSystem:()=>i.Bw,Renderer:()=>i.A4,ResizePlugin:()=>N,Resource:()=>i.FW,RopeGeometry:()=>_s,RoundedRectangle:()=>i.TE,Runner:()=>i.by,SAMPLER_TYPES:()=>i.XZ,SCALE_MODES:()=>i.M6,SHAPES:()=>i.HY,SVGResource:()=>i.$f,ScissorSystem:()=>i.s9,Shader:()=>i.Mt,ShaderSystem:()=>i.$P,SimpleMesh:()=>xs,SimplePlane:()=>vs,SimpleRope:()=>bs,Sprite:()=>a,SpriteMaskFilter:()=>i.ah,Spritesheet:()=>ni,StartupSystem:()=>i.fE,State:()=>i.Uw,StateSystem:()=>i.D8,StencilSystem:()=>i.iH,SystemManager:()=>i.zi,TARGETS:()=>i.dW,TEXT_GRADIENT:()=>Cs,TYPES:()=>i.QE,TYPES_TO_BYTES_PER_COMPONENT:()=>Tt,TYPES_TO_BYTES_PER_PIXEL:()=>Et,TemporaryDisplayObject:()=>r.dC,Text:()=>Fs,TextFormat:()=>ui,TextMetrics:()=>Ms,TextStyle:()=>Rs,Texture:()=>i.gP,TextureGCSystem:()=>i.lB,TextureMatrix:()=>i.NW,TextureSystem:()=>i.vB,TextureUvs:()=>i.OE,Ticker:()=>i.Rv,TickerPlugin:()=>i.y,TilingSprite:()=>ei,TilingSpriteRenderer:()=>ii,TimeLimiter:()=>Ks,Transform:()=>i.dL,TransformFeedback:()=>i.wF,TransformFeedbackSystem:()=>i.vT,UPDATE_PRIORITY:()=>i.dQ,UniformGroup:()=>i.k2,VERSION:()=>i.xv,VideoResource:()=>i.A5,ViewSystem:()=>i.vr,ViewableBuffer:()=>i.u3,WRAP_MODES:()=>i.uR,XMLFormat:()=>ci,XMLStringFormat:()=>di,accessibleTarget:()=>D,autoDetectFormat:()=>fi,autoDetectRenderer:()=>i.q5,autoDetectResource:()=>i.Nc,cacheTextureArray:()=>Ae,checkDataUrl:()=>q,checkExtension:()=>V,checkMaxIfStatementsInShader:()=>i.uC,convertToList:()=>H,copySearchParams:()=>Ue,createStringVariations:()=>we,createTexture:()=>pe,createUBOElements:()=>i._J,curves:()=>Vt,defaultFilterVertex:()=>i.Eo,defaultVertex:()=>i.MT,detectAvif:()=>Pe,detectCompressedTextures:()=>Xe,detectDefaults:()=>Le,detectMp4:()=>Fe,detectOgv:()=>Oe,detectWebm:()=>Be,detectWebp:()=>Ie,extensions:()=>i.XO,filters:()=>x,generateProgram:()=>i.CF,generateUniformBufferSync:()=>i.He,getFontFamilyName:()=>se,getTestContext:()=>i.WD,getUBOData:()=>i.RO,graphicsUtils:()=>ls,groupD8:()=>i.ER,isMobile:()=>i.Fr,isSingleItem:()=>X,loadBitmapFont:()=>Si,loadDDS:()=>At,loadImageBitmap:()=>me,loadJson:()=>Q,loadKTX:()=>Mt,loadSVG:()=>ve,loadTextures:()=>_e,loadTxt:()=>K,loadVideo:()=>be,loadWebFont:()=>ne,parseDDS:()=>ht,parseKTX:()=>Ct,resolveCompressedTextureUrl:()=>It,resolveTextureUrl:()=>Ne,settings:()=>i.W0,spritesheetAsset:()=>li,uniformParsers:()=>i.$Z,unsafeEvalSupported:()=>i.ff,utils:()=>i.Wp}),s.r(t);var i=s(609),r=s(685);const n=new i.bR,o=new Uint16Array([0,1,2,0,2,3]);class a extends r.mc{constructor(e){super(),this._anchor=new i.oA(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new i.Q1(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=i.B9.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||i.gP.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=o,this.pluginName='batch',this.isSprite=!0,this._roundPixels=i.W0.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=i.Wp.sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=i.Wp.sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,s=t.a,r=t.b,n=t.c,o=t.d,a=t.tx,l=t.ty,h=this.vertexData,u=e.trim,c=e.orig,d=this._anchor;let p=0,f=0,g=0,m=0;if(u?(f=u.x-d._x*c.width,p=f+u.width,m=u.y-d._y*c.height,g=m+u.height):(f=-d._x*c.width,p=f+c.width,m=-d._y*c.height,g=m+c.height),h[0]=s*f+n*m+a,h[1]=o*m+r*f+l,h[2]=s*p+n*m+a,h[3]=o*m+r*p+l,h[4]=s*p+n*g+a,h[5]=o*g+r*p+l,h[6]=s*f+n*g+a,h[7]=o*g+r*f+l,this._roundPixels){const e=i.W0.RESOLUTION;for(let t=0;t<h.length;++t)h[t]=Math.round(h[t]*e)/e}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,s=e.orig,r=this._anchor,n=this.transform.worldTransform,o=n.a,a=n.b,l=n.c,h=n.d,u=n.tx,c=n.ty,d=-r._x*s.width,p=d+s.width,f=-r._y*s.height,g=f+s.height;if(t[0]=o*d+l*f+u,t[1]=h*f+a*d+c,t[2]=o*p+l*f+u,t[3]=h*f+a*p+c,t[4]=o*p+l*g+u,t[5]=h*g+a*p+c,t[6]=o*d+l*g+u,t[7]=h*g+a*d+c,this._roundPixels){const e=i.W0.RESOLUTION;for(let s=0;s<t.length;++s)t[s]=Math.round(t[s]*e)/e}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return 0===this.children.length?(this._localBounds||(this._localBounds=new r.cz),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new i.M_),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,n);const t=this._texture.orig.width,s=this._texture.orig.height,i=-t*this.anchor.x;let r=0;return n.x>=i&&n.x<i+t&&(r=-s*this.anchor.y,n.y>=r&&n.y<r+s)}destroy(e){if(super.destroy(e),this._texture.off('update',this._onTextureUpdate,this),this._anchor=null,'boolean'==typeof e?e:e?.texture){const t='boolean'==typeof e?e:e?.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){const s=e instanceof i.gP?e:i.gP.from(e,t);return new a(s)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=i.Wp.sign(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=i.Wp.sign(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off('update',this._onTextureUpdate,this),this._texture=e||i.gP.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once('update',this._onTextureUpdate,this)))}}const l=new i.uq;r.q9.prototype._cacheAsBitmap=!1,r.q9.prototype._cacheData=null,r.q9.prototype._cacheAsBitmapResolution=null,r.q9.prototype._cacheAsBitmapMultisample=null;class h{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(r.q9.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;let t;this._cacheAsBitmap=e,e?(this._cacheData||(this._cacheData=new h),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}),r.q9.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))},r.q9.prototype._initCachedDisplayObject=function(e){if(this._cacheData?.sprite)return;const t=this.alpha;this.alpha=1,e.batch.flush();const s=this.getLocalBounds(new i.M_,!0);if(this.filters?.length){const e=this.filters[0].padding;s.pad(e)}const r=this.cacheAsBitmapResolution||e.resolution;s.ceil(r),s.width=Math.max(s.width,1/r),s.height=Math.max(s.height,1/r);const n=e.renderTexture.current,o=e.renderTexture.sourceFrame.clone(),h=e.renderTexture.destinationFrame.clone(),u=e.projection.transform,c=i.Y7.create({width:s.width,height:s.height,resolution:r,multisample:this.cacheAsBitmapMultisample??e.multisample}),d=`cacheAsBitmap_${i.Wp.uid()}`;this._cacheData.textureCacheId=d,i.t5.addToCache(c.baseTexture,d),i.gP.addToCache(c,d);const p=this.transform.localTransform.copyTo(l).invert().translate(-s.x,-s.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:c,clear:!0,transform:p,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=u,e.renderTexture.bind(n,o,h),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const f=new a(c);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-s.x/s.width,f.anchor.y=-s.y/s.height,f.alpha=t,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=f.containsPoint.bind(f)},r.q9.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))},r.q9.prototype._initCachedDisplayObjectCanvas=function(e){if(this._cacheData?.sprite)return;const t=this.getLocalBounds(new i.M_,!0),s=this.alpha;this.alpha=1;const r=e.canvasContext.activeContext,n=e._projTransform,o=this.cacheAsBitmapResolution||e.resolution;t.ceil(o),t.width=Math.max(t.width,1/o),t.height=Math.max(t.height,1/o);const h=i.Y7.create({width:t.width,height:t.height,resolution:o}),u=`cacheAsBitmap_${i.Wp.uid()}`;this._cacheData.textureCacheId=u,i.t5.addToCache(h.baseTexture,u),i.gP.addToCache(h,u);const c=l;this.transform.localTransform.copyTo(c),c.invert(),c.tx-=t.x,c.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:h,clear:!0,transform:c,skipUpdateTransform:!1}),e.canvasContext.activeContext=r,e._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=s;const d=new a(h);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-t.x/t.width,d.anchor.y=-t.y/t.height,d.alpha=s,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=d.containsPoint.bind(d)},r.q9.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},r.q9.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},r.q9.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,i.t5.removeFromCache(this._cacheData.textureCacheId),i.gP.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},r.q9.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)},r.q9.prototype.name=null,r.mc.prototype.getChildByName=function(e,t){for(let t=0,s=this.children.length;t<s;t++)if(this.children[t].name===e)return this.children[t];if(t)for(let t=0,s=this.children.length;t<s;t++){const s=this.children[t];if(!s.getChildByName)continue;const i=s.getChildByName(e,!0);if(i)return i}return null},r.q9.prototype.getGlobalPosition=function(e=new i.bR,t=!1){return this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e};class u extends i.dJ{constructor(e=1){super(i.MT,'varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n',{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}const c={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},d=['varying vec2 vBlurTexCoords[%size%];','uniform sampler2D uSampler;','void main(void)','{','    gl_FragColor = vec4(0.0);','    %blur%','}'].join('\n');class p extends i.dJ{constructor(e,t=8,s=4,r=i.dJ.defaultResolution,n=5){const o=function(e,t){const s=Math.ceil(e/2);let i,r='\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }',n='';i=t?'vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);':'vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);';for(let t=0;t<e;t++){let e=i.replace('%index%',t.toString());e=e.replace('%sampleIndex%',t-(s-1)+'.0'),n+=e,n+='\n'}return r=r.replace('%blur%',n),r=r.replace('%size%',e.toString()),r}(n,e),a=function(e){const t=c[e],s=t.length;let i,r=d,n='';for(let r=0;r<e;r++){let o='gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;'.replace('%index%',r.toString());i=r,r>=s&&(i=e-r-1),o=o.replace('%value%',t[i].toString()),n+=o,n+='\n'}return r=r.replace('%blur%',n),r=r.replace('%size%',e.toString()),r}(n);super(o,a),this.horizontal=e,this.resolution=r,this._quality=0,this.quality=s,this.blur=t}apply(e,t,s,r){if(s?this.horizontal?this.uniforms.strength=1/s.width*(s.width/t.width):this.uniforms.strength=1/s.height*(s.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,t,s,r);else{const n=e.getFilterTexture(),o=e.renderer;let a=t,l=n;this.state.blend=!1,e.applyFilter(this,a,l,i.fr.CLEAR);for(let t=1;t<this.passes-1;t++){e.bindAndClear(a,i.fr.BLIT),this.uniforms.uSampler=l;const t=l;l=a,a=t,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,l,s,r),e.returnFilterTexture(n)}}get blur(){return this.strength}set blur(e){this.padding=1+2*Math.abs(e),this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class f extends i.dJ{constructor(e=8,t=4,s=i.dJ.defaultResolution,r=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new p(!0,e,t,s,r),this.blurYFilter=new p(!1,e,t,s,r),this.resolution=s,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,s,r){const n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){const n=e.getFilterTexture();this.blurXFilter.apply(e,t,n,i.fr.CLEAR),this.blurYFilter.apply(e,n,s,r),e.returnFilterTexture(n)}else o?this.blurYFilter.apply(e,t,s,r):this.blurXFilter.apply(e,t,s,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}}class g extends i.dJ{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(i.Eo,'varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n',e),this.alpha=1}_loadMatrix(e,t=!1){let s=e;t&&(this._multiply(s,this.uniforms.m,e),s=this._colorMatrix(s)),this.uniforms.m=s}_multiply(e,t,s){return e[0]=t[0]*s[0]+t[1]*s[5]+t[2]*s[10]+t[3]*s[15],e[1]=t[0]*s[1]+t[1]*s[6]+t[2]*s[11]+t[3]*s[16],e[2]=t[0]*s[2]+t[1]*s[7]+t[2]*s[12]+t[3]*s[17],e[3]=t[0]*s[3]+t[1]*s[8]+t[2]*s[13]+t[3]*s[18],e[4]=t[0]*s[4]+t[1]*s[9]+t[2]*s[14]+t[3]*s[19]+t[4],e[5]=t[5]*s[0]+t[6]*s[5]+t[7]*s[10]+t[8]*s[15],e[6]=t[5]*s[1]+t[6]*s[6]+t[7]*s[11]+t[8]*s[16],e[7]=t[5]*s[2]+t[6]*s[7]+t[7]*s[12]+t[8]*s[17],e[8]=t[5]*s[3]+t[6]*s[8]+t[7]*s[13]+t[8]*s[18],e[9]=t[5]*s[4]+t[6]*s[9]+t[7]*s[14]+t[8]*s[19]+t[9],e[10]=t[10]*s[0]+t[11]*s[5]+t[12]*s[10]+t[13]*s[15],e[11]=t[10]*s[1]+t[11]*s[6]+t[12]*s[11]+t[13]*s[16],e[12]=t[10]*s[2]+t[11]*s[7]+t[12]*s[12]+t[13]*s[17],e[13]=t[10]*s[3]+t[11]*s[8]+t[12]*s[13]+t[13]*s[18],e[14]=t[10]*s[4]+t[11]*s[9]+t[12]*s[14]+t[13]*s[19]+t[14],e[15]=t[15]*s[0]+t[16]*s[5]+t[17]*s[10]+t[18]*s[15],e[16]=t[15]*s[1]+t[16]*s[6]+t[17]*s[11]+t[18]*s[16],e[17]=t[15]*s[2]+t[16]*s[7]+t[17]*s[12]+t[18]*s[17],e[18]=t[15]*s[3]+t[16]*s[8]+t[17]*s[13]+t[18]*s[18],e[19]=t[15]*s[4]+t[16]*s[9]+t[17]*s[14]+t[18]*s[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const s=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(s,t)}tint(e,t){const[s,r,n]=i.Q1.shared.setValue(e).toArray(),o=[s,0,0,0,0,0,r,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(o,t)}greyscale(e,t){const s=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(s,t)}blackAndWhite(e){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],e)}hue(e,t){e=(e||0)/180*Math.PI;const s=Math.cos(e),i=Math.sin(e),r=1/3,n=(0,Math.sqrt)(r),o=[s+(1-s)*r,r*(1-s)-n*i,r*(1-s)+n*i,0,0,r*(1-s)+n*i,s+r*(1-s),r*(1-s)-n*i,0,0,r*(1-s)-n*i,r*(1-s)+n*i,s+r*(1-s),0,0,0,0,0,1,0];this._loadMatrix(o,t)}contrast(e,t){const s=(e||0)+1,i=-.5*(s-1),r=[s,0,0,0,i,0,s,0,0,i,0,0,s,0,i,0,0,0,1,0];this._loadMatrix(r,t)}saturate(e=0,t){const s=2*e/3+1,i=-.5*(s-1),r=[s,i,i,0,0,i,s,i,0,0,i,i,s,0,0,0,0,0,1,0];this._loadMatrix(r,t)}desaturate(){this.saturate(-1)}negative(e){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],e)}sepia(e){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],e)}technicolor(e){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],e)}polaroid(e){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],e)}toBGR(e){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],e)}kodachrome(e){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],e)}browni(e){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],e)}vintage(e){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],e)}colorTone(e,t,s,r,n){e=e||.2,t=t||.15,s=s||16770432,r=r||3375104;const o=i.Q1.shared,[a,l,h]=o.setValue(s).toArray(),[u,c,d]=o.setValue(r).toArray(),p=[.3,.59,.11,0,0,a,l,h,e,0,u,c,d,t,0,a-u,l-c,h-d,0,0];this._loadMatrix(p,n)}night(e,t){const s=[-2*(e=e||.1),-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0];this._loadMatrix(s,t)}predator(e,t){const s=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(s,t)}lsd(e){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],e)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}g.prototype.grayscale=g.prototype.greyscale;class m extends i.dJ{constructor(e,t){const s=new i.uq;e.renderable=!1,super('attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n','varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n',{mapSampler:e._texture,filterMatrix:s,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=s,null==t&&(t=20),this.scale=new i.bR(t,t)}apply(e,t,s,i){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const r=this.maskSprite.worldTransform,n=Math.sqrt(r.a*r.a+r.b*r.b),o=Math.sqrt(r.c*r.c+r.d*r.d);0!==n&&0!==o&&(this.uniforms.rotation[0]=r.a/n,this.uniforms.rotation[1]=r.b/n,this.uniforms.rotation[2]=r.c/o,this.uniforms.rotation[3]=r.d/o),e.applyFilter(this,t,s,i)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}}class v extends i.dJ{constructor(){super('\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n','varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}}class y extends i.dJ{constructor(e=.5,t=Math.random()){super(i.Eo,'precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n',{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}const x={AlphaFilter:u,BlurFilter:f,BlurFilterPass:p,ColorMatrixFilter:g,DisplacementFilter:m,FXAAFilter:v,NoiseFilter:y};Object.entries(x).forEach(([e,t])=>{Object.defineProperty(x,e,{get:()=>(i.Wp.deprecation('7.1.0',`filters.${e} has moved to ${e}`),t)})});const b=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(i.Rv.system.add(this.tickerUpdate,this,i.dQ.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(i.Rv.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&'touch'===e.pointerType||globalThis.document.dispatchEvent(new PointerEvent('pointermove',{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}};class T{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=T.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new i.bR,this.page=new i.bR,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,s){throw new Error('initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.')}initUIEvent(e,t,s,i,r){throw new Error('initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.')}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class w extends T{constructor(){super(...arguments),this.client=new i.bR,this.movement=new i.bR,this.offset=new i.bR,this.global=new i.bR,this.screen=new i.bR}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,s){return e.worldTransform.applyInverse(s||this.global,t)}getModifierState(e){return'getModifierState'in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,s,i,r,n,o,a,l,h,u,c,d,p,f){throw new Error('Method not implemented.')}}class E extends w{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return'pointermove'===this.type||'mousemove'===this.type||'touchmove'===this.type?[this]:[]}getPredictedEvents(){throw new Error('getPredictedEvents is not supported!')}}class C extends w{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}C.DOM_DELTA_PIXEL=0,C.DOM_DELTA_LINE=1,C.DOM_DELTA_PAGE=2;const S=new i.bR,A=new i.bR;class M{constructor(e){this.dispatch=new i.Wp.EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping('pointerdown',this.mapPointerDown),this.addEventMapping('pointermove',this.mapPointerMove),this.addEventMapping('pointerout',this.mapPointerOut),this.addEventMapping('pointerleave',this.mapPointerOut),this.addEventMapping('pointerover',this.mapPointerOver),this.addEventMapping('pointerup',this.mapPointerUp),this.addEventMapping('pointerupoutside',this.mapPointerUpOutside),this.addEventMapping('wheel',this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((e,t)=>e.priority-t.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let s=0,i=t.length;s<i;s++)t[s].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){b.pauseUpdate=!0;const s=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?'hitTestMoveRecursive':'hitTestRecursive'](this.rootTarget,this.rootTarget.eventMode,S.set(e,t),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(e,t){if(!e.target)return;const s=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let i=0,r=s.length-1;i<r;i++)if(e.currentTarget=s[i],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!e.propagationStopped&&!e.propagationImmediatelyStopped){e.eventPhase=e.BUBBLING_PHASE;for(let i=s.length-2;i>=0;i--)if(e.currentTarget=s[i],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,s=this._allInteractiveElements){if(0===s.length)return;e.eventPhase=e.BUBBLING_PHASE;const i=Array.isArray(t)?t:[t];for(let t=s.length-1;t>=0;t--)i.forEach(i=>{e.currentTarget=s[t],this.notifyTarget(e,i)})}propagationPath(e){const t=[e];for(let s=0;s<2048&&e!==this.rootTarget;s++){if(!e.parent)throw new Error('Cannot find propagation path to disconnected target');t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,s,i,r,n=!1){let o=!1;if(this._interactivePrune(e))return null;if(('dynamic'===e.eventMode||'dynamic'===t)&&(b.pauseUpdate=!1),e.interactiveChildren&&e.children){const a=e.children;for(let l=a.length-1;l>=0;l--){const h=a[l],u=this.hitTestMoveRecursive(h,this._isInteractive(t)?t:h.eventMode,s,i,r,n||r(e,s));if(u){if(u.length>0&&!u[u.length-1].parent)continue;const t=e.isInteractive();(u.length>0||t)&&(t&&this._allInteractiveElements.push(e),u.push(e)),0===this._hitElements.length&&(this._hitElements=u),o=!0}}}const a=this._isInteractive(t),l=e.isInteractive();return a&&l&&this._allInteractiveElements.push(e),n||this._hitElements.length>0?null:o?this._hitElements:a&&!r(e,s)&&i(e,s)?l?[e]:[]:null}hitTestRecursive(e,t,s,i,r){if(this._interactivePrune(e)||r(e,s))return null;if(('dynamic'===e.eventMode||'dynamic'===t)&&(b.pauseUpdate=!1),e.interactiveChildren&&e.children){const n=e.children;for(let o=n.length-1;o>=0;o--){const a=n[o],l=this.hitTestRecursive(a,this._isInteractive(t)?t:a.eventMode,s,i,r);if(l){if(l.length>0&&!l[l.length-1].parent)continue;const t=e.isInteractive();return(l.length>0||t)&&l.push(e),l}}}const n=this._isInteractive(t),o=e.isInteractive();return n&&i(e,s)?o?[e]:[]:null}_isInteractive(e){return'static'===e||'dynamic'===e}_interactivePrune(e){return!(e&&!e.isMask&&e.visible&&e.renderable&&'none'!==e.eventMode&&('passive'!==e.eventMode||e.interactiveChildren)&&!e.isMask)}hitPruneFn(e,t){if(e.hitArea&&(e.worldTransform.applyInverse(t,A),!e.hitArea.contains(A.x,A.y)))return!0;if(e._mask){const s=e._mask.isMaskData?e._mask.maskObject:e._mask;if(s&&!s.containsPoint?.(t))return!0}return!1}hitTestFn(e,t){return'passive'!==e.eventMode&&(!!e.hitArea||!!e.containsPoint&&e.containsPoint(t))}notifyTarget(e,t){const s=`on${t=t??e.type}`;e.currentTarget[s]?.(e);const i=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,i),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof E))return void console.warn('EventBoundary cannot map a non-pointer event as a pointer event');const t=this.createPointerEvent(e);if(this.dispatchEvent(t,'pointerdown'),'touch'===t.pointerType)this.dispatchEvent(t,'touchstart');else if('mouse'===t.pointerType||'pen'===t.pointerType){const e=2===t.button;this.dispatchEvent(t,e?'rightdown':'mousedown')}this.trackingData(e.pointerId).pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){if(!(e instanceof E))return void console.warn('EventBoundary cannot map a non-pointer event as a pointer event');this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const t=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const s='mouse'===t.pointerType||'pen'===t.pointerType,i=this.trackingData(e.pointerId),r=this.findMountedTarget(i.overTargets);if(i.overTargets?.length>0&&r!==t.target){const i='mousemove'===e.type?'mouseout':'pointerout',n=this.createPointerEvent(e,i,r);if(this.dispatchEvent(n,'pointerout'),s&&this.dispatchEvent(n,'mouseout'),!t.composedPath().includes(r)){const i=this.createPointerEvent(e,'pointerleave',r);for(i.eventPhase=i.AT_TARGET;i.target&&!t.composedPath().includes(i.target);)i.currentTarget=i.target,this.notifyTarget(i),s&&this.notifyTarget(i,'mouseleave'),i.target=i.target.parent;this.freeEvent(i)}this.freeEvent(n)}if(r!==t.target){const i='mousemove'===e.type?'mouseover':'pointerover',n=this.clonePointerEvent(t,i);this.dispatchEvent(n,'pointerover'),s&&this.dispatchEvent(n,'mouseover');let o=r?.parent;for(;o&&o!==this.rootTarget.parent&&o!==t.target;)o=o.parent;if(!o||o===this.rootTarget.parent){const e=this.clonePointerEvent(t,'pointerenter');for(e.eventPhase=e.AT_TARGET;e.target&&e.target!==r&&e.target!==this.rootTarget.parent;)e.currentTarget=e.target,this.notifyTarget(e),s&&this.notifyTarget(e,'mouseenter'),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(n)}const n=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?n.push('pointermove'):this.dispatchEvent(t,'pointermove'),o&&n.push('globalpointermove'),'touch'===t.pointerType&&(this.moveOnAll?n.splice(1,0,'touchmove'):this.dispatchEvent(t,'touchmove'),o&&n.push('globaltouchmove')),s&&(this.moveOnAll?n.splice(1,0,'mousemove'):this.dispatchEvent(t,'mousemove'),o&&n.push('globalmousemove'),this.cursor=t.target?.cursor),n.length>0&&this.all(t,n),this._allInteractiveElements.length=0,this._hitElements.length=0,i.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){if(!(e instanceof E))return void console.warn('EventBoundary cannot map a non-pointer event as a pointer event');const t=this.trackingData(e.pointerId),s=this.createPointerEvent(e),i='mouse'===s.pointerType||'pen'===s.pointerType;this.dispatchEvent(s,'pointerover'),i&&this.dispatchEvent(s,'mouseover'),'mouse'===s.pointerType&&(this.cursor=s.target?.cursor);const r=this.clonePointerEvent(s,'pointerenter');for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),i&&this.notifyTarget(r,'mouseenter'),r.target=r.target.parent;t.overTargets=s.composedPath(),this.freeEvent(s),this.freeEvent(r)}mapPointerOut(e){if(!(e instanceof E))return void console.warn('EventBoundary cannot map a non-pointer event as a pointer event');const t=this.trackingData(e.pointerId);if(t.overTargets){const s='mouse'===e.pointerType||'pen'===e.pointerType,i=this.findMountedTarget(t.overTargets),r=this.createPointerEvent(e,'pointerout',i);this.dispatchEvent(r),s&&this.dispatchEvent(r,'mouseout');const n=this.createPointerEvent(e,'pointerleave',i);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,'mouseleave'),n.target=n.target.parent;t.overTargets=null,this.freeEvent(r),this.freeEvent(n)}this.cursor=null}mapPointerUp(e){if(!(e instanceof E))return void console.warn('EventBoundary cannot map a non-pointer event as a pointer event');const t=performance.now(),s=this.createPointerEvent(e);if(this.dispatchEvent(s,'pointerup'),'touch'===s.pointerType)this.dispatchEvent(s,'touchend');else if('mouse'===s.pointerType||'pen'===s.pointerType){const e=2===s.button;this.dispatchEvent(s,e?'rightup':'mouseup')}const i=this.trackingData(e.pointerId),r=this.findMountedTarget(i.pressTargetsByButton[e.button]);let n=r;if(r&&!s.composedPath().includes(r)){let t=r;for(;t&&!s.composedPath().includes(t);){if(s.currentTarget=t,this.notifyTarget(s,'pointerupoutside'),'touch'===s.pointerType)this.notifyTarget(s,'touchendoutside');else if('mouse'===s.pointerType||'pen'===s.pointerType){const e=2===s.button;this.notifyTarget(s,e?'rightupoutside':'mouseupoutside')}t=t.parent}delete i.pressTargetsByButton[e.button],n=t}if(n){const r=this.clonePointerEvent(s,'click');r.target=n,r.path=null,i.clicksByButton[e.button]||(i.clicksByButton[e.button]={clickCount:0,target:r.target,timeStamp:t});const o=i.clicksByButton[e.button];if(o.target===r.target&&t-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=r.target,o.timeStamp=t,r.detail=o.clickCount,'mouse'===r.pointerType){const e=2===r.button;this.dispatchEvent(r,e?'rightclick':'click')}else'touch'===r.pointerType&&this.dispatchEvent(r,'tap');this.dispatchEvent(r,'pointertap'),this.freeEvent(r)}this.freeEvent(s)}mapPointerUpOutside(e){if(!(e instanceof E))return void console.warn('EventBoundary cannot map a non-pointer event as a pointer event');const t=this.trackingData(e.pointerId),s=this.findMountedTarget(t.pressTargetsByButton[e.button]),i=this.createPointerEvent(e);if(s){let r=s;for(;r;)i.currentTarget=r,this.notifyTarget(i,'pointerupoutside'),'touch'===i.pointerType?this.notifyTarget(i,'touchendoutside'):('mouse'===i.pointerType||'pen'===i.pointerType)&&this.notifyTarget(i,2===i.button?'rightupoutside':'mouseupoutside'),r=r.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(i)}mapWheel(e){if(!(e instanceof C))return void console.warn('EventBoundary cannot map a non-wheel event as a wheel event');const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let s=1;s<e.length&&e[s].parent===t;s++)t=e[s];return t}createPointerEvent(e,t,s){const i=this.allocateEvent(E);return this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.nativeEvent=e.nativeEvent,i.originalEvent=e,i.target=s??this.hitTest(i.global.x,i.global.y)??this._hitElements[0],'string'==typeof t&&(i.type=t),i}createWheelEvent(e){const t=this.allocateEvent(C);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const s=this.allocateEvent(E);return s.nativeEvent=e.nativeEvent,s.originalEvent=e.originalEvent,this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.target=e.target,s.path=e.composedPath().slice(),s.type=t??s.type,s}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof E&&t instanceof E&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof w&&t instanceof w&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error('It is illegal to free an event not managed by this EventBoundary!');const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const s=e.currentTarget._events[t];if(s&&e.currentTarget.isInteractive())if('fn'in s)s.once&&e.currentTarget.removeListener(t,s.fn,void 0,!0),s.fn.call(s.context,e);else for(let i=0,r=s.length;i<r&&!e.propagationImmediatelyStopped;i++)s[i].once&&e.currentTarget.removeListener(t,s[i].fn,void 0,!0),s[i].fn.call(s[i].context,e)}}const P={touchstart:'pointerdown',touchend:'pointerup',touchendoutside:'pointerupoutside',touchmove:'pointermove',touchcancel:'pointercancel'},I=class e{constructor(t){this.supportsTouchEvents='ontouchstart'in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new M(null),b.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new E(null),this.rootWheelEvent=new C(null),this.cursorStyles={default:'inherit',pointer:'pointer'},this.features=new Proxy({...e.defaultEventFeatures},{set:(e,t,s)=>('globalMove'===t&&(this.rootBoundary.enableGlobalMoveEvents=s),e[t]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:s,resolution:i}=this.renderer;this.setTargetElement(s),this.resolution=i,e._defaultEventMode=t.eventMode??'auto',Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||'default';let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const s=this.cursorStyles[e];if(s)switch(typeof s){case'string':t&&(this.domElement.style.cursor=s);break;case'function':s(e);break;case'object':t&&Object.assign(this.domElement.style,s)}else t&&'string'==typeof e&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!('cancelable'in e))&&e.preventDefault();for(let e=0,s=t.length;e<s;e++){const s=t[e],i=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,b.pointerMoved();const t=this.normalizeToPointerData(e);for(let e=0,s=t.length;e<s;e++){const s=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const s=t!==this.domElement?'outside':'',i=this.normalizeToPointerData(e);for(let e=0,t=i.length;e<t;e++){const t=this.bootstrapEvent(this.rootPointerEvent,i[e]);t.type+=s,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);for(let e=0,s=t.length;e<s;e++){const s=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,b.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;b.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming='none',e.msTouchAction='none'):this.supportsPointerEvents&&(e.touchAction='none')),this.supportsPointerEvents?(globalThis.document.addEventListener('pointermove',this.onPointerMove,!0),this.domElement.addEventListener('pointerdown',this.onPointerDown,!0),this.domElement.addEventListener('pointerleave',this.onPointerOverOut,!0),this.domElement.addEventListener('pointerover',this.onPointerOverOut,!0),globalThis.addEventListener('pointerup',this.onPointerUp,!0)):(globalThis.document.addEventListener('mousemove',this.onPointerMove,!0),this.domElement.addEventListener('mousedown',this.onPointerDown,!0),this.domElement.addEventListener('mouseout',this.onPointerOverOut,!0),this.domElement.addEventListener('mouseover',this.onPointerOverOut,!0),globalThis.addEventListener('mouseup',this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener('touchstart',this.onPointerDown,!0),this.domElement.addEventListener('touchend',this.onPointerUp,!0),this.domElement.addEventListener('touchmove',this.onPointerMove,!0))),this.domElement.addEventListener('wheel',this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;b.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming='',e.msTouchAction=''):this.supportsPointerEvents&&(e.touchAction=''),this.supportsPointerEvents?(globalThis.document.removeEventListener('pointermove',this.onPointerMove,!0),this.domElement.removeEventListener('pointerdown',this.onPointerDown,!0),this.domElement.removeEventListener('pointerleave',this.onPointerOverOut,!0),this.domElement.removeEventListener('pointerover',this.onPointerOverOut,!0),globalThis.removeEventListener('pointerup',this.onPointerUp,!0)):(globalThis.document.removeEventListener('mousemove',this.onPointerMove,!0),this.domElement.removeEventListener('mousedown',this.onPointerDown,!0),this.domElement.removeEventListener('mouseout',this.onPointerOverOut,!0),this.domElement.removeEventListener('mouseover',this.onPointerOverOut,!0),globalThis.removeEventListener('mouseup',this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener('touchstart',this.onPointerDown,!0),this.domElement.removeEventListener('touchend',this.onPointerUp,!0),this.domElement.removeEventListener('touchmove',this.onPointerMove,!0))),this.domElement.removeEventListener('wheel',this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,s){const i=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},r=1/this.resolution;e.x=(t-i.left)*(this.domElement.width/i.width)*r,e.y=(s-i.top)*(this.domElement.height/i.height)*r}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let s=0,i=e.changedTouches.length;s<i;s++){const i=e.changedTouches[s];typeof i.button>'u'&&(i.button=0),typeof i.buttons>'u'&&(i.buttons=1),typeof i.isPrimary>'u'&&(i.isPrimary=1===e.touches.length&&'touchstart'===e.type),typeof i.width>'u'&&(i.width=i.radiusX||1),typeof i.height>'u'&&(i.height=i.radiusY||1),typeof i.tiltX>'u'&&(i.tiltX=0),typeof i.tiltY>'u'&&(i.tiltY=0),typeof i.pointerType>'u'&&(i.pointerType='touch'),typeof i.pointerId>'u'&&(i.pointerId=i.identifier||0),typeof i.pressure>'u'&&(i.pressure=i.force||.5),typeof i.twist>'u'&&(i.twist=0),typeof i.tangentialPressure>'u'&&(i.tangentialPressure=0),typeof i.layerX>'u'&&(i.layerX=i.offsetX=i.clientX),typeof i.layerY>'u'&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,i.type=e.type,t.push(i)}else if(globalThis.MouseEvent&&(!(e instanceof MouseEvent)||this.supportsPointerEvents&&e instanceof globalThis.PointerEvent))t.push(e);else{const s=e;typeof s.isPrimary>'u'&&(s.isPrimary=!0),typeof s.width>'u'&&(s.width=1),typeof s.height>'u'&&(s.height=1),typeof s.tiltX>'u'&&(s.tiltX=0),typeof s.tiltY>'u'&&(s.tiltY=0),typeof s.pointerType>'u'&&(s.pointerType='mouse'),typeof s.pointerId>'u'&&(s.pointerId=1),typeof s.pressure>'u'&&(s.pressure=.5),typeof s.twist>'u'&&(s.twist=0),typeof s.tangentialPressure>'u'&&(s.tangentialPressure=0),s.isNormalized=!0,t.push(s)}return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,'pointerleave'===e.type&&(e.type='pointerout'),e.type.startsWith('mouse')&&(e.type=e.type.replace('mouse','pointer')),e.type.startsWith('touch')&&(e.type=P[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};I.extension={name:'events',type:[i.Ag.RendererSystem,i.Ag.CanvasRendererSystem]},I.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let R=I;function L(e){return'dynamic'===e||'static'===e}i.XO.add(R);const k={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??L(R.defaultEventMode)},set interactive(e){i.Wp.deprecation('7.2.0','Setting interactive is deprecated, use eventMode = \'none\'/\'passive\'/\'auto\'/\'static\'/\'dynamic\' instead.'),this._internalInteractive=e,this.eventMode=e?'static':'auto'},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??R.defaultEventMode},set eventMode(e){this._internalInteractive=L(e),this._internalEventMode=e},isInteractive(){return'static'===this.eventMode||'dynamic'===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(e,t,s){const i='boolean'==typeof s&&s||'object'==typeof s&&s.capture,r='object'==typeof s?s.signal:void 0,n='object'==typeof s&&!0===s.once,o='function'==typeof t?void 0:t;e=i?`${e}capture`:e;const a='function'==typeof t?t:t.handleEvent,l=this;r&&r.addEventListener('abort',()=>{l.off(e,a,o)}),n?l.once(e,a,o):l.on(e,a,o)},removeEventListener(e,t,s){const i='function'==typeof t?void 0:t;e='boolean'==typeof s&&s||'object'==typeof s&&s.capture?`${e}capture`:e,t='function'==typeof t?t:t.handleEvent,this.off(e,t,i)},dispatchEvent(e){if(!(e instanceof T))throw new Error('DisplayObject cannot propagate events outside of the Federated Events API');return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}};r.q9.mixin(k);const D={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:'button',accessiblePointerEvents:'auto',accessibleChildren:!0,renderId:-1};r.q9.mixin(D);class B{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(i.Wp.isMobile.tablet||i.Wp.isMobile.phone)&&this.createTouchHook();const t=document.createElement('div');t.style.width='100px',t.style.height='100px',t.style.position='absolute',t.style.top='0px',t.style.left='0px',t.style.zIndex=2..toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener('keydown',this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement('button');e.style.width='1px',e.style.height='1px',e.style.position='absolute',e.style.top='-1000px',e.style.left='-1000px',e.style.zIndex=2..toString(),e.style.backgroundColor='#FF0000',e.title='select to enable accessibility for this content',e.addEventListener('focus',()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener('mousemove',this._onMouseMove,!0),globalThis.removeEventListener('keydown',this._onKeyDown,!1),this.renderer.on('postrender',this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener('mousemove',this._onMouseMove,!0),globalThis.addEventListener('keydown',this._onKeyDown,!1),this.renderer.off('postrender',this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let e=0;e<t.length;e++)this.updateAccessibleObjects(t[e])}update(){const e=performance.now();if(i.Wp.isMobile.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:s,width:r,height:n}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:l}=this.renderer,h=r/o*l,u=n/a*l;let c=this.div;c.style.left=`${t}px`,c.style.top=`${s}px`,c.style.width=`${o}px`,c.style.height=`${a}px`;for(let e=0;e<this.children.length;e++){const t=this.children[e];if(t.renderId!==this.renderId)t._accessibleActive=!1,i.Wp.removeItems(this.children,e,1),this.div.removeChild(t._accessibleDiv),this.pool.push(t._accessibleDiv),t._accessibleDiv=null,e--;else{c=t._accessibleDiv;let e=t.hitArea;const s=t.worldTransform;t.hitArea?(c.style.left=(s.tx+e.x*s.a)*h+'px',c.style.top=(s.ty+e.y*s.d)*u+'px',c.style.width=e.width*s.a*h+'px',c.style.height=e.height*s.d*u+'px'):(e=t.getBounds(),this.capHitArea(e),c.style.left=e.x*h+'px',c.style.top=e.y*u+'px',c.style.width=e.width*h+'px',c.style.height=e.height*u+'px',c.title!==t.accessibleTitle&&null!==t.accessibleTitle&&(c.title=t.accessibleTitle),c.getAttribute('aria-label')!==t.accessibleHint&&null!==t.accessibleHint&&c.setAttribute('aria-label',t.accessibleHint)),(t.accessibleTitle!==c.title||t.tabIndex!==c.tabIndex)&&(c.title=t.accessibleTitle,c.tabIndex=t.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:s}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>s&&(e.height=s-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement('button'),t.style.width='100px',t.style.height='100px',t.style.backgroundColor=this.debug?'rgba(255,255,255,0.5)':'transparent',t.style.position='absolute',t.style.zIndex=2..toString(),t.style.borderStyle='none',navigator.userAgent.toLowerCase().includes('chrome')?t.setAttribute('aria-live','off'):t.setAttribute('aria-live','polite'),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute('aria-relevant','additions'):t.setAttribute('aria-relevant','text'),t.addEventListener('click',this._onClick.bind(this)),t.addEventListener('focus',this._onFocus.bind(this)),t.addEventListener('focusout',this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&null!==e.accessibleTitle?t.title=e.accessibleTitle:(!e.accessibleHint||null===e.accessibleHint)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&null!==e.accessibleHint&&t.setAttribute('aria-label',e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:s}=e.target,i=this.renderer.events.rootBoundary,r=Object.assign(new T(i),{target:s});i.rootTarget=this.renderer.lastObjectRendered,t.forEach(e=>i.dispatchEvent(r,e))}_onClick(e){this._dispatchEvent(e,['click','pointertap','tap'])}_onFocus(e){e.target.getAttribute('aria-live')||e.target.setAttribute('aria-live','assertive'),this._dispatchEvent(e,['mouseover'])}_onFocusOut(e){e.target.getAttribute('aria-live')||e.target.setAttribute('aria-live','polite'),this._dispatchEvent(e,['mouseout'])}_onKeyDown(e){9===e.keyCode&&this.activate()}_onMouseMove(e){0===e.movementX&&0===e.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener('mousemove',this._onMouseMove,!0),globalThis.removeEventListener('keydown',this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}B.extension={name:'accessibility',type:[i.Ag.RendererPlugin,i.Ag.CanvasRendererPlugin]},i.XO.add(B);const F=class e{constructor(t){this.stage=new r.mc,t=Object.assign({forceCanvas:!1},t),this.renderer=(0,i.q5)(t),e._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,s){const i=e._plugins.slice(0);i.reverse(),i.forEach(e=>{e.destroy.call(this)}),this.stage.destroy(s),this.stage=null,this.renderer.destroy(t),this.renderer=null}};F._plugins=[];let O=F;i.XO.handleByList(i.Ag.Application,O._plugins);class N{static init(e){Object.defineProperty(this,'resizeTo',{set(e){globalThis.removeEventListener('resize',this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener('resize',this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let e,t;if(this.cancelResize(),this._resizeTo===globalThis.window)e=globalThis.innerWidth,t=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:i}=this._resizeTo;e=s,t=i}this.renderer.resize(e,t),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener('resize',this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}N.extension=i.Ag.Application,i.XO.add(N);const U={loader:i.Ag.LoadParser,resolver:i.Ag.ResolveParser,cache:i.Ag.CacheParser,detection:i.Ag.DetectionParser};i.XO.handle(i.Ag.Asset,e=>{const t=e.ref;Object.entries(U).filter(([e])=>!!t[e]).forEach(([e,s])=>i.XO.add(Object.assign(t[e],{extension:t[e].extension??s})))},e=>{const t=e.ref;Object.keys(U).filter(e=>!!t[e]).forEach(e=>i.XO.remove(t[e]))});class G{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log('[BackgroundLoader] assets: ',this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<t;s++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function V(e,t){const s=e.split('?')[0],r=i.Wp.path.extname(s).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const H=(e,t,s=!1)=>(Array.isArray(e)||(e=[e]),t?e.map(e=>'string'==typeof e||s?t(e):e):e);const W=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const s=H(e);let r;for(let e=0;e<this.parsers.length;e++){const i=this.parsers[e];if(i.test(t)){r=i.getCacheableAssets(s,t);break}}r||(r={},s.forEach(e=>{r[e]=t}));const n=Object.keys(r),o={cacheKeys:n,keys:s};if(s.forEach(e=>{this._cacheMap.set(e,o)}),n.forEach(e=>{const s=r?r[e]:t;this._cache.has(e)&&this._cache.get(e)!==s&&console.warn('[Cache] already has key:',e),this._cache.set(e,r[e])}),t instanceof i.gP){const e=t;s.forEach(t=>{e.baseTexture!==i.gP.EMPTY.baseTexture&&i.t5.addToCache(e.baseTexture,t),i.gP.addToCache(e,t)})}}remove(e){if(!this._cacheMap.has(e))return void console.warn(`[Assets] Asset id ${e} was not found in the Cache`);const t=this._cacheMap.get(e);t.cacheKeys.forEach(e=>{this._cache.delete(e)}),t.keys.forEach(e=>{this._cacheMap.delete(e)})}get parsers(){return this._parsers}},X=e=>!Array.isArray(e);class j{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,s)=>(this._parsersValidated=!1,e[t]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const s={promise:null,parser:null};return s.promise=(async()=>{let i=null,r=null;if(t.loadParser&&(r=this._parserHash[t.loadParser],r||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!r){for(let s=0;s<this.parsers.length;s++){const i=this.parsers[s];if(i.load&&i.test?.(e,t,this)){r=i;break}}if(!r)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}i=await r.load(e,t,this),s.parser=r;for(let e=0;e<this.parsers.length;e++){const r=this.parsers[e];r.parse&&r.parse&&await(r.testParse?.(i,t,this))&&(i=await r.parse(i,t,this)||i,s.parser=r)}return i})(),s}async load(e,t){this._parsersValidated||this._validateParsers();let s=0;const r={},n=X(e),o=H(e,e=>({alias:[e],src:e})),a=o.length,l=o.map(async e=>{const n=i.Wp.path.toAbsolute(e.src);if(!r[e.src])try{this.promiseCache[n]||(this.promiseCache[n]=this._getLoadPromiseAndParser(n,e)),r[e.src]=await this.promiseCache[n].promise,t&&t(++s/a)}catch(t){throw delete this.promiseCache[n],delete r[e.src],new Error(`[Loader.load] Failed to load ${n}.\n${t}`)}});return await Promise.all(l),n?r[o[0].src]:r}async unload(e){const t=H(e,e=>({alias:[e],src:e})).map(async e=>{const t=i.Wp.path.toAbsolute(e.src),s=this.promiseCache[t];if(s){const i=await s.promise;delete this.promiseCache[t],s.parser?.unload?.(i,e,this)}});await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t}),{})}}var Y=(e=>(e[e.Low=0]='Low',e[e.Normal=1]='Normal',e[e.High=2]='High',e))(Y||{});function q(e,t){if(Array.isArray(t)){for(const s of t)if(e.startsWith(`data:${s}`))return!0;return!1}return e.startsWith(`data:${t}`)}const Q={extension:{type:i.Ag.LoadParser,priority:Y.Low},name:'loadJson',test:e=>q(e,'application/json')||V(e,'.json'),load:async e=>await(await i.W0.ADAPTER.fetch(e)).json()};i.XO.add(Q);const K={name:'loadTxt',extension:{type:i.Ag.LoadParser,priority:Y.Low},test:e=>q(e,'text/plain')||V(e,'.txt'),load:async e=>await(await i.W0.ADAPTER.fetch(e)).text()};i.XO.add(K);const Z=['normal','bold','100','200','300','400','500','600','700','800','900'],J=['.ttf','.otf','.woff','.woff2'],ee=['font/ttf','font/otf','font/woff','font/woff2'],te=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function se(e){const t=i.Wp.path.extname(e),s=i.Wp.path.basename(e,t).replace(/(-|_)/g,' ').toLowerCase().split(' ').map(e=>e.charAt(0).toUpperCase()+e.slice(1));let r=s.length>0;for(const e of s)if(!e.match(te)){r=!1;break}let n=s.join(' ');return r||(n=`"${n.replace(/[\\"]/g,'\\$&')}"`),n}const ie=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function re(e){return ie.test(e)?e:encodeURI(e)}const ne={extension:{type:i.Ag.LoadParser,priority:Y.Low},name:'loadWebFont',test:e=>q(e,ee)||V(e,J),async load(e,t){const s=i.W0.ADAPTER.getFontFaceSet();if(s){const i=[],r=t.data?.family??se(e),n=t.data?.weights?.filter(e=>Z.includes(e))??['normal'],o=t.data??{};for(let t=0;t<n.length;t++){const a=n[t],l=new FontFace(r,`url(${re(e)})`,{...o,weight:a});await l.load(),s.add(l),i.push(l)}return 1===i.length?i[0]:i}return console.warn('[loadWebFont] FontFace API is not supported. Skipping loading font'),null},unload(e){(Array.isArray(e)?e:[e]).forEach(e=>i.W0.ADAPTER.getFontFaceSet().delete(e))}};i.XO.add(ne);let oe=null;class ae{constructor(){oe||(oe=URL.createObjectURL(new Blob(['(function() {\n  "use strict";\n  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";\n  async function checkImageBitmap() {\n    try {\n      if (typeof createImageBitmap != "function")\n        return !1;\n      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);\n      return imageBitmap.width === 1 && imageBitmap.height === 1;\n    } catch {\n      return !1;\n    }\n  }\n  checkImageBitmap().then((result) => {\n    self.postMessage(result);\n  });\n})();\n'],{type:'application/javascript'}))),this.worker=new Worker(oe)}}ae.revokeObjectURL=function(){oe&&(URL.revokeObjectURL(oe),oe=null)};let le=null;class he{constructor(){le||(le=URL.createObjectURL(new Blob(['(function() {\n  "use strict";\n  async function loadImageBitmap(url) {\n    const response = await fetch(url);\n    if (!response.ok)\n      throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: ${response.status} ${response.statusText}`);\n    const imageBlob = await response.blob();\n    return await createImageBitmap(imageBlob);\n  }\n  self.onmessage = async (event) => {\n    try {\n      const imageBitmap = await loadImageBitmap(event.data.data[0]);\n      self.postMessage({\n        data: imageBitmap,\n        uuid: event.data.uuid,\n        id: event.data.id\n      }, [imageBitmap]);\n    } catch (e) {\n      self.postMessage({\n        error: e,\n        uuid: event.data.uuid,\n        id: event.data.id\n      });\n    }\n  };\n})();\n'],{type:'application/javascript'}))),this.worker=new Worker(le)}}he.revokeObjectURL=function(){le&&(URL.revokeObjectURL(le),le=null)};let ue,ce=0;const de=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise(e=>{const{worker:t}=new ae;t.addEventListener('message',s=>{t.terminate(),ae.revokeObjectURL(),e(s.data)})})),this._isImageBitmapSupported}loadImageBitmap(e){return this._run('loadImageBitmap',[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===ue&&(ue=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<ue&&(this._createdWorkers++,e=(new he).worker,e.addEventListener('message',e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){void 0!==e.error?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const s=new Promise((s,i)=>{this.queue.push({id:e,arguments:t,resolve:s,reject:i})});return this.next(),s}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),s=t.id;this.resolveHash[ce]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:ce++,id:s})}};function pe(e,t,s){e.resource.internal=!0;const r=new i.gP(e),n=()=>{delete t.promiseCache[s],W.has(s)&&W.remove(s)};return r.baseTexture.once('destroyed',()=>{s in t.promiseCache&&(console.warn('[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture.'),n())}),r.once('destroyed',()=>{e.destroyed||(console.warn('[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture.'),n())}),r}const fe=['.jpeg','.jpg','.png','.webp','.avif'],ge=['image/jpeg','image/png','image/webp','image/avif'];async function me(e){const t=await i.W0.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const s=await t.blob();return await createImageBitmap(s)}const _e={name:'loadTextures',extension:{type:i.Ag.LoadParser,priority:Y.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:'anonymous'},test:e=>q(e,ge)||V(e,fe),async load(e,t,s){const r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let n;n=r?this.config.preferWorkers&&await de.isImageBitmapSupported()?await de.loadImageBitmap(e):await me(e):await new Promise((t,s)=>{const i=new Image;i.crossOrigin=this.config.crossOrigin,i.src=e,i.complete?t(i):(i.onload=()=>t(i),i.onerror=e=>s(e))});const o={...t.data};o.resolution??(o.resolution=i.Wp.getResolutionOfUrl(e)),r&&void 0===o.resourceOptions?.ownsImageBitmap&&(o.resourceOptions={...o.resourceOptions},o.resourceOptions.ownsImageBitmap=!0);const a=new i.t5(n,o);return a.resource.src=e,pe(a,s,e)},unload(e){e.destroy(!0)}};i.XO.add(_e);const ve={extension:{type:i.Ag.LoadParser,priority:Y.High},name:'loadSVG',test:e=>q(e,'image/svg+xml')||V(e,'.svg'),testParse:async e=>i.$f.test(e),async parse(e,t,s){const r=new i.$f(e,t?.data?.resourceOptions);await r.load();const n=new i.t5(r,{resolution:i.Wp.getResolutionOfUrl(e),...t?.data});return n.resource.src=t.src,pe(n,s,t.src)},load:async(e,t)=>(await i.W0.ADAPTER.fetch(e)).text(),unload:_e.unload};i.XO.add(ve);const ye=['.mp4','.m4v','.webm','.ogv'],xe=['video/mp4','video/webm','video/ogg'],be={name:'loadVideo',extension:{type:i.Ag.LoadParser,priority:Y.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test:e=>q(e,xe)||V(e,ye),async load(e,t,s){let r;const n=await(await i.W0.ADAPTER.fetch(e)).blob(),o=URL.createObjectURL(n);try{const n={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...t?.data?.resourceOptions,autoLoad:!0},a=new i.A5(o,n);await a.load();const l=new i.t5(a,{alphaMode:await i.Wp.detectVideoAlphaMode(),resolution:i.Wp.getResolutionOfUrl(e),...t?.data});l.resource.src=e,r=pe(l,s,e),r.baseTexture.once('destroyed',()=>{URL.revokeObjectURL(o)})}catch(e){throw URL.revokeObjectURL(o),e}return r},unload(e){e.destroy(!0)}};function Te(e,t,s,i,r){const n=t[s];for(let o=0;o<n.length;o++){const a=n[o];s<t.length-1?Te(e.replace(i[s],a),t,s+1,i,r):r.push(e.replace(i[s],a))}}function we(e){const t=e.match(/\{(.*?)\}/g),s=[];if(t){const i=[];t.forEach(e=>{const t=e.substring(1,e.length-1).split(',');i.push(t)}),Te(e,i,0,t,s)}else s.push(e);return s}i.XO.add(be);class Ee{constructor(){this._defaultBundleIdentifierOptions={connector:'-',createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,'')},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,'bar'!==this._extractAssetIdFromBundle('foo',this._createBundleAssetId('foo','bar')))throw new Error('[Resolver] GenerateBundleAssetId are not working correctly')}prefer(...e){e.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if('string'==typeof e)this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join('&')}}getAlias(e){const{alias:t,name:s,src:i,srcs:r}=e;return H(t||s||i||r,e=>'string'==typeof e?e:Array.isArray(e)?e.map(e=>e?.src??e?.srcs??e):e?.src||e?.srcs?e.src??e.srcs:e,!0)}addManifest(e){this._manifest&&console.warn('[Resolver] Manifest already exists, this will be overwritten'),this._manifest=e,e.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(e,t){const s=[];Array.isArray(t)?t.forEach(t=>{const i=t.src??t.srcs,r=t.alias??t.name;let n;if('string'==typeof r){const t=this._createBundleAssetId(e,r);s.push(t),n=[r,t]}else{const t=r.map(t=>this._createBundleAssetId(e,t));s.push(...t),n=[...r,...t]}this.add({...t,alias:n,src:i})}):Object.keys(t).forEach(i=>{const r=[i,this._createBundleAssetId(e,i)];if('string'==typeof t[i])this.add({alias:r,src:t[i]});else if(Array.isArray(t[i]))this.add({alias:r,src:t[i]});else{const e=t[i],s=e.src??e.srcs;this.add({...e,alias:r,src:Array.isArray(s)?s:[s]})}s.push(...r)}),this._bundles[e]=s}add(e,t,s,r,n){const o=[];let a;'string'==typeof e||Array.isArray(e)&&'string'==typeof e[0]?(i.Wp.deprecation('7.2.0','Assets.add now uses an object instead of individual parameters.\nPlease use Assets.add({ alias, src, data, format, loadParser }) instead.'),o.push({alias:e,src:t,data:s,format:r,loadParser:n})):Array.isArray(e)?o.push(...e):o.push(e),a=e=>{this.hasKey(e)&&console.warn(`[Resolver] already has key: ${e} overwriting`)},H(o).forEach(e=>{const{src:t,srcs:s}=e;let{data:i,format:r,loadParser:n}=e;const o=H(t||s).map(e=>'string'==typeof e?we(e):Array.isArray(e)?e:[e]),l=this.getAlias(e);Array.isArray(l)?l.forEach(a):a(l);const h=[];o.forEach(e=>{e.forEach(e=>{let t={};if('object'!=typeof e){t.src=e;for(let s=0;s<this._parsers.length;s++){const i=this._parsers[s];if(i.test(e)){t=i.parse(e);break}}}else i=e.data??i,r=e.format??r,n=e.loadParser??n,t={...t,...e};if(!l)throw new Error(`[Resolver] alias is undefined for this asset: ${t.src}`);t=this.buildResolvedAsset(t,{aliases:l,data:i,format:r,loadParser:n}),h.push(t)})}),l.forEach(e=>{this._assetMap[e]=h})})}resolveBundle(e){const t=X(e);e=H(e);const s={};return e.forEach(e=>{const t=this._bundles[e];if(t){const i=this.resolve(t),r={};for(const t in i){const s=i[t];r[this._extractAssetIdFromBundle(e,t)]=s}s[e]=r}}),t?s[e[0]]:s}resolveUrl(e){const t=this.resolve(e);if('string'!=typeof e){const e={};for(const s in t)e[s]=t[s].src;return e}return t.src}resolve(e){const t=X(e);e=H(e);const s={};return e.forEach(e=>{if(!this._resolverHash[e])if(this._assetMap[e]){let t=this._assetMap[e];const s=t[0],i=this._getPreferredOrder(t);i?.priority.forEach(e=>{i.params[e].forEach(s=>{const i=t.filter(t=>!!t[e]&&t[e]===s);i.length&&(t=i)})}),this._resolverHash[e]=t[0]??s}else this._resolverHash[e]=this.buildResolvedAsset({alias:[e],src:e},{});s[e]=this._resolverHash[e]}),t?s[e[0]]:s}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const t=e[0],s=this._preferredOrder.find(e=>e.params.format.includes(t.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;return`${e}${/\?/.test(e)?'&':'?'}${this._defaultSearchParams}`}buildResolvedAsset(e,t){const{aliases:s,data:r,loadParser:n,format:o}=t;return(this._basePath||this._rootPath)&&(e.src=i.Wp.path.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=s??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...r||{},...e.data},e.loadParser=n??e.loadParser,e.format=o??e.format??i.Wp.path.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}}class Ce{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Ee,this.loader=new j,this.cache=W,this._backgroundLoader=new G(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized)return void console.warn('[Assets]AssetManager already initialized, did you load before calling this Assets.init()?');if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let t=e.manifest;'string'==typeof t&&(t=await this.load(t)),this.resolver.addManifest(t)}const t=e.texturePreference?.resolution??1,s='number'==typeof t?[t]:t,i=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:i,resolution:s}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,s,i,r){this.resolver.add(e,t,s,i,r)}async load(e,t){this._initialized||await this.init();const s=X(e),i=H(e).map(e=>{if('string'!=typeof e){const t=this.resolver.getAlias(e);return t.some(e=>!this.resolver.hasKey(e))&&this.add(e),Array.isArray(t)?t[0]:t}return this.resolver.hasKey(e)||this.add({alias:e,src:e}),e}),r=this.resolver.resolve(i),n=await this._mapLoadToResolve(r,t);return s?n[i[0]]:n}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let s=!1;'string'==typeof e&&(s=!0,e=[e]);const i=this.resolver.resolveBundle(e),r={},n=Object.keys(i);let o=0,a=0;const l=()=>{t?.(++o/a)},h=n.map(e=>{const t=i[e];return a+=Object.keys(t).length,this._mapLoadToResolve(t,l).then(t=>{r[e]=t})});return await Promise.all(h),s?r[e[0]]:r}async backgroundLoad(e){this._initialized||await this.init(),'string'==typeof e&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),'string'==typeof e&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(e=>{this._backgroundLoader.add(Object.values(e))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if('string'==typeof e)return W.get(e);const t={};for(let s=0;s<e.length;s++)t[s]=W.get(e[s]);return t}async _mapLoadToResolve(e,t){const s=Object.values(e),i=Object.keys(e);this._backgroundLoader.active=!1;const r=await this.loader.load(s,t);this._backgroundLoader.active=!0;const n={};return s.forEach((e,t)=>{const s=r[e.src],o=[e.src];e.alias&&o.push(...e.alias),n[i[t]]=s,W.set(o,s)}),n}async unload(e){this._initialized||await this.init();const t=H(e).map(e=>'string'!=typeof e?e.src:e),s=this.resolver.resolve(t);await this._unloadFromResolved(s)}async unloadBundle(e){this._initialized||await this.init(),e=H(e);const t=this.resolver.resolveBundle(e),s=Object.keys(t).map(e=>this._unloadFromResolved(t[e]));await Promise.all(s)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(e=>{W.remove(e.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const s of e.detections)e.skipDetections||await s.test()?t=await s.add(t):e.skipDetections||(t=await s.remove(t));return t=t.filter((e,s)=>t.indexOf(e)===s),t}get detections(){return this._detections}get preferWorkers(){return _e.config.preferWorkers}set preferWorkers(e){i.Wp.deprecation('7.2.0','Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead.'),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(t=>t in e).forEach(s=>{t.config[s]=e[s]})})}}const Se=new Ce;i.XO.handleByList(i.Ag.LoadParser,Se.loader.parsers).handleByList(i.Ag.ResolveParser,Se.resolver.parsers).handleByList(i.Ag.CacheParser,Se.cache.parsers).handleByList(i.Ag.DetectionParser,Se.detections);const Ae={extension:i.Ag.CacheParser,test:e=>Array.isArray(e)&&e.every(e=>e instanceof i.gP),getCacheableAssets:(e,t)=>{const s={};return e.forEach(e=>{t.forEach((t,i)=>{s[e+(0===i?'':i+1)]=t})}),s}};async function Me(e){if('Image'in globalThis)return new Promise(t=>{const s=new Image;s.onload=()=>{t(!0)},s.onerror=()=>{t(!1)},s.src=e});if('createImageBitmap'in globalThis&&'fetch'in globalThis){try{const t=await(await fetch(e)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}i.XO.add(Ae);const Pe={extension:{type:i.Ag.DetectionParser,priority:1},test:async()=>Me('data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A='),add:async e=>[...e,'avif'],remove:async e=>e.filter(e=>'avif'!==e)};i.XO.add(Pe);const Ie={extension:{type:i.Ag.DetectionParser,priority:0},test:async()=>Me('data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA='),add:async e=>[...e,'webp'],remove:async e=>e.filter(e=>'webp'!==e)};i.XO.add(Ie);const Re=['png','jpg','jpeg'],Le={extension:{type:i.Ag.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...Re],remove:async e=>e.filter(e=>!Re.includes(e))};i.XO.add(Le);const ke='WorkerGlobalScope'in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function De(e){return!ke&&''!==document.createElement('video').canPlayType(e)}const Be={extension:{type:i.Ag.DetectionParser,priority:0},test:async()=>De('video/webm'),add:async e=>[...e,'webm'],remove:async e=>e.filter(e=>'webm'!==e)};i.XO.add(Be);const Fe={extension:{type:i.Ag.DetectionParser,priority:0},test:async()=>De('video/mp4'),add:async e=>[...e,'mp4','m4v'],remove:async e=>e.filter(e=>'mp4'!==e&&'m4v'!==e)};i.XO.add(Fe);const Oe={extension:{type:i.Ag.DetectionParser,priority:0},test:async()=>De('video/ogg'),add:async e=>[...e,'ogv'],remove:async e=>e.filter(e=>'ogv'!==e)};i.XO.add(Oe);const Ne={extension:i.Ag.ResolveParser,test:_e.test,parse:e=>({resolution:parseFloat(i.W0.RETINA_PREFIX.exec(e)?.[1]??'1'),format:i.Wp.path.extname(e).slice(1),src:e})};i.XO.add(Ne);const Ue=(e,t)=>{const s=t.split('?')[1];return s&&(e+=`?${s}`),e};var Ge=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]='COMPRESSED_RGB_S3TC_DXT1_EXT',e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]='COMPRESSED_RGBA_S3TC_DXT1_EXT',e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]='COMPRESSED_RGBA_S3TC_DXT3_EXT',e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]='COMPRESSED_RGBA_S3TC_DXT5_EXT',e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]='COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT',e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]='COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT',e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]='COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT',e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]='COMPRESSED_SRGB_S3TC_DXT1_EXT',e[e.COMPRESSED_R11_EAC=37488]='COMPRESSED_R11_EAC',e[e.COMPRESSED_SIGNED_R11_EAC=37489]='COMPRESSED_SIGNED_R11_EAC',e[e.COMPRESSED_RG11_EAC=37490]='COMPRESSED_RG11_EAC',e[e.COMPRESSED_SIGNED_RG11_EAC=37491]='COMPRESSED_SIGNED_RG11_EAC',e[e.COMPRESSED_RGB8_ETC2=37492]='COMPRESSED_RGB8_ETC2',e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]='COMPRESSED_RGBA8_ETC2_EAC',e[e.COMPRESSED_SRGB8_ETC2=37493]='COMPRESSED_SRGB8_ETC2',e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]='COMPRESSED_SRGB8_ALPHA8_ETC2_EAC',e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]='COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2',e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]='COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2',e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]='COMPRESSED_RGB_PVRTC_4BPPV1_IMG',e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]='COMPRESSED_RGBA_PVRTC_4BPPV1_IMG',e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]='COMPRESSED_RGB_PVRTC_2BPPV1_IMG',e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]='COMPRESSED_RGBA_PVRTC_2BPPV1_IMG',e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]='COMPRESSED_RGB_ETC1_WEBGL',e[e.COMPRESSED_RGB_ATC_WEBGL=35986]='COMPRESSED_RGB_ATC_WEBGL',e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]='COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL',e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]='COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL',e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]='COMPRESSED_RGBA_ASTC_4x4_KHR',e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]='COMPRESSED_RGBA_BPTC_UNORM_EXT',e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]='COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT',e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]='COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT',e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]='COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT',e))(Ge||{});const Ve={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let He,We;function $e(){We={bptc:He.getExtension('EXT_texture_compression_bptc'),astc:He.getExtension('WEBGL_compressed_texture_astc'),etc:He.getExtension('WEBGL_compressed_texture_etc'),s3tc:He.getExtension('WEBGL_compressed_texture_s3tc'),s3tc_sRGB:He.getExtension('WEBGL_compressed_texture_s3tc_srgb'),pvrtc:He.getExtension('WEBGL_compressed_texture_pvrtc')||He.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc'),etc1:He.getExtension('WEBGL_compressed_texture_etc1'),atc:He.getExtension('WEBGL_compressed_texture_atc')}}const Xe={extension:{type:i.Ag.DetectionParser,priority:2},test:async()=>{const e=i.W0.ADAPTER.createCanvas().getContext('webgl');return e?(He=e,!0):(console.warn('WebGL not available for compressed textures.'),!1)},add:async e=>{We||$e();const t=[];for(const e in We)We[e]&&t.push(e);return[...t,...e]},remove:async e=>(We||$e(),e.filter(e=>!(e in We)))};i.XO.add(Xe);class je extends i.dZ{constructor(e,t={width:1,height:1,autoLoad:!0}){let s,r;'string'==typeof e?(s=e,r=new Uint8Array):(s=null,r=e),super(r,t),this.origin=s,this.buffer=r?new i.u3(r):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==t.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load||(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new i.u3(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this))),this._load}}class ze extends je{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=ze._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||ze._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,s){const i=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;i.pixelStorei(i.UNPACK_ALIGNMENT,4);for(let e=0,t=this.levels;e<t;e++){const{levelID:t,levelWidth:s,levelHeight:r,levelBuffer:n}=this._levelBuffers[e];i.compressedTexImage2D(i.TEXTURE_2D,t,this.format,s,r,0,n)}return!0}onBlobLoaded(){this._levelBuffers=ze._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return's3tc';if(e>=35916&&e<=35919)return's3tc_sRGB';if(e>=37488&&e<=37497)return'etc';if(e>=35840&&e<=35843)return'pvrtc';if(36196===e)return'etc1';if(35986===e||35987===e||34798===e)return'atc';if(e>=36492&&e<=36495)return'bptc';if(37808===e)return'astc';throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,s,i,r,n,o){const a=new Array(s);let l=e.byteOffset,h=n,u=o,c=h+i-1&~(i-1),d=u+r-1&~(r-1),p=c*d*Ve[t];for(let n=0;n<s;n++)a[n]={levelID:n,levelWidth:s>1?h:c,levelHeight:s>1?u:d,levelBuffer:new Uint8Array(e.buffer,l,p)},l+=p,h=h>>1||1,u=u>>1||1,c=h+i-1&~(i-1),d=u+r-1&~(r-1),p=c*d*Ve[t];return a}}const Ye=124,qe=3,Qe=4,Ke=7,Ze=19,Je=2,et=0,tt=1,st=2,it=3,rt=827611204,nt=861165636,ot=894720068,at={[rt]:Ge.COMPRESSED_RGBA_S3TC_DXT1_EXT,[nt]:Ge.COMPRESSED_RGBA_S3TC_DXT3_EXT,[ot]:Ge.COMPRESSED_RGBA_S3TC_DXT5_EXT},lt={70:Ge.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Ge.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Ge.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Ge.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Ge.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Ge.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Ge.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Ge.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Ge.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:Ge.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:Ge.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:Ge.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:Ge.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function ht(e){const t=new Uint32Array(e);if(542327876!==t[0])throw new Error('Invalid DDS file magic word');const s=new Uint32Array(e,0,Ye/Uint32Array.BYTES_PER_ELEMENT),i=s[qe],r=s[Qe],n=s[Ke],o=new Uint32Array(e,Ze*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const s=o[Je];if(808540228!==s){const t=at[s],o=new Uint8Array(e,128);return[new ze(o,{format:t,width:r,height:i,levels:n})]}const a=128,l=new Uint32Array(t.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),h=l[et],u=l[tt],c=l[st],d=l[it],p=lt[h];if(void 0===p)throw new Error(`DDSParser cannot parse texture data with DXGI format ${h}`);if(4===c)throw new Error('DDSParser does not support cubemap textures');if(6===u)throw new Error('DDSParser does not supported 3D texture data');const f=new Array,g=148;if(1===d)f.push(new Uint8Array(e,g));else{const t=Ve[p];let s=0,o=r,a=i;for(let e=0;e<n;e++){s+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*t,o>>>=1,a>>>=1}let l=g;for(let t=0;t<d;t++)f.push(new Uint8Array(e,l,s)),l+=s}return f.map(e=>new ze(e,{format:p,width:r,height:i,levels:n}))}throw 64&a?new Error('DDSParser does not support uncompressed texture data.'):512&a?new Error('DDSParser does not supported YUV uncompressed texture data.'):131072&a?new Error('DDSParser does not support single-channel (lumninance) texture data!'):2&a?new Error('DDSParser does not support single-channel (alpha) texture data!'):new Error('DDSParser failed to load a texture file due to an unknown reason!')}const ut=[171,75,84,88,32,49,49,187,13,10,26,10],ct=12,dt=16,pt=24,ft=28,gt=36,mt=40,_t=44,vt=48,yt=52,xt=56,bt=60,Tt={[i.QE.UNSIGNED_BYTE]:1,[i.QE.UNSIGNED_SHORT]:2,[i.QE.INT]:4,[i.QE.UNSIGNED_INT]:4,[i.QE.FLOAT]:4,[i.QE.HALF_FLOAT]:8},wt={[i.hR.RGBA]:4,[i.hR.RGB]:3,[i.hR.RG]:2,[i.hR.RED]:1,[i.hR.LUMINANCE]:1,[i.hR.LUMINANCE_ALPHA]:2,[i.hR.ALPHA]:1},Et={[i.QE.UNSIGNED_SHORT_4_4_4_4]:2,[i.QE.UNSIGNED_SHORT_5_5_5_1]:2,[i.QE.UNSIGNED_SHORT_5_6_5]:2};function Ct(e,t,s=!1){const r=new DataView(t);if(!function(e,t){for(let s=0;s<ut.length;s++)if(t.getUint8(s)!==ut[s])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}(e,r))return null;const n=67305985===r.getUint32(ct,!0),o=r.getUint32(dt,n),a=r.getUint32(pt,n),l=r.getUint32(ft,n),h=r.getUint32(gt,n),u=r.getUint32(mt,n)||1,c=r.getUint32(_t,n)||1,d=r.getUint32(vt,n)||1,p=r.getUint32(yt,n),f=r.getUint32(xt,n),g=r.getUint32(bt,n);if(0===u||1!==c)throw new Error('Only 2D textures are supported');if(1!==p)throw new Error('CubeTextures are not supported by KTXLoader yet!');if(1!==d)throw new Error('WebGL does not support array textures');const m=h+3&-4,v=u+3&-4,y=new Array(d);let x,b=h*u;if(0===o&&(b=m*v),x=0!==o?Tt[o]?Tt[o]*wt[a]:Et[o]:Ve[l],void 0===x)throw new Error('Unable to resolve the pixel format stored in the *.ktx file!');const T=s?function(e,t,s){const i=new Map;let r=0;for(;r<t;){const n=e.getUint32(64+r,s),o=64+r+4,a=3-(n+3)%4;if(0===n||n>t-r){console.error('KTXLoader: keyAndValueByteSize out of bounds');break}let l=0;for(;l<n&&0!==e.getUint8(o+l);l++);if(-1===l){console.error('KTXLoader: Failed to find null byte terminating kvData key');break}const h=(new TextDecoder).decode(new Uint8Array(e.buffer,o,l)),u=new DataView(e.buffer,o+l+1,n-l-1);i.set(h,u),r+=4+n+a}return i}(r,g,n):null;let w=b*x,E=h,C=u,S=m,A=v,M=64+g;for(let e=0;e<f;e++){const s=r.getUint32(M,n);let i=M+4;for(let s=0;s<d;s++){let r=y[s];r||(r=y[s]=new Array(f)),r[e]={levelID:e,levelWidth:f>1||0!==o?E:S,levelHeight:f>1||0!==o?C:A,levelBuffer:new Uint8Array(t,i,w)},i+=w}M+=s+4,M=M%4!=0?M+4-M%4:M,E=E>>1||1,C=C>>1||1,S=E+4-1&-4,A=C+4-1&-4,w=S*A*x}return 0!==o?{uncompressed:y.map(e=>{let t=e[0].levelBuffer,s=!1;return o===i.QE.FLOAT?t=new Float32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4):o===i.QE.UNSIGNED_INT?(s=!0,t=new Uint32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)):o===i.QE.INT&&(s=!0,t=new Int32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)),{resource:new i.dZ(t,{width:e[0].levelWidth,height:e[0].levelHeight}),type:o,format:s?St(a):a}}),kvData:T}:{compressed:y.map(e=>new ze(null,{format:l,width:h,height:u,levels:f,levelBuffers:e})),kvData:T}}function St(e){switch(e){case i.hR.RGBA:return i.hR.RGBA_INTEGER;case i.hR.RGB:return i.hR.RGB_INTEGER;case i.hR.RG:return i.hR.RG_INTEGER;case i.hR.RED:return i.hR.RED_INTEGER;default:return e}}const At={extension:{type:i.Ag.LoadParser,priority:Y.High},name:'loadDDS',test:e=>V(e,'.dds'),async load(e,t,s){const r=ht(await(await i.W0.ADAPTER.fetch(e)).arrayBuffer()).map(r=>pe(new i.t5(r,{mipmap:i.E8.OFF,alphaMode:i.Gk.NO_PREMULTIPLIED_ALPHA,resolution:i.Wp.getResolutionOfUrl(e),...t.data}),s,e));return 1===r.length?r[0]:r},unload(e){Array.isArray(e)?e.forEach(e=>e.destroy(!0)):e.destroy(!0)}};i.XO.add(At);const Mt={extension:{type:i.Ag.LoadParser,priority:Y.High},name:'loadKTX',test:e=>V(e,'.ktx'),async load(e,t,s){const r=await(await i.W0.ADAPTER.fetch(e)).arrayBuffer(),{compressed:n,uncompressed:o,kvData:a}=Ct(e,r),l=n??o,h={mipmap:i.E8.OFF,alphaMode:i.Gk.NO_PREMULTIPLIED_ALPHA,resolution:i.Wp.getResolutionOfUrl(e),...t.data},u=l.map(t=>{l===o&&Object.assign(h,{type:t.type,format:t.format});const r=t.resource??t,n=new i.t5(r,h);return n.ktxKeyValueData=a,pe(n,s,e)});return 1===u.length?u[0]:u},unload(e){Array.isArray(e)?e.forEach(e=>e.destroy(!0)):e.destroy(!0)}};i.XO.add(Mt);const Pt=['s3tc','s3tc_sRGB','etc','etc1','pvrtc','atc','astc','bptc'],It={extension:i.Ag.ResolveParser,test:e=>{const t=i.Wp.path.extname(e).slice(1);return['basis','ktx','dds'].includes(t)},parse:e=>{const t=e.split('.'),s=t.pop();if(['ktx','dds'].includes(s)){const s=t.pop();if(Pt.includes(s))return{resolution:parseFloat(i.W0.RETINA_PREFIX.exec(e)?.[1]??'1'),format:s,src:e}}return{resolution:parseFloat(i.W0.RETINA_PREFIX.exec(e)?.[1]??'1'),format:s,src:e}}};i.XO.add(It);const Rt=new i.M_,Lt=class e{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(e,t,s,i){const r=new Image;return r.src=await this.base64(e,t,s,i),r}async base64(e,t,s,i){const r=this.canvas(e,i);if(void 0!==r.toBlob)return new Promise((e,i)=>{r.toBlob(t=>{if(!t)return void i(new Error('ICanvas.toBlob failed!'));const s=new FileReader;s.onload=()=>e(s.result),s.onerror=i,s.readAsDataURL(t)},t,s)});if(void 0!==r.toDataURL)return r.toDataURL(t,s);if(void 0!==r.convertToBlob){const e=await r.convertToBlob({type:t,quality:s});return new Promise((t,s)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=s,i.readAsDataURL(e)})}throw new Error('Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented')}canvas(t,s){const{pixels:r,width:n,height:o,flipY:a,premultipliedAlpha:l}=this._rawPixels(t,s);a&&e._flipY(r,n,o),l&&e._unpremultiplyAlpha(r);const h=new i.Wp.CanvasRenderTarget(n,o,1),u=new ImageData(new Uint8ClampedArray(r.buffer),n,o);return h.context.putImageData(u,0,0),h.canvas}pixels(t,s){const{pixels:i,width:r,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,s);return o&&e._flipY(i,r,n),a&&e._unpremultiplyAlpha(i),i}_rawPixels(e,t){const s=this.renderer;if(!s)throw new Error('The Extract has already been destroyed');let r,n,o=!1,a=!1,l=!1;e&&(e instanceof i.Y7?n=e:(n=s.generateTexture(e,{region:t,resolution:s.resolution,multisample:s.multisample}),l=!0,t&&(Rt.width=t.width,Rt.height=t.height,t=Rt)));const h=s.gl;if(n){if(r=n.baseTexture.resolution,t=t??n.frame,o=!1,a=n.baseTexture.alphaMode>0&&n.baseTexture.format===i.hR.RGBA,!l){s.renderTexture.bind(n);const e=n.framebuffer.glFramebuffers[s.CONTEXT_UID];e.blitFramebuffer&&s.framebuffer.bind(e.blitFramebuffer)}}else r=s.resolution,t||((t=Rt).width=s.width/r,t.height=s.height/r),o=!0,a=this._rendererPremultipliedAlpha,s.renderTexture.bind();const u=Math.max(Math.round(t.width*r),1),c=Math.max(Math.round(t.height*r),1),d=new Uint8Array(4*u*c);return h.readPixels(Math.round(t.x*r),Math.round(t.y*r),u,c,h.RGBA,h.UNSIGNED_BYTE,d),l&&n?.destroy(!0),{pixels:d,width:u,height:c,flipY:o,premultipliedAlpha:a}}destroy(){this.renderer=null}static _flipY(e,t,s){const i=t<<2,r=s>>1,n=new Uint8Array(i);for(let t=0;t<r;t++){const r=t*i,o=(s-t-1)*i;n.set(e.subarray(r,r+i)),e.copyWithin(r,o,o+i),e.set(n,o)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let s=0;s<t;s+=4){const t=e[s+3];if(0!==t){const i=255.001/t;e[s]=e[s]*i+.5,e[s+1]=e[s+1]*i+.5,e[s+2]=e[s+2]*i+.5}}}};Lt.extension={name:'extract',type:i.Ag.RendererSystem};let kt=Lt;i.XO.add(kt);const Dt={build(e){const t=e.points;let s,r,n,o,a,l;if(e.type===i.HY.CIRC){const t=e.shape;s=t.x,r=t.y,a=l=t.radius,n=o=0}else if(e.type===i.HY.ELIP){const t=e.shape;s=t.x,r=t.y,a=t.width,l=t.height,n=o=0}else{const t=e.shape,i=t.width/2,h=t.height/2;s=t.x+i,r=t.y+h,a=l=Math.max(0,Math.min(t.radius,Math.min(i,h))),n=i-a,o=h-l}if(!(a>=0&&l>=0&&n>=0&&o>=0))return void(t.length=0);const h=Math.ceil(2.3*Math.sqrt(a+l)),u=8*h+(n?4:0)+(o?4:0);if(t.length=u,0===u)return;if(0===h)return t.length=8,t[0]=t[6]=s+n,t[1]=t[3]=r+o,t[2]=t[4]=s-n,void(t[5]=t[7]=r-o);let c=0,d=4*h+(n?2:0)+2,p=d,f=u;{const e=n+a,i=o,l=s+e,h=s-e,u=r+i;if(t[c++]=l,t[c++]=u,t[--d]=u,t[--d]=h,o){const e=r-i;t[p++]=h,t[p++]=e,t[--f]=e,t[--f]=l}}for(let e=1;e<h;e++){const i=Math.PI/2*(e/h),u=n+Math.cos(i)*a,g=o+Math.sin(i)*l,m=s+u,v=s-u,y=r+g,x=r-g;t[c++]=m,t[c++]=y,t[--d]=y,t[--d]=v,t[p++]=v,t[p++]=x,t[--f]=x,t[--f]=m}{const e=o+l,i=s+n,a=s-n,h=r+e,u=r-e;t[c++]=i,t[c++]=h,t[--f]=u,t[--f]=i,n&&(t[c++]=a,t[c++]=h,t[--f]=u,t[--f]=a)}},triangulate(e,t){const s=e.points,r=t.points,n=t.indices;if(0===s.length)return;let o=r.length/2;const a=o;let l,h;if(e.type!==i.HY.RREC){const t=e.shape;l=t.x,h=t.y}else{const t=e.shape;l=t.x+t.width/2,h=t.y+t.height/2}const u=e.matrix;r.push(e.matrix?u.a*l+u.c*h+u.tx:l,e.matrix?u.b*l+u.d*h+u.ty:h),o++,r.push(s[0],s[1]);for(let e=2;e<s.length;e+=2)r.push(s[e],s[e+1]),n.push(o++,a,o);n.push(a+1,a,o)}};function Bt(e,t=!1){const s=e.length;if(s<6)return;let i=0;for(let t=0,r=e[s-2],n=e[s-1];t<s;t+=2){const s=e[t],o=e[t+1];i+=(s-r)*(o+n),r=s,n=o}if(!t&&i>0||t&&i<=0){const t=s/2;for(let i=t+t%2;i<s;i+=2){const t=s-i-2,r=s-i-1,n=i,o=i+1;[e[t],e[n]]=[e[n],e[t]],[e[r],e[o]]=[e[o],e[r]]}}}const Ft={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let s=e.points;const r=e.holes,n=t.points,o=t.indices;if(s.length>=6){Bt(s,!1);const e=[];for(let t=0;t<r.length;t++){const i=r[t];Bt(i.points,!0),e.push(s.length/2),s=s.concat(i.points)}const t=i.Wp.earcut(s,e,2);if(!t)return;const a=n.length/2;for(let e=0;e<t.length;e+=3)o.push(t[e]+a),o.push(t[e+1]+a),o.push(t[e+2]+a);for(let e=0;e<s.length;e++)n.push(s[e])}}},Ot={build(e){const t=e.shape,s=t.x,i=t.y,r=t.width,n=t.height,o=e.points;o.length=0,r>=0&&n>=0&&o.push(s,i,s+r,i,s+r,i+n,s,i+n)},triangulate(e,t){const s=e.points,i=t.points;if(0===s.length)return;const r=i.length/2;i.push(s[0],s[1],s[2],s[3],s[6],s[7],s[4],s[5]),t.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},Nt={build(e){Dt.build(e)},triangulate(e,t){Dt.triangulate(e,t)}};var Ut=(e=>(e.MITER='miter',e.BEVEL='bevel',e.ROUND='round',e))(Ut||{}),Gt=(e=>(e.BUTT='butt',e.ROUND='round',e.SQUARE='square',e))(Gt||{});const Vt={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let s=Math.ceil(e/this.maxLength);return s<this.minSegments?s=this.minSegments:s>this.maxSegments&&(s=this.maxSegments),s}},Ht=Vt;class Wt{static curveTo(e,t,s,i,r,n){const o=n[n.length-2],a=n[n.length-1]-t,l=o-e,h=i-t,u=s-e,c=Math.abs(a*u-l*h);if(c<1e-8||0===r)return(n[n.length-2]!==e||n[n.length-1]!==t)&&n.push(e,t),null;const d=a*a+l*l,p=h*h+u*u,f=a*h+l*u,g=r*Math.sqrt(d)/c,m=r*Math.sqrt(p)/c,v=g*f/d,y=m*f/p,x=g*u+m*l,b=g*h+m*a,T=l*(m+v),w=a*(m+v),E=u*(g+y),C=h*(g+y);return{cx:x+e,cy:b+t,radius:r,startAngle:Math.atan2(w-b,T-x),endAngle:Math.atan2(C-b,E-x),anticlockwise:l*h>u*a}}static arc(e,t,s,r,n,o,a,l,h){const u=a-o,c=Vt._segmentsCount(Math.abs(u)*n,40*Math.ceil(Math.abs(u)/i.TO)),d=u/(2*c),p=2*d,f=Math.cos(d),g=Math.sin(d),m=c-1,v=m%1/m;for(let e=0;e<=m;++e){const t=d+o+p*(e+v*e),i=Math.cos(t),a=-Math.sin(t);h.push((f*i+g*a)*n+s,(f*-a+g*i)*n+r)}}}class $t{static curveLength(e,t,s,i,r,n,o,a){let l=0,h=0,u=0,c=0,d=0,p=0,f=0,g=0,m=0,v=0,y=0,x=e,b=t;for(let T=1;T<=10;++T)h=T/10,u=h*h,c=u*h,d=1-h,p=d*d,f=p*d,g=f*e+3*p*h*s+3*d*u*r+c*o,m=f*t+3*p*h*i+3*d*u*n+c*a,v=x-g,y=b-m,x=g,b=m,l+=Math.sqrt(v*v+y*y);return l}static curveTo(e,t,s,i,r,n,o){const a=o[o.length-2],l=o[o.length-1];o.length-=2;const h=Vt._segmentsCount($t.curveLength(a,l,e,t,s,i,r,n));let u=0,c=0,d=0,p=0,f=0;o.push(a,l);for(let g=1,m=0;g<=h;++g)m=g/h,u=1-m,c=u*u,d=c*u,p=m*m,f=p*m,o.push(d*a+3*c*m*e+3*u*p*s+f*r,d*l+3*c*m*t+3*u*p*i+f*n)}}function Xt(e,t,s,i,r,n,o,a){let l,h;o?(l=i,h=-s):(l=-i,h=s);const u=e-s*r+l,c=t-i*r+h,d=e+s*n+l,p=t+i*n+h;return a.push(u,c,d,p),2}function jt(e,t,s,i,r,n,o,a){const l=s-e,h=i-t;let u=Math.atan2(l,h),c=Math.atan2(r-e,n-t);a&&u<c?u+=2*Math.PI:!a&&u>c&&(c+=2*Math.PI);let d=u;const p=c-u,f=Math.abs(p),g=Math.sqrt(l*l+h*h),m=1+(15*f*Math.sqrt(g)/Math.PI|0),v=p/m;if(d+=v,a){o.push(e,t,s,i);for(let s=1,i=d;s<m;s++,i+=v)o.push(e,t,e+Math.sin(i)*g,t+Math.cos(i)*g);o.push(e,t,r,n)}else{o.push(s,i,e,t);for(let s=1,i=d;s<m;s++,i+=v)o.push(e+Math.sin(i)*g,t+Math.cos(i)*g,e,t);o.push(r,n,e,t)}return 2*m}function zt(e,t){e.lineStyle.native?function(e,t){let s=0;const r=e.shape,n=e.points||r.points,o=r.type!==i.HY.POLY||r.closeStroke;if(0===n.length)return;const a=t.points,l=t.indices,h=n.length/2,u=a.length/2;let c=u;for(a.push(n[0],n[1]),s=1;s<h;s++)a.push(n[2*s],n[2*s+1]),l.push(c,c+1),c++;o&&l.push(c,u)}(e,t):function(e,t){const s=e.shape;let r=e.points||s.points.slice();const n=t.closePointEps;if(0===r.length)return;const o=e.lineStyle,a=new i.bR(r[0],r[1]),l=new i.bR(r[r.length-2],r[r.length-1]),h=s.type!==i.HY.POLY||s.closeStroke,u=Math.abs(a.x-l.x)<n&&Math.abs(a.y-l.y)<n;if(h){r=r.slice(),u&&(r.pop(),r.pop(),l.set(r[r.length-2],r[r.length-1]));const e=.5*(a.x+l.x),t=.5*(l.y+a.y);r.unshift(e,t),r.push(e,t)}const c=t.points,d=r.length/2;let p=r.length;const f=c.length/2,g=o.width/2,m=g*g,v=o.miterLimit*o.miterLimit;let y=r[0],x=r[1],b=r[2],T=r[3],w=0,E=0,C=-(x-T),S=y-b,A=0,M=0,P=Math.sqrt(C*C+S*S);C/=P,S/=P,C*=g,S*=g;const I=o.alignment,R=2*(1-I),L=2*I;h||(o.cap===Gt.ROUND?p+=jt(y-C*(R-L)*.5,x-S*(R-L)*.5,y-C*R,x-S*R,y+C*L,x+S*L,c,!0)+2:o.cap===Gt.SQUARE&&(p+=Xt(y,x,C,S,R,L,!0,c))),c.push(y-C*R,x-S*R,y+C*L,x+S*L);for(let e=1;e<d-1;++e){y=r[2*(e-1)],x=r[2*(e-1)+1],b=r[2*e],T=r[2*e+1],w=r[2*(e+1)],E=r[2*(e+1)+1],C=-(x-T),S=y-b,P=Math.sqrt(C*C+S*S),C/=P,S/=P,C*=g,S*=g,A=-(T-E),M=b-w,P=Math.sqrt(A*A+M*M),A/=P,M/=P,A*=g,M*=g;const t=b-y,s=x-T,i=b-w,n=E-T,a=t*i+s*n,l=s*i-n*t,h=l<0;if(Math.abs(l)<.001*Math.abs(a)){c.push(b-C*R,T-S*R,b+C*L,T+S*L),a>=0&&(o.join===Ut.ROUND?p+=jt(b,T,b-C*R,T-S*R,b-A*R,T-M*R,c,!1)+4:p+=2,c.push(b-A*L,T-M*L,b+A*R,T+M*R));continue}const u=(-C+y)*(-S+T)-(-C+b)*(-S+x),d=(-A+w)*(-M+T)-(-A+b)*(-M+E),f=(t*d-i*u)/l,I=(n*u-s*d)/l,k=(f-b)*(f-b)+(I-T)*(I-T),D=b+(f-b)*R,B=T+(I-T)*R,F=b-(f-b)*L,O=T-(I-T)*L,N=h?R:L,U=k<=Math.min(t*t+s*s,i*i+n*n)+N*N*m;let G=o.join;if(G===Ut.MITER&&k/m>v&&(G=Ut.BEVEL),U)switch(G){case Ut.MITER:c.push(D,B,F,O);break;case Ut.BEVEL:h?c.push(D,B,b+C*L,T+S*L,D,B,b+A*L,T+M*L):c.push(b-C*R,T-S*R,F,O,b-A*R,T-M*R,F,O),p+=2;break;case Ut.ROUND:h?(c.push(D,B,b+C*L,T+S*L),p+=jt(b,T,b+C*L,T+S*L,b+A*L,T+M*L,c,!0)+4,c.push(D,B,b+A*L,T+M*L)):(c.push(b-C*R,T-S*R,F,O),p+=jt(b,T,b-C*R,T-S*R,b-A*R,T-M*R,c,!1)+4,c.push(b-A*R,T-M*R,F,O))}else{switch(c.push(b-C*R,T-S*R,b+C*L,T+S*L),G){case Ut.MITER:h?c.push(F,O,F,O):c.push(D,B,D,B),p+=2;break;case Ut.ROUND:p+=h?jt(b,T,b+C*L,T+S*L,b+A*L,T+M*L,c,!0)+2:jt(b,T,b-C*R,T-S*R,b-A*R,T-M*R,c,!1)+2}c.push(b-A*R,T-M*R,b+A*L,T+M*L),p+=2}}y=r[2*(d-2)],x=r[2*(d-2)+1],b=r[2*(d-1)],T=r[2*(d-1)+1],C=-(x-T),S=y-b,P=Math.sqrt(C*C+S*S),C/=P,S/=P,C*=g,S*=g,c.push(b-C*R,T-S*R,b+C*L,T+S*L),h||(o.cap===Gt.ROUND?p+=jt(b-C*(R-L)*.5,T-S*(R-L)*.5,b-C*R,T-S*R,b+C*L,T+S*L,c,!1)+2:o.cap===Gt.SQUARE&&(p+=Xt(b,T,C,S,R,L,!1,c)));const k=t.indices,D=Vt.epsilon*Vt.epsilon;for(let e=f;e<p+f-2;++e)y=c[2*e],x=c[2*e+1],b=c[2*(e+1)],T=c[2*(e+1)+1],w=c[2*(e+2)],E=c[2*(e+2)+1],!(Math.abs(y*(T-E)+b*(E-x)+w*(x-T))<D)&&k.push(e,e+1,e+2)}(e,t)}class Yt{static curveLength(e,t,s,i,r,n){const o=e-2*s+r,a=t-2*i+n,l=2*s-2*e,h=2*i-2*t,u=4*(o*o+a*a),c=4*(o*l+a*h),d=l*l+h*h,p=2*Math.sqrt(u+c+d),f=Math.sqrt(u),g=2*u*f,m=2*Math.sqrt(d),v=c/f;return(g*p+f*c*(p-m)+(4*d*u-c*c)*Math.log((2*f+v+p)/(v+m)))/(4*g)}static curveTo(e,t,s,i,r){const n=r[r.length-2],o=r[r.length-1],a=Vt._segmentsCount(Yt.curveLength(n,o,e,t,s,i));let l=0,h=0;for(let u=1;u<=a;++u){const c=u/a;l=n+(e-n)*c,h=o+(t-o)*c,r.push(l+(e+(s-e)*c-l)*c,h+(t+(i-t)*c-h)*c)}}}const qt={[i.HY.POLY]:Ft,[i.HY.CIRC]:Dt,[i.HY.ELIP]:Dt,[i.HY.RECT]:Ot,[i.HY.RREC]:Nt},Qt=[],Kt=[];class Zt{constructor(e,t=null,s=null,i=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=s,this.fillStyle=t,this.matrix=i,this.type=e.type}clone(){return new Zt(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class Jt{constructor(){this.reset()}begin(e,t,s){this.reset(),this.style=e,this.start=t,this.attribStart=s}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const es=new i.bR,ts=class e extends i.JH{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new r.cz,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Kt.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),Qt.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,s=null,i=null){const r=new Zt(e,t,s,i);return this.graphicsData.push(r),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const s=new Zt(e,null,null,t),i=this.graphicsData[this.graphicsData.length-1];return s.lineStyle=i.lineStyle,i.holes.push(s),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let s=0;s<t.length;++s){const i=t[s];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(e,es):es.copyFrom(e),i.shape.contains(es.x,es.y))){let e=!1;if(i.holes)for(let t=0;t<i.holes.length;t++)if(i.holes[t].shape.contains(es.x,es.y)){e=!0;break}if(!e)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let s=null,r=null;this.batches.length>0&&(s=this.batches[this.batches.length-1],r=s.style);for(let n=this.shapeIndex;n<t.length;n++){this.shapeIndex++;const o=t[n],a=o.fillStyle,l=o.lineStyle;qt[o.type].build(o),o.matrix&&this.transformPoints(o.points,o.matrix),(a.visible||l.visible)&&this.processHoles(o.holes);for(let t=0;t<2;t++){const n=0===t?a:l;if(!n.visible)continue;const h=n.texture.baseTexture,u=this.indices.length,c=this.points.length/2;h.wrapMode=i.uR.REPEAT,0===t?this.processFill(o):this.processLine(o);const d=this.points.length/2-c;0!==d&&(s&&!this._compareStyles(r,n)&&(s.end(u,c),s=null),s||(s=Qt.pop()||new Jt,s.begin(n,u,c),this.batches.push(s),r=n),this.addUvs(this.points,e,n.texture,c,d,n.matrix))}}const n=this.indices.length,o=this.points.length/2;if(s&&s.end(n,o),0===this.batches.length)return void(this.batchable=!0);const a=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const t=this.graphicsData[e],s=t.fillStyle,i=t.lineStyle;if(s&&!s.texture.baseTexture.valid||i&&!i.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,s=e.length;t<s;t++){const s=e[t];for(let e=0;e<s.size;e++){const t=s.start+e;this.indicesUint16[t]=this.indicesUint16[t]-s.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE}buildDrawCalls(){let e=++i.t5._globalBatch;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Kt.push(this.drawCalls[e]);this.drawCalls.length=0;const t=this.colors,s=this.textureIds;let r=Kt.pop();r||(r=new i.hq,r.texArray=new i.cc),r.texArray.count=0,r.start=0,r.size=0,r.type=i._4.TRIANGLES;let n=0,o=null,a=0,l=!1,h=i._4.TRIANGLES,u=0;this.drawCalls.push(r);for(let c=0;c<this.batches.length;c++){const d=this.batches[c],p=8,f=d.style,g=f.texture.baseTexture;l!==!!f.native&&(l=!!f.native,h=l?i._4.LINES:i._4.TRIANGLES,o=null,n=p,e++),o!==g&&(o=g,g._batchEnabled!==e&&(n===p&&(e++,n=0,r.size>0&&(r=Kt.pop(),r||(r=new i.hq,r.texArray=new i.cc),this.drawCalls.push(r)),r.start=u,r.size=0,r.texArray.count=0,r.type=h),g.touched=1,g._batchEnabled=e,g._batchLocation=n,g.wrapMode=i.uR.REPEAT,r.texArray.elements[r.texArray.count++]=g,n++)),r.size+=d.size,u+=d.size,a=g._batchLocation,this.addColors(t,f.color,f.alpha,d.attribSize,d.attribStart),this.addTextureIds(s,a,d.attribSize,d.attribStart)}i.t5._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,s=this.colors,i=this.textureIds,r=new ArrayBuffer(3*e.length*4),n=new Float32Array(r),o=new Uint32Array(r);let a=0;for(let r=0;r<e.length/2;r++)n[a++]=e[2*r],n[a++]=e[2*r+1],n[a++]=t[2*r],n[a++]=t[2*r+1],o[a++]=s[r],n[a++]=i[r];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?Ft.triangulate(e,this):qt[e.type].triangulate(e,this)}processLine(e){zt(e,this);for(let t=0;t<e.holes.length;t++)zt(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const s=e[t];qt[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let s=0;s<e.length/2;s++){const i=e[2*s],r=e[2*s+1];e[2*s]=t.a*i+t.c*r+t.tx,e[2*s+1]=t.b*i+t.d*r+t.ty}}addColors(e,t,s,r,n=0){const o=i.Q1.shared.setValue(t).toLittleEndianNumber(),a=i.Q1.shared.setValue(o).toPremultiplied(s);e.length=Math.max(e.length,n+r);for(let t=0;t<r;t++)e[n+t]=a}addTextureIds(e,t,s,i=0){e.length=Math.max(e.length,i+s);for(let r=0;r<s;r++)e[i+r]=t}addUvs(e,t,s,i,r,n=null){let o=0;const a=t.length,l=s.frame;for(;o<r;){let s=e[2*(i+o)],r=e[2*(i+o)+1];if(n){const e=n.a*s+n.c*r+n.tx;r=n.b*s+n.d*r+n.ty,s=e}o++,t.push(s/l.width,r/l.height)}const h=s.baseTexture;(l.width<h.width||l.height<h.height)&&this.adjustUvs(t,s,a,r)}adjustUvs(e,t,s,i){const r=t.baseTexture,n=1e-6,o=s+2*i,a=t.frame,l=a.width/r.width,h=a.height/r.height;let u=a.x/a.width,c=a.y/a.height,d=Math.floor(e[s]+n),p=Math.floor(e[s+1]+n);for(let t=s+2;t<o;t+=2)d=Math.min(d,Math.floor(e[t]+n)),p=Math.min(p,Math.floor(e[t+1]+n));u-=d,c-=p;for(let t=s;t<o;t+=2)e[t]=(e[t]+u)*l,e[t+1]=(e[t+1]+c)*h}};ts.BATCHABLE_SIZE=100;let ss=ts;class is{constructor(){this.color=16777215,this.alpha=1,this.texture=i.gP.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new is;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=i.gP.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class rs extends is{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Gt.BUTT,this.join=Ut.MITER,this.miterLimit=10}clone(){const e=new rs;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Gt.BUTT,this.join=Ut.MITER,this.miterLimit=10}}const ns={},os=class e extends r.mc{constructor(e=null){super(),this.shader=null,this.pluginName='batch',this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new is,this._lineStyle=new rs,this._matrix=null,this._holeMode=!1,this.state=i.Uw.for2d(),this._geometry=e||new ss,this._geometry.refCount++,this._transformID=-1,this._tintColor=new i.Q1(16777215),this.blendMode=i.B9.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new e(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,s,i=.5,r=!1){return'number'==typeof e&&(e={width:e,color:t,alpha:s,alignment:i,native:r}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:i.gP.WHITE,color:e?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Gt.BUTT,join:Ut.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const s=e.width>0&&e.alpha>0;return s?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:s},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new i.tS,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new i.tS,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const s=this.currentPath.points,i=s[s.length-2],r=s[s.length-1];return(i!==e||r!==t)&&s.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,s,i){this._initCurve();const r=this.currentPath.points;return 0===r.length&&this.moveTo(0,0),Yt.curveTo(e,t,s,i,r),this}bezierCurveTo(e,t,s,i,r,n){return this._initCurve(),$t.curveTo(e,t,s,i,r,n,this.currentPath.points),this}arcTo(e,t,s,i,r){this._initCurve(e,t);const n=this.currentPath.points,o=Wt.curveTo(e,t,s,i,r,n);if(o){const{cx:e,cy:t,radius:s,startAngle:i,endAngle:r,anticlockwise:n}=o;this.arc(e,t,s,i,r,n)}return this}arc(e,t,s,r,n,o=!1){if(r===n)return this;if(!o&&n<=r?n+=i.TO:o&&r<=n&&(r+=i.TO),n-r===0)return this;const a=e+Math.cos(r)*s,l=t+Math.sin(r)*s,h=this._geometry.closePointEps;let u=this.currentPath?this.currentPath.points:null;if(u){const e=Math.abs(u[u.length-2]-a),t=Math.abs(u[u.length-1]-l);e<h&&t<h||u.push(a,l)}else this.moveTo(a,l),u=this.currentPath.points;return Wt.arc(a,l,e,t,s,r,n,o,u),this}beginFill(e=0,t){return this.beginTextureFill({texture:i.gP.WHITE,color:e,alpha:t})}normalizeColor(e){const t=i.Q1.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:i.gP.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const s=e.alpha>0;return s?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:s},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,s,r){return this.drawShape(new i.M_(e,t,s,r))}drawRoundedRect(e,t,s,r,n){return this.drawShape(new i.TE(e,t,s,r,n))}drawCircle(e,t,s){return this.drawShape(new i.jl(e,t,s))}drawEllipse(e,t,s,r){return this.drawShape(new i.Pp(e,t,s,r))}drawPolygon(...e){let t,s=!0;const r=e[0];r.points?(s=r.closeStroke,t=r.points):t=Array.isArray(e[0])?e[0]:e;const n=new i.tS(t);return n.closeStroke=s,this.drawShape(n),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return!(1!==e.length||e[0].shape.type!==i.HY.RECT||e[0].matrix||e[0].holes.length||e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,s=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=s,this.vertexData=new Float32Array(e.points);for(let r=0;r<s;r++){const s=e.batches[r],n=s.style.color,o=new Float32Array(this.vertexData.buffer,4*s.attribStart*2,2*s.attribSize),a=new Float32Array(e.uvsFloat32.buffer,4*s.attribStart*2,2*s.attribSize),l={vertexData:o,blendMode:t,indices:new Uint16Array(e.indicesUint16.buffer,2*s.start,s.size),uvs:a,_batchRGB:i.Q1.shared.setValue(n).toRgbArray(),_tintRGB:n,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[r]=l}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,s=this.batches.length;t<s;t++){const s=this.batches[t];s.worldAlpha=this.worldAlpha*s.alpha,e.plugins[this.pluginName].render(s)}}}_renderDirect(e){const t=this._resolveDirectShader(e),s=this._geometry,r=this.worldAlpha,n=t.uniforms,o=s.drawCalls;n.translationMatrix=this.transform.worldTransform,i.Q1.shared.setValue(this._tintColor).premultiply(r).toArray(n.tint),e.shader.bind(t),e.geometry.bind(s,t),e.state.set(this.state);for(let t=0,i=o.length;t<i;t++)this._renderDrawCallDirect(e,s.drawCalls[t])}_renderDrawCallDirect(e,t){const{texArray:s,type:i,size:r,start:n}=t,o=s.count;for(let t=0;t<o;t++)e.texture.bind(s.elements[t],t);e.geometry.draw(i,r,n)}_resolveDirectShader(e){let t=this.shader;const s=this.pluginName;if(!t){if(!ns[s]){const{maxTextures:t}=e.plugins[s],r=new Int32Array(t);for(let e=0;e<t;e++)r[e]=e;const n={tint:new Float32Array([1,1,1,1]),translationMatrix:new i.uq,default:i.k2.from({uSamplers:r},!0)},o=e.plugins[s]._shader.program;ns[s]=new i.Mt(o,n)}t=ns[s]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:s,maxX:i,maxY:r}=e.bounds;this._bounds.addFrame(this.transform,t,s,i,r)}containsPoint(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=i.Q1.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,s=t.a,i=t.b,r=t.c,n=t.d,o=t.tx,a=t.ty,l=this._geometry.points,h=this.vertexData;let u=0;for(let e=0;e<l.length;e+=2){const t=l[e],c=l[e+1];h[u++]=s*t+r*c+o,h[u++]=n*c+i*t+a}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};os.curves=Vt,os._TEMP_POINT=new i.bR;let as=os;const ls={buildPoly:Ft,buildCircle:Dt,buildRectangle:Ot,buildRoundedRectangle:Nt,buildLine:zt,ArcUtils:Wt,BezierUtils:$t,QuadraticUtils:Yt,BatchPart:Jt,FILL_COMMANDS:qt,BATCH_POOL:Qt,DRAW_CALL_POOL:Kt};class hs{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const us=new i.bR,cs=new i.tS,ds=class e extends r.mc{constructor(e,t,s,r=i._4.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=s||i.Uw.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=i.W0.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return'tint'in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return'texture'in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(t){const s=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===i._4.TRIANGLES&&s.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,s=this.shader;s.uvMatrix&&(s.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=s._tintRGB,this._texture=s.texture;const i=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[i]),e.plugins[i].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,s=e._updateID;if(s===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const r=this.transform.worldTransform,n=r.a,o=r.b,a=r.c,l=r.d,h=r.tx,u=r.ty,c=this.vertexData;for(let e=0;e<c.length/2;e++){const s=t[2*e],i=t[2*e+1];c[2*e]=n*s+a*i+h,c[2*e+1]=o*s+l*i+u}if(this._roundPixels){const e=i.W0.RESOLUTION;for(let t=0;t<c.length;++t)c[t]=Math.round(c[t]*e)/e}this.vertexDirty=s}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new hs(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,us);const t=this.geometry.getBuffer('aVertexPosition').data,s=cs.points,i=this.geometry.getIndex().data,r=i.length,n=4===this.drawMode?3:1;for(let e=0;e+2<r;e+=n){const r=2*i[e],n=2*i[e+1],o=2*i[e+2];if(s[0]=t[r],s[1]=t[r+1],s[2]=t[n],s[3]=t[n+1],s[4]=t[o],s[5]=t[o+1],cs.contains(us.x,us.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};ds.BATCHABLE_SIZE=100;let ps=ds;class fs extends i.V2{constructor(e,t,s){super();const r=new i.hp(e),n=new i.hp(t,!0),o=new i.hp(s,!0,!0);this.addAttribute('aVertexPosition',r,2,!1,i.QE.FLOAT).addAttribute('aTextureCoord',n,2,!1,i.QE.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class gs extends i.Mt{constructor(e,t){const s={uSampler:e,alpha:1,uTextureMatrix:i.uq.IDENTITY,uColor:new Float32Array([1,1,1,1])};(t=Object.assign({tint:16777215,alpha:1,pluginName:'batch'},t)).uniforms&&Object.assign(s,t.uniforms),super(t.program||i.BP.from('attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n','varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n'),s),this._colorDirty=!1,this.uvMatrix=new i.NW(e),this.batchable=void 0===t.program,this.pluginName=t.pluginName,this._tintColor=new i.Q1(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;i.Q1.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class ms extends fs{constructor(e=100,t=100,s=10,i=10){super(),this.segWidth=s,this.segHeight=i,this.width=e,this.height=t,this.build()}build(){const e=this.segWidth*this.segHeight,t=[],s=[],i=[],r=this.segWidth-1,n=this.segHeight-1,o=this.width/r,a=this.height/n;for(let i=0;i<e;i++){const e=i%this.segWidth,l=i/this.segWidth|0;t.push(e*o,l*a),s.push(e/r,l/n)}const l=r*n;for(let e=0;e<l;e++){const t=e%r,s=e/r|0,n=s*this.segWidth+t,o=s*this.segWidth+t+1,a=(s+1)*this.segWidth+t,l=(s+1)*this.segWidth+t+1;i.push(n,o,a,o,l,a)}this.buffers[0].data=new Float32Array(t),this.buffers[1].data=new Float32Array(s),this.indexBuffer.data=new Uint16Array(i),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class _s extends fs{constructor(e=200,t,s=0){super(new Float32Array(4*t.length),new Float32Array(4*t.length),new Uint16Array(6*(t.length-1))),this.points=t,this._width=e,this.textureScale=s,this.build()}get width(){return this._width}build(){const e=this.points;if(!e)return;const t=this.getBuffer('aVertexPosition'),s=this.getBuffer('aTextureCoord'),i=this.getIndex();if(e.length<1)return;t.data.length/4!==e.length&&(t.data=new Float32Array(4*e.length),s.data=new Float32Array(4*e.length),i.data=new Uint16Array(6*(e.length-1)));const r=s.data,n=i.data;r[0]=0,r[1]=0,r[2]=0,r[3]=1;let o=0,a=e[0];const l=this._width*this.textureScale,h=e.length;for(let t=0;t<h;t++){const s=4*t;if(this.textureScale>0){const s=a.x-e[t].x,i=a.y-e[t].y,r=Math.sqrt(s*s+i*i);a=e[t],o+=r/l}else o=t/(h-1);r[s]=o,r[s+1]=0,r[s+2]=o,r[s+3]=1}let u=0;for(let e=0;e<h-1;e++){const t=2*e;n[u++]=t,n[u++]=t+1,n[u++]=t+2,n[u++]=t+2,n[u++]=t+1,n[u++]=t+3}s.update(),i.update(),this.updateVertices()}updateVertices(){const e=this.points;if(e.length<1)return;let t,s=e[0],i=0,r=0;const n=this.buffers[0].data,o=e.length,a=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let l=0;l<o;l++){const h=e[l],u=4*l;t=l<e.length-1?e[l+1]:h,r=-(t.x-s.x),i=t.y-s.y;let c=10*(1-l/(o-1));c>1&&(c=1);const d=Math.sqrt(i*i+r*r);d<1e-6?(i=0,r=0):(i/=d,r/=d,i*=a,r*=a),n[u]=h.x+i,n[u+1]=h.y+r,n[u+2]=h.x-i,n[u+3]=h.y-r,s=h}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}}class vs extends ps{constructor(e,t,s){super(new ms(e.width,e.height,t,s),new gs(i.gP.WHITE)),this.texture=e,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const e=this.geometry,{width:t,height:s}=this.shader.texture;this.autoResize&&(e.width!==t||e.height!==s)&&(e.width=this.shader.texture.width,e.height=this.shader.texture.height,e.build())}set texture(e){this.shader.texture!==e&&(this.shader.texture=e,this._textureID=-1,e.baseTexture.valid?this.textureUpdated():e.once('update',this.textureUpdated,this))}get texture(){return this.shader.texture}_render(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(e)}destroy(e){this.shader.texture.off('update',this.textureUpdated,this),super.destroy(e)}}class ys extends vs{constructor(e,t,s,r,n){super(i.gP.WHITE,4,4),this._origWidth=e.orig.width,this._origHeight=e.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=t??e.defaultBorders?.left??10,this._rightWidth=r??e.defaultBorders?.right??10,this._topHeight=s??e.defaultBorders?.top??10,this._bottomHeight=n??e.defaultBorders?.bottom??10,this.texture=e}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer('aVertexPosition').data}set vertices(e){this.geometry.getBuffer('aVertexPosition').data=e}updateHorizontalVertices(){const e=this.vertices,t=this._getMinScale();e[9]=e[11]=e[13]=e[15]=this._topHeight*t,e[17]=e[19]=e[21]=e[23]=this._height-this._bottomHeight*t,e[25]=e[27]=e[29]=e[31]=this._height}updateVerticalVertices(){const e=this.vertices,t=this._getMinScale();e[2]=e[10]=e[18]=e[26]=this._leftWidth*t,e[4]=e[12]=e[20]=e[28]=this._width-this._rightWidth*t,e[6]=e[14]=e[22]=e[30]=this._width}_getMinScale(){const e=this._leftWidth+this._rightWidth,t=this._width>e?1:this._width/e,s=this._topHeight+this._bottomHeight,i=this._height>s?1:this._height/s;return Math.min(t,i)}get width(){return this._width}set width(e){this._width=e,this._refresh()}get height(){return this._height}set height(e){this._height=e,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(e){this._leftWidth=e,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(e){this._rightWidth=e,this._refresh()}get topHeight(){return this._topHeight}set topHeight(e){this._topHeight=e,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(e){this._bottomHeight=e,this._refresh()}_refresh(){const e=this.texture,t=this.geometry.buffers[1].data;this._origWidth=e.orig.width,this._origHeight=e.orig.height;const s=1/this._origWidth,i=1/this._origHeight;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1,t[2]=t[10]=t[18]=t[26]=s*this._leftWidth,t[4]=t[12]=t[20]=t[28]=1-s*this._rightWidth,t[9]=t[11]=t[13]=t[15]=i*this._topHeight,t[17]=t[19]=t[21]=t[23]=1-i*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}class xs extends ps{constructor(e=i.gP.EMPTY,t,s,r,n){const o=new fs(t,s,r);o.getBuffer('aVertexPosition').static=!1;super(o,new gs(e),null,n),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer('aVertexPosition').data}set vertices(e){this.geometry.getBuffer('aVertexPosition').data=e}_render(e){this.autoUpdate&&this.geometry.getBuffer('aVertexPosition').update(),super._render(e)}}class bs extends ps{constructor(e,t,s=0){const r=new _s(e.height,t,s),n=new gs(e);s>0&&(e.baseTexture.wrapMode=i.uR.REPEAT),super(r,n),this.autoUpdate=!0}_render(e){const t=this.geometry;(this.autoUpdate||t._width!==this.shader.texture.height)&&(t._width=this.shader.texture.height,t.update()),super._render(e)}}class Ts extends r.mc{constructor(e=1500,t,s=16384,r=!1){super();s>16384&&(s=16384),this._properties=[!1,!0,!1,!1,!1],this._maxSize=e,this._batchSize=s,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=i.B9.NORMAL,this.autoResize=r,this.roundPixels=!0,this.baseTexture=null,this.setProperties(t),this._tintColor=new i.Q1(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(e){e&&(this._properties[0]='vertices'in e||'scale'in e?!!e.vertices||!!e.scale:this._properties[0],this._properties[1]='position'in e?!!e.position:this._properties[1],this._properties[2]='rotation'in e?!!e.rotation:this._properties[2],this._properties[3]='uvs'in e?!!e.uvs:this._properties[3],this._properties[4]='tint'in e||'alpha'in e?!!e.tint||!!e.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintColor.toRgbArray(this.tintRgb)}render(e){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once('update',()=>this.onChildrenChange(0))),e.batch.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))}onChildrenChange(e){const t=Math.floor(e/this._batchSize);for(;this._bufferUpdateIDs.length<t;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[t]=++this._updateID}dispose(){if(this._buffers){for(let e=0;e<this._buffers.length;++e)this._buffers[e].destroy();this._buffers=null}}destroy(e){super.destroy(e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}class ws{constructor(e,t,s){this.geometry=new i.V2,this.indexBuffer=null,this.size=s,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<e.length;++s){let r=e[s];r={attributeName:r.attributeName,size:r.size,uploadFunction:r.uploadFunction,type:r.type||i.QE.FLOAT,offset:r.offset},t[s]?this.dynamicProperties.push(r):this.staticProperties.push(r)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new i.hp(i.Wp.createIndicesForQuads(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let e=0;e<this.dynamicProperties.length;++e){const s=this.dynamicProperties[e];s.offset=t,t+=s.size,this.dynamicStride+=s.size}const s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=new i.hp(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let e=0;e<this.staticProperties.length;++e){const t=this.staticProperties[e];t.offset=r,r+=t.size,this.staticStride+=t.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new i.hp(this.staticData,!0,!1);for(let t=0;t<this.dynamicProperties.length;++t){const s=this.dynamicProperties[t];e.addAttribute(s.attributeName,this.dynamicBuffer,0,s.type===i.QE.UNSIGNED_BYTE,s.type,4*this.dynamicStride,4*s.offset)}for(let t=0;t<this.staticProperties.length;++t){const s=this.staticProperties[t];e.addAttribute(s.attributeName,this.staticBuffer,0,s.type===i.QE.UNSIGNED_BYTE,s.type,4*this.staticStride,4*s.offset)}}uploadDynamic(e,t,s){for(let r=0;r<this.dynamicProperties.length;r++){const n=this.dynamicProperties[r];n.uploadFunction(e,t,s,n.type===i.QE.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,s){for(let r=0;r<this.staticProperties.length;r++){const n=this.staticProperties[r];n.uploadFunction(e,t,s,n.type===i.QE.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class Es extends i.Pt{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new i.uq,this.properties=[{attributeName:'aVertexPosition',size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:'aPositionCoord',size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:'aRotation',size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:'aTextureCoord',size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:'aColor',size:1,type:i.QE.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=i.Mt.from('attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n','varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}',{}),this.state=i.Uw.for2d()}render(e){const t=e.children,s=e._maxSize,r=e._batchSize,n=this.renderer;let o=t.length;if(0===o)return;o>s&&!e.autoResize&&(o=s);let a=e._buffers;a||(a=e._buffers=this.generateBuffers(e));const l=t[0]._texture.baseTexture,h=l.alphaMode>0;this.state.blendMode=i.Wp.correctBlendMode(e.blendMode,h),n.state.set(this.state);const u=n.gl,c=e.worldTransform.copyTo(this.tempMatrix);c.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=i.Q1.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let d=!1;for(let s=0,i=0;s<o;s+=r,i+=1){let l=o-s;l>r&&(l=r),i>=a.length&&a.push(this._generateOneMoreBuffer(e));const h=a[i];h.uploadDynamic(t,s,l);const c=e._bufferUpdateIDs[i]||0;d=d||h._updateID<c,d&&(h._updateID=e._updateID,h.uploadStatic(t,s,l)),n.geometry.bind(h.geometry),u.drawElements(u.TRIANGLES,6*l,u.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],s=e._maxSize,i=e._batchSize,r=e._properties;for(let e=0;e<s;e+=i)t.push(new ws(this.properties,r,i));return t}_generateOneMoreBuffer(e){const t=e._batchSize,s=e._properties;return new ws(this.properties,s,t)}uploadVertices(e,t,s,i,r,n){let o=0,a=0,l=0,h=0;for(let u=0;u<s;++u){const s=e[t+u],c=s._texture,d=s.scale.x,p=s.scale.y,f=c.trim,g=c.orig;f?(a=f.x-s.anchor.x*g.width,o=a+f.width,h=f.y-s.anchor.y*g.height,l=h+f.height):(o=g.width*(1-s.anchor.x),a=g.width*-s.anchor.x,l=g.height*(1-s.anchor.y),h=g.height*-s.anchor.y),i[n]=a*d,i[n+1]=h*p,i[n+r]=o*d,i[n+r+1]=h*p,i[n+2*r]=o*d,i[n+2*r+1]=l*p,i[n+3*r]=a*d,i[n+3*r+1]=l*p,n+=4*r}}uploadPosition(e,t,s,i,r,n){for(let o=0;o<s;o++){const s=e[t+o].position;i[n]=s.x,i[n+1]=s.y,i[n+r]=s.x,i[n+r+1]=s.y,i[n+2*r]=s.x,i[n+2*r+1]=s.y,i[n+3*r]=s.x,i[n+3*r+1]=s.y,n+=4*r}}uploadRotation(e,t,s,i,r,n){for(let o=0;o<s;o++){const s=e[t+o].rotation;i[n]=s,i[n+r]=s,i[n+2*r]=s,i[n+3*r]=s,n+=4*r}}uploadUvs(e,t,s,i,r,n){for(let o=0;o<s;++o){const s=e[t+o]._texture._uvs;s?(i[n]=s.x0,i[n+1]=s.y0,i[n+r]=s.x1,i[n+r+1]=s.y1,i[n+2*r]=s.x2,i[n+2*r+1]=s.y2,i[n+3*r]=s.x3,i[n+3*r+1]=s.y3,n+=4*r):(i[n]=0,i[n+1]=0,i[n+r]=0,i[n+r+1]=0,i[n+2*r]=0,i[n+2*r+1]=0,i[n+3*r]=0,i[n+3*r+1]=0,n+=4*r)}}uploadTint(e,t,s,r,n,o){for(let a=0;a<s;++a){const s=e[t+a],l=i.Q1.shared.setValue(s._tintRGB).toPremultiplied(s.alpha,s.texture.baseTexture.alphaMode>0);r[o]=l,r[o+n]=l,r[o+2*n]=l,r[o+3*n]=l,o+=4*n}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Es.extension={name:'particle',type:i.Ag.RendererPlugin},i.XO.add(Es);var Cs=(e=>(e[e.LINEAR_VERTICAL=0]='LINEAR_VERTICAL',e[e.LINEAR_HORIZONTAL=1]='LINEAR_HORIZONTAL',e))(Cs||{});const Ss={willReadFrequently:!0},As=class e{static get experimentalLetterSpacingSupported(){let t=e._experimentalLetterSpacingSupported;if(void 0!==t){const s=i.W0.ADAPTER.getCanvasRenderingContext2D().prototype;t=e._experimentalLetterSpacingSupported='letterSpacing'in s||'textLetterSpacing'in s}return t}constructor(e,t,s,i,r,n,o,a,l){this.text=e,this.style=t,this.width=s,this.height=i,this.lines=r,this.lineWidths=n,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(t,s,i,r=e._canvas){i=i??s.wordWrap;const n=s.toFontString(),o=e.measureFont(n);0===o.fontSize&&(o.fontSize=s.fontSize,o.ascent=s.fontSize);const a=r.getContext('2d',Ss);a.font=n;const l=(i?e.wordWrap(t,s,r):t).split(/(?:\r\n|\r|\n)/),h=new Array(l.length);let u=0;for(let t=0;t<l.length;t++){const i=e._measureText(l[t],s.letterSpacing,a);h[t]=i,u=Math.max(u,i)}let c=u+s.strokeThickness;s.dropShadow&&(c+=s.dropShadowDistance);const d=s.lineHeight||o.fontSize+s.strokeThickness;let p=Math.max(d,o.fontSize+2*s.strokeThickness)+s.leading+(l.length-1)*(d+s.leading);return s.dropShadow&&(p+=s.dropShadowDistance),new e(t,s,c,p,l,h,d+s.leading,u,o)}static _measureText(t,s,i){let r=!1;e.experimentalLetterSpacingSupported&&(e.experimentalLetterSpacing?(i.letterSpacing=`${s}px`,i.textLetterSpacing=`${s}px`,r=!0):(i.letterSpacing='0px',i.textLetterSpacing='0px'));let n=i.measureText(t).width;return n>0&&(r?n-=s:n+=(e.graphemeSegmenter(t).length-1)*s),n}static wordWrap(t,s,i=e._canvas){const r=i.getContext('2d',Ss);let n=0,o='',a='';const l=Object.create(null),{letterSpacing:h,whiteSpace:u}=s,c=e.collapseSpaces(u),d=e.collapseNewlines(u);let p=!c;const f=s.wordWrapWidth+h,g=e.tokenize(t);for(let t=0;t<g.length;t++){let i=g[t];if(e.isNewline(i)){if(!d){a+=e.addLine(o),p=!c,o='',n=0;continue}i=' '}if(c){const t=e.isBreakingSpace(i),s=e.isBreakingSpace(o[o.length-1]);if(t&&s)continue}const u=e.getFromCache(i,h,l,r);if(u>f)if(''!==o&&(a+=e.addLine(o),o='',n=0),e.canBreakWords(i,s.breakWords)){const t=e.wordWrapSplit(i);for(let u=0;u<t.length;u++){let c=t[u],d=c,g=1;for(;t[u+g];){const r=t[u+g];if(e.canBreakChars(d,r,i,u,s.breakWords))break;c+=r,d=r,g++}u+=g-1;const m=e.getFromCache(c,h,l,r);m+n>f&&(a+=e.addLine(o),p=!1,o='',n=0),o+=c,n+=m}}else{o.length>0&&(a+=e.addLine(o),o='',n=0);const s=t===g.length-1;a+=e.addLine(i,!s),p=!1,o='',n=0}else u+n>f&&(p=!1,a+=e.addLine(o),o='',n=0),(o.length>0||!e.isBreakingSpace(i)||p)&&(o+=i,n+=u)}return a+=e.addLine(o,!1),a}static addLine(t,s=!0){return t=e.trimRight(t),t=s?`${t}\n`:t}static getFromCache(t,s,i,r){let n=i[t];return'number'!=typeof n&&(n=e._measureText(t,s,r)+s,i[t]=n),n}static collapseSpaces(e){return'normal'===e||'pre-line'===e}static collapseNewlines(e){return'normal'===e}static trimRight(t){if('string'!=typeof t)return'';for(let s=t.length-1;s>=0;s--){const i=t[s];if(!e.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return'string'==typeof t&&e._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,s){return'string'==typeof t&&e._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const s=[];let i='';if('string'!=typeof t)return s;for(let r=0;r<t.length;r++){const n=t[r],o=t[r+1];e.isBreakingSpace(n,o)||e.isNewline(n)?(''!==i&&(s.push(i),i=''),s.push(n)):i+=n}return''!==i&&s.push(i),s}static canBreakWords(e,t){return t}static canBreakChars(e,t,s,i,r){return!0}static wordWrapSplit(t){return e.graphemeSegmenter(t)}static measureFont(t){if(e._fonts[t])return e._fonts[t];const s={ascent:0,descent:0,fontSize:0},i=e._canvas,r=e._context;r.font=t;const n=e.METRICS_STRING+e.BASELINE_SYMBOL,o=Math.ceil(r.measureText(n).width);let a=Math.ceil(r.measureText(e.BASELINE_SYMBOL).width);const l=Math.ceil(e.HEIGHT_MULTIPLIER*a);if(a=a*e.BASELINE_MULTIPLIER|0,0===o||0===l)return e._fonts[t]=s,s;i.width=o,i.height=l,r.fillStyle='#f00',r.fillRect(0,0,o,l),r.font=t,r.textBaseline='alphabetic',r.fillStyle='#000',r.fillText(n,0,a);const h=r.getImageData(0,0,o,l).data,u=h.length,c=4*o;let d=0,p=0,f=!1;for(d=0;d<a;++d){for(let e=0;e<c;e+=4)if(255!==h[p+e]){f=!0;break}if(f)break;p+=c}for(s.ascent=a-d,p=u-c,f=!1,d=l;d>a;--d){for(let e=0;e<c;e+=4)if(255!==h[p+e]){f=!0;break}if(f)break;p-=c}return s.descent=d-a,s.fontSize=s.ascent+s.descent,e._fonts[t]=s,s}static clearMetrics(t=''){t?delete e._fonts[t]:e._fonts={}}static get _canvas(){if(!e.__canvas){let t;try{const s=new OffscreenCanvas(0,0);if(s.getContext('2d',Ss)?.measureText)return e.__canvas=s,s;t=i.W0.ADAPTER.createCanvas()}catch{t=i.W0.ADAPTER.createCanvas()}t.width=t.height=10,e.__canvas=t}return e.__canvas}static get _context(){return e.__context||(e.__context=e._canvas.getContext('2d',Ss)),e.__context}};As.METRICS_STRING='|q',As.BASELINE_SYMBOL='M',As.BASELINE_MULTIPLIER=1.4,As.HEIGHT_MULTIPLIER=2,As.graphemeSegmenter=(()=>{if('function'==typeof Intl?.Segmenter){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map(e=>e.segment)}return e=>[...e]})(),As.experimentalLetterSpacing=!1,As._fonts={},As._newlines=[10,13],As._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Ms=As;const Ps=['serif','sans-serif','monospace','cursive','fantasy','system-ui'],Is=class e{constructor(e){this.styleID=0,this.reset(),ks(this,e,e)}clone(){const t={};return ks(t,this,e.defaultStyle),new e(t)}reset(){ks(this,e.defaultStyle,e.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=Ls(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=Ls(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){(function(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(e[s]!==t[s])return!1;return!0})(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=Ls(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e='number'==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(','));for(let e=t.length-1;e>=0;e--){let s=t[e].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!Ps.includes(s)&&(s=`"${s}"`),t[e]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(',')}`}};Is.defaultStyle={align:'left',breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:'black',dropShadowDistance:5,fill:'black',fillGradientType:Cs.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:'Arial',fontSize:26,fontStyle:'normal',fontVariant:'normal',fontWeight:'normal',leading:0,letterSpacing:0,lineHeight:0,lineJoin:'miter',miterLimit:10,padding:0,stroke:'black',strokeThickness:0,textBaseline:'alphabetic',trim:!1,whiteSpace:'pre',wordWrap:!1,wordWrapWidth:100};let Rs=Is;function Ls(e){const t=i.Q1.shared,s=e=>{const s=t.setValue(e);return 1===s.alpha?s.toHex():s.toRgbaString()};return Array.isArray(e)?e.map(s):s(e)}function ks(e,t,s){for(const i in s)Array.isArray(t[i])?e[i]=t[i].slice():e[i]=t[i]}const Ds={texture:!0,children:!1,baseTexture:!0},Bs=class e extends a{constructor(t,s,r){let n=!1;r||(r=i.W0.ADAPTER.createCanvas(),n=!0),r.width=3,r.height=3;const o=i.gP.from(r);o.orig=new i.M_,o.trim=new i.M_,super(o),this._ownCanvas=n,this.canvas=r,this.context=r.getContext('2d',{willReadFrequently:!0}),this._resolution=e.defaultResolution??i.W0.RESOLUTION,this._autoResolution=e.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font='',this.text=t,this.style=s,this.localStyleID=-1}static get experimentalLetterSpacing(){return Ms.experimentalLetterSpacing}static set experimentalLetterSpacing(e){i.Wp.deprecation('7.1.0','Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing'),Ms.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const s=this.context,r=Ms.measureText(this._text||' ',this._style,this._style.wordWrap,this.canvas),n=r.width,o=r.height,a=r.lines,l=r.lineHeight,h=r.lineWidths,u=r.maxLineWidth,c=r.fontProperties;let d,p;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+2*t.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+2*t.padding)*this._resolution),s.scale(this._resolution,this._resolution),s.clearRect(0,0,this.canvas.width,this.canvas.height),s.font=this._font,s.lineWidth=t.strokeThickness,s.textBaseline=t.textBaseline,s.lineJoin=t.lineJoin,s.miterLimit=t.miterLimit;const f=t.dropShadow?2:1;for(let e=0;e<f;++e){const n=t.dropShadow&&0===e,f=n?Math.ceil(Math.max(1,o)+2*t.padding):0,g=f*this._resolution;if(n){s.fillStyle='black',s.strokeStyle='black';const e=t.dropShadowColor,r=t.dropShadowBlur*this._resolution,n=t.dropShadowDistance*this._resolution;s.shadowColor=i.Q1.shared.setValue(e).setAlpha(t.dropShadowAlpha).toRgbaString(),s.shadowBlur=r,s.shadowOffsetX=Math.cos(t.dropShadowAngle)*n,s.shadowOffsetY=Math.sin(t.dropShadowAngle)*n+g}else s.fillStyle=this._generateFillStyle(t,a,r),s.strokeStyle=t.stroke,s.shadowColor='black',s.shadowBlur=0,s.shadowOffsetX=0,s.shadowOffsetY=0;let m=(l-c.fontSize)/2;l-c.fontSize<0&&(m=0);for(let e=0;e<a.length;e++)d=t.strokeThickness/2,p=t.strokeThickness/2+e*l+c.ascent+m,'right'===t.align?d+=u-h[e]:'center'===t.align&&(d+=(u-h[e])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(a[e],d+t.padding,p+t.padding-f,!0),t.fill&&this.drawLetterSpacing(a[e],d+t.padding,p+t.padding-f)}this.updateTexture()}drawLetterSpacing(e,t,s,i=!1){const r=this._style.letterSpacing;let n=!1;if(Ms.experimentalLetterSpacingSupported&&(Ms.experimentalLetterSpacing?(this.context.letterSpacing=`${r}px`,this.context.textLetterSpacing=`${r}px`,n=!0):(this.context.letterSpacing='0px',this.context.textLetterSpacing='0px')),0===r||n)return void(i?this.context.strokeText(e,t,s):this.context.fillText(e,t,s));let o=t;const a=Ms.graphemeSegmenter(e);let l=this.context.measureText(e).width,h=0;for(let e=0;e<a.length;++e){const t=a[e];i?this.context.strokeText(t,o,s):this.context.fillText(t,o,s);let n='';for(let t=e+1;t<a.length;++t)n+=a[t];h=this.context.measureText(n).width,o+=l-h+r,l=h}}updateTexture(){const e=this.canvas;if(this._style.trim){const t=i.Wp.trimCanvas(e);t.data&&(e.width=t.width,e.height=t.height,this.context.putImageData(t.data,0,0))}const t=this._texture,s=this._style,r=s.trim?0:s.padding,n=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-2*r,t.orig.height=t._frame.height-2*r,this._onTextureUpdate(),n.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),-1===this._textureID&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,s){const i=e.fill;if(!Array.isArray(i))return i;if(1===i.length)return i[0];let r;const n=e.dropShadow?e.dropShadowDistance:0,o=e.padding||0,a=this.canvas.width/this._resolution-n-2*o,l=this.canvas.height/this._resolution-n-2*o,h=i.slice(),u=e.fillGradientStops.slice();if(!u.length){const e=h.length+1;for(let t=1;t<e;++t)u.push(t/e)}if(h.unshift(i[0]),u.unshift(0),h.push(i[i.length-1]),u.push(1),e.fillGradientType===Cs.LINEAR_VERTICAL){r=this.context.createLinearGradient(a/2,o,a/2,l+o);const i=s.fontProperties.fontSize+e.strokeThickness;for(let e=0;e<t.length;e++){const n=s.lineHeight*(e-1)+i,o=s.lineHeight*e;let a=o;e>0&&n>o&&(a=(o+n)/2);const c=o+i,d=s.lineHeight*(e+1);let p=c;e+1<t.length&&d<c&&(p=(c+d)/2);const f=(p-a)/l;for(let e=0;e<h.length;e++){let t=0;t='number'==typeof u[e]?u[e]:e/h.length;let s=Math.min(1,Math.max(0,a/l+t*f));s=Number(s.toFixed(5)),r.addColorStop(s,h[e])}}}else{r=this.context.createLinearGradient(o,l/2,a+o,l/2);const e=h.length+1;let t=1;for(let s=0;s<h.length;s++){let i;i='number'==typeof u[s]?u[s]:t/e,r.addColorStop(i,h[s]),t++}}return r}destroy(e){'boolean'==typeof e&&(e={children:e}),e=Object.assign({},Ds,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=i.Wp.sign(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=i.Wp.sign(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},this._style=e instanceof Rs?e:new Rs(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??''),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};Bs.defaultAutoResolution=!0;let Fs=Bs;class Os{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Ns(e,t){let s=!1;if(e?._textures?.length)for(let r=0;r<e._textures.length;r++)if(e._textures[r]instanceof i.gP){const i=e._textures[r].baseTexture;t.includes(i)||(t.push(i),s=!0)}return s}function Us(e,t){if(e.baseTexture instanceof i.t5){const s=e.baseTexture;return t.includes(s)||t.push(s),!0}return!1}function Gs(e,t){if(e._texture&&e._texture instanceof i.gP){const s=e._texture.baseTexture;return t.includes(s)||t.push(s),!0}return!1}function Vs(e,t){return t instanceof Fs&&(t.updateText(!0),!0)}function Hs(e,t){if(t instanceof Rs){const e=t.toFontString();return Ms.measureFont(e),!0}return!1}function Ws(e,t){if(e instanceof Fs){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const s=e._texture.baseTexture;return t.includes(s)||t.push(s),!0}return!1}function $s(e,t){return e instanceof Rs&&(t.includes(e)||t.push(e),!0)}const Xs=class e{constructor(t){this.limiter=new Os(e.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Ws),this.registerFindHook($s),this.registerFindHook(Ns),this.registerFindHook(Us),this.registerFindHook(Gs),this.registerUploadHook(Vs),this.registerUploadHook(Hs)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,i.Rv.system.addOnce(this.tick,this,i.dQ.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed)for(let s=0,i=this.uploadHooks.length;s<i;s++)if(this.uploadHooks[s](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}t||this.queue.shift()}if(this.queue.length)i.Rv.system.addOnce(this.tick,this,i.dQ.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,s=e.length;t<s;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,s=this.addHooks.length;t<s&&!this.addHooks[t](e,this.queue);t++);if(e instanceof r.mc)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&i.Rv.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Xs.uploadsPerFrame=4;let js=Xs;function zs(e,t){return t instanceof i.t5&&(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0)}function Ys(e,t){if(!(t instanceof as))return!1;const{geometry:s}=t;t.finishPoly(),s.updateBatches();const{batches:i}=s;for(let t=0;t<i.length;t++){const{texture:s}=i[t].style;s&&zs(e,s.baseTexture)}return s.batchable||e.geometry.bind(s,t._resolveDirectShader(e)),!0}function qs(e,t){return e instanceof as&&(t.push(e),!0)}Object.defineProperties(i.W0,{UPLOADS_PER_FRAME:{get:()=>js.uploadsPerFrame,set(e){i.Wp.deprecation('7.1.0','settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame'),js.uploadsPerFrame=e}}});class Qs extends js{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(qs),this.registerUploadHook(zs),this.registerUploadHook(Ys)}}Qs.extension={name:'prepare',type:i.Ag.RendererSystem},i.XO.add(Qs);class Ks{constructor(e){this.maxMilliseconds=e,this.frameStart=0}beginFrame(){this.frameStart=Date.now()}allowedToUpload(){return Date.now()-this.frameStart<this.maxMilliseconds}}class Zs extends a{constructor(e,t=!0){super(e[0]instanceof i.gP?e[0]:e[0].texture),this._textures=null,this._durations=null,this._autoUpdate=t,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=e}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(i.Rv.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(i.Rv.shared.add(this.update,this,i.dQ.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const t=this.animationSpeed*e,s=this.currentFrame;if(null!==this._durations){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=t/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=t;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):s!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<s||this.animationSpeed<0&&this.currentFrame>s)&&this.onLoop(),this.updateTexture())}updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this._texture=this._textures[e],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(e){this.stop(),super.destroy(e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const t=[];for(let s=0;s<e.length;++s)t.push(i.gP.from(e[s]));return new Zs(t)}static fromImages(e){const t=[];for(let s=0;s<e.length;++s)t.push(i.gP.from(e[s]));return new Zs(t)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof i.gP)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let t=0;t<e.length;t++)this._textures.push(e[t].texture),this._durations.push(e[t].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const t=this.currentFrame;this._currentTime=e,t!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(i.Rv.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(i.Rv.shared.add(this.update,this),this._isConnectedToTicker=!0))}}const Js=new i.bR;class ei extends a{constructor(e,t=100,s=100){super(e),this.tileTransform=new i.dL,this._width=t,this._height=s,this.uvMatrix=this.texture.uvMatrix||new i.NW(e),this.pluginName='tilingSprite',this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(e){this.uvMatrix.clampMargin=e,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(e){this.tileTransform.scale.copyFrom(e)}get tilePosition(){return this.tileTransform.position}set tilePosition(e){this.tileTransform.position.copyFrom(e)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(e){const t=this._texture;!t||!t.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this))}_calculateBounds(){const e=this._width*-this._anchor._x,t=this._height*-this._anchor._y,s=this._width*(1-this._anchor._x),i=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,e,t,s,i)}getLocalBounds(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new i.M_),e=this._localBoundsRect),this._bounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,Js);const t=this._width,s=this._height,i=-t*this.anchor._x;if(Js.x>=i&&Js.x<i+t){const e=-s*this.anchor._y;if(Js.y>=e&&Js.y<e+s)return!0}return!1}destroy(e){super.destroy(e),this.tileTransform=null,this.uvMatrix=null}static from(e,t){const s=e instanceof i.gP?e:i.gP.from(e,t);return new ei(s,t.width,t.height)}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}}var ti='#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n';const si=new i.uq;class ii extends i.Pt{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new i.X1,this.state=i.Uw.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=i.Mt.from(ti,'#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n',t),this.shader=e.context.webGLVersion>1?i.Mt.from('#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n','#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n',t):i.Mt.from(ti,'#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n',t)}render(e){const t=this.renderer,s=this.quad;let r=s.vertices;r[0]=r[6]=e._width*-e.anchor.x,r[1]=r[3]=e._height*-e.anchor.y,r[2]=r[4]=e._width*(1-e.anchor.x),r[5]=r[7]=e._height*(1-e.anchor.y);const n=e.uvRespectAnchor?e.anchor.x:0,o=e.uvRespectAnchor?e.anchor.y:0;r=s.uvs,r[0]=r[6]=-n,r[1]=r[3]=-o,r[2]=r[4]=1-n,r[5]=r[7]=1-o,s.invalidate();const a=e._texture,l=a.baseTexture,h=l.alphaMode>0,u=e.tileTransform.localTransform,c=e.uvMatrix;let d=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;d&&(l._glTextures[t.CONTEXT_UID]?d=l.wrapMode!==i.uR.CLAMP:l.wrapMode===i.uR.CLAMP&&(l.wrapMode=i.uR.REPEAT));const p=d?this.simpleShader:this.shader,f=a.width,g=a.height,m=e._width,v=e._height;si.set(u.a*f/m,u.b*f/v,u.c*g/m,u.d*g/v,u.tx/m,u.ty/v),si.invert(),d?si.prepend(c.mapCoord):(p.uniforms.uMapCoord=c.mapCoord.toArray(!0),p.uniforms.uClampFrame=c.uClampFrame,p.uniforms.uClampOffset=c.uClampOffset),p.uniforms.uTransform=si.toArray(!0),p.uniforms.uColor=i.Q1.shared.setValue(e.tint).premultiply(e.worldAlpha,h).toArray(p.uniforms.uColor),p.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),p.uniforms.uSampler=a,t.shader.bind(p),t.geometry.bind(s),this.state.blendMode=i.Wp.correctBlendMode(e.blendMode,h),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}ii.extension={name:'tilingSprite',type:i.Ag.RendererPlugin},i.XO.add(ii);const ri=class e{constructor(e,t,s){this.linkedSheets=[],(e instanceof i.t5||e instanceof i.gP)&&(e={texture:e,data:t,resolutionFilename:s});const{texture:r,data:n,resolutionFilename:o=null,cachePrefix:a=''}=e;this.cachePrefix=a,this._texture=r instanceof i.gP?r:null,this.baseTexture=r instanceof i.t5?r:this._texture.baseTexture,this.textures={},this.animations={},this.data=n;const l=this.baseTexture.resource;this.resolution=this._updateResolution(o||(l?l.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let s=i.Wp.getResolutionOfUrl(e,null);return null===s&&(s='number'==typeof t?t:parseFloat(t??'1')),1!==s&&this.baseTexture.setResolution(s),s}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=e.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let s=t;const r=e.BATCH_SIZE;for(;s-t<r&&s<this._frameKeys.length;){const e=this._frameKeys[s],t=this._frames[e],r=t.frame;if(r){let s=null,n=null;const o=!1!==t.trimmed&&t.sourceSize?t.sourceSize:t.frame,a=new i.M_(0,0,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution);s=t.rotated?new i.M_(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):new i.M_(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),!1!==t.trimmed&&t.spriteSourceSize&&(n=new i.M_(Math.floor(t.spriteSourceSize.x)/this.resolution,Math.floor(t.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution)),this.textures[e]=new i.gP(this.baseTexture,s,a,n,t.rotated?2:0,t.anchor,t.borders),i.gP.addToCache(this.textures[e],this.cachePrefix+e.toString())}s++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let s=0;s<e[t].length;s++){const i=e[t][s];this.animations[t].push(this.textures[i])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*e.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*e.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};ri.BATCH_SIZE=1e3;let ni=ri;const oi=['jpg','png','jpeg','avif','webp','s3tc','s3tc_sRGB','etc','etc1','pvrtc','atc','astc','bptc'];function ai(e,t,s){const r={};if(e.forEach(e=>{r[e]=t}),Object.keys(t.textures).forEach(e=>{r[`${t.cachePrefix}${e}`]=t.textures[e]}),!s){const s=i.Wp.path.dirname(e[0]);t.linkedSheets.forEach((e,i)=>{Object.assign(r,ai([`${s}/${t.data.meta.related_multi_packs[i]}`],e,!0))})}return r}const li={extension:i.Ag.Asset,cache:{test:e=>e instanceof ni,getCacheableAssets:(e,t)=>ai(e,t,!1)},resolver:{test:e=>{const t=e.split('?')[0].split('.'),s=t.pop(),i=t.pop();return'json'===s&&oi.includes(i)},parse:e=>{const t=e.split('.');return{resolution:parseFloat(i.W0.RETINA_PREFIX.exec(e)?.[1]??'1'),format:t[t.length-2],src:e}}},loader:{name:'spritesheetLoader',extension:{type:i.Ag.LoadParser,priority:Y.Normal},testParse:async(e,t)=>'.json'===i.Wp.path.extname(t.src).toLowerCase()&&!!e.frames,async parse(e,t,s){const{texture:r,imageFilename:n,cachePrefix:o}=t?.data??{};let a,l=i.Wp.path.dirname(t.src);if(l&&l.lastIndexOf('/')!==l.length-1&&(l+='/'),r&&r.baseTexture)a=r;else{const i=Ue(l+(n??e.meta.image),t.src);a=(await s.load([i]))[i]}const h=new ni({texture:a.baseTexture,data:e,resolutionFilename:t.src,cachePrefix:o});await h.parse();const u=e?.meta?.related_multi_packs;if(Array.isArray(u)){const e=[];for(const i of u){if('string'!=typeof i)continue;let r=l+i;t.data?.ignoreMultiPack||(r=Ue(r,t.src),e.push(s.load({src:r,data:{ignoreMultiPack:!0}})))}const i=await Promise.all(e);h.linkedSheets=i,i.forEach(e=>{e.linkedSheets=[h].concat(h.linkedSheets.filter(t=>t!==e))})}return h},unload(e){e.destroy(!0)}}};i.XO.add(li);class hi{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class ui{static test(e){return'string'==typeof e&&e.startsWith('info face=')}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),s={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const e in t){const i=t[e].match(/^[a-z]+/gm)[0],r=t[e].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),n={};for(const e in r){const t=r[e].split('='),s=t[0],i=t[1].replace(/"/gm,''),o=parseFloat(i),a=isNaN(o)?i:o;n[s]=a}s[i].push(n)}const i=new hi;return s.info.forEach(e=>i.info.push({face:e.face,size:parseInt(e.size,10)})),s.common.forEach(e=>i.common.push({lineHeight:parseInt(e.lineHeight,10)})),s.page.forEach(e=>i.page.push({id:parseInt(e.id,10),file:e.file})),s.char.forEach(e=>i.char.push({id:parseInt(e.id,10),page:parseInt(e.page,10),x:parseInt(e.x,10),y:parseInt(e.y,10),width:parseInt(e.width,10),height:parseInt(e.height,10),xoffset:parseInt(e.xoffset,10),yoffset:parseInt(e.yoffset,10),xadvance:parseInt(e.xadvance,10)})),s.kerning.forEach(e=>i.kerning.push({first:parseInt(e.first,10),second:parseInt(e.second,10),amount:parseInt(e.amount,10)})),s.distanceField.forEach(e=>i.distanceField.push({distanceRange:parseInt(e.distanceRange,10),fieldType:e.fieldType})),i}}class ci{static test(e){const t=e;return'string'!=typeof e&&'getElementsByTagName'in e&&t.getElementsByTagName('page').length&&null!==t.getElementsByTagName('info')[0].getAttribute('face')}static parse(e){const t=new hi,s=e.getElementsByTagName('info'),i=e.getElementsByTagName('common'),r=e.getElementsByTagName('page'),n=e.getElementsByTagName('char'),o=e.getElementsByTagName('kerning'),a=e.getElementsByTagName('distanceField');for(let e=0;e<s.length;e++)t.info.push({face:s[e].getAttribute('face'),size:parseInt(s[e].getAttribute('size'),10)});for(let e=0;e<i.length;e++)t.common.push({lineHeight:parseInt(i[e].getAttribute('lineHeight'),10)});for(let e=0;e<r.length;e++)t.page.push({id:parseInt(r[e].getAttribute('id'),10)||0,file:r[e].getAttribute('file')});for(let e=0;e<n.length;e++){const s=n[e];t.char.push({id:parseInt(s.getAttribute('id'),10),page:parseInt(s.getAttribute('page'),10)||0,x:parseInt(s.getAttribute('x'),10),y:parseInt(s.getAttribute('y'),10),width:parseInt(s.getAttribute('width'),10),height:parseInt(s.getAttribute('height'),10),xoffset:parseInt(s.getAttribute('xoffset'),10),yoffset:parseInt(s.getAttribute('yoffset'),10),xadvance:parseInt(s.getAttribute('xadvance'),10)})}for(let e=0;e<o.length;e++)t.kerning.push({first:parseInt(o[e].getAttribute('first'),10),second:parseInt(o[e].getAttribute('second'),10),amount:parseInt(o[e].getAttribute('amount'),10)});for(let e=0;e<a.length;e++)t.distanceField.push({fieldType:a[e].getAttribute('fieldType'),distanceRange:parseInt(a[e].getAttribute('distanceRange'),10)});return t}}class di{static test(e){return!('string'!=typeof e||!e.includes('<font>'))&&ci.test(i.W0.ADAPTER.parseXML(e))}static parse(e){return ci.parse(i.W0.ADAPTER.parseXML(e))}}const pi=[ui,ci,di];function fi(e){for(let t=0;t<pi.length;t++)if(pi[t].test(e))return pi[t];return null}function gi(e,t,s,r,n,o,a){const l=s.text,h=s.fontProperties;t.translate(r,n),t.scale(o,o);const u=a.strokeThickness/2,c=-a.strokeThickness/2;if(t.font=a.toFontString(),t.lineWidth=a.strokeThickness,t.textBaseline=a.textBaseline,t.lineJoin=a.lineJoin,t.miterLimit=a.miterLimit,t.fillStyle=function(e,t,s,i,r,n){const o=s.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const l=s.dropShadow?s.dropShadowDistance:0,h=s.padding||0,u=e.width/i-l-2*h,c=e.height/i-l-2*h,d=o.slice(),p=s.fillGradientStops.slice();if(!p.length){const e=d.length+1;for(let t=1;t<e;++t)p.push(t/e)}if(d.unshift(o[0]),p.unshift(0),d.push(o[o.length-1]),p.push(1),s.fillGradientType===Cs.LINEAR_VERTICAL){a=t.createLinearGradient(u/2,h,u/2,c+h);let e=0;const i=(n.fontProperties.fontSize+s.strokeThickness)/c;for(let t=0;t<r.length;t++){const s=n.lineHeight*t;for(let t=0;t<d.length;t++){let r=0;r='number'==typeof p[t]?p[t]:t/d.length;const n=s/c+r*i;let o=Math.max(e,n);o=Math.min(o,1),a.addColorStop(o,d[t]),e=o}}}else{a=t.createLinearGradient(h,c/2,u+h,c/2);const e=d.length+1;let s=1;for(let t=0;t<d.length;t++){let i;i='number'==typeof p[t]?p[t]:s/e,a.addColorStop(i,d[t]),s++}}return a}(e,t,a,o,[l],s),t.strokeStyle=a.stroke,a.dropShadow){const e=a.dropShadowColor,s=a.dropShadowBlur*o,r=a.dropShadowDistance*o;t.shadowColor=i.Q1.shared.setValue(e).setAlpha(a.dropShadowAlpha).toRgbaString(),t.shadowBlur=s,t.shadowOffsetX=Math.cos(a.dropShadowAngle)*r,t.shadowOffsetY=Math.sin(a.dropShadowAngle)*r}else t.shadowColor='black',t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;a.stroke&&a.strokeThickness&&t.strokeText(l,u,c+s.lineHeight-h.descent),a.fill&&t.fillText(l,u,c+s.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle='rgba(0, 0, 0, 0)'}function mi(e){return Array.from?Array.from(e):e.split('')}function _i(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}const vi=class e{constructor(e,t,s){const[r]=e.info,[n]=e.common,[o]=e.page,[a]=e.distanceField,l=i.Wp.getResolutionOfUrl(o.file),h={};this._ownsTextures=s,this.font=r.face,this.size=r.size,this.lineHeight=n.lineHeight/l,this.chars={},this.pageTextures=h;for(let s=0;s<e.page.length;s++){const{id:r,file:n}=e.page[s];h[r]=t instanceof Array?t[s]:t[n],a?.fieldType&&'none'!==a.fieldType&&(h[r].baseTexture.alphaMode=i.Gk.NO_PREMULTIPLIED_ALPHA,h[r].baseTexture.mipmap=i.E8.OFF)}for(let t=0;t<e.char.length;t++){const{id:s,page:r}=e.char[t];let{x:n,y:o,width:a,height:u,xoffset:c,yoffset:d,xadvance:p}=e.char[t];n/=l,o/=l,a/=l,u/=l,c/=l,d/=l,p/=l;const f=new i.M_(n+h[r].frame.x/l,o+h[r].frame.y/l,a,u);this.chars[s]={xOffset:c,yOffset:d,xAdvance:p,kerning:{},texture:new i.gP(h[r].baseTexture,f),page:r}}for(let t=0;t<e.kerning.length;t++){let{first:s,second:i,amount:r}=e.kerning[t];s/=l,i/=l,r/=l,this.chars[i]&&(this.chars[i].kerning[s]=r)}this.distanceFieldRange=a?.distanceRange,this.distanceFieldType=a?.fieldType?.toLowerCase()??'none'}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(t,s,r){let n;if(t instanceof hi)n=t;else{const e=fi(t);if(!e)throw new Error('Unrecognized data format for font.');n=e.parse(t)}s instanceof i.gP&&(s=[s]);const o=new e(n,s,r);return e.available[o.font]=o,o}static uninstall(t){const s=e.available[t];if(!s)throw new Error(`No font found named '${t}'`);s.destroy(),delete e.available[t]}static from(t,s,r){if(!t)throw new Error('[BitmapFont] Property `name` is required.');const{chars:n,padding:o,resolution:a,textureWidth:l,textureHeight:h,...u}=Object.assign({},e.defaultOptions,r),c=function(e){'string'==typeof e&&(e=[e]);const t=[];for(let s=0,i=e.length;s<i;s++){const i=e[s];if(Array.isArray(i)){if(2!==i.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);const e=i[0].charCodeAt(0),s=i[1].charCodeAt(0);if(s<e)throw new Error('[BitmapFont]: Invalid character range.');for(let i=e,r=s;i<=r;i++)t.push(String.fromCharCode(i))}else t.push(...mi(i))}if(0===t.length)throw new Error('[BitmapFont]: Empty set when resolving characters.');return t}(n),d=s instanceof Rs?s:new Rs(s),p=l,f=new hi;f.info[0]={face:d.fontFamily,size:d.fontSize},f.common[0]={lineHeight:d.fontSize};let g,m,v,y=0,x=0,b=0;const T=[],w=[];for(let e=0;e<c.length;e++){g||(g=i.W0.ADAPTER.createCanvas(),g.width=l,g.height=h,m=g.getContext('2d'),v=new i.t5(g,{resolution:a,...u}),T.push(v),w.push(new i.gP(v)),f.page.push({id:w.length-1,file:''}));const t=c[e],s=Ms.measureText(t,d,!1,g),r=s.width,n=Math.ceil(s.height),E=Math.ceil(('italic'===d.fontStyle?2:1)*r);if(x>=h-n*a){if(0===x)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${t}')`);--e,g=null,m=null,v=null,x=0,y=0,b=0;continue}if(b=Math.max(n+s.fontProperties.descent,b),E*a+y>=p){if(0===y)throw new Error(`[BitmapFont] textureWidth ${l}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${t}')`);--e,x+=b*a,x=Math.ceil(x),y=0,b=0;continue}gi(g,m,s,y,x,a,d);const C=_i(s.text);f.char.push({id:C,page:w.length-1,x:y/a,y:x/a,width:E,height:n,xoffset:0,yoffset:0,xadvance:r-(d.dropShadow?d.dropShadowDistance:0)-(d.stroke?d.strokeThickness:0)}),y+=(E+2*o)*a,y=Math.ceil(y)}if(!r?.skipKerning)for(let e=0,t=c.length;e<t;e++){const s=c[e];for(let e=0;e<t;e++){const t=c[e],i=m.measureText(s).width,r=m.measureText(t).width,n=m.measureText(s+t).width-(i+r);n&&f.kerning.push({first:_i(s),second:_i(t),amount:n})}}const E=new e(f,w,!0);return void 0!==e.available[t]&&e.uninstall(t),e.available[t]=E,E}};vi.ALPHA=[['a','z'],['A','Z'],' '],vi.NUMERIC=[['0','9']],vi.ALPHANUMERIC=[['a','z'],['A','Z'],['0','9'],' '],vi.ASCII=[[' ','~']],vi.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:vi.ALPHANUMERIC},vi.available={};let yi=vi;const xi=[],bi=[],Ti=[],wi=class e extends r.mc{constructor(t,s={}){super();const{align:r,tint:n,maxWidth:o,letterSpacing:a,fontName:l,fontSize:h}=Object.assign({},e.styleDefaults,s);if(!yi.available[l])throw new Error(`Missing BitmapFont "${l}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new i.Q1(n),this._font=void 0,this._fontName=l,this._fontSize=h,this.text=t,this._maxWidth=o,this._maxLineHeight=0,this._letterSpacing=a,this._anchor=new i.oA(()=>{this.dirty=!0},this,0,0),this._roundPixels=i.W0.ROUND_PIXELS,this.dirty=!0,this._resolution=i.W0.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const e=yi.available[this._fontName],t=this.fontSize,s=t/e.size,r=new i.bR,n=[],o=[],a=[],l=mi(this._text.replace(/(?:\r\n|\r)/g,'\n')||' '),h=this._maxWidth*e.size/t,u='none'===e.distanceFieldType?xi:bi;let c=null,d=0,p=0,f=0,g=-1,m=0,v=0,y=0,x=0;for(let t=0;t<l.length;t++){const s=l[t],u=_i(s);if(/(?:\s)/.test(s)&&(g=t,m=d,x++),'\r'===s||'\n'===s){o.push(d),a.push(-1),p=Math.max(p,d),++f,++v,r.x=0,r.y+=e.lineHeight,c=null,x=0;continue}const b=e.chars[u];if(!b)continue;c&&b.kerning[c]&&(r.x+=b.kerning[c]);const T=Ti.pop()||{texture:i.gP.EMPTY,line:0,charCode:0,prevSpaces:0,position:new i.bR};T.texture=b.texture,T.line=f,T.charCode=u,T.position.x=Math.round(r.x+b.xOffset+this._letterSpacing/2),T.position.y=Math.round(r.y+b.yOffset),T.prevSpaces=x,n.push(T),d=T.position.x+Math.max(b.xAdvance-b.xOffset,b.texture.orig.width),r.x+=b.xAdvance+this._letterSpacing,y=Math.max(y,b.yOffset+b.texture.height),c=u,-1!==g&&h>0&&r.x>h&&(++v,i.Wp.removeItems(n,1+g-v,1+t-g),t=g,g=-1,o.push(m),a.push(n.length>0?n[n.length-1].prevSpaces:0),p=Math.max(p,m),f++,r.x=0,r.y+=e.lineHeight,c=null,x=0)}const b=l[l.length-1];'\r'!==b&&'\n'!==b&&(/(?:\s)/.test(b)&&(d=m),o.push(d),p=Math.max(p,d),a.push(-1));const T=[];for(let e=0;e<=f;e++){let t=0;'right'===this._align?t=p-o[e]:'center'===this._align?t=(p-o[e])/2:'justify'===this._align&&(t=a[e]<0?0:(p-o[e])/a[e]),T.push(t)}const w=n.length,E={},C=[],S=this._activePagesMeshData;u.push(...S);for(let t=0;t<w;t++){const s=n[t].texture,r=s.baseTexture.uid;if(!E[r]){let t=u.pop();if(!t){const s=new fs;let r,n;'none'===e.distanceFieldType?(r=new gs(i.gP.EMPTY),n=i.B9.NORMAL):(r=new gs(i.gP.EMPTY,{program:i.BP.from('// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n','// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n'),uniforms:{uFWidth:0}}),n=i.B9.NORMAL_NPM);const o=new ps(s,r);o.blendMode=n,t={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:o,vertices:null,uvs:null,indices:null}}t.index=0,t.indexCount=0,t.vertexCount=0,t.uvsCount=0,t.total=0;const{_textureCache:n}=this;n[r]=n[r]||new i.gP(s.baseTexture),t.mesh.texture=n[r],t.mesh.tint=this._tintColor.value,C.push(t),E[r]=t}E[r].total++}for(let e=0;e<S.length;e++)C.includes(S[e])||this.removeChild(S[e].mesh);for(let e=0;e<C.length;e++)C[e].mesh.parent!==this&&this.addChild(C[e].mesh);this._activePagesMeshData=C;for(const e in E){const t=E[e],s=t.total;if(!(t.indices?.length>6*s)||t.vertices.length<2*ps.BATCHABLE_SIZE)t.vertices=new Float32Array(8*s),t.uvs=new Float32Array(8*s),t.indices=new Uint16Array(6*s);else{const e=t.total,s=t.vertices;for(let t=4*e*2;t<s.length;t++)s[t]=0}t.mesh.size=6*s}for(let e=0;e<w;e++){const t=n[e];let i=t.position.x+T[t.line]*('justify'===this._align?t.prevSpaces:1);this._roundPixels&&(i=Math.round(i));const r=i*s,o=t.position.y*s,a=t.texture,l=E[a.baseTexture.uid],h=a.frame,u=a._uvs,c=l.index++;l.indices[6*c+0]=0+4*c,l.indices[6*c+1]=1+4*c,l.indices[6*c+2]=2+4*c,l.indices[6*c+3]=0+4*c,l.indices[6*c+4]=2+4*c,l.indices[6*c+5]=3+4*c,l.vertices[8*c+0]=r,l.vertices[8*c+1]=o,l.vertices[8*c+2]=r+h.width*s,l.vertices[8*c+3]=o,l.vertices[8*c+4]=r+h.width*s,l.vertices[8*c+5]=o+h.height*s,l.vertices[8*c+6]=r,l.vertices[8*c+7]=o+h.height*s,l.uvs[8*c+0]=u.x0,l.uvs[8*c+1]=u.y0,l.uvs[8*c+2]=u.x1,l.uvs[8*c+3]=u.y1,l.uvs[8*c+4]=u.x2,l.uvs[8*c+5]=u.y2,l.uvs[8*c+6]=u.x3,l.uvs[8*c+7]=u.y3}this._textWidth=p*s,this._textHeight=(r.y+e.lineHeight)*s;for(const e in E){const t=E[e];if(0!==this.anchor.x||0!==this.anchor.y){let e=0;const s=this._textWidth*this.anchor.x,i=this._textHeight*this.anchor.y;for(let r=0;r<t.total;r++)t.vertices[e++]-=s,t.vertices[e++]-=i,t.vertices[e++]-=s,t.vertices[e++]-=i,t.vertices[e++]-=s,t.vertices[e++]-=i,t.vertices[e++]-=s,t.vertices[e++]-=i}this._maxLineHeight=y*s;const i=t.mesh.geometry.getBuffer('aVertexPosition'),r=t.mesh.geometry.getBuffer('aTextureCoord'),n=t.mesh.geometry.getIndex();i.data=t.vertices,r.data=t.uvs,n.data=t.indices,i.update(),r.update(),n.update()}for(let e=0;e<n.length;e++)Ti.push(n[e]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:s,size:i}=yi.available[this._fontName];if('none'!==s){const{a:s,b:r,c:n,d:o}=this.worldTransform,a=Math.sqrt(s*s+r*r),l=Math.sqrt(n*n+o*o),h=(Math.abs(a)+Math.abs(l))/2,u=this.fontSize/i,c=e._view.resolution;for(const e of this._activePagesMeshData)e.mesh.shader.uniforms.uFWidth=h*t*u*c}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=yi.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!yi.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??yi.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){'number'==typeof e?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??''),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,s='none'===yi.available[this._fontName].distanceFieldType?xi:bi;s.push(...this._activePagesMeshData);for(const e of this._activePagesMeshData)this.removeChild(e.mesh);this._activePagesMeshData=[],s.filter(e=>t[e.mesh.texture.baseTexture.uid]).forEach(e=>{e.mesh.texture=i.gP.EMPTY});for(const e in t)t[e].destroy(),delete t[e];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};wi.styleDefaults={align:'left',tint:16777215,maxWidth:0,letterSpacing:0};let Ei=wi;const Ci=['.xml','.fnt'],Si={extension:{type:i.Ag.LoadParser,priority:Y.Normal},name:'loadBitmapFont',test:e=>Ci.includes(i.Wp.path.extname(e).toLowerCase()),testParse:async e=>ui.test(e)||di.test(e),async parse(e,t,s){const r=ui.test(e)?ui.parse(e):di.parse(e),{src:n}=t,{page:o}=r,a=[];for(let e=0;e<o.length;++e){const t=o[e].file;let s=i.Wp.path.join(i.Wp.path.dirname(n),t);s=Ue(s,n),a.push(s)}const l=await s.load(a),h=a.map(e=>l[e]);return yi.install(r,h,!0)},load:async(e,t)=>(await i.W0.ADAPTER.fetch(e)).text(),unload(e){e.destroy()}};i.XO.add(Si);const Ai=class e extends Rs{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet='',this.fontsDirty=!1}static from(t){return new e(Object.keys(e.defaultOptions).reduce((e,s)=>({...e,[s]:t[s]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts.delete(t.fontFace),delete e.availableFonts[t.originalUrl])}),this.fontFamily='Arial',this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,s={}){const{availableFonts:r}=e;if(r[t]){const e=r[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return i.W0.ADAPTER.fetch(t).then(e=>e.blob()).then(async e=>new Promise((t,s)=>{const i=URL.createObjectURL(e),r=new FileReader;r.onload=()=>t([i,r.result]),r.onerror=s,r.readAsDataURL(e)})).then(async([e,n])=>{const o=Object.assign({family:i.Wp.path.basename(t,i.Wp.path.extname(t)),weight:'normal',style:'normal',display:'auto',src:e,dataSrc:n,refs:1,originalUrl:t,fontFace:null},s);r[t]=o,this._fonts.push(o),this.styleID++;const a=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){const t=e.filter(e=>!this._overrides.includes(e));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter(e=>this._overrides.includes(e));t.length>0&&(this._overrides=this._overrides.filter(e=>!t.includes(e)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,'transform-origin: top left','display: inline-block',`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?['word-wrap: '+(this.breakWords?'break-all':'break-word'),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,'paint-order: stroke']:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(';')}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}\n            @font-face {\n                font-family: "${t.family}";\n                src: url('${t.dataSrc}');\n                font-weight: ${t.weight};\n                font-style: ${t.style};\n                font-display: ${t.display};\n            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=i.Wp.rgb2hex(e)),'number'==typeof e?i.Wp.hex2string(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,s=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),i=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith('#')&&t<1&&(e+=(255*t|0).toString(16).padStart(2,'0'));const r=`${s}px ${i}px`;return this.dropShadowBlur>0?`text-shadow: ${r} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${r} ${e}`}reset(){Object.assign(this,e.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=i.W0.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn('[HTMLTextStyle] fillGradientStops is not supported by HTMLText')}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn('[HTMLTextStyle] fillGradientType is not supported by HTMLText')}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn('[HTMLTextStyle] miterLimit is not supported by HTMLText')}get miterLimit(){return super.miterLimit}set trim(e){console.warn('[HTMLTextStyle] trim is not supported by HTMLText')}get trim(){return super.trim}set textBaseline(e){console.warn('[HTMLTextStyle] textBaseline is not supported by HTMLText')}get textBaseline(){return super.textBaseline}set leading(e){console.warn('[HTMLTextStyle] leading is not supported by HTMLText')}get leading(){return super.leading}set lineJoin(e){console.warn('[HTMLTextStyle] lineJoin is not supported by HTMLText')}get lineJoin(){return super.lineJoin}};Ai.availableFonts={},Ai.defaultOptions={align:'left',breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:'black',dropShadowDistance:5,fill:'black',fontFamily:'Arial',fontSize:26,fontStyle:'normal',fontVariant:'normal',fontWeight:'normal',letterSpacing:0,lineHeight:0,padding:0,stroke:'black',strokeThickness:0,whiteSpace:'normal',wordWrap:!1,wordWrapWidth:100};let Mi=Ai;const Pi=class e extends a{constructor(t='',s={}){super(i.gP.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const r=new Image,n=i.gP.from(r,{scaleMode:i.W0.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new i.M_,n.trim=new i.M_,this.texture=n;const o='http://www.w3.org/2000/svg',a='http://www.w3.org/1999/xhtml',l=document.createElementNS(o,'svg'),h=document.createElementNS(o,'foreignObject'),u=document.createElementNS(a,'div'),c=document.createElementNS(a,'style');h.setAttribute('width','10000'),h.setAttribute('height','10000'),h.style.overflow='hidden',l.appendChild(h),this.maxWidth=e.defaultMaxWidth,this.maxHeight=e.defaultMaxHeight,this._domElement=u,this._styleElement=c,this._svgRoot=l,this._foreignObject=h,this._foreignObject.appendChild(c),this._foreignObject.appendChild(u),this._image=r,this._loadImage=new Image,this._autoResolution=e.defaultAutoResolution,this._resolution=e.defaultResolution??i.W0.RESOLUTION,this.text=t,this.style=s}measureText(e){const{text:t,style:s,resolution:i}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:s.toCSS(i)}),this._styleElement.textContent=s.toGlobalCSS(),document.body.appendChild(this._svgRoot);const r=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:n,height:o}=r;(n>this.maxWidth||o>this.maxHeight)&&console.warn('[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.');const a=Math.min(this.maxWidth,Math.ceil(n)),l=Math.min(this.maxHeight,Math.ceil(o));return this._svgRoot.setAttribute('width',a.toString()),this._svgRoot.setAttribute('height',l.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),s!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(i)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:a+2*s.padding,height:l+2*s.padding}}async updateText(e=!0){const{style:t,_image:s,_loadImage:i}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:r,height:n}=this.measureText();s.width=i.width=Math.ceil(Math.max(1,r)),s.height=i.height=Math.ceil(Math.max(1,n)),this._updateID++;const o=this._updateID;await new Promise(e=>{i.onload=async()=>{o<this._updateID||(await t.onBeforeDraw(),s.src=i.src,i.onload=null,i.src='',this.updateTexture()),e()};const r=(new XMLSerializer).serializeToString(this._svgRoot);i.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(r)}`})}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:s,resolution:i}=this,{padding:r}=e,{baseTexture:n}=t;t.trim.width=t._frame.width=s.width/i,t.trim.height=t._frame.height=s.height/i,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-2*r,t.orig.height=t._frame.height-2*r,this._onTextureUpdate(),n.setRealSize(s.width,s.height,i),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){'boolean'==typeof t&&(t={children:t}),t=Object.assign({},e.defaultDestroyOptions,t),super.destroy(t);const s=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=s,this._svgRoot?.remove(),this._svgRoot=s,this._domElement?.remove(),this._domElement=s,this._foreignObject?.remove(),this._foreignObject=s,this._styleElement?.remove(),this._styleElement=s,this._loadImage.src='',this._loadImage.onload=null,this._loadImage=s,this._image.src='',this._image=s}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=i.Wp.sign(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=i.Wp.sign(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&((e=e||{})instanceof Mi?(this.ownsStyle=!1,this._style=e):e instanceof Rs?(console.warn('[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle'),this.ownsStyle=!0,this._style=Mi.from(e)):(this.ownsStyle=!0,this._style=new Mi(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(''===e||null==e?' ':e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,'<br/>').replace(/<hr>/gi,'<hr/>').replace(/&nbsp;/gi,'&#160;')}};Pi.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Pi.defaultMaxWidth=2024,Pi.defaultMaxHeight=2024,Pi.defaultAutoResolution=!0;let Ii=Pi},371(e,t,s){s.d(t,{default:()=>fi});var i=s(990),r=s(395),n=s(677),o=s(926);const a=(0,s(35).defineStore)('pendingText',()=>{const e=(0,o.KR)([]);function t(t){const s=`${t.source}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={...t,id:s};return e.value.push(i),console.info('[PendingTextStore] :',{id:s,text:t.text,source:t.source,unitId:t.unitId,contact:t.contact}),console.info('[PendingTextStore] :',e.value.map(e=>({id:e.id,text:e.text,source:e.source}))),s}return{pendingTexts:e,addPendingText:t,addPhoneText:function(e,s,i){return t({text:e,timestamp:i,source:'phone',contact:s})},addInputText:function(e,s,i){return t({text:e,timestamp:s,source:'input',unitId:i})},clearById:function(t){const s=e.value.findIndex(e=>e.id===t);if(-1!==s){const i=e.value.splice(s,1)[0];console.info('[PendingTextStore]  (by ID):',{id:t,text:i.text,source:i.source}),console.info('[PendingTextStore] :',e.value.map(e=>({id:e.id,text:e.text,source:e.source})))}},clearByUnitId:function(t){const s=e.value.filter(e=>e.unitId===t);e.value=e.value.filter(e=>e.unitId!==t),s.length>0&&(console.info('[PendingTextStore]  (by unitId):',{unitId:t,removedCount:s.length,removedTexts:s.map(e=>e.text)}),console.info('[PendingTextStore] :',e.value.map(e=>({id:e.id,text:e.text,source:e.source}))))},clearByContact:function(t){const s=e.value.filter(e=>'phone'===e.source&&e.contact===t);e.value=e.value.filter(e=>!('phone'===e.source&&e.contact===t)),s.length>0&&(console.info('[PendingTextStore]  (by contact):',{contact:t,removedCount:s.length,removedTexts:s.map(e=>e.text)}),console.info('[PendingTextStore] :',e.value.map(e=>({id:e.id,text:e.text,source:e.source}))))},clearAll:function(){const t=e.value.length,s=e.value.map(e=>({text:e.text,source:e.source}));e.value=[],console.info('[PendingTextStore] :',{clearedCount:t,clearedTexts:s})},getAllPendingText:function(){return console.info('[PendingTextStore] :',{count:e.value.length,texts:e.value.map(e=>({text:e.text,source:e.source,contact:e.contact,unitId:e.unitId}))}),[...e.value]},getPhoneTexts:function(t){const s=t?e.value.filter(e=>'phone'===e.source&&e.contact===t):e.value.filter(e=>'phone'===e.source);return console.info('[PendingTextStore]  PhonePanel :',{contact:t,count:s.length,texts:s.map(e=>e.text)}),s},getInputTexts:function(){const t=e.value.filter(e=>'input'===e.source);return console.info('[PendingTextStore]  GalgamePlayer :',{count:t.length,texts:t.map(e=>({text:e.text,unitId:e.unitId}))}),t},updateText:function(t,s){const i=e.value.find(e=>e.id===t);if(i){const e=i.text;i.text=s,console.info('[PendingTextStore] :',{id:t,oldText:e,newText:s,source:i.source})}},updateTextByUnitId:function(t,s){const i=e.value.find(e=>e.unitId===t);if(i){const e=i.text;i.text=s,console.info('[PendingTextStore]  (by unitId):',{unitId:t,oldText:e,newText:s,source:i.source})}}}}),l=[{id:'none',name:'',pattern:''},{id:'grid',name:'',pattern:'linear-gradient(to right, VAR_BORDER_COLOR 1px, transparent 1px), linear-gradient(to bottom, VAR_BORDER_COLOR 1px, transparent 1px)'},{id:'dots',name:'',pattern:'radial-gradient(circle, VAR_BORDER_COLOR 1px, transparent 1px)'},{id:'diamonds',name:'',pattern:'linear-gradient(45deg, VAR_BORDER_COLOR 25%, transparent 25%), linear-gradient(-45deg, VAR_BORDER_COLOR 25%, transparent 25%), linear-gradient(45deg, transparent 75%, VAR_BORDER_COLOR 75%), linear-gradient(-45deg, transparent 75%, VAR_BORDER_COLOR 75%)'},{id:'stripes',name:'',pattern:'repeating-linear-gradient(45deg, transparent, transparent 10px, VAR_BORDER_COLOR 10px, VAR_BORDER_COLOR 20px)'},{id:'gradient-soft',name:'',pattern:'linear-gradient(135deg, rgba(255,255,255,0.15) 0%, transparent 50%, VAR_BORDER_COLOR 100%)'}],h=[{id:'rounded',name:'',borderRadius:'12px',borderWidth:'1px',shadow:'0 4px 20px rgba(0,0,0,0.08)'},{id:'pill',name:'',borderRadius:'24px',borderWidth:'1px',shadow:'0 4px 24px rgba(0,0,0,0.1)'},{id:'sharp',name:'',borderRadius:'0px',borderWidth:'2px',shadow:'4px 4px 0 rgba(0,0,0,0.1)'},{id:'soft',name:'',borderRadius:'16px',borderWidth:'0px',shadow:'0 8px 32px rgba(0,0,0,0.12)'},{id:'frame',name:'',borderRadius:'4px',borderWidth:'3px',shadow:'inset 0 0 0 1px rgba(0,0,0,0.05)'}],u=[{id:'none',name:'',width:'0px'},{id:'thin',name:'',width:'1px'},{id:'medium',name:'',width:'2px'},{id:'thick',name:'',width:'3px'},{id:'bold',name:'',width:'4px'}],c=[{id:'tag',name:'',borderRadius:'6px 6px 0 0',style:'tag'},{id:'pill',name:'',borderRadius:'999px',style:'pill'},{id:'square',name:'',borderRadius:'0px',style:'square'},{id:'underline',name:'',borderRadius:'0px',style:'underline'},{id:'floating',name:'',borderRadius:'8px',style:'floating'}],d=[{id:'circle',name:'',type:'circle',isInner:!1},{id:'square',name:'',type:'square',isInner:!1},{id:'pill',name:'',type:'pill',isInner:!1},{id:'minimal',name:'',type:'minimal',isInner:!1},{id:'inner-round',name:'',type:'inner-round',isInner:!0},{id:'inner-square',name:'',type:'inner-square',isInner:!0}],p=[{id:'dots',name:'',type:'dots'},{id:'diamonds',name:'',type:'diamonds'},{id:'pulse',name:'',type:'pulse'},{id:'arrow',name:'',type:'arrow'},{id:'none',name:'',type:'none'}],f={boxShape:'rounded',nameShape:'tag',arrowShape:'circle',indicatorShape:'dots',backgroundPattern:'none',borderWidth:'thin',colors:{boxBackground:'rgba(255, 255, 255, 0.9)',boxBorder:'rgba(16, 185, 129, 0.3)',nameBackground:'rgba(236, 253, 245, 0.9)',nameText:'#059669',nameBorder:'rgba(16, 185, 129, 0.3)',dialogText:'#374151',narrationText:'#6b7280',arrowBackground:'rgba(255, 255, 255, 0.85)',arrowIcon:'#10b981',indicatorColor:'#10b981'},fontSize:16};function g(e){const t=e.match(/```json\s*([\s\S]*?)\s*```/);if(t)try{return JSON.parse(t[1])}catch(e){console.warn(' JSON :',e)}const s=e.replace(/^\uFEFF/,'').trim();if(s.startsWith('---')){const e=s.split('---');if(e.length>=3){return g(e.slice(2).join('---').trim())}}if(!s.startsWith('{')&&!s.startsWith('['))return null;try{return JSON.parse(s)}catch(e){return console.warn(' JSON :',e),null}}let m=null,v=0,y='';const x='-';async function b(){const e=Date.now();let t='';try{t=new RawCharacter(RawCharacter.find({name:'current'})).getCardData().name||''}catch(e){console.warn(':',e)}if(m&&e-v<5e3&&y===t)return m;const s={models:new Map,sprites:null,backgrounds:null,cgs:null},i=[];try{const e=getCharWorldbookNames('current');e.primary&&i.push(e.primary),i.push(...e.additional)}catch(e){console.warn(':',e)}i.includes(x)||i.push(x),console.info('[] :',i);for(const e of i)try{if('function'!=typeof getWorldbook){console.warn('[] getWorldbook ');continue}const t=await getWorldbook(e);console.info(`[]  ${e}  ${t.length} `);for(const e of t){if(!e.enabled)continue;const t=g(e.content);if(t){if(console.info(`[] : ${e.name}, type=${t.type}`),'live2d_model'===t.type){const e=t;s.models.has(e.modelName)||s.models.set(e.modelName,e)}else if('sprite'===t.type){const e=t;if(console.info(`[]  ${e.sprites?.length||0} `),e.sprites&&e.sprites.length>0)for(const t of e.sprites)console.info(`[] : ${t.name}, textMappings: ${t.textMappings?.join(', ')}`);if(s.sprites){const t=s.sprites,i=e;t.sprites.push(...i.sprites)}else s.sprites=e;console.info('[] :',s.sprites.sprites.length)}else if('background'===t.type)if(s.backgrounds){const e=s.backgrounds,i=t;e.backgrounds.push(...i.backgrounds)}else s.backgrounds=t;else if('cg'===t.type)if(s.cgs){const e=s.cgs,i=t;e.cgs.push(...i.cgs)}else s.cgs=t}else console.warn(`[] : ${e.name}`)}}catch(t){console.warn(` ${e} :`,t)}return m=s,v=e,y=t,console.info('[] :',{:s.models.size,:s.sprites?.sprites?.length||0,:s.backgrounds?.backgrounds?.length||0,CG:s.cgs?.cgs?.length||0}),s}function T(e){return e.replace(/[-/\\_.\s]/g,'').toLowerCase()}function w(e,t){const s=T(e),i=T(t);return s===i||s.includes(i)||i.includes(s)}function E(e){const t={},s=e.split('||').map(e=>e.trim()).filter(e=>e);for(const e of s){const s=e.match(/^([^:]+)[:]\s*(.+)$/);if(s){const e=s[1].trim(),i=s[2].trim();e&&i&&(t[e]=i)}}return t}async function C(e,t,s,i,r){const n={};try{const o=await b();if(t&&o.backgrounds)for(const e of o.backgrounds.backgrounds){const s=t;if(w(e.name,s)||e.textMappings?.some(e=>w(e,s))){n.sceneImageUrl=e.file;break}}if(r&&o.cgs)for(const e of o.cgs.cgs){const t=r;if(w(e.name,t)||e.textMappings?.some(e=>w(e,t))){n.cgImageUrl=e.file;break}}if(e&&o.sprites){const t=e;console.info('[] :',e,':',o.sprites.sprites.length,':',o.sprites.sprites.map(e=>({name:e.name,textMappings:e.textMappings})));for(const e of o.sprites.sprites){const s=e.textMappings?.some(e=>{const s=w(e,t);return console.info('[]  textMapping:',{mapping:e,matchText:t,result:s}),s}),i=w(e.name,t);if(console.info('[] :',{spriteName:e.name,textMappingMatch:s,nameMatch:i}),s||i){n.spriteImageUrl=e.file,console.info('[] ! sprite:',e.name,'textMappings:',s,'name:',i,'URL:',e.file);break}}n.spriteImageUrl||console.warn('[] :',e)}else e&&!o.sprites&&console.warn('[] :',e);const a=[];e&&a.push(e),t&&a.push(t),s&&a.push(s),i&&a.push(i);let l=null;for(const[e,t]of o.models.entries())if(a.some(t=>w(e,t))){l=t;break}if(l){if(s){let e=!1;if(l.motions&&l.motions.length>0)for(const t of l.motions)if('motion'===t.motionType&&t.textMappings&&t.textMappings.length>0){if(t.textMappings.some(e=>w(e,s))){n.motionFile=t.file,e=!0,console.info('[]  textMappings :',{motionName:t.name,motionFile:t.file,matchedText:s});break}}if(!e&&l.textMappings?.motion)for(const[t,i]of Object.entries(l.textMappings.motion))if(w(i,s)){const s=(l.motions||[]).find(e=>e.file===t||e.name===t);if(s){n.motionFile=s.file,e=!0;break}}if(!e)for(const e of l.motions||[])if('motion'===e.motionType&&(w(e.name,s)||w(e.file,s))){n.motionFile=e.file;break}}if(i){let e=!1;if(l.motions&&l.motions.length>0)for(const t of l.motions)if('expression'===t.motionType&&t.textMappings&&t.textMappings.length>0){if(t.textMappings.some(e=>w(e,i))){n.expressionFile=t.file,e=!0,console.info('[]  textMappings :',{motionName:t.name,motionFile:t.file,matchedText:i});break}}if(!e&&l.textMappings?.expression)for(const[t,s]of Object.entries(l.textMappings.expression))if(w(s,i)){const s=(l.expressions||[]).find(e=>e.file===t||e.name===t);if(s){n.expressionFile=s.file,e=!0;break}}if(!e){for(const t of l.motions||[])if('expression'===t.motionType&&(w(t.name,i)||w(t.file,i))){n.expressionFile=t.file,e=!0;break}if(!e&&l.expressions)for(const e of l.expressions){const t='string'==typeof e?e:e.name||e.file,s='string'==typeof e?e:e.file;if(w(t,i)||w(s,i)){n.expressionFile=s;break}}}}}}catch(e){console.warn(':',e)}return n}function S(e){const t=e.match(/<StatusBlock>([\s\S]*?)<\/StatusBlock>/i);if(!t)return null;const s={},i=t[1].trim().replace(/<skit>[\s\S]*?<\/skit>/gi,'').split('\n');let r=null,n=[];for(const e of i){const t=e.trim(),i=t.match(/^([^:]+)[:]\s*(.*)$/);if(i){if(r){const e=n.join('\n').trim();e&&(s[r]=e)}r=i[1].trim();const e=i[2].trim();n=e?[e]:[]}else r&&t&&n.push(t)}return r&&(s[r]=n.join('\n').trim()),Object.keys(s).length>0?s:null}function A(e,t){if(!e)return!1;const s=e.trim().toLowerCase();if('<user>'===s||'{{user}}'===s||'user'===s||''===s||''===s||''===s)return!0;if(t&&t.trim()){return s===t.trim().toLowerCase()}return!1}async function M(e,t,s){const i=[];let r=t;const n=e.match(/<content>([\s\S]*?)<\/content>/i),o=n?n[1]:e,a=[],l=/\[\[(\w+)\|\|([^\]]*)\]\]/g;let h;for(;null!==(h=l.exec(o));)a.push({type:'format',start:h.index,end:h.index+h[0].length,match:h});const u=o.split('\n');let c=0,d=[],p=-1;for(let e=0;e<u.length;e++){const t=u[e],s=t.trim(),i=c,r=c+t.length;if(s.startsWith('> ')){0===d.length&&(p=i);const e=s.substring(2);d.push(e)}else if(d.length>0&&''===s)d.push('');else if(d.length>0&&!s.startsWith('> ')){const e=d.join('\n').trim();e&&a.push({type:'note',start:p,end:i,noteContent:e}),d=[],p=-1}c=r+1}if(d.length>0){const e=d.join('\n').trim();e&&a.push({type:'note',start:p,end:c,noteContent:e})}a.sort((e,t)=>e.start-t.start);for(const e of a){if('note'===e.type){i.push({type:'note',noteContent:e.noteContent});continue}h=e.match;const t=h[1],n=h[2];if('character'===t){const e=E(n),t=e['']||e.character||'';if(A(t,s)){const t=e['']||e.scene||r;let s=e['']||e['']||e.text||n;const o=/([^]+)/g,a=[];let l;for(;null!==(l=o.exec(s));)a.push(l[1]);s=s.replace(o,'').trim(),t&&(r=t);for(const e of a){const s={type:'narration',scene:t,message:e};if(t){const e=await C(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(s.sceneImageUrl=e.sceneImageUrl)}i.push(s)}const h={type:'user',scene:t,message:s};if(t){const e=await C(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(h.sceneImageUrl=e.sceneImageUrl)}i.push(h);continue}const o={type:'character'};o.character=t;const a=e['CG']||e['cg']||e.CG||e.cg;a?(o.scene=a,o.text=e['']||e.text||'',o.isCG=!0):(o.scene=e['']||e.scene||r,o.motion=e['']||e.motion||'',o.expression=e['']||e.expression||'',o.text=e['']||e.text||'',o.isCG=!1),!o.scene&&r&&(o.scene=r),o.scene&&(r=o.scene),console.info('[] :',{character:o.character,scene:o.isCG?void 0:o.scene,motion:o.motion,expression:o.expression,cgScene:o.isCG?o.scene:void 0,isCGMode:o.isCG});const l=await C(o.character,o.isCG?void 0:o.scene,o.motion,o.expression,o.isCG?o.scene:void 0);console.info('[] :',l),Object.assign(o,l),i.push(o)}else if('narration'===t){const e=E(n),t=e['']||e.scene||r;t&&(r=t);const s={type:'narration',scene:t,message:e['']||e['']||e.text||e['']||n};if(t){const e=await C(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(s.sceneImageUrl=e.sceneImageUrl)}i.push(s)}else if('blacktext'===t){const e=E(n),t=e['']||e.text||e['']||n;i.push({type:'blacktext',message:t})}else if('user'===t){const e=E(n),t=e['']||e.scene||r;let s=e['']||e['']||e['']||e.text||n;const o=/([^]+)/g,a=[];let l;for(;null!==(l=o.exec(s));)a.push(l[1]);s=s.replace(o,'').trim(),t&&(r=t);for(const e of a){const s={type:'narration',scene:t,message:e};if(t){const e=await C(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(s.sceneImageUrl=e.sceneImageUrl)}i.push(s)}const h={type:'user',scene:t,message:s};if(t){const e=await C(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(h.sceneImageUrl=e.sceneImageUrl)}i.push(h)}else if('choice'===t){const e=E(n),t=e['']||e.character||e['']||e.response||e.text||e['']||e.narration,s=[];for(const t in e)if(t.match(/^\d+?$/)){const e=t.replace(/^(\d+)?$/,'$1');s.push(e)}if(s.sort((e,t)=>parseInt(e)-parseInt(t)),1===s.length&&t){const t=`${s[0]}`,r=e[t]||e[`${t}`];r&&i.push({type:'choice',choiceFormat:'format1',options:[{id:'choice_0',text:r,character:e['']||e.character,response:e['']||e.response||e.text||e['']||e.narration}]})}else if(s.length>1){const t=[];for(const i of s){const s=`${i}`,r=e[s]||e[`${s}`];r&&t.push(r)}t.length>0&&i.push({type:'choice',choiceFormat:'format2',choices:t})}}}return i}function P(e,t,s,i){if(!e||!i||0===i.length)return!1;const r=i.find(t=>t.name===e);if(!r)return!1;if(t){let e=!1;if(e=r.motions?.some(e=>{const s='string'==typeof e?e:e.name||e.file;return s===t||s===`${t}.motion3.json`}),!e&&r.textMappings?.motion)for(const[s,i]of Object.entries(r.textMappings.motion)){const n=T(t),o=T(String(i));if((n===o||n.includes(o)||o.includes(n))&&(e=r.motions?.some(e=>{const t='string'==typeof e?e:e.file;return t===s||t===`${s}.motion3.json`}),e))break}if(!e)return!1}if(s){let e=!1;if(e=r.expressions?.some(e=>{const t='string'==typeof e?e:e.name||e.file;return t===s||t===`${s}.exp3.json`}),!e&&r.textMappings?.expression)for(const[t,i]of Object.entries(r.textMappings.expression)){const n=T(s),o=T(String(i));if((n===o||n.includes(o)||o.includes(n))&&(e=r.expressions?.some(e=>{const s='string'==typeof e?e:e.file;return s===t||s===`${t}.exp3.json`}),e))break}if(!e)return!1}return!0}var I=s(165),R=s(958);class L{canvas=null;app=null;model=null;isInitialized=!1;config=null;getDisplaySize(){const e=this.app?.renderer?.screen?.width,t=this.app?.renderer?.screen?.height;if(e&&t)return{width:e,height:t};return{width:this.canvas?.clientWidth||this.canvas?.offsetWidth||this.canvas?.width||800,height:this.canvas?.clientHeight||this.canvas?.offsetHeight||this.canvas?.height||600}}async init(e){if(!this.isInitialized)try{const t=e.clientWidth||e.offsetWidth||800,s=e.clientHeight||e.offsetHeight||600;console.info('[PixiLive2DRenderer] canvas:',{exists:!!e,clientWidth:e.clientWidth,clientHeight:e.clientHeight,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,finalWidth:t,finalHeight:s}),0!==e.clientWidth&&0!==e.clientHeight||console.warn('[PixiLive2DRenderer] Canvas  0:',{width:t,height:s}),this.canvas=e,this.app=new I.Application({view:e,autoStart:!0,width:t,height:s,backgroundColor:0,backgroundAlpha:0,antialias:!0,resolution:window.devicePixelRatio||1,autoDensity:!0}),console.info('[PixiLive2DRenderer] Pixi ',{screenWidth:this.app.renderer?.screen?.width,screenHeight:this.app.renderer?.screen?.height}),this.app.renderer?.screen||console.warn('[PixiLive2DRenderer] renderer.screen  canvas ');new ResizeObserver(()=>{this.resize()}).observe(e),this.isInitialized=!0,console.info('[PixiLive2DRenderer] ')}catch(e){const t=e instanceof Error?e.message:String(e),s=e instanceof Error?e.stack:void 0;throw console.error('[PixiLive2DRenderer] :',t),s&&console.error('[PixiLive2DRenderer] :',s),console.error('[PixiLive2DRenderer] :',JSON.stringify({message:t,stack:s},null,2)),e}}async loadModel(e){if(!this.isInitialized||!this.app)throw new Error('');try{console.info(`[PixiLive2DRenderer] : "${e.name}"`);const t=await R.live2dModelManager.getOrLoadModel(e);this.model&&this.app.stage.removeChild(this.model),this.model=t,this.config=e,this.app.stage.addChild(t),t.anchor.set(.5,1);const{width:s,height:i}=this.getDisplaySize(),r=.3*Math.min(s/t.width,i/t.height);if(t.scale.set(r),t.x=s/2,t.y=i,t.alpha=1,t.visible=!0,console.info(`[PixiLive2DRenderer]  "${e.name}" `),e.defaultAnimation){if(e.defaultAnimation.motion){const t=e.motions?.find(t=>(t.name===e.defaultAnimation?.motion||t.file===e.defaultAnimation?.motion)&&'expression'!==t.motionType);if(t&&void 0!==t.index){const e=t.group??'default';this.playMotion(e,t.index,1)}else if(t){const t=e.motions?.findIndex(t=>t.name===e.defaultAnimation?.motion||t.file===e.defaultAnimation?.motion);if(void 0!==t&&t>=0&&e.motions){const s=e.motions[t].group??'default';this.playMotion(s,t,1)}}}if(e.defaultAnimation.expression){const t=e.motions?.find(t=>(t.name===e.defaultAnimation?.expression||t.file===e.defaultAnimation?.expression)&&'expression'===t.motionType);if(t&&void 0!==t.index){const e=t.group??'default';this.playMotion(e,t.index,2)}else{const t=e.expressions?.findIndex(t=>t===e.defaultAnimation?.expression||t.includes(e.defaultAnimation?.expression||''));void 0!==t&&t>=0&&this.playExpression(t)}}}}catch(e){throw console.error('[PixiLive2DRenderer] :',e),new Error(`: ${e instanceof Error?e.message:String(e)}`)}}playMotion(e,t,s=2){if(this.model)try{console.info(`[PixiLive2DRenderer] : ="${e}", =${t}, =${s}`),this.model.motion(e,t,s)}catch(e){console.error('[PixiLive2DRenderer] :',e)}else console.warn('[PixiLive2DRenderer] ')}playExpression(e){if(this.model)try{console.info(`[PixiLive2DRenderer] : =${e}`),this.model.expression(e)}catch(e){console.error('[PixiLive2DRenderer] :',e)}else console.warn('[PixiLive2DRenderer] ')}setPosition(e,t){if(!this.model||!this.app)return;const{width:s,height:i}=this.getDisplaySize();this.model.x=e/100*s,this.model.y=t/100*i}setScale(e){this.model&&this.model.scale.set(e)}getModel(){return this.model}isReady(){return this.isInitialized}setVisible(e){this.model&&(e?(this.model.alpha=1,this.model.visible=!0,console.info('[PixiLive2DRenderer] ')):(this.model.alpha=0,this.model.visible=!1,console.info('[PixiLive2DRenderer] ')))}playMotionByText(e,t){if(!this.model||!this.config?.motions)return!1;const s=e=>e.replace(/[-/\\_.\s]/g,'').toLowerCase(),i=s(e);for(const r of this.config.motions)if(r.textMappings&&r.textMappings.length>0){if(r.textMappings.some(e=>{const t=s(e);return i===t||i.includes(t)||t.includes(i)})){let s=t;if(void 0===s&&(s=2),void 0!==r.index)return console.info(`[PixiLive2DRenderer] : "${r.name}" (group="${r.group}", index=${r.index}, type=${r.motionType}, text="${e}")`),this.playMotion(r.group,r.index,s),!0}}return!1}unloadModel(){this.model&&this.app&&(this.app.stage.removeChild(this.model),this.model.destroy(),this.model=null),this.config=null}destroy(){this.unloadModel(),this.app&&(this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0}),this.app=null),this.canvas=null,this.isInitialized=!1}resize(e,t){if(!this.canvas||!this.app)return;const s=this.getDisplaySize(),i=e||this.canvas.clientWidth||s.width,r=t||this.canvas.clientHeight||s.height;this.app.renderer.resize(i,r),console.info('[PixiLive2DRenderer] :',{displayWidth:i,displayHeight:r})}}const k=['src'],D=(0,i.pM)({__name:'CharacterSprite',props:{spriteScale:{},spritePositionX:{},spritePositionY:{},live2dScale:{},live2dPositionX:{},live2dPositionY:{},spriteType:{},imageUrl:{},live2dModelId:{},live2dModels:{},motion:{},expression:{}},setup(e){const t=e,s=(0,o.KR)(null);let n,a,l,h=null;const u=(0,i.EW)(()=>({left:`${t.spritePositionX}%`,bottom:100-t.spritePositionY+'%',transform:`translateX(-50%) scale(${t.spriteScale})`,transformOrigin:'bottom center'}));function c(e,t){if(!h)return;if(h.playMotionByText(t))return;let s=t;if(e.textMappings?.motions)for(const[i,r]of Object.entries(e.textMappings.motions))if(r===t||String(r).toLowerCase()===t.toLowerCase()){s=i,console.info(`[CharacterSprite]  textMappings : ${t} -> ${i}`);break}const i=e.motions?.find(e=>{const t='string'==typeof e?e:e.name||e.file;return t===s||t===`${s}.motion3.json`||e.file===s});if(i){const t='string'==typeof i?'idle':i.group??'idle';if('string'!=typeof i&&void 0!==i.index)return console.info(`[CharacterSprite] : group="${t}", index=${i.index}, motion=${s}`),void h.playMotion(t,i.index,2);const r=(e.motions?.filter(e=>('string'==typeof e?'idle':e.group??'idle')===t)||[]).findIndex(e=>{const t='string'==typeof e?e:e.name||e.file;return t===s||t===`${s}.motion3.json`||e.file===s});r>=0&&(console.info(`[CharacterSprite] : group="${t}", index=${r}, motion=${s}`),h.playMotion(t,r,2))}else console.warn(`[CharacterSprite] : ${s}`)}function d(e,t){if(!h)return;if(h.playMotionByText(t,3))return;let s=t;if(e.textMappings?.expressions)for(const[i,r]of Object.entries(e.textMappings.expressions))if(r===t||String(r).toLowerCase()===t.toLowerCase()){s=i,console.info(`[CharacterSprite]  textMappings : ${t} -> ${i}`);break}const i=e.expressions?.findIndex(e=>{const t='string'==typeof e?e:e.name||e.file;return t===s||t===`${s}.exp3.json`||'object'==typeof e&&e.file===s});void 0!==i&&i>=0?(console.info(`[CharacterSprite] : index=${i}, expression=${s}`),h.playExpression(i)):console.warn(`[CharacterSprite] : ${s}`)}async function p(){if(console.info('[CharacterSprite] loadLive2dModel ',{spriteType:t.spriteType,live2dModelId:t.live2dModelId,hasModels:!!t.live2dModels,modelsLength:t.live2dModels?.length||0,hasCanvas:!!s.value}),!t.live2dModelId||!t.live2dModels||!s.value)return void console.warn('[CharacterSprite] ',{live2dModelId:t.live2dModelId,hasModels:!!t.live2dModels,hasCanvas:!!s.value});if(!await async function(){if(h&&h.isReady())return!0;if(await(0,i.dY)(),s.value||(console.error('[CharacterSprite] Canvas '),await new Promise(e=>requestAnimationFrame(()=>e(void 0))),await(0,i.dY)()),!s.value)return console.error('[CharacterSprite] Canvas '),!1;try{h||(console.info('[CharacterSprite]  Pixi Live2D '),h=new L);const e=h;return e?(e.isReady()||(await e.init(s.value),console.info('[CharacterSprite] Pixi Live2D ')),!!e&&e.isReady()):(console.error('[CharacterSprite] '),!1)}catch(e){const t=e instanceof Error?e.message:String(e),s=e instanceof Error?e.stack:void 0;return console.error('[CharacterSprite] :',t),s&&console.error('[CharacterSprite] :',s),!1}}())return void console.error('[CharacterSprite] ');const e=t.live2dModels.map(e=>({id:e.id,name:e.name}));console.info('[CharacterSprite] :',e),console.info('[CharacterSprite] ID:',t.live2dModelId,':',typeof t.live2dModelId);let r=t.live2dModels.find(e=>e.id===t.live2dModelId);if(r||(r=t.live2dModels.find(e=>e.name===t.live2dModelId),r&&console.info(`[CharacterSprite]  name : ${t.live2dModelId} -> ${r.id}`)),r){console.info('[CharacterSprite] :',{id:r.id,name:r.name,modelPath:r.modelPath,basePath:r.basePath,motionsCount:r.motions?.length||0,expressionsCount:r.expressions?.length||0});try{const e=h;if(!e)return void console.error('[CharacterSprite] ');const s=l!==t.live2dModelId;s&&(console.info('[CharacterSprite] ID:',{oldModelId:l,newModelId:t.live2dModelId}),await e.loadModel(r),console.info('[CharacterSprite] Live2D '),l=t.live2dModelId,e.setScale(t.live2dScale),e.setPosition(t.live2dPositionX,t.live2dPositionY),console.info('[CharacterSprite] :',{scale:t.live2dScale,positionX:t.live2dPositionX,positionY:t.live2dPositionY}));const i=n!==t.motion,o=a!==t.expression;(i||o||s)&&(!async function(e){t.expression&&t.motion?(d(e,t.expression),await new Promise(e=>setTimeout(e,3e3)),c(e,t.motion)):(t.expression&&d(e,t.expression),t.motion&&c(e,t.motion))}(r),n=t.motion,a=t.expression)}catch(e){console.error('[CharacterSprite]  Live2D :',e);const i=e instanceof Error?e.message:String(e),n=e instanceof Error?e.stack:void 0,o={message:i,stack:n,modelId:t.live2dModelId,modelConfig:r?{id:r.id,name:r.name}:null,canvasInfo:s.value?{width:s.value.clientWidth,height:s.value.clientHeight,offsetWidth:s.value.offsetWidth,offsetHeight:s.value.offsetHeight}:null,rendererReady:h?.isReady()||!1};console.error('[CharacterSprite] :',JSON.stringify(o,null,2)),console.error('[CharacterSprite] :',i),n&&console.error('[CharacterSprite] :',n),console.error('[CharacterSprite] ID:',t.live2dModelId),console.error('[CharacterSprite] Canvas :',o.canvasInfo),console.error('[CharacterSprite] :',o.rendererReady)}}else console.warn(`[CharacterSprite]  Live2D : ${t.live2dModelId}`,{requestedId:t.live2dModelId,requestedIdType:typeof t.live2dModelId,availableIds:t.live2dModels.map(e=>({id:e.id,idType:typeof e.id,name:e.name})),availableIdsString:JSON.stringify(t.live2dModels.map(e=>e.id)),requestedIdString:JSON.stringify(t.live2dModelId)})}return(0,i.wB)(()=>[t.live2dModelId,t.live2dModels],async(e,r)=>{const o=r?.[1],l=o!==t.live2dModelId;console.info('[CharacterSprite] watch ID:',{live2dModelId:t.live2dModelId,modelsCount:t.live2dModels?.length,oldModelId:o,modelIdChanged:l}),l&&t.live2dModelId&&(n=void 0,a=void 0,await(0,i.dY)(),s.value||(console.error('[CharacterSprite] Canvas '),await new Promise(e=>requestAnimationFrame(()=>e(void 0))),await(0,i.dY)()),s.value?await p():console.error('[CharacterSprite] Canvas '))},{immediate:!0}),(0,i.wB)(()=>t.spriteType,(e,t)=>{console.info('[CharacterSprite] spriteType :',{oldType:t,newType:e,hasRenderer:!!h}),h&&('live2d'===e?(console.info('[CharacterSprite]  Live2D '),h.setVisible(!0)):(console.info('[CharacterSprite]  Live2D '),h.setVisible(!1)))},{immediate:!0}),(0,i.wB)(()=>[t.motion,t.expression],()=>{if('live2d'===t.spriteType&&h&&t.live2dModelId&&t.live2dModels){const e=n!==t.motion,s=a!==t.expression;if(e||s){const i=t.live2dModels.find(e=>e.id===t.live2dModelId);i&&(t.expression&&t.motion&&(s||e)?(s&&t.expression&&d(i,t.expression),e&&t.motion&&setTimeout(()=>{c(i,t.motion)},3e3)):(e&&t.motion&&c(i,t.motion),s&&t.expression&&d(i,t.expression)),n=t.motion,a=t.expression)}}}),(0,i.wB)(()=>[t.live2dScale,t.live2dPositionX,t.live2dPositionY],()=>{'live2d'===t.spriteType&&h&&(h.setScale(t.live2dScale),h.setPosition(t.live2dPositionX,t.live2dPositionY))}),(0,i.sV)(async()=>{if(await(0,i.dY)(),s.value){if(!h)try{const e=s.value;if(!e)return void console.error('[CharacterSprite] Canvas ');const t=e.clientWidth||e.offsetWidth||800,r=e.clientHeight||e.offsetHeight||600;if(console.info('[CharacterSprite]  Pixi Live2D ',{canvasWidth:t,canvasHeight:r,clientWidth:e.clientWidth,clientHeight:e.clientHeight,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight}),0===t||0===r){console.warn('[CharacterSprite] Canvas  0'),await new Promise(e=>requestAnimationFrame(()=>e(void 0))),await(0,i.dY)();const t=e.clientWidth||e.offsetWidth||800,s=e.clientHeight||e.offsetHeight||600;if(console.info('[CharacterSprite]  Canvas :',{width:t,height:s}),0===t||0===s)return void console.error('[CharacterSprite] Canvas  0')}h=new L,await h.init(e),console.info('[CharacterSprite] Pixi Live2D ')}catch(e){const t=e instanceof Error?e.message:String(e),s=e instanceof Error?e.stack:void 0;return console.error('[CharacterSprite] :',t),s&&console.error('[CharacterSprite] :',s),void console.error('[CharacterSprite] :',JSON.stringify({message:t,stack:s},null,2))}t.live2dModelId&&t.live2dModels&&(await p(),'live2d'===t.spriteType?h.setVisible(!0):h.setVisible(!1))}else console.error('[CharacterSprite] Canvas ')}),(0,i.hi)(()=>{h&&(h.destroy(),h=null)}),(t,n)=>((0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Q3)('  -  '),'image'===e.spriteType?((0,i.uX)(),(0,i.CE)('div',{key:0,class:'pointer-events-none absolute z-5 transition-all duration-300',style:(0,r.Tr)(u.value)},[(0,i.Lk)('img',{src:e.imageUrl,alt:'',class:'h-[70vh] w-auto object-contain drop-shadow-2xl',draggable:'false'},null,8,k)],4)):(0,i.Q3)('v-if',!0),(0,i.Q3)(' Live2D  - / '),(0,i.Lk)('canvas',{ref_key:'live2dCanvasRef',ref:s,class:'live2d-canvas pointer-events-none absolute inset-0 z-5',style:(0,r.Tr)({width:'100%',height:'100%',display:s.value?'block':'none'})},null,4)],64))}});var B=s(502);const F=(0,B.A)(D,[['__scopeId','data-v-110796a2']]),O=F,N={class:'status-container'},U={class:'status-header'},G={class:'status-main-content'},V={class:'status-info-bar'},H={class:'info-item'},W={class:'info-item'},X={class:'status-values-grid'},j={class:'value-card'},Y={class:'value-number'},q={class:'value-card'},Q={class:'value-number'},K={class:'value-card'},Z={class:'value-number'},J={class:'value-card'},ee={class:'value-number'},te={class:'status-text-card'},se={class:'text-card-row'},ie={class:'text-card-content'},re={class:'text-card-row'},ne={class:'text-card-content'},oe={class:'text-card-row'},ae={class:'text-card-content'},le={class:'text-card-row'},he={class:'text-card-content'},ue=(0,i.pM)({__name:'CharacterStatusPanel',props:{show:{type:Boolean},messageId:{},statusBlock:{},onClose:{type:Function}},setup(e){const t=e,s=(0,o.KR)({});function a(){if(void 0!==t.messageId)try{const e=getVariables({type:'message',message_id:t.messageId}),i=e?.stat_data||{};s.value={:i.||'',:{:i.?.??0,:i.?.??0,:i.?.??0,:i.?.??0}}}catch(e){console.warn(' MVU :',e),s.value={}}else s.value={}}(0,i.wB)(()=>t.messageId,()=>{t.show&&a()},{immediate:!0}),(0,i.wB)(()=>t.show,e=>{e&&a()});const l=(0,i.EW)(()=>{const e={:'',:'',:'',:'',:''};return t.statusBlock&&(t.statusBlock.&&(e.=t.statusBlock.),t.statusBlock.&&(e.=t.statusBlock.),t.statusBlock.&&(e.=t.statusBlock.),t.statusBlock.&&(e.=t.statusBlock.),t.statusBlock.&&(e.=t.statusBlock.)),e});return(t,o)=>e.show?((0,i.uX)(),(0,i.CE)('div',{key:0,class:'animate-in fade-in absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm duration-200',onClick:o[2]||(o[2]=(...t)=>e.onClose&&e.onClose(...t))},[(0,i.Lk)('div',{class:'status-container-wrapper',onClick:o[1]||(o[1]=(0,n.D$)(()=>{},['stop']))},[(0,i.Lk)('div',N,[(0,i.Q3)('  '),(0,i.Lk)('div',U,[o[4]||(o[4]=(0,i.Lk)('span',{class:'summary-icon'},'',-1)),o[5]||(o[5]=(0,i.Lk)('span',{class:'status-title'},'',-1)),(0,i.Lk)('button',{class:'status-close','aria-label':'',onClick:o[0]||(o[0]=(...t)=>e.onClose&&e.onClose(...t))},[...o[3]||(o[3]=[(0,i.Lk)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),(0,i.Q3)('  '),(0,i.Lk)('div',G,[(0,i.Q3)('  '),(0,i.Lk)('div',V,[(0,i.Lk)('div',H,[o[6]||(o[6]=(0,i.Lk)('span',null,'',-1)),(0,i.Lk)('span',null,(0,r.v_)(s.value.||''),1)]),(0,i.Lk)('div',W,[o[7]||(o[7]=(0,i.Lk)('span',null,'',-1)),(0,i.Lk)('span',null,(0,r.v_)(l.value.||''),1)])]),(0,i.Q3)('  '),(0,i.Lk)('div',X,[(0,i.Lk)('div',j,[o[8]||(o[8]=(0,i.Lk)('div',{class:'value-name'},'',-1)),(0,i.Lk)('div',Y,(0,r.v_)(s.value.?.??0),1)]),(0,i.Lk)('div',q,[o[9]||(o[9]=(0,i.Lk)('div',{class:'value-name'},'',-1)),(0,i.Lk)('div',Q,(0,r.v_)(s.value.?.??0),1)]),(0,i.Lk)('div',K,[o[10]||(o[10]=(0,i.Lk)('div',{class:'value-name'},'',-1)),(0,i.Lk)('div',Z,(0,r.v_)(s.value.?.??0),1)]),(0,i.Lk)('div',J,[o[11]||(o[11]=(0,i.Lk)('div',{class:'value-name'},'',-1)),(0,i.Lk)('div',ee,(0,r.v_)(s.value.?.??0),1)])]),(0,i.Q3)('  '),(0,i.Lk)('div',te,[(0,i.Lk)('div',se,[o[12]||(o[12]=(0,i.Lk)('span',{class:'text-card-label'},'',-1)),(0,i.Lk)('span',ie,(0,r.v_)(l.value.||''),1)]),(0,i.Lk)('div',re,[o[13]||(o[13]=(0,i.Lk)('span',{class:'text-card-label'},'',-1)),(0,i.Lk)('span',ne,(0,r.v_)(l.value.||''),1)]),(0,i.Lk)('div',oe,[o[14]||(o[14]=(0,i.Lk)('span',{class:'text-card-label'},'',-1)),(0,i.Lk)('span',ae,(0,r.v_)(l.value.||''),1)]),(0,i.Lk)('div',le,[o[15]||(o[15]=(0,i.Lk)('span',{class:'text-card-label'},'',-1)),(0,i.Lk)('span',he,(0,r.v_)(l.value.||''),1)])])])])])])):(0,i.Q3)('v-if',!0)}}),ce=(0,B.A)(ue,[['__scopeId','data-v-92b411dc']]),de=['onClick'],pe={key:1,class:'flex items-center gap-2'},fe=(0,i.pM)({__name:'ChoiceBox',props:{options:{},customStyle:{},onSelect:{type:Function},onPrev:{type:Function},onNext:{type:Function},onSave:{type:Function}},setup(e){const t=e,s=(0,o.KR)(!1),a=(0,o.KR)(''),l=(0,o.KR)(!1),c=(0,o.KR)(null);function d(){s.value?a.value.trim()&&t.onSelect('custom',a.value):(s.value=!0,(0,i.dY)(()=>{c.value?.focus()}))}function p(){a.value.trim()&&t.onSelect('custom',a.value)}(0,i.wB)(()=>t.options,()=>{s.value=!1,a.value='',l.value=!1});const g=(0,i.EW)(()=>t.customStyle||f),m=(0,i.EW)(()=>h.find(e=>e.id===g.value.boxShape)||h[0]),v=(0,i.EW)(()=>u.find(e=>e.id===g.value.borderWidth)||u[1]),y=(0,i.EW)(()=>'pill'===g.value.boxShape);function x(e){const s=e.currentTarget.getBoundingClientRect();e.clientX-s.left<s.width/2&&t.onPrev?.()}return(o,h)=>((0,i.uX)(),(0,i.CE)('div',{class:'absolute inset-0 z-25 flex items-center justify-center bg-black/30 backdrop-blur-sm',onClick:x},[(0,i.Lk)('div',{class:'flex w-full max-w-md flex-col gap-3 px-6',onClick:h[2]||(h[2]=(0,n.D$)(()=>{},['stop']))},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.options,(e,s)=>((0,i.uX)(),(0,i.CE)('button',{key:e.id,class:'w-full p-4 text-left transition-all hover:scale-[1.02] active:scale-[0.98]',style:(0,r.Tr)({backgroundColor:y.value?'rgba(255, 255, 255, 0.7)':g.value.colors.boxBackground,borderRadius:m.value.borderRadius,borderTopWidth:v.value.width,borderLeftWidth:v.value.width,borderRightWidth:v.value.width,borderBottomWidth:v.value.width,borderStyle:'solid',borderColor:g.value.colors.boxBorder,boxShadow:m.value.shadow,color:g.value.colors.dialogText,fontSize:`${g.value.fontSize}px`,backdropFilter:y.value?'blur(12px)':void 0,WebkitBackdropFilter:y.value?'blur(12px)':void 0}),onClick:()=>{return s=e.id,l.value&&(l.value=!1),void t.onSelect(s);var s}},(0,r.v_)(e.text),13,de))),128)),(0,i.Q3)('  '),(0,i.Lk)('div',{class:(0,r.C4)(['w-full p-4 transition-all cursor-pointer',l.value?'ring-2 ring-primary':'']),style:(0,r.Tr)({backgroundColor:y.value?'rgba(255, 255, 255, 0.7)':g.value.colors.boxBackground,borderRadius:m.value.borderRadius,borderTopWidth:v.value.width,borderLeftWidth:v.value.width,borderRightWidth:v.value.width,borderBottomWidth:v.value.width,borderStyle:'solid',borderColor:g.value.colors.boxBorder,boxShadow:m.value.shadow,fontSize:`${g.value.fontSize}px`,backdropFilter:y.value?'blur(12px)':void 0,WebkitBackdropFilter:y.value?'blur(12px)':void 0}),onClick:d},[s.value?((0,i.uX)(),(0,i.CE)('div',pe,[(0,i.bo)((0,i.Lk)('input',{ref_key:'inputRef',ref:c,'onUpdate:modelValue':h[0]||(h[0]=e=>a.value=e),type:'text',placeholder:'...',class:'flex-1 bg-transparent outline-none',style:(0,r.Tr)({color:g.value.colors.dialogText}),onClick:h[1]||(h[1]=(0,n.D$)(()=>{},['stop'])),onKeydown:(0,n.jR)(p,['enter']),autofocus:''},null,36),[[n.Jo,a.value]]),(0,i.Q3)('  '),a.value.trim()?((0,i.uX)(),(0,i.CE)('button',{key:0,class:'p-1 transition-colors hover:opacity-80',style:(0,r.Tr)({color:g.value.colors.nameText}),'aria-label':'',onClick:(0,n.D$)(p,['stop'])},[...h[4]||(h[4]=[(0,i.Lk)('svg',{class:'h-5 w-5',viewBox:'0 0 1024 1024',version:'1.1',xmlns:'http://www.w3.org/2000/svg',fill:'currentColor'},[(0,i.Lk)('path',{d:'M1023.200312 43.682936L877.057399 920.640375c-1.899258 10.995705-8.096837 19.592347-18.292854 25.689965-5.29793 2.898868-11.295588 4.598204-17.693089 4.598204-4.19836 0-8.796564-0.99961-13.69465-2.898868l-236.707536-96.762202c-12.994924-5.29793-27.889106-1.499414-36.785631 9.296368l-123.251855 150.341273c-6.897306 8.796564-16.293635 13.094885-27.989066 13.094885-4.898087 0-9.096447-0.799688-12.695041-2.299102-7.197189-2.698946-12.994924-6.997267-17.393206-13.394768-4.398282-6.29754-6.697384-13.194846-6.697384-20.891839V811.083171c0-14.794221 5.098009-28.988676 14.394377-40.484186l478.912925-587.070676-602.864506 521.796174c-4.598204 3.898477-10.995705 4.998048-16.493557 2.698945L23.390863 619.358063C9.296369 614.060133 1.599375 603.664194 0.599766 587.870363c-0.799688-15.194065 5.29793-26.489652 18.292854-33.786802L968.921515 5.997657c5.797735-3.498633 11.795392-5.098009 18.292854-5.098008 7.696993 0 14.594299 2.199141 20.691918 6.397501 12.695041 8.996486 17.593128 21.291683 15.294025 36.385786z'})],-1)])],4)):(0,i.Q3)('v-if',!0)])):((0,i.uX)(),(0,i.CE)('div',{key:0,class:'flex items-center gap-2',style:(0,r.Tr)({color:g.value.colors.narrationText})},[...h[3]||(h[3]=[(0,i.Lk)('svg',{class:'h-4 w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z'})],-1),(0,i.Lk)('span',null,'...',-1)])],4))],6)])]))}}),ge={class:'absolute bottom-0 left-0 right-0 z-20 px-4 md:px-8 pb-4 md:pb-6'},me={class:'flex items-center gap-2 md:gap-4 max-w-4xl mx-auto'},_e=['disabled'],ve={key:0,class:'absolute left-2 top-1/2 -translate-y-1/2 z-10'},ye=['disabled'],xe={key:0,class:'ml-auto flex gap-2'},be=['innerHTML'],Te={class:'absolute bottom-3 right-4'},we={key:2,class:'absolute right-2 top-1/2 -translate-y-1/2 z-10'},Ee=['disabled'],Ce=['disabled'],Se={class:'flex gap-3 mt-4 justify-end'},Ae=(0,i.pM)({__name:'DialogBox',props:{character:{},text:{},isLastDialogue:{type:Boolean},isFirstDialogue:{type:Boolean},onPrev:{type:Function},onNext:{type:Function},dialogKey:{},customStyle:{},isLoading:{type:Boolean},streamingText:{},isThrough:{type:Boolean},isEditable:{type:Boolean},messageId:{},onEdit:{type:Function},onDelete:{type:Function}},setup(e){const t=e,s=(0,o.KR)(''),a=(0,o.KR)(!0);let g=null;const m=(0,o.KR)(null),v=(0,o.KR)(!1),y=(0,i.EW)(()=>v.value?'justify-start':'justify-center'),x=(0,i.EW)(()=>t.customStyle||f),b=(0,i.EW)(()=>h.find(e=>e.id===x.value.boxShape)||h[0]),T=(0,i.EW)(()=>c.find(e=>e.id===x.value.nameShape)||c[0]),w=(0,i.EW)(()=>d.find(e=>e.id===x.value.arrowShape)||d[0]),E=(0,i.EW)(()=>p.find(e=>e.id===x.value.indicatorShape)||p[0]),C=(0,i.EW)(()=>u.find(e=>e.id===x.value.borderWidth)||u[1]),S=(0,i.EW)(()=>l.find(e=>e.id===x.value.backgroundPattern)),A=(0,i.EW)(()=>!t.character||''===t.character.trim()),M=(0,i.EW)(()=>w.value.isInner),P=(0,i.EW)(()=>'minimal'===w.value.type),I=(0,i.EW)(()=>'pill'===x.value.boxShape),R=(0,i.EW)(()=>{if(!S.value?.pattern)return{};const e=x.value.colors.boxBorder.replace(/[\d.]+\)$/,'0.08)'),t=S.value.pattern.replace(/VAR_BORDER_COLOR/g,e);let s='20px 20px';return'dots'===S.value.id&&(s='16px 16px'),'diamonds'===S.value.id&&(s='16px 16px'),'stripes'===S.value.id&&(s='28px 28px'),{backgroundImage:t,backgroundSize:s}}),L=(0,i.EW)(()=>({backgroundColor:I.value?'rgba(255, 255, 255, 0.7)':x.value.colors.boxBackground,borderRadius:b.value.borderRadius,borderTopWidth:C.value.width,borderLeftWidth:C.value.width,borderRightWidth:C.value.width,borderBottomWidth:C.value.width,borderStyle:'solid',borderColor:x.value.colors.boxBorder,boxShadow:b.value.shadow,...I.value?{backdropFilter:'blur(12px)',WebkitBackdropFilter:'blur(12px)'}:{},...R.value})),k=(0,i.EW)(()=>{const e=t.isFirstDialogue||t.isLastDialogue?`${x.value.colors.arrowIcon}66`:x.value.colors.arrowIcon;if(P.value)return{color:e};const s=x.value.colors.arrowBackground;let i='9999px';return'square'!==w.value.type&&'inner-square'!==w.value.type||(i='6px'),'pill'===w.value.type&&(i='16px'),{backgroundColor:s,borderRadius:i,color:e}}),D=(0,i.EW)(()=>{const e=t.isFirstDialogue?`${x.value.colors.arrowIcon}66`:x.value.colors.arrowIcon;return{background:'inner-round'===w.value.type?x.value.colors.arrowBackground:'transparent',color:e}}),B=(0,i.EW)(()=>{const e=t.isLastDialogue?`${x.value.colors.arrowIcon}66`:x.value.colors.arrowIcon;return{background:'inner-round'===w.value.type?x.value.colors.arrowBackground:'transparent',color:e}}),F=(0,i.EW)(()=>{const{type:e}=E.value,{indicatorColor:s}=x.value.colors;if('none'===e)return null;const r=t.isLoading||!1;return'dots'===e?(0,i.h)('div',{class:'flex gap-1 items-center'},[0,1,2].map(e=>(0,i.h)('span',{key:e,class:'w-1.5 h-1.5 rounded-full transition-opacity duration-500',style:{backgroundColor:s,opacity:r?2===e?1:.4:.6,animation:r&&2===e?'pulse 1s ease-in-out infinite':void 0}}))):'diamonds'===e?(0,i.h)('div',{class:'flex gap-1 items-center'},[0,1,2].map(e=>(0,i.h)('span',{key:e,class:'transition-all duration-300',style:{width:'8px',height:'8px',backgroundColor:s,opacity:r?2===e?1:.3+.15*e:.5,transform:`rotate(45deg) scale(${r&&2===e?1.1:.9})`,animation:r&&2===e?'diamondPulse 1.2s ease-in-out infinite':void 0,display:'inline-block'}}))):'pulse'===e?(0,i.h)('div',{class:'relative w-3 h-3'},[(0,i.h)('span',{class:'absolute inset-0 rounded-full',style:{backgroundColor:s,opacity:.4,animation:r?'ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite':void 0}}),(0,i.h)('span',{class:'absolute inset-0 rounded-full',style:{backgroundColor:s,animation:r?'pulse 2s ease-in-out infinite':void 0}})]):'arrow'===e?(0,i.h)('svg',{class:'w-4 h-4 transition-transform duration-300',style:{color:s,animation:r?'arrowBounce 0.8s ease-in-out infinite':void 0},fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.h)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})]):null});function O(){t.isFirstDialogue||t.onPrev()}function N(){t.isLastDialogue||t.onNext()}function U(e,t){const s=function(e){return e?e.replace(/\*([^*]+)\*/g,(e,t)=>'through'===t.trim()?e:` <span style="color: #9ca3af; font-style: italic;">${t}</span> `):''}(e);return t?s+'<span class="animate-pulse" style="display: inline; margin-left: 2px;">|</span>':s}function G(){g&&(clearInterval(g),g=null)}function V(){if(G(),t.isLoading)return s.value=t.text,void(a.value=!0);if(!t.text)return s.value='',void(a.value=!1);s.value='',a.value=!0;let e=0;g=setInterval(()=>{e<t.text.length?(s.value=t.text.slice(0,e+1),e++):(a.value=!1,G())},50)}function H(){A.value&&m.value?(0,i.dY)(()=>{if(!m.value)return;const e=m.value,t=e.querySelector('span');if(!t||!s.value)return void(v.value=!1);const i=e.offsetWidth-(parseInt(getComputedStyle(e).paddingLeft)||0)-(parseInt(getComputedStyle(e).paddingRight)||0);if(i<=0)return void(v.value=!1);const r=document.createElement('div');r.style.visibility='hidden',r.style.position='absolute',r.style.top='-9999px',r.style.left='-9999px',r.style.width=`${i}px`,r.style.fontSize=`${x.value.fontSize}px`,r.style.fontStyle='italic',r.style.fontFamily=getComputedStyle(e).fontFamily,r.style.lineHeight=getComputedStyle(e).lineHeight,r.style.textAlign='center',r.style.whiteSpace='normal',r.style.wordWrap='break-word',r.style.overflowWrap='break-word';const n=(t.innerHTML||'').replace(/<span[^>]*class="[^"]*animate-pulse[^"]*"[^>]*>.*?<\/span>/gi,'');r.innerHTML=n||'M',document.body.appendChild(r);const o=document.createElement('div');o.style.visibility='hidden',o.style.position='absolute',o.style.top='-9999px',o.style.left='-9999px',o.style.width=`${i}px`,o.style.fontSize=`${x.value.fontSize}px`,o.style.fontStyle='italic',o.style.fontFamily=getComputedStyle(e).fontFamily,o.style.lineHeight=getComputedStyle(e).lineHeight,o.style.textAlign='center',o.style.whiteSpace='nowrap',o.textContent='M',document.body.appendChild(o);const a=o.offsetHeight,l=r.offsetHeight;document.body.removeChild(r),document.body.removeChild(o),v.value=l>1.3*a}):v.value=!1}(0,i.wB)(()=>[t.text,t.dialogKey,t.isLoading],()=>{V()},{immediate:!0}),(0,i.wB)(()=>s.value,()=>{A.value&&setTimeout(()=>{H()},10)}),(0,i.sV)(()=>{V(),A.value&&H()}),(0,i.hi)(()=>{G()});const W=(0,o.KR)(!1),X=(0,o.KR)('');function j(){void 0!==t.messageId&&(X.value=t.text,W.value=!0)}function Y(){void 0!==t.messageId&&t.onDelete&&confirm('')&&t.onDelete(t.messageId)}function q(){void 0!==t.messageId&&t.onEdit&&X.value.trim()&&(t.onEdit(t.messageId,X.value.trim()),W.value=!1)}function Q(){W.value=!1,X.value=''}return(o,l)=>((0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)('div',ge,[(0,i.Lk)('div',me,[(0,i.Q3)('  '),M.value?(0,i.Q3)('v-if',!0):((0,i.uX)(),(0,i.CE)('button',{key:0,disabled:e.isFirstDialogue,class:(0,r.C4)(['flex flex-shrink-0 items-center justify-center transition-all duration-200',e.isFirstDialogue?'cursor-not-allowed opacity-40':'hover:scale-105']),style:(0,r.Tr)(k.value),'aria-label':'',onClick:(0,n.D$)(O,['stop'])},[...l[2]||(l[2]=[(0,i.Lk)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 19l-7-7 7-7'})],-1)])],14,_e)),(0,i.Q3)('  '),(0,i.Lk)('div',{class:(0,r.C4)(['flex-1 relative p-4 md:p-5 min-h-[120px]',[A.value?'flex flex-col':'']]),style:(0,r.Tr)(L.value)},[(0,i.Q3)('  '),M.value?((0,i.uX)(),(0,i.CE)('div',ve,[(0,i.Lk)('button',{disabled:e.isFirstDialogue,class:(0,r.C4)(['flex items-center justify-center transition-all duration-200',e.isFirstDialogue?'cursor-not-allowed opacity-40':'hover:bg-opacity-100']),style:(0,r.Tr)(D.value),'aria-label':'',onClick:(0,n.D$)(O,['stop'])},[...l[3]||(l[3]=[(0,i.Lk)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 19l-7-7 7-7'})],-1)])],14,ye)])):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),A.value?(0,i.Q3)('v-if',!0):((0,i.uX)(),(0,i.CE)('div',{key:1,class:'h-6 mb-2 flex items-start',style:(0,r.Tr)({paddingLeft:M.value?'48px':0,paddingRight:M.value?'48px':0})},[(0,i.Lk)('div',{class:'px-3 py-1 text-sm font-medium',style:(0,r.Tr)({backgroundColor:x.value.colors.nameBackground,color:x.value.colors.nameText,borderRadius:T.value.borderRadius,borderBottom:'underline'===T.value.style?`2px solid ${x.value.colors.nameText}`:void 0,boxShadow:'floating'===T.value.style?'0 2px 8px rgba(0,0,0,0.1)':void 0})},(0,r.v_)(e.character),5),(0,i.Q3)(' /user '),t.isEditable&&void 0!==t.messageId?((0,i.uX)(),(0,i.CE)('div',xe,[(0,i.Lk)('button',{onClick:(0,n.D$)(j,['stop']),class:'p-1 rounded transition-colors hover:bg-black/10','aria-label':'',title:''},[...l[4]||(l[4]=[(0,i.Lk)('svg',{class:'h-4 w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z'})],-1)])]),(0,i.Lk)('button',{onClick:(0,n.D$)(Y,['stop']),class:'p-1 rounded transition-colors hover:bg-red-500/20','aria-label':'',title:''},[...l[5]||(l[5]=[(0,i.Lk)('svg',{class:'h-4 w-4 text-red-500',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16'})],-1)])])])):(0,i.Q3)('v-if',!0)],4)),(0,i.Q3)('  '),(0,i.Lk)('div',{ref_key:'textContentRef',ref:m,class:(0,r.C4)(['leading-relaxed',A.value?`italic text-center flex-1 flex flex-col ${y.value}`:'']),style:(0,r.Tr)({color:A.value?x.value.colors.narrationText:x.value.colors.dialogText,fontSize:`${x.value.fontSize}px`,paddingLeft:M.value?'48px':0,paddingRight:M.value?'48px':0})},[(0,i.Lk)('span',{innerHTML:U(s.value,a.value)},null,8,be)],6),(0,i.Q3)('  '),(0,i.Lk)('div',Te,[((0,i.uX)(),(0,i.Wv)((0,i.$y)(F.value)))]),(0,i.Q3)('  '),M.value?((0,i.uX)(),(0,i.CE)('div',we,[(0,i.Lk)('button',{disabled:e.isLastDialogue,class:(0,r.C4)(['flex items-center justify-center transition-all duration-200',e.isLastDialogue?'cursor-not-allowed opacity-40':'hover:bg-opacity-100']),style:(0,r.Tr)(B.value),'aria-label':'',onClick:(0,n.D$)(N,['stop'])},[...l[6]||(l[6]=[(0,i.Lk)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})],-1)])],14,Ee)])):(0,i.Q3)('v-if',!0)],6),(0,i.Q3)('  '),M.value?(0,i.Q3)('v-if',!0):((0,i.uX)(),(0,i.CE)('button',{key:1,disabled:e.isLastDialogue,class:(0,r.C4)(['flex flex-shrink-0 items-center justify-center transition-all duration-200',e.isLastDialogue?'cursor-not-allowed opacity-40':'hover:scale-105']),style:(0,r.Tr)(k.value),'aria-label':'',onClick:(0,n.D$)(N,['stop'])},[...l[7]||(l[7]=[(0,i.Lk)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})],-1)])],14,Ce))])]),(0,i.Q3)('  '),W.value?((0,i.uX)(),(0,i.CE)('div',{key:0,class:'fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm',onClick:Q},[(0,i.Lk)('div',{class:'bg-card rounded-lg p-6 shadow-xl max-w-md w-full mx-4',onClick:l[1]||(l[1]=(0,n.D$)(()=>{},['stop'])),style:(0,r.Tr)({backgroundColor:x.value.colors.boxBackground,borderColor:x.value.colors.boxBorder,borderWidth:'1px',borderStyle:'solid'})},[(0,i.Lk)('h3',{class:'text-lg font-semibold mb-4',style:(0,r.Tr)({color:x.value.colors.dialogText})},'',4),(0,i.bo)((0,i.Lk)('textarea',{'onUpdate:modelValue':l[0]||(l[0]=e=>X.value=e),class:'w-full p-3 rounded border resize-none focus:outline-none focus:ring-2',style:(0,r.Tr)({backgroundColor:x.value.colors.boxBackground,borderColor:x.value.colors.boxBorder,color:x.value.colors.dialogText}),rows:'4',placeholder:'...'},null,4),[[n.Jo,X.value]]),(0,i.Lk)('div',Se,[(0,i.Lk)('button',{onClick:Q,class:'px-4 py-2 rounded transition-colors',style:(0,r.Tr)({backgroundColor:x.value.colors.boxBorder+'40',color:x.value.colors.dialogText})},'  ',4),(0,i.Lk)('button',{onClick:q,class:'px-4 py-2 rounded transition-colors',style:(0,r.Tr)({backgroundColor:x.value.colors.nameBackground,color:x.value.colors.nameText})},'  ',4)])],4)])):(0,i.Q3)('v-if',!0)],64))}}),Me=(0,B.A)(Ae,[['__scopeId','data-v-7ebdc071']]),Pe={class:'note-lines'},Ie={class:'note-content'},Re={class:'note-text'},Le=(0,i.pM)({__name:'NoteCard',props:{content:{},noteUnitId:{},initialPosition:{}},emits:['close','positionChange'],setup(e,{emit:t}){const s=e,a=t,l=(0,o.KR)(null),h=(0,o.KR)(!1),u=(0,o.KR)({x:0,y:0}),c=(0,o.KR)({x:0,y:0});(0,i.sV)(()=>{if(s.noteUnitId){const e=`note_position_${s.noteUnitId}`,t=localStorage.getItem(e);if(t)try{c.value=JSON.parse(t)}catch(e){console.warn('Failed to parse saved note position:',e)}else s.initialPosition&&(c.value=s.initialPosition)}else s.initialPosition&&(c.value=s.initialPosition)}),(0,i.wB)(()=>s.initialPosition,e=>{e&&!h.value&&(c.value=e)});const d=(0,i.EW)(()=>({transform:`translate(${c.value.x}px, ${c.value.y}px)`,cursor:h.value?'grabbing':'grab'}));function p(e){e.target.closest('.note-close-btn')||(g(e.clientX,e.clientY),e.preventDefault())}function f(e){if(!e.target.closest('.note-close-btn')&&e.touches.length>0){const t=e.touches[0];g(t.clientX,t.clientY),e.preventDefault()}}function g(e,t){h.value=!0;const s=l.value?.getBoundingClientRect();s&&(u.value={x:e-s.left,y:t-s.top}),document.addEventListener('mousemove',m),document.addEventListener('mouseup',x),document.addEventListener('touchmove',v,{passive:!1}),document.addEventListener('touchend',b)}function m(e){h.value&&l.value&&y(e.clientX,e.clientY)}function v(e){if(h.value&&l.value&&e.touches.length>0){const t=e.touches[0];y(t.clientX,t.clientY),e.preventDefault()}}function y(e,t){if(!l.value)return;const s=(l.value.closest('.relative')||document.body).getBoundingClientRect(),i=l.value.getBoundingClientRect(),r=e-s.left-u.value.x,n=t-s.top-u.value.y,o=Math.max(0,s.width-i.width),a=Math.max(0,s.height-i.height);c.value={x:Math.max(.5*-i.width,Math.min(r,o+.5*i.width)),y:Math.max(.5*-i.height,Math.min(n,a+.5*i.height))}}function x(){T()}function b(){T()}function T(){h.value=!1,document.removeEventListener('mousemove',m),document.removeEventListener('mouseup',x),document.removeEventListener('touchmove',v),document.removeEventListener('touchend',b),s.noteUnitId&&a('positionChange',s.noteUnitId,c.value)}function w(){a('close')}return(0,i.hi)(()=>{document.removeEventListener('mousemove',m),document.removeEventListener('mouseup',x),document.removeEventListener('touchmove',v),document.removeEventListener('touchend',b)}),(t,s)=>e.content?((0,i.uX)(),(0,i.CE)('div',{key:0,ref_key:'noteCardRef',ref:l,class:'note-card',style:(0,r.Tr)(d.value),onMousedown:p,onTouchstart:f},[(0,i.Q3)('  '),(0,i.Lk)('button',{class:'note-close-btn','aria-label':'',onClick:(0,n.D$)(w,['stop']),onTouchend:(0,n.D$)(w,['stop'])},[...s[0]||(s[0]=[(0,i.Lk)('svg',{width:'12',height:'12',viewBox:'0 0 12 12',fill:'none',xmlns:'http://www.w3.org/2000/svg'},[(0,i.Lk)('path',{d:'M9 3L3 9M3 3L9 9',stroke:'currentColor','stroke-width':'1.5','stroke-linecap':'round','stroke-linejoin':'round'})],-1)])],32),(0,i.Q3)('  '),s[1]||(s[1]=(0,i.Lk)('div',{class:'note-border'},null,-1)),(0,i.Q3)('  -  '),s[2]||(s[2]=(0,i.Lk)('div',{class:'note-dots'},[(0,i.Lk)('div',{class:'note-dot'}),(0,i.Lk)('div',{class:'note-dot'}),(0,i.Lk)('div',{class:'note-dot'})],-1)),(0,i.Q3)('  -  '),(0,i.Lk)('div',Pe,[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)(8,e=>(0,i.Lk)('div',{key:e,class:'note-line'})),64))]),(0,i.Q3)('  '),s[3]||(s[3]=(0,i.Lk)('div',{class:'note-binding'},null,-1)),(0,i.Q3)('  '),(0,i.Lk)('div',Ie,[(0,i.Lk)('div',Re,(0,r.v_)(e.content),1)]),(0,i.Q3)('  -  '),s[4]||(s[4]=(0,i.Fv)('<div class="note-flower" data-v-68f5f8e2><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-68f5f8e2><circle cx="10" cy="10" r="2" fill="currentColor" data-v-68f5f8e2></circle><circle cx="10" cy="5" r="2.5" fill="currentColor" data-v-68f5f8e2></circle><circle cx="15" cy="10" r="2.5" fill="currentColor" data-v-68f5f8e2></circle><circle cx="10" cy="15" r="2.5" fill="currentColor" data-v-68f5f8e2></circle><circle cx="5" cy="10" r="2.5" fill="currentColor" data-v-68f5f8e2></circle></svg></div>',1))],36)):(0,i.Q3)('v-if',!0)}}),ke=(0,B.A)(Le,[['__scopeId','data-v-68f5f8e2']]),De={class:'title-bar'},Be={class:'title-group'},Fe={class:'menu-bar'},Oe={key:0,class:'menu-item-badge'},Ne={class:'panel-body relative flex'},Ue={key:0,class:'contacts-sidebar'},Ge={class:'contacts-list'},Ve=['onClick'],He={class:'contact-avatar'},We={key:0,class:'avatar-unread-dot'},$e={class:'contact-info'},Xe={class:'contact-name'},je={key:0,class:'contact-badge'},ze={class:'display-wrapper'},Ye={key:0,class:'refresh-indicator'},qe={class:'chat-log'},Qe={key:0,class:'text-muted-foreground my-4 flex items-center gap-3 px-4 text-xs select-none'},Ke={class:'whitespace-nowrap'},Ze=['data-owner','innerHTML'],Je={key:0,class:'typing-cursor'},et={class:'cmd-bar'},tt={class:'cmd-input-wrapper'},st=['disabled','placeholder'],it=['disabled'],rt=['disabled'],nt={class:'settings-header'},ot={class:'settings-body'},at={class:'settings-item'},lt=(0,i.pM)({__name:'PhonePanel',props:{show:{type:Boolean},messageId:{},statusBlock:{},onClose:{type:Function}},setup(e,{expose:t}){const s=e,l=a(),h=(0,o.KR)(null),u=(0,o.KR)(!1),c=(0,o.KR)(!1),d=(0,o.KR)(!1),p=(0,o.KR)(''),f=(0,o.KR)(''),g=(0,o.KR)([]),m=(0,o.KR)(new Map),v=(0,o.KR)(new Map),y=(0,o.KR)([]),x=(0,o.KR)(new Set),b=(0,o.KR)('  Phone'),T=(0,o.KR)([]),w=(0,o.KR)(0),E=(0,o.KR)(!1),C=(0,o.KR)(!1),S=(0,o.KR)(null),A=(0,o.KR)(''),M=(0,o.KR)(!1),P=(0,o.KR)(!1),I=(0,o.KR)(new Set),R=(0,o.KR)(null);function L(){p.value=f.value,localStorage.setItem('phone-panel-bg-url',f.value),c.value=!1,console.info('[PhonePanel] :',f.value)}function k(){f.value='',p.value='';try{localStorage.removeItem('phone-panel-bg-url')}catch(e){console.warn('URL:',e)}c.value=!1}function D(){S.value&&(clearTimeout(S.value),S.value=null),C.value=!1,s.onClose()}function B(e){const t=e.match(/<StatusBlock>([\s\S]*?)<\/StatusBlock>/i);if(!t)return null;const s=t[1].match(/<skit>\s*([\s\S]*?)<\/skit>/i);if(!s)return null;const i=s[1].trim();if(!i)return null;const r=i.match(/^([^:\n]+?)[:]\s*(.+)$/s);if(r){return{title:r[1].trim(),content:r[2].trim()}}return{title:'',content:i}}function F(e){const t=/<phone>([\s\S]*?)<\/phone>/gi.exec(e);if(!t)return null;const s=t[1].trim().match(/(?:)?([^:]+)(?:)?[:](.*?)(?:\|(.+))?$/);if(!s)return null;const i=s[1].trim(),r=s[2].trim(),n=s[3]?.trim();let o='';try{const e=localStorage.getItem('galgame_user_display_name');e&&(o=JSON.parse(e))}catch(e){console.warn('[PhonePanel]  localStorage  userDisplayName :',e)}const a=function(e){if(!e)return!1;const t=e.trim().toLowerCase();if('<user>'===t||'{{user}}'===t||'user'===t||''===t||''===t||''===t)return!0;if(o&&o.trim()){return t===o.trim().toLowerCase()}return!1}(i);return{contact:a?'':i,messages:[{speaker:i,content:r,timestamp:n,isUser:a,hideLabel:!1}]}}function O(){if(!A.value.trim()||!h.value)return;const e=A.value.trim(),t=function(){try{if(void 0!==s.messageId){const e=getVariables({type:'message',message_id:s.messageId}),t=e?.stat_data;if(t?.){const e=t..match(/(\d{2})\/(\d{1,2})\/(\d{1,2})\s*-\s*.\s*-\s*.*?\s*-\s*(\d{1,2}):(\d{2})/);if(e){const t='20'+e[1],s=e[2].padStart(2,'0'),i=e[3].padStart(2,'0'),r=e[4].padStart(2,'0');return`${t}-${s}-${i} ${r}:${e[5]}`}}}}catch(e){console.warn('[PhonePanel] :',e)}try{if('undefined'!=typeof Mvu&&Mvu.get){const e=Mvu.get('');if(e){const t=e.match(/(\d{2})\/(\d{1,2})\/(\d{1,2})\s*-\s*.\s*-\s*.*?\s*-\s*(\d{1,2}):(\d{2})/);if(t){const e='20'+t[1],s=t[2].padStart(2,'0'),i=t[3].padStart(2,'0'),r=t[4].padStart(2,'0');return`${e}-${s}-${i} ${r}:${t[5]}`}}}}catch(e){console.warn('[PhonePanel]  MVU :',e)}const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,'0')}-${String(e.getDate()).padStart(2,'0')} ${String(e.getHours()).padStart(2,'0')}:${String(e.getMinutes()).padStart(2,'0')}`}(),r={speaker:'',content:e,isUser:!0,hideLabel:!1,timestamp:t};l.addPhoneText(e,h.value,t);const n=m.value.get(h.value)||[];n.push(r),m.value.set(h.value,n);const o=v.value.get(h.value)||[];o.push(r),v.value.set(h.value,o),g.value.push(r),A.value='',(0,i.dY)(()=>{G()}),console.info('[PhonePanel] :',r)}async function N(){if(!h.value)return;A.value.trim()&&O();const e=m.value.get(h.value)||[];if(0!==e.length)try{const t=e.map(e=>`<phone>${h.value}${e.content}${e.timestamp?`|${e.timestamp}`:''}</phone>`).join('\n');console.info('[PhonePanel] '),console.info('[PhonePanel] :',e.length),console.info('[PhonePanel] :',e.map(e=>e.content)),console.info('[PhonePanel] phone:',t),await updateVariablesWith(e=>(e['']=!0,e),{type:'message',message_id:s.messageId||getLastMessageId()}),await triggerSlash('/send '+t),await triggerSlash('/trigger'),m.value.set(h.value,[]),l.clearByContact(h.value),console.info('[PhonePanel] AI'),function(){const e=setInterval(async()=>{try{const t='function'==typeof getLastMessageId?getLastMessageId():-1;if(t<0)return;const s=getChatMessages(t);if(0===s.length)return;const i=s[0].message||'',r=/<phone>([^:]+)[:](.*?)(?:\|(.+?))?<\/phone>/gi;let n;for(;null!==(n=r.exec(i));){const t=n[1].trim(),s=n[2].trim(),i=n[3]?.trim();return await W(t,[{speaker:t,content:s,timestamp:i,isUser:!1,hideLabel:!1}]),await triggerSlash('/del'),console.info('[PhonePanel] AI'),void clearInterval(e)}}catch(e){console.warn('[PhonePanel] AI:',e)}},1e3);setTimeout(()=>{clearInterval(e)},3e4)}()}catch(e){console.error('[PhonePanel] :',e),'undefined'!=typeof toastr&&toastr.error('')}else console.warn('[PhonePanel] ')}async function U(){try{await updateVariablesWith(e=>(e['']=!1,e),{type:'message',message_id:s.messageId||getLastMessageId()}),console.info('[PhonePanel] '),'undefined'!=typeof toastr&&toastr.success('')}catch(e){console.error('[PhonePanel] :',e),'undefined'!=typeof toastr&&toastr.error('')}}function G(){R.value&&(R.value.scrollTop=R.value.scrollHeight)}function V(){R.value&&h.value&&(0!==R.value.scrollTop||P.value||I.value.has(h.value)||(P.value=!0,H(h.value)))}async function H(e){try{console.info('[PhonePanel] :',e);const t=`[${e}]`,s=[];try{const c=getCharWorldbookNames('current');c.primary&&s.push(c.primary),s.push(...c.additional)}catch(d){console.warn('[PhonePanel] :',d)}if(0===s.length)return console.warn('[PhonePanel] '),void(P.value=!1);let r='';for(const p of s)try{const f=(await getWorldbook(p)).find(e=>e.enabled&&e.name===t);if(f){r=f.content,console.info('[PhonePanel] :',t,':',r.length);break}}catch(m){console.warn('[PhonePanel] :',p,m)}if(!r)return console.info('[PhonePanel] :',t),I.value.add(e),void(P.value=!1);const n=[],o=r.split('\n').filter(e=>e.trim());let a='';try{const y=localStorage.getItem('galgame_user_display_name');y&&(a=JSON.parse(y))}catch(x){console.warn('[PhonePanel]  localStorage  userDisplayName :',x)}function l(e){if(!e)return!1;const t=e.trim().toLowerCase();if('<user>'===t||'{{user}}'===t||'user'===t||''===t||''===t||''===t)return!0;if(a&&a.trim()){return t===a.trim().toLowerCase()}return!1}for(const b of o){if(b.match(/^\[.+\]$/))continue;const T=b.match(/^([^:]+)[:](.*?)(?:\|(.+))?$/);if(T){const w=T[1].trim(),E=T[2].trim(),C=T[3]?.trim(),S=l(w);n.push({speaker:w,content:E,timestamp:C,isUser:S,hideLabel:!1})}}for(let A=1;A<n.length;A++)n[A].speaker===n[A-1].speaker&&(n[A].hideLabel=!0);const u=v.value.get(e)||[];if(v.value.set(e,[...n,...u]),h.value===e){const M=R.value?.scrollHeight||0,L={speaker:'',content:`[${e}]`,isUser:!1,hideLabel:!0},k=g.value.filter(e=>!e.content.match(/^\[.+\]$/));g.value=[L,...n,...k],(0,i.dY)(()=>{if(R.value){const e=R.value.scrollHeight;R.value.scrollTop=e-M}})}I.value.add(e),console.info('[PhonePanel] :',n.length)}catch(D){console.error('[PhonePanel] :',D)}finally{P.value=!1}}async function W(e,t){try{const s=`[${e}]`,i=[];try{const e=getCharWorldbookNames('current');e.primary&&i.push(e.primary),i.push(...e.additional)}catch(e){console.warn('[PhonePanel] :',e)}if(0===i.length)return void console.warn('[PhonePanel] ');const r=i[0],n=(await getWorldbook(r)).find(e=>e.name===s),o=t.map(e=>`${e.speaker}${e.content}${e.timestamp?`|${e.timestamp}`:''}`).join('\n');if(n)n.content.includes(`[${e}]`)||(n.content=`[${e}]\n`+n.content),n.content+='\n'+o,await updateWorldbookWith(r,e=>{const t=e.findIndex(e=>e.uid===n.uid);return-1!==t&&(e[t]=n),e}),console.info('[PhonePanel] :',s);else{const t={name:s,content:`[${e}]\n`+o,enabled:!0,strategy:{type:'selective',keys:[e],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'after_character_definition',role:'system',depth:4,order:100},probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}};await createWorldbookEntries(r,[t]),console.info('[PhonePanel] :',s)}}catch(e){console.error('[PhonePanel] :',e)}}function X(){0!==T.value.length&&(w.value>=T.value.length?console.info('[PhonePanel] '):(C.value=!0,q(!0)))}function j(){0!==T.value.length&&(w.value>=T.value.length?console.info('[PhonePanel] '):(C.value=!1,S.value&&(clearTimeout(S.value),S.value=null),q(!1)))}function Y(){if(C.value=!1,S.value&&(clearTimeout(S.value),S.value=null),w.value=0,h.value){const e=v.value.get(h.value)||[],t={speaker:'',content:`[${h.value}]`,isUser:!1,hideLabel:!0};g.value=[t,...e]}else g.value=[];console.info('[PhonePanel] ')}function q(e){if(w.value>=T.value.length)return void(C.value=!1);const t=T.value[w.value];w.value++,E.value=!0;const s=t.content.length>50?30:50;g.value.push({...t,content:''});const i=g.value.length-1;let r=0;const n=setInterval(()=>{r<t.content.length?(g.value[i].content+=t.content[r],r++,G()):(clearInterval(n),E.value=!1,e&&C.value&&(S.value=window.setTimeout(()=>{q(!0)},800)))},s)}async function Q(){try{const e=await async function(){return new Promise((e,t)=>{if(void 0!==window.html2canvas)return void e(window.html2canvas);const s=document.createElement('script');s.src='https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js',s.onload=()=>{void 0!==window.html2canvas?e(window.html2canvas):t(new Error('html2canvas '))},s.onerror=()=>t(new Error('html2canvas ')),document.head.appendChild(s)})}();E.value=!1,await(0,i.dY)();const t=R.value?.parentElement;if(!t)return void console.warn('[PhonePanel] ');const s=await e(t,{backgroundColor:'#fdfdfb',scale:2,useCORS:!0,allowTaint:!1,logging:!1,onclone:(e,t)=>{const s=e.createElement('style');s.textContent='\n          /*  oklch  rgb html2canvas  */\n          :root {\n            --background: rgb(247, 250, 252) !important;\n            --foreground: rgb(51, 65, 85) !important;\n            --card: rgb(253, 253, 253) !important;\n            --card-foreground: rgb(51, 65, 85) !important;\n            --popover: rgb(253, 253, 253) !important;\n            --popover-foreground: rgb(51, 65, 85) !important;\n            --primary: rgb(76, 175, 80) !important;\n            --primary-foreground: rgb(253, 253, 253) !important;\n            --secondary: rgb(235, 245, 240) !important;\n            --secondary-foreground: rgb(89, 110, 100) !important;\n            --muted: rgb(240, 245, 243) !important;\n            --muted-foreground: rgb(128, 140, 135) !important;\n            --accent: rgb(200, 230, 200) !important;\n            --accent-foreground: rgb(51, 65, 85) !important;\n            --destructive: rgb(220, 80, 80) !important;\n            --destructive-foreground: rgb(220, 80, 80) !important;\n            --border: rgb(217, 230, 225) !important;\n            --input: rgb(230, 240, 235) !important;\n            --ring: rgb(76, 175, 80) !important;\n            --color-background: rgb(247, 250, 252) !important;\n            --color-foreground: rgb(51, 65, 85) !important;\n            --color-card: rgb(253, 253, 253) !important;\n            --color-card-foreground: rgb(51, 65, 85) !important;\n            --color-popover: rgb(253, 253, 253) !important;\n            --color-popover-foreground: rgb(51, 65, 85) !important;\n            --color-primary: rgb(76, 175, 80) !important;\n            --color-primary-foreground: rgb(253, 253, 253) !important;\n            --color-secondary: rgb(235, 245, 240) !important;\n            --color-secondary-foreground: rgb(89, 110, 100) !important;\n            --color-muted: rgb(240, 245, 243) !important;\n            --color-muted-foreground: rgb(128, 140, 135) !important;\n            --color-accent: rgb(200, 230, 200) !important;\n            --color-accent-foreground: rgb(51, 65, 85) !important;\n            --color-destructive: rgb(220, 80, 80) !important;\n            --color-destructive-foreground: rgb(220, 80, 80) !important;\n            --color-border: rgb(217, 230, 225) !important;\n            --color-input: rgb(230, 240, 235) !important;\n            --color-ring: rgb(76, 175, 80) !important;\n          }\n          /*  */\n          .scroll-container {\n            height: auto !important;\n            max-height: none !important;\n            overflow: visible !important;\n            position: relative !important;\n          }\n          .chat-log {\n            height: auto !important;\n            max-height: none !important;\n          }\n          .display-wrapper {\n            height: auto !important;\n            min-height: auto !important;\n            overflow: visible !important;\n          }\n        ',e.head.appendChild(s)}}),r=document.createElement('a'),n=(new Date).toISOString().replace(/[:.]/g,'-').slice(0,-5);r.download=`_${n}.png`,r.href=s.toDataURL('image/png'),r.click(),console.info('[PhonePanel] ')}catch(e){console.error('[PhonePanel] :',e),'undefined'!=typeof toastr&&toastr.error('')}}async function K(){b.value='  Phone',T.value=[],y.value=[],w.value=0,Z();try{let e=null;if(void 0!==s.messageId){const t=getChatMessages(s.messageId);if(t.length>0){e=B(t[0].message||'')}}if(!e)try{const t=void 0!==s.messageId?s.messageId:'function'==typeof getLastMessageId?getLastMessageId():null;if(null!==t)for(let s=t;s>=Math.max(0,t-10);s--){const t=getChatMessages(s);if(t.length>0){if(e=B(t[0].message||''),e)break}}}catch(e){console.warn(':',e)}if(!e&&s.statusBlock?.){const t=s.statusBlock.,i=t.match(/^([^:\n]+?)[:]\s*(.+)$/s);e=i?{title:i[1].trim(),content:i[2].trim()}:{title:'',content:t}}e&&e.content?(b.value=e.title||'  Phone',T.value=function(e){const t=[],s=/([^:]+)[:](.*?)/g;let i,r='';try{const e=localStorage.getItem('galgame_user_display_name');e&&(r=JSON.parse(e))}catch(e){console.warn('[PhonePanel]  localStorage  userDisplayName :',e)}function n(e){if(!e)return!1;const t=e.trim().toLowerCase();return'<user>'===t||'{{user}}'===t||'user'===t||''===t||''===t||''===t||!(!r||!r.trim())&&t===r.trim().toLowerCase()}for(;null!==(i=s.exec(e));){const e=i[1]?.trim()||'',s=i[2]?.trim()||'',r=e.split('')[0].split('(')[0].trim(),o=n(r)||n(e);t.push({speaker:e,content:s,isUser:o,hideLabel:!1}),o||y.value.includes(r)||(y.value.push(r),console.info('[PhonePanel] :',r))}for(let e=1;e<t.length;e++)t[e].speaker===t[e-1].speaker&&(t[e].hideLabel=!0);return t}(e.content),console.info('[PhonePanel] :',T.value.length),x.value.size>0&&(u.value=!0)):b.value='  Phone'}catch(e){console.error('[PhonePanel] :',e)}}function Z(){S.value&&(clearTimeout(S.value),S.value=null),C.value=!1,E.value=!1}return(0,i.sV)(()=>{const e=localStorage.getItem('phone-panel-bg-url');e&&(p.value=e,f.value=e);const t=()=>{d.value=!!document.fullscreenElement};document.addEventListener('fullscreenchange',t);const s=setInterval(()=>{!async function(){try{const e='function'==typeof getLastMessageId?getLastMessageId():-1;if(e<0)return;const t=[];try{const s=Math.max(0,e-4);for(let i=e;i>=s;i--){const e=getChatMessages(i);e.length>0&&t.unshift(...e)}}catch(e){return void console.warn('[PhonePanel] :',e)}const s=t.slice(-5);for(const e of s){const t=/<phone>([\s\S]*?)<\/phone>/gi;let s;for(;null!==(s=t.exec(e.message||''));){const e=F(s[0]);if(e&&e.contact&&e.contact!==h.value){x.value.add(e.contact),y.value.includes(e.contact)||y.value.push(e.contact);const t=v.value.get(e.contact)||[];t.push(...e.messages),v.value.set(e.contact,t),W(e.contact,e.messages)}}}}catch(e){console.error('[PhonePanel] :',e)}}()},2e3);(0,i.hi)(()=>{document.removeEventListener('fullscreenchange',t),clearInterval(s),S.value&&clearTimeout(S.value)})}),(0,i.wB)(()=>[s.show,s.messageId,s.statusBlock],async()=>{s.show?await K():Z()},{immediate:!0}),(0,i.wB)(()=>s.show,e=>{e||(w.value=0,C.value=!1,E.value=!1,S.value&&(clearTimeout(S.value),S.value=null))}),t({getPendingMessages:function(){const e=[];for(const[t,s]of m.value.entries())if(s.length>0){const i=s.map(e=>`${e.content}${e.timestamp?`|${e.timestamp}`:''}`).join('\n');e.push(`<phone>\n${t}${i}\n</phone>`)}return m.value.clear(),e.join('\n')}}),(t,s)=>e.show?((0,i.uX)(),(0,i.CE)('div',{key:0,class:'fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm',onClick:(0,n.D$)(D,['self'])},[(0,i.Q3)('  '),(0,i.Lk)('div',{class:(0,r.C4)(['theater-window relative max-h-[85vh] w-[90%] max-w-md overflow-hidden rounded-xl shadow-2xl',{'theater-window-fullscreen':d.value}])},[(0,i.Q3)('  -  '),(0,i.Lk)('div',De,[(0,i.Lk)('div',Be,[s[7]||(s[7]=(0,i.Lk)('div',{class:'icon-charm'},null,-1)),(0,i.Lk)('span',null,(0,r.v_)(h.value?`${h.value}`:b.value),1)]),(0,i.Lk)('div',{class:'win-controls'},[(0,i.Lk)('button',{class:'win-btn btn-close','aria-label':'',onClick:D},[...s[8]||(s[8]=[(0,i.Lk)('svg',{t:'1766144599366',class:'icon',viewBox:'0 0 1024 1024',version:'1.1',xmlns:'http://www.w3.org/2000/svg','p-id':'4447',width:'12',height:'12'},[(0,i.Lk)('path',{d:'M886.784 746.496q29.696 30.72 43.52 56.32t-4.608 58.368q-4.096 6.144-11.264 14.848t-14.848 16.896-15.36 14.848-12.8 9.728q-25.6 15.36-60.416 8.192t-62.464-34.816l-43.008-43.008-57.344-57.344-67.584-67.584-73.728-73.728-131.072 131.072q-60.416 60.416-98.304 99.328-38.912 38.912-77.312 48.128t-68.096-17.408l-7.168-7.168-11.264-11.264-11.264-11.264q-6.144-6.144-7.168-8.192-11.264-14.336-13.312-29.184t2.56-29.184 13.824-27.648 20.48-24.576q9.216-8.192 32.768-30.72l55.296-57.344q33.792-32.768 75.264-73.728t86.528-86.016q-49.152-49.152-93.696-93.184t-79.872-78.848-57.856-56.832-27.648-27.136q-26.624-26.624-27.136-52.736t17.92-52.736q8.192-10.24 23.552-24.064t21.504-17.92q30.72-20.48 55.296-17.92t49.152 28.16l31.744 31.744q23.552 23.552 58.368 57.344t78.336 76.288 90.624 88.576q38.912-38.912 76.288-75.776t69.632-69.12 58.368-57.856 43.52-43.008q24.576-23.552 53.248-31.232t55.296 12.8q1.024 1.024 6.656 5.12t11.264 9.216 10.752 9.728 7.168 5.632q27.648 26.624 27.136 57.856t-27.136 57.856q-18.432 18.432-45.568 46.08t-60.416 60.416-70.144 69.632l-77.824 77.824q37.888 36.864 74.24 72.192t67.584 66.048 56.32 56.32 41.472 41.984z','p-id':'4448',fill:'currentColor'})],-1)])])])]),(0,i.Q3)('  '),(0,i.Lk)('div',Fe,[(0,i.Lk)('span',{class:'menu-item',onClick:s[0]||(s[0]=e=>u.value=!u.value)},[(0,i.eW)((0,r.v_)(u.value?'':'')+' ',1),x.value.size>0?((0,i.uX)(),(0,i.CE)('span',Oe)):(0,i.Q3)('v-if',!0)]),(0,i.Lk)('span',{class:'menu-item',onClick:Q},''),(0,i.Lk)('span',{class:'menu-item',onClick:s[1]||(s[1]=e=>c.value=!c.value)},'')]),(0,i.Q3)('  '),(0,i.Lk)('div',Ne,[(0,i.Q3)('  '),u.value?((0,i.uX)(),(0,i.CE)('div',Ue,[s[9]||(s[9]=(0,i.Lk)('div',{class:'contacts-header'},'',-1)),(0,i.Lk)('div',Ge,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(y.value,e=>((0,i.uX)(),(0,i.CE)('div',{key:e,class:(0,r.C4)(['contact-item',{active:h.value===e,'has-unread':x.value.has(e)}]),onClick:t=>async function(e){h.value=e,T.value=[],w.value=0,C.value=!1,E.value=!1,I.value.has(e)||await H(e);const t=v.value.get(e)||[],s={speaker:'',content:`[${e}]`,isUser:!1,hideLabel:!0};g.value=[s,...t],x.value.delete(e),(0,i.dY)(()=>{G()}),console.info('[PhonePanel] :',e)}(e)},[(0,i.Lk)('div',He,[(0,i.eW)((0,r.v_)(e.charAt(0))+' ',1),x.value.has(e)?((0,i.uX)(),(0,i.CE)('div',We)):(0,i.Q3)('v-if',!0)]),(0,i.Lk)('div',$e,[(0,i.Lk)('div',Xe,(0,r.v_)(e),1)]),x.value.has(e)?((0,i.uX)(),(0,i.CE)('div',je)):(0,i.Q3)('v-if',!0)],10,Ve))),128))])])):(0,i.Q3)('v-if',!0),(0,i.Q3)(' / '),(0,i.Lk)('div',{class:(0,r.C4)(['chat-area',{'w-full':!u.value,'w-2/3':u.value}])},[(0,i.Lk)('div',ze,[(0,i.Q3)('  '),(0,i.Lk)('div',{class:'bg-image',style:(0,r.Tr)({backgroundImage:p.value?`url('${p.value}')`:'url(\'https://files.catbox.moe/2td8l0.jpg\')'})},null,4),s[14]||(s[14]=(0,i.Lk)('div',{class:'watermark-xi'},'',-1)),(0,i.Lk)('div',{ref_key:'scrollContainer',ref:R,class:'scroll-container',onScroll:V},[(0,i.Q3)('  '),P.value?((0,i.uX)(),(0,i.CE)('div',Ye,[...s[10]||(s[10]=[(0,i.Lk)('div',{class:'refresh-spinner'},null,-1),(0,i.Lk)('span',null,'...',-1)])])):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),(0,i.Lk)('div',qe,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(g.value,(e,t)=>{return(0,i.uX)(),(0,i.CE)(i.FK,{key:t},[(0,i.Q3)('  '),e.content.match(/^\[.+\]$/)?((0,i.uX)(),(0,i.CE)('div',Qe,[s[11]||(s[11]=(0,i.Lk)('div',{class:'bg-border h-px flex-1'},null,-1)),(0,i.Lk)('span',Ke,(0,r.v_)(e.content.replace(/^\[|\]$/g,'')),1),s[12]||(s[12]=(0,i.Lk)('div',{class:'bg-border h-px flex-1'},null,-1))])):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.Q3)('  '),(0,i.Lk)('div',{class:(0,r.C4)(['message-container',e.isUser?'message-right':'message-left'])},[(0,i.Q3)('  '),e.hideLabel?(0,i.Q3)('v-if',!0):((0,i.uX)(),(0,i.CE)('div',{key:0,class:(0,r.C4)(['speaker-label',e.isUser?'text-right':'text-left'])},(0,r.v_)(e.speaker),3)),(0,i.Q3)('  '),(0,i.Lk)('div',{class:(0,r.C4)(['bubble',e.isUser?'bubble-right':'bubble-left']),'data-owner':e.speaker,innerHTML:(n=e.content,n.replace(/[(]([^)]+)[)]/g,'<span style="font-family: \'KaiTi\', \'\', serif; font-size: 0.9em; color: #888; margin: 0 2px;">$1</span>'))},null,10,Ze),(0,i.Q3)('  '),e.timestamp?((0,i.uX)(),(0,i.CE)('div',{key:1,class:(0,r.C4)(['timestamp',e.isUser?'text-right':'text-left'])},(0,r.v_)(e.timestamp),3)):(0,i.Q3)('v-if',!0)],2)],2112))],64);var n}),128)),(0,i.Q3)('  '),E.value?((0,i.uX)(),(0,i.CE)('div',Je,[...s[13]||(s[13]=[(0,i.Lk)('span',{class:'cursor'},null,-1)])])):(0,i.Q3)('v-if',!0)])],544)]),(0,i.Q3)('  '),(0,i.Lk)('div',et,[(0,i.Lk)('div',tt,[(0,i.bo)((0,i.Lk)('input',{'onUpdate:modelValue':s[2]||(s[2]=e=>A.value=e),type:'text',class:'cmd-input',disabled:E.value||M.value||!h.value,placeholder:h.value?'...':''},null,8,st),[[n.Jo,A.value]]),h.value?((0,i.uX)(),(0,i.CE)('button',{key:0,class:'cmd-newline-btn-inline',title:'',disabled:E.value||M.value||!A.value.trim(),onClick:O},[...s[15]||(s[15]=[(0,i.Lk)('svg',{t:'1766816834864',class:'icon',viewBox:'0 0 1024 1024',version:'1.1',xmlns:'http://www.w3.org/2000/svg','p-id':'2650',width:'16',height:'16'},[(0,i.Lk)('path',{d:'M810.666667 213.333333a42.666667 42.666667 0 0 1 42.368 37.674667L853.333333 256v274.304c0 79.274667-50.944 147.498667-120.490666 152.106667L725.333333 682.666667H273.706667l97.792 97.834666a42.666667 42.666667 0 0 1-56.32 63.872l-4.010667-3.541333-170.666667-170.666667a42.666667 42.666667 0 0 1 0-60.330666l170.666667-170.666667a42.666667 42.666667 0 0 1 63.872 56.32l-3.541333 4.010667L273.706667 597.333333H725.333333c19.584 0 39.936-24.618667 42.410667-59.861333l0.256-7.168V256a42.666667 42.666667 0 0 1 42.666667-42.666667z',fill:'currentColor','p-id':'2651'})],-1)])],8,it)):(0,i.Q3)('v-if',!0)]),(0,i.Lk)('button',{class:'cmd-send-btn',title:'AI',disabled:E.value||M.value||!h.value,onClick:N},[...s[16]||(s[16]=[(0,i.Lk)('svg',{t:'1766144631220',class:'icon',viewBox:'0 0 1024 1024',version:'1.1',xmlns:'http://www.w3.org/2000/svg','p-id':'5495',width:'16',height:'16'},[(0,i.Lk)('path',{d:'M1023.200312 43.682936L877.057399 920.640375c-1.899258 10.995705-8.096837 19.592347-18.292854 25.689965-5.29793 2.898868-11.295588 4.598204-17.693089 4.598204-4.19836 0-8.796564-0.99961-13.69465-2.898868l-236.707536-96.762202c-12.994924-5.29793-27.889106-1.499414-36.785631 9.296368l-123.251855 150.341273c-6.897306 8.796564-16.293635 13.094885-27.989066 13.094885-4.898087 0-9.096447-0.799688-12.695041-2.299102-7.197189-2.698946-12.994924-6.997267-17.393206-13.394768-4.398282-6.29754-6.697384-13.194846-6.697384-20.891839V811.083171c0-14.794221 5.098009-28.988676 14.394377-40.484186l478.912925-587.070676-602.864506 521.796174c-4.598204 3.898477-10.995705 4.998048-16.493557 2.698945L23.390863 619.358063C9.296369 614.060133 1.599375 603.664194 0.599766 587.870363c-0.799688-15.194065 5.29793-26.489652 18.292854-33.786802L968.921515 5.997657c5.797735-3.498633 11.795392-5.098009 18.292854-5.098008 7.696993 0 14.594299 2.199141 20.691918 6.397501 12.695041 8.996486 17.593128 21.291683 15.294025 36.385786z','p-id':'5496',fill:'currentColor'})],-1)])],8,rt)]),(0,i.Q3)('  '),(0,i.Lk)('div',{class:'status-bar'},[(0,i.Lk)('button',{class:'jade-btn',onClick:X},' '),(0,i.Lk)('button',{class:'jade-btn',onClick:j},' '),(0,i.Lk)('button',{class:'jade-btn jade-btn-red',onClick:Y},' '),(0,i.Lk)('button',{class:'jade-btn jade-btn-red',title:'',onClick:U},[...s[17]||(s[17]=[(0,i.Lk)('svg',{t:'1766144599366',class:'icon',viewBox:'0 0 1024 1024',version:'1.1',xmlns:'http://www.w3.org/2000/svg','p-id':'4447',width:'12',height:'12'},[(0,i.Lk)('path',{d:'M886.784 746.496q29.696 30.72 43.52 56.32t-4.608 58.368q-4.096 6.144-11.264 14.848t-14.848 16.896-15.36 14.848-12.8 9.728q-25.6 15.36-60.416 8.192t-62.464-34.816l-43.008-43.008-57.344-57.344-67.584-67.584-73.728-73.728-131.072 131.072q-60.416 60.416-98.304 99.328-38.912 38.912-77.312 48.128t-68.096-17.408l-7.168-7.168-11.264-11.264-11.264-11.264q-6.144-6.144-7.168-8.192-11.264-14.336-13.312-29.184t2.56-29.184 13.824-27.648 20.48-24.576q9.216-8.192 32.768-30.72l55.296-57.344q33.792-32.768 75.264-73.728t86.528-86.016q-49.152-49.152-93.696-93.184t-79.872-78.848-57.856-56.832-27.648-27.136q-26.624-26.624-27.136-52.736t17.92-52.736q8.192-10.24 23.552-24.064t21.504-17.92q30.72-20.48 55.296-17.92t49.152 28.16l31.744 31.744q23.552 23.552 58.368 57.344t78.336 76.288 90.624 88.576q38.912-38.912 76.288-75.776t69.632-69.12 58.368-57.856 43.52-43.008q24.576-23.552 53.248-31.232t55.296 12.8q1.024 1.024 6.656 5.12t11.264 9.216 10.752 9.728 7.168 5.632q27.648 26.624 27.136 57.856t-27.136 57.856q-18.432 18.432-45.568 46.08t-60.416 60.416-70.144 69.632l-77.824 77.824q37.888 36.864 74.24 72.192t67.584 66.048 56.32 56.32 41.472 41.984z','p-id':'4448',fill:'currentColor'})],-1),(0,i.eW)('  ',-1)])])])],2)]),(0,i.Q3)('  '),c.value?((0,i.uX)(),(0,i.CE)('div',{key:0,class:'settings-overlay',onClick:s[6]||(s[6]=e=>c.value=!1)},[(0,i.Lk)('div',{class:'settings-panel',onClick:s[5]||(s[5]=(0,n.D$)(()=>{},['stop']))},[(0,i.Lk)('div',nt,[s[18]||(s[18]=(0,i.Lk)('h3',null,'',-1)),(0,i.Lk)('button',{class:'settings-close',onClick:s[3]||(s[3]=e=>c.value=!1)},'')]),(0,i.Lk)('div',ot,[(0,i.Lk)('div',at,[s[19]||(s[19]=(0,i.Lk)('label',null,'URL',-1)),(0,i.bo)((0,i.Lk)('input',{'onUpdate:modelValue':s[4]||(s[4]=e=>f.value=e),type:'text',class:'settings-input',placeholder:'URL',onBlur:L},null,544),[[n.Jo,f.value]]),(0,i.Lk)('button',{class:'settings-btn',onClick:k},'')])])])])):(0,i.Q3)('v-if',!0)],2)])):(0,i.Q3)('v-if',!0)}}),ht=(0,B.A)(lt,[['__scopeId','data-v-6e6d14fc']]),ut={class:'space-y-1.5'},ct={class:'flex items-center justify-between'},dt={class:'text-muted-foreground text-xs'},pt={class:'flex items-center gap-2'},ft={class:'text-muted-foreground w-5 text-[10px]'},gt=['onPointerdown','onPointermove','onPointerup'],mt={class:'text-muted-foreground w-9 text-right text-[10px]'},_t=(0,i.pM)({__name:'ColorSlider',props:{label:{},value:{},showAlpha:{type:Boolean,default:!0}},emits:['update:value'],setup(e,{emit:t}){const s=e,a=t;function l(e){let t=0,s=0,i=0,r=1;if(e.startsWith('rgba')){const n=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);n&&(t=Number.parseInt(n[1])/255,s=Number.parseInt(n[2])/255,i=Number.parseInt(n[3])/255,r=n[4]?Number.parseFloat(n[4]):1)}else if(e.startsWith('rgb')){const r=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);r&&(t=Number.parseInt(r[1])/255,s=Number.parseInt(r[2])/255,i=Number.parseInt(r[3])/255)}else if(e.startsWith('#')){const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);n&&(t=Number.parseInt(n[1],16)/255,s=Number.parseInt(n[2],16)/255,i=Number.parseInt(n[3],16)/255,r=n[4]?Number.parseInt(n[4],16)/255:1)}const n=Math.max(t,s,i),o=Math.min(t,s,i);let a=0,l=0;const h=(n+o)/2;if(n!==o){const e=n-o;switch(l=h>.5?e/(2-n-o):e/(n+o),n){case t:a=((s-i)/e+(s<i?6:0))/6;break;case s:a=((i-t)/e+2)/6;break;case i:a=((t-s)/e+4)/6}}return{h:Math.round(360*a),s:Math.round(100*l),l:Math.round(100*h),a:r}}function h(e,t,s,i){t/=100,s/=100;const r=t=>(t+e/30)%12,n=e=>s-t*Math.min(s,1-s)*Math.max(-1,Math.min(r(e)-3,Math.min(9-r(e),1))),o=Math.round(255*n(0)),a=Math.round(255*n(8)),l=Math.round(255*n(4));return i<1?`rgba(${o}, ${a}, ${l}, ${i.toFixed(2)})`:`#${o.toString(16).padStart(2,'0')}${a.toString(16).padStart(2,'0')}${l.toString(16).padStart(2,'0')}`}function u(e){if(e.startsWith('#'))return e.slice(0,7).toUpperCase();const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(t){return`#${Number.parseInt(t[1]).toString(16).padStart(2,'0')}${Number.parseInt(t[2]).toString(16).padStart(2,'0')}${Number.parseInt(t[3]).toString(16).padStart(2,'0')}`.toUpperCase()}return'#000000'}const c=(0,i.EW)(()=>l(s.value)),d=(0,i.EW)(()=>u(s.value)),p=(0,o.KR)(d.value),f=(0,o.KR)(c.value),g=(0,o.KR)(!1),m={},v=(0,o.KR)(null),y=(0,o.KR)(null),x=(0,o.KR)(null);(0,i.wB)(()=>s.value,()=>{if(!g.value){const e=l(s.value);f.value=e,p.value=d.value}});const b=(0,i.EW)(()=>{const e=[{key:'h',label:'H',min:0,max:360,currentValue:f.value.h,gradient:'linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000)',step:1,thumbColor:`hsl(${f.value.h}, 100%, 50%)`,displayValue:`${Math.round(f.value.h)}`},{key:'s',label:'S',min:0,max:100,currentValue:f.value.s,gradient:`linear-gradient(to right, hsl(${f.value.h}, 0%, ${f.value.l}%), hsl(${f.value.h}, 100%, ${f.value.l}%))`,step:1,thumbColor:h(f.value.h,f.value.s,f.value.l,1),displayValue:`${Math.round(f.value.s)}%`},{key:'l',label:'L',min:0,max:100,currentValue:f.value.l,gradient:`linear-gradient(to right, #000, hsl(${f.value.h}, ${f.value.s}%, 50%), #fff)`,step:1,thumbColor:h(f.value.h,f.value.s,f.value.l,1),displayValue:`${Math.round(f.value.l)}%`}];return s.showAlpha&&e.push({key:'a',label:'A',min:0,max:1,currentValue:f.value.a,gradient:`linear-gradient(to right, transparent, ${h(f.value.h,f.value.s,f.value.l,1)})`,step:.01,thumbColor:h(f.value.h,f.value.s,f.value.l,f.value.a),displayValue:`${Math.round(100*f.value.a)}%`}),e});function T(e,t){const s=m[t.key];if(!s)return;const i=s.getBoundingClientRect(),r=Math.max(0,Math.min(e.clientX-i.left,i.width))/i.width,n=t.min+r*(t.max-t.min),o=t.step<1?Math.round(100*n)/100:Math.round(n);f.value={...f.value,[t.key]:o};const l=h(f.value.h,f.value.s,f.value.l,f.value.a);a('update:value',l)}function w(){if(g.value){const e=h(f.value.h,f.value.s,f.value.l,f.value.a);a('update:value',e),g.value=!1}}function E(e){const t=e.target.value.toUpperCase();if(p.value=t,/^#[0-9A-F]{6}$/.test(t)){const e=l(t);e.a=f.value.a,f.value=e,a('update:value',h(e.h,e.s,e.l,e.a))}}function C(){p.value=u(s.value)}return(t,s)=>((0,i.uX)(),(0,i.CE)('div',ut,[(0,i.Lk)('div',ct,[(0,i.Lk)('label',dt,(0,r.v_)(e.label),1),(0,i.Lk)('div',pt,[(0,i.bo)((0,i.Lk)('input',{'onUpdate:modelValue':s[0]||(s[0]=e=>p.value=e),type:'text',class:'bg-background text-foreground w-20 rounded border px-2 py-0.5 font-mono text-xs',placeholder:'#000000',onInput:E,onBlur:C},null,544),[[n.Jo,p.value]]),(0,i.Lk)('div',{class:'border-border h-6 w-6 rounded border shadow-sm',style:(0,r.Tr)({backgroundColor:e.value})},null,4)])]),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(b.value,e=>((0,i.uX)(),(0,i.CE)('div',{key:e.key,class:'flex items-center gap-2'},[(0,i.Lk)('span',ft,(0,r.v_)(e.label),1),(0,i.Lk)('div',{ref_for:!0,ref:t=>m[e.key]=t,class:'relative flex h-6 flex-1 cursor-pointer touch-none items-center',onPointerdown:t=>function(e,t){g.value=!0,v.value=t.key,e.currentTarget.setPointerCapture(e.pointerId),T(e,t);const s=e=>{v.value===t.key&&g.value&&T(e,t)},i=()=>{v.value===t.key&&(w(),v.value=null,y.value&&document.removeEventListener('pointermove',y.value),x.value&&document.removeEventListener('pointerup',x.value),e.currentTarget instanceof HTMLElement&&e.currentTarget.releasePointerCapture(e.pointerId))};y.value=s,x.value=i,document.addEventListener('pointermove',s),document.addEventListener('pointerup',i)}(t,e),onPointermove:t=>function(e,t){v.value===t.key&&g.value&&T(e,t)}(t,e),onPointerup:t=>function(e,t){v.value===t.key&&(w(),v.value=null,e.currentTarget instanceof HTMLElement&&e.currentTarget.releasePointerCapture(e.pointerId))}(t,e)},[(0,i.Lk)('div',{class:'absolute inset-y-2 right-0 left-0 rounded-full',style:(0,r.Tr)({background:e.gradient})},null,4),(0,i.Lk)('div',{class:'pointer-events-none absolute top-1/2 h-4 w-4 -translate-y-1/2 rounded-full border-2 border-white shadow-md',style:(0,r.Tr)({left:`calc(${(e.currentValue-e.min)/(e.max-e.min)*100}% - 8px)`,background:e.thumbColor})},null,4)],40,gt),(0,i.Lk)('span',mt,(0,r.v_)(e.displayValue),1)]))),128))]))}}),vt=(0,B.A)(_t,[['__scopeId','data-v-6137eb39']]),yt={class:'flex items-center gap-1'},xt={key:0,class:'p-1'},bt={key:0,class:'absolute left-1 top-1/2 -translate-y-1/2'},Tt={class:'absolute bottom-1.5 right-2'},wt={key:1,class:'absolute right-1 top-1/2 -translate-y-1/2'},Et={key:1,class:'p-1'},Ct=(0,i.pM)({__name:'DialogPreview',props:{style:{}},setup(e){const t=e,s=(0,i.EW)(()=>t.style),n=(0,i.EW)(()=>h.find(e=>e.id===s.value.boxShape)||h[0]),o=(0,i.EW)(()=>c.find(e=>e.id===s.value.nameShape)||c[0]),a=(0,i.EW)(()=>d.find(e=>e.id===s.value.arrowShape)||d[0]),f=(0,i.EW)(()=>p.find(e=>e.id===s.value.indicatorShape)||p[0]),g=(0,i.EW)(()=>u.find(e=>e.id===s.value.borderWidth)||u[1]),m=(0,i.EW)(()=>l.find(e=>e.id===s.value.backgroundPattern)),v=(0,i.EW)(()=>a.value.isInner),y=((0,i.EW)(()=>'minimal'===a.value.type),(0,i.EW)(()=>'pill'===s.value.boxShape)),x=(0,i.EW)(()=>'square'===a.value.type||'inner-square'===a.value.type?'4px':'pill'===a.value.type?'12px':'9999px'),b=(0,i.EW)(()=>{if(!m.value?.pattern)return{};const e=s.value.colors.boxBorder.replace(/[\d.]+\)$/,'0.08)'),t=m.value.pattern.replace(/VAR_BORDER_COLOR/g,e);let i='20px 20px';return'dots'===m.value.id&&(i='16px 16px'),'diamonds'===m.value.id&&(i='16px 16px'),'stripes'===m.value.id&&(i='28px 28px'),{backgroundImage:t,backgroundSize:i}}),T=(0,i.EW)(()=>({backgroundColor:y.value?'rgba(255,255,255,0.7)':s.value.colors.boxBackground,borderRadius:n.value.borderRadius,borderTopWidth:g.value.width,borderLeftWidth:g.value.width,borderRightWidth:g.value.width,borderBottomWidth:g.value.width,borderStyle:'solid',borderColor:s.value.colors.boxBorder,boxShadow:n.value.shadow,...y.value?{backdropFilter:'blur(12px)',WebkitBackdropFilter:'blur(12px)'}:{},...b.value})),w=(0,i.EW)(()=>{const{type:e}=f.value,t=s.value.colors.indicatorColor;return'none'===e?null:'dots'===e?(0,i.h)('div',{class:'flex gap-0.5 items-center'},[0,1,2].map(e=>(0,i.h)('span',{key:e,class:'w-1 h-1 rounded-full',style:{backgroundColor:t,opacity:2===e?1:.4}}))):'diamonds'===e?(0,i.h)('div',{class:'flex gap-0.5 items-center'},[0,1,2].map(e=>(0,i.h)('span',{key:e,style:{width:'8px',height:'8px',backgroundColor:t,opacity:2===e?1:.3+.15*e,transform:'rotate(45deg)',display:'inline-block'}}))):'pulse'===e?(0,i.h)('div',{class:'relative w-2 h-2'},[(0,i.h)('span',{class:'absolute inset-0 rounded-full',style:{backgroundColor:t}})]):'arrow'===e?(0,i.h)('svg',{class:'w-3 h-3',style:{color:t},fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.h)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})]):null});return(e,t)=>((0,i.uX)(),(0,i.CE)('div',yt,[v.value?(0,i.Q3)('v-if',!0):((0,i.uX)(),(0,i.CE)('div',xt,[(0,i.Lk)('div',{class:'p-1 backdrop-blur-sm shadow',style:(0,r.Tr)({backgroundColor:s.value.colors.arrowBackground,borderRadius:x.value.value})},[((0,i.uX)(),(0,i.CE)('svg',{class:'w-3 h-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',style:(0,r.Tr)({color:s.value.colors.arrowIcon})},[...t[0]||(t[0]=[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 19l-7-7 7-7'},null,-1)])],4))],4)])),(0,i.Lk)('div',{class:'flex-1 p-2 min-h-[60px] relative',style:(0,r.Tr)(T.value)},[v.value?((0,i.uX)(),(0,i.CE)('div',bt,[(0,i.Lk)('div',{class:'p-1 backdrop-blur-sm shadow',style:(0,r.Tr)({backgroundColor:s.value.colors.arrowBackground,borderRadius:x.value})},[((0,i.uX)(),(0,i.CE)('svg',{class:'w-3 h-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',style:(0,r.Tr)({color:s.value.colors.arrowIcon})},[...t[1]||(t[1]=[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 19l-7-7 7-7'},null,-1)])],4))],4)])):(0,i.Q3)('v-if',!0),(0,i.Lk)('div',{class:'h-4 mb-1 flex items-start',style:(0,r.Tr)({paddingLeft:v.value?'24px':0,paddingRight:v.value?'24px':0})},[(0,i.Lk)('div',{class:'px-2 py-0.5 text-[10px] font-medium',style:(0,r.Tr)({backgroundColor:s.value.colors.nameBackground,color:s.value.colors.nameText,borderRadius:o.value.borderRadius,borderBottom:'underline'===o.value.style?`2px solid ${s.value.colors.nameText}`:void 0,boxShadow:'floating'===o.value.style?'0 2px 8px rgba(0,0,0,0.1)':void 0})},'  ',4)],4),(0,i.Lk)('p',{class:'text-[10px] leading-relaxed',style:(0,r.Tr)({color:s.value.colors.dialogText,fontSize:`${s.value.fontSize}px`,paddingLeft:v.value?'24px':0,paddingRight:v.value?'24px':0})},' ... ',4),(0,i.Lk)('div',Tt,[((0,i.uX)(),(0,i.Wv)((0,i.$y)(w.value)))]),v.value?((0,i.uX)(),(0,i.CE)('div',wt,[(0,i.Lk)('div',{class:'p-1 backdrop-blur-sm shadow',style:(0,r.Tr)({backgroundColor:s.value.colors.arrowBackground,borderRadius:x.value})},[((0,i.uX)(),(0,i.CE)('svg',{class:'w-3 h-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',style:(0,r.Tr)({color:s.value.colors.arrowIcon})},[...t[2]||(t[2]=[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'},null,-1)])],4))],4)])):(0,i.Q3)('v-if',!0)],4),v.value?(0,i.Q3)('v-if',!0):((0,i.uX)(),(0,i.CE)('div',Et,[(0,i.Lk)('div',{class:'p-1 backdrop-blur-sm shadow',style:(0,r.Tr)({backgroundColor:s.value.colors.arrowBackground,borderRadius:x.value.value})},[((0,i.uX)(),(0,i.CE)('svg',{class:'w-3 h-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',style:(0,r.Tr)({color:s.value.colors.arrowIcon})},[...t[3]||(t[3]=[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'},null,-1)])],4))],4)]))]))}}),St={class:'animate-in fade-in absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm duration-200'},At={class:'bg-card relative max-h-[85vh] w-[90%] max-w-lg overflow-hidden rounded-2xl shadow-2xl'},Mt={class:'border-border flex items-center justify-between border-b p-4'},Pt={class:'settings-scroll-container max-h-[calc(85vh-120px)] overflow-y-auto p-4'},It={class:'space-y-6'},Rt={class:'space-y-4'},Lt={class:'space-y-3'},kt={class:'space-y-2'},Dt=['value'],Bt={class:'space-y-4'},Ft={class:'space-y-3'},Ot={class:'space-y-2'},Nt={class:'text-muted-foreground text-xs'},Ut=['value'],Gt={class:'space-y-2'},Vt={class:'text-muted-foreground text-xs'},Ht=['value'],Wt={class:'space-y-2'},$t={class:'text-muted-foreground text-xs'},Xt=['value'],jt={class:'space-y-4'},zt={class:'space-y-3'},Yt={class:'space-y-2'},qt={class:'text-muted-foreground text-xs'},Qt=['value'],Kt={class:'space-y-2'},Zt={class:'text-muted-foreground text-xs'},Jt=['value'],es={class:'space-y-2'},ts={class:'text-muted-foreground text-xs'},ss=['value'],is={class:'space-y-4'},rs={class:'flex items-center justify-between'},ns={class:'relative inline-flex cursor-pointer items-center'},os=['checked'],as={key:0,class:'animate-in fade-in space-y-2 duration-200'},ls={class:'text-muted-foreground text-xs'},hs=['value'],us={class:'space-y-4'},cs={class:'flex items-center justify-between'},ds={class:'relative inline-flex cursor-pointer items-center'},ps=['checked'],fs={key:0,class:'animate-in fade-in space-y-4 duration-200'},gs={class:'bg-muted/30 rounded-lg p-3'},ms={class:'mb-2 flex items-center justify-between'},_s=['disabled'],vs={key:0,class:'h-3 w-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},ys={key:1,class:'h-3 w-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},xs={class:'px-6'},bs={class:'space-y-4'},Ts={class:'bg-muted text-muted-foreground inline-flex h-9 w-full items-center justify-center rounded-lg p-[3px]'},ws={key:0,class:'space-y-4'},Es={class:'space-y-2'},Cs={class:'grid grid-cols-5 gap-2'},Ss=['onClick'],As={class:'space-y-2'},Ms={class:'grid grid-cols-6 gap-2'},Ps=['onClick'],Is={class:'space-y-2'},Rs={class:'grid grid-cols-5 gap-2'},Ls=['onClick'],ks={class:'space-y-2'},Ds={class:'grid grid-cols-5 gap-2'},Bs=['onClick'],Fs={class:'space-y-2'},Os={class:'grid grid-cols-6 gap-2'},Ns=['onClick'],Us={class:'space-y-2'},Gs={class:'grid grid-cols-5 gap-2'},Vs=['onClick'],Hs={class:'space-y-2'},Ws={class:'text-muted-foreground text-xs'},$s=['value'],Xs={key:1,class:'space-y-4'},js=(0,i.pM)({__name:'SettingsPanel',props:{onClose:{type:Function},userDisplayName:{},onUserDisplayNameChange:{type:Function},spriteSettings:{},onSpriteSettingsChange:{type:Function},live2dSettings:{},onLive2dSettingsChange:{type:Function},autoPlay:{type:Boolean},onAutoPlayChange:{type:Function},autoPlaySpeed:{},onAutoPlaySpeedChange:{type:Function},dialogStyle:{},onDialogStyleChange:{type:Function},onSaveStyle:{type:Function},currentAppliedStyle:{},customModeEnabled:{type:Boolean},onCustomModeChange:{type:Function}},setup(e){const t=e,s=(0,o.KR)('shapes'),n=(0,i.EW)(()=>JSON.stringify(t.dialogStyle)!==JSON.stringify(t.currentAppliedStyle));function a(e){t.onSpriteSettingsChange(e)}function f(e){t.onLive2dSettingsChange(e)}function g(e,s){t.onDialogStyleChange({...t.dialogStyle,[e]:s})}function m(e,s){t.onDialogStyleChange({...t.dialogStyle,colors:{...t.dialogStyle.colors,[e]:s}})}return(v,y)=>((0,i.uX)(),(0,i.CE)('div',St,[(0,i.Lk)('div',At,[(0,i.Q3)('  '),(0,i.Lk)('div',Mt,[y[25]||(y[25]=(0,i.Lk)('h2',{class:'text-foreground text-lg font-semibold'},'',-1)),(0,i.Lk)('button',{class:'hover:bg-muted rounded-full p-1 transition-colors','aria-label':'',onClick:y[0]||(y[0]=(...t)=>e.onClose&&e.onClose(...t))},[...y[24]||(y[24]=[(0,i.Lk)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),(0,i.Q3)('  '),(0,i.Lk)('div',Pt,[(0,i.Lk)('div',It,[(0,i.Q3)('  '),(0,i.Lk)('div',Rt,[y[27]||(y[27]=(0,i.Lk)('h3',{class:'text-foreground text-sm font-medium'},'',-1)),(0,i.Lk)('div',Lt,[(0,i.Lk)('div',kt,[y[26]||(y[26]=(0,i.Lk)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,i.Lk)('input',{type:'text',value:e.userDisplayName,placeholder:'',class:'border-border bg-background text-foreground w-full rounded-lg border px-3 py-2 text-sm placeholder:text-muted-foreground focus:border-primary focus:ring-primary focus:ring-1 focus:outline-none',onInput:y[1]||(y[1]=e=>{return s=e.target.value,void t.onUserDisplayNameChange(s);var s})},null,40,Dt)])])]),(0,i.Q3)('  '),(0,i.Lk)('div',Bt,[y[28]||(y[28]=(0,i.Lk)('h3',{class:'text-foreground text-sm font-medium'},'',-1)),y[29]||(y[29]=(0,i.Lk)('p',{class:'text-muted-foreground text-xs'},'',-1)),(0,i.Lk)('div',Ft,[(0,i.Lk)('div',Ot,[(0,i.Lk)('label',Nt,' ('+(0,r.v_)(Math.round(100*e.spriteSettings.scale))+'%)',1),(0,i.Lk)('input',{type:'range',value:e.spriteSettings.scale,min:'0.5',max:'1.5',step:'0.05',class:'w-full',onInput:y[2]||(y[2]=t=>a({...e.spriteSettings,scale:parseFloat(t.target.value)}))},null,40,Ut)]),(0,i.Lk)('div',Gt,[(0,i.Lk)('label',Vt,' ('+(0,r.v_)(e.spriteSettings.positionX)+'%)',1),(0,i.Lk)('input',{type:'range',value:e.spriteSettings.positionX,min:'0',max:'100',step:'1',class:'w-full',onInput:y[3]||(y[3]=t=>a({...e.spriteSettings,positionX:parseInt(t.target.value)}))},null,40,Ht)]),(0,i.Lk)('div',Wt,[(0,i.Lk)('label',$t,' ('+(0,r.v_)(e.spriteSettings.positionY)+'%)',1),(0,i.Lk)('input',{type:'range',value:e.spriteSettings.positionY,min:'0',max:'200',step:'1',class:'w-full',onInput:y[4]||(y[4]=t=>a({...e.spriteSettings,positionY:parseInt(t.target.value)}))},null,40,Xt)])])]),(0,i.Q3)(' Live2D  '),(0,i.Lk)('div',jt,[y[30]||(y[30]=(0,i.Lk)('h3',{class:'text-foreground text-sm font-medium'},'Live2D ',-1)),y[31]||(y[31]=(0,i.Lk)('p',{class:'text-muted-foreground text-xs'},' Live2D ',-1)),(0,i.Lk)('div',zt,[(0,i.Lk)('div',Yt,[(0,i.Lk)('label',qt,' ('+(0,r.v_)(Math.round(100*e.live2dSettings.scale))+'%)',1),(0,i.Lk)('input',{type:'range',value:e.live2dSettings.scale,min:'0',max:'2',step:'0.05',class:'w-full',onInput:y[5]||(y[5]=t=>f({...e.live2dSettings,scale:parseFloat(t.target.value)}))},null,40,Qt)]),(0,i.Lk)('div',Kt,[(0,i.Lk)('label',Zt,' ('+(0,r.v_)(e.live2dSettings.positionX)+'%)',1),(0,i.Lk)('input',{type:'range',value:e.live2dSettings.positionX,min:'0',max:'100',step:'1',class:'w-full',onInput:y[6]||(y[6]=t=>f({...e.live2dSettings,positionX:parseInt(t.target.value)}))},null,40,Jt)]),(0,i.Lk)('div',es,[(0,i.Lk)('label',ts,' ('+(0,r.v_)(e.live2dSettings.positionY)+'%)',1),(0,i.Lk)('input',{type:'range',value:e.live2dSettings.positionY,min:'0',max:'150',step:'1',class:'w-full',onInput:y[7]||(y[7]=t=>f({...e.live2dSettings,positionY:parseInt(t.target.value)}))},null,40,ss)])])]),(0,i.Q3)('  '),(0,i.Lk)('div',is,[y[34]||(y[34]=(0,i.Lk)('h3',{class:'text-foreground text-sm font-medium'},'',-1)),(0,i.Lk)('div',rs,[y[33]||(y[33]=(0,i.Lk)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,i.Lk)('label',ns,[(0,i.Lk)('input',{type:'checkbox',checked:e.autoPlay,class:'peer sr-only',onChange:y[8]||(y[8]=t=>e.onAutoPlayChange(t.target.checked))},null,40,os),y[32]||(y[32]=(0,i.Lk)('div',{class:'bg-input peer relative h-[1.15rem] w-8 rounded-full transition-colors peer-checked:bg-primary'},[(0,i.Lk)('div',{class:'bg-background absolute top-0 left-0 h-4 w-4 rounded-full transition-transform peer-checked:translate-x-[calc(100%-2px)]'})],-1))])]),e.autoPlay?((0,i.uX)(),(0,i.CE)('div',as,[(0,i.Lk)('label',ls,' ('+(0,r.v_)(e.autoPlaySpeed/1e3)+')',1),(0,i.Lk)('input',{type:'range',value:e.autoPlaySpeed,min:'1000',max:'8000',step:'500',class:'w-full',onInput:y[9]||(y[9]=t=>e.onAutoPlaySpeedChange(parseInt(t.target.value)))},null,40,hs)])):(0,i.Q3)('v-if',!0)]),(0,i.Q3)('  '),(0,i.Lk)('div',us,[(0,i.Lk)('div',cs,[y[36]||(y[36]=(0,i.Lk)('h3',{class:'text-foreground text-sm font-medium'},'',-1)),(0,i.Lk)('label',ds,[(0,i.Lk)('input',{type:'checkbox',checked:e.customModeEnabled,class:'peer sr-only',onChange:y[10]||(y[10]=e=>{return s=e.target.checked,t.onCustomModeChange(s),void(s&&t.onDialogStyleChange(t.currentAppliedStyle));var s})},null,40,ps),y[35]||(y[35]=(0,i.Lk)('div',{class:'bg-input peer relative h-[1.15rem] w-8 rounded-full transition-colors peer-checked:bg-primary'},[(0,i.Lk)('div',{class:'bg-background absolute top-0 left-0 h-4 w-4 rounded-full transition-transform peer-checked:translate-x-[calc(100%-2px)]'})],-1))])]),e.customModeEnabled?((0,i.uX)(),(0,i.CE)('div',fs,[(0,i.Q3)('  '),(0,i.Lk)('div',gs,[(0,i.Lk)('div',ms,[y[39]||(y[39]=(0,i.Lk)('span',{class:'text-muted-foreground text-xs'},'',-1)),(0,i.Lk)('button',{disabled:!n.value,class:(0,r.C4)(['flex h-7 items-center gap-1 rounded-md border px-3 text-xs transition-colors',n.value?'bg-primary text-primary-foreground border-primary hover:bg-primary/90':'bg-background cursor-not-allowed border-gray-200 opacity-50']),onClick:y[11]||(y[11]=(...t)=>e.onSaveStyle&&e.onSaveStyle(...t))},[n.value?((0,i.uX)(),(0,i.CE)('svg',vs,[...y[37]||(y[37]=[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12'},null,-1)])])):((0,i.uX)(),(0,i.CE)('svg',ys,[...y[38]||(y[38]=[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M5 13l4 4L19 7'},null,-1)])])),(0,i.eW)(' '+(0,r.v_)(n.value?'':''),1)],10,_s)]),(0,i.Lk)('div',xs,[(0,i.bF)(Ct,{style:(0,r.Tr)(e.dialogStyle)},null,8,['style'])])]),(0,i.Q3)('  '),(0,i.Lk)('div',bs,[(0,i.Lk)('div',Ts,[(0,i.Lk)('button',{class:(0,r.C4)(['inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all','shapes'===s.value?'bg-background text-foreground border-input shadow-sm':'text-muted-foreground hover:text-foreground']),onClick:y[12]||(y[12]=e=>s.value='shapes')},'  ',2),(0,i.Lk)('button',{class:(0,r.C4)(['inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all','colors'===s.value?'bg-background text-foreground border-input shadow-sm':'text-muted-foreground hover:text-foreground']),onClick:y[13]||(y[13]=e=>s.value='colors')},'  ',2)]),(0,i.Q3)('  '),'shapes'===s.value?((0,i.uX)(),(0,i.CE)('div',ws,[(0,i.Q3)('  '),(0,i.Lk)('div',Es,[y[40]||(y[40]=(0,i.Lk)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,i.Lk)('div',Cs,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)((0,o.R1)(h),t=>((0,i.uX)(),(0,i.CE)('button',{key:t.id,class:(0,r.C4)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.boxShape===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>g('boxShape',t.id)},(0,r.v_)(t.name),11,Ss))),128))])]),(0,i.Q3)('  '),(0,i.Lk)('div',As,[y[41]||(y[41]=(0,i.Lk)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,i.Lk)('div',Ms,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)((0,o.R1)(l),t=>((0,i.uX)(),(0,i.CE)('button',{key:t.id,class:(0,r.C4)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.backgroundPattern===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>g('backgroundPattern',t.id)},(0,r.v_)(t.name),11,Ps))),128))])]),(0,i.Q3)('  '),(0,i.Lk)('div',Is,[y[42]||(y[42]=(0,i.Lk)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,i.Lk)('div',Rs,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)((0,o.R1)(u),t=>((0,i.uX)(),(0,i.CE)('button',{key:t.id,class:(0,r.C4)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.borderWidth===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>g('borderWidth',t.id)},(0,r.v_)(t.name),11,Ls))),128))])]),(0,i.Q3)('  '),(0,i.Lk)('div',ks,[y[43]||(y[43]=(0,i.Lk)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,i.Lk)('div',Ds,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)((0,o.R1)(c),t=>((0,i.uX)(),(0,i.CE)('button',{key:t.id,class:(0,r.C4)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.nameShape===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>g('nameShape',t.id)},(0,r.v_)(t.name),11,Bs))),128))])]),(0,i.Q3)('  '),(0,i.Lk)('div',Fs,[y[44]||(y[44]=(0,i.Lk)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,i.Lk)('div',Os,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)((0,o.R1)(d),t=>((0,i.uX)(),(0,i.CE)('button',{key:t.id,class:(0,r.C4)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.arrowShape===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>g('arrowShape',t.id)},(0,r.v_)(t.name),11,Ns))),128))])]),(0,i.Q3)('  '),(0,i.Lk)('div',Us,[y[45]||(y[45]=(0,i.Lk)('label',{class:'text-muted-foreground text-xs'},'',-1)),(0,i.Lk)('div',Gs,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)((0,o.R1)(p),t=>((0,i.uX)(),(0,i.CE)('button',{key:t.id,class:(0,r.C4)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.indicatorShape===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>g('indicatorShape',t.id)},(0,r.v_)(t.name),11,Vs))),128))])]),(0,i.Q3)('  '),(0,i.Lk)('div',Hs,[(0,i.Lk)('label',Ws,' ('+(0,r.v_)(e.dialogStyle.fontSize)+'px)',1),(0,i.Lk)('input',{type:'range',value:e.dialogStyle.fontSize,min:'12',max:'24',step:'1',class:'w-full',onInput:y[14]||(y[14]=t=>e.onDialogStyleChange({...e.dialogStyle,fontSize:parseInt(t.target.value)}))},null,40,$s)])])):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),'colors'===s.value?((0,i.uX)(),(0,i.CE)('div',Xs,[(0,i.bF)(vt,{label:'',value:e.dialogStyle.colors.boxBackground,'onUpdate:value':y[15]||(y[15]=e=>m('boxBackground',e))},null,8,['value']),(0,i.bF)(vt,{label:'',value:e.dialogStyle.colors.boxBorder,'onUpdate:value':y[16]||(y[16]=e=>m('boxBorder',e))},null,8,['value']),(0,i.bF)(vt,{label:'',value:e.dialogStyle.colors.nameBackground,'onUpdate:value':y[17]||(y[17]=e=>m('nameBackground',e))},null,8,['value']),(0,i.bF)(vt,{label:'',value:e.dialogStyle.colors.nameText,'show-alpha':!1,'onUpdate:value':y[18]||(y[18]=e=>m('nameText',e))},null,8,['value']),(0,i.bF)(vt,{label:'',value:e.dialogStyle.colors.dialogText,'show-alpha':!1,'onUpdate:value':y[19]||(y[19]=e=>m('dialogText',e))},null,8,['value']),(0,i.bF)(vt,{label:'',value:e.dialogStyle.colors.narrationText,'show-alpha':!1,'onUpdate:value':y[20]||(y[20]=e=>m('narrationText',e))},null,8,['value']),(0,i.bF)(vt,{label:'',value:e.dialogStyle.colors.arrowBackground,'onUpdate:value':y[21]||(y[21]=e=>m('arrowBackground',e))},null,8,['value']),(0,i.bF)(vt,{label:'',value:e.dialogStyle.colors.arrowIcon,'show-alpha':!1,'onUpdate:value':y[22]||(y[22]=e=>m('arrowIcon',e))},null,8,['value']),(0,i.bF)(vt,{label:'',value:e.dialogStyle.colors.indicatorColor,'onUpdate:value':y[23]||(y[23]=e=>m('indicatorColor',e))},null,8,['value'])])):(0,i.Q3)('v-if',!0)])])):(0,i.Q3)('v-if',!0)])])])])]))}}),zs=(0,B.A)(js,[['__scopeId','data-v-783ad584']]),Ys={class:'absolute top-4 left-4 z-50 flex flex-col items-start gap-2'},qs={key:0,class:'animate-in fade-in slide-in-from-left-2 text-sm duration-200'},Qs={class:'absolute top-4 right-4 z-50 flex flex-col items-end gap-2'},Ks={key:0,class:'animate-in fade-in slide-in-from-left-2 text-sm duration-200'},Zs=['aria-label'],Js={key:0,class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},ei={key:1,class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},ti={class:'text-sm'},si={class:'animate-in fade-in px-8 text-center text-xl leading-relaxed text-white duration-1000 md:text-2xl'},ii={key:3,class:'absolute z-40',style:{right:'20%',top:'20%',maxWidth:'280px'}},ri={class:'bg-card/95 text-foreground relative max-h-[85vh] w-[90%] max-w-3xl rounded-2xl shadow-2xl backdrop-blur-md'},ni={class:'border-border/30 flex items-center justify-between border-b px-6 py-3'},oi={class:'history-scroll-container max-h-[calc(85vh-100px)] overflow-y-auto px-6 py-2'},ai={key:0,class:'text-muted-foreground py-12 text-center text-sm'},li=['onClick'],hi={class:'font-medium'},ui=['innerHTML'],ci={key:4,class:'bg-border/30 absolute right-3 bottom-0 left-3 h-px opacity-0 transition-opacity group-hover:opacity-100'},di={class:'flex items-center gap-3'},pi=(0,i.pM)({__name:'GalgamePlayer',setup(e){const t='galgame_dialog_style',l='galgame_sprite_settings',h='galgame_live2d_settings',u='galgame_user_display_name',c=a(),d=(0,o.KR)(null),p=(0,o.KR)(null),g=(0,o.IJ)([]),m=(0,o.KR)(0),v=(0,i.EW)(()=>g.value[m.value]||null),y=(0,o.KR)(!1),x=(0,i.EW)(()=>{if(!v.value)return;const e=g.value.find(e=>e.noteUnitId===v.value?.unitId&&e.noteContent);return e?.noteContent}),T=(0,i.EW)(()=>{if(!v.value)return;const e=g.value.find(e=>e.noteUnitId===v.value?.unitId&&e.noteContent);return e?.noteUnitId}),w=(0,i.EW)(()=>{if(!v.value)return;const e=g.value.find(e=>e.noteUnitId===v.value?.unitId&&e.noteContent);return e?.notePosition});function E(e,t){const s=g.value.find(t=>t.noteUnitId===e&&t.noteContent);if(s){s.notePosition=t;const i=`note_position_${e}`;localStorage.setItem(i,JSON.stringify(t))}}const C=(0,o.KR)(!1),A=(0,o.KR)(!1),I=(0,o.KR)(!1),R=(0,o.KR)(3e3),L=(0,o.KR)(!1),k=(0,o.KR)(!1),D=(0,o.KR)(!1),B=(0,o.KR)(!1),F=(0,o.KR)(!1),N=(0,o.KR)(''),U=(0,o.KR)(!1),G=(0,o.KR)(!1),V=(0,o.KR)(!1),H=(0,o.KR)(''),W=(0,o.KR)(null),X=(0,o.KR)(null),j=(0,o.KR)(ee(l,{scale:1.15,positionX:24,positionY:120})),Y=(0,o.KR)(ee(h,{scale:1.15,positionX:24,positionY:120})),q=(0,o.KR)(ee(t,f)),Q=(0,o.KR)({...q.value}),K=(0,o.KR)(ee(u,'')),Z=(0,o.IJ)([]),J=(0,o.IJ)(new Map);function ee(e,t){try{const t=localStorage.getItem(e);if(t)return JSON.parse(t)}catch(t){console.warn(` localStorage  ${e} :`,t)}return t}function te(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(t){console.warn(` localStorage ${e} :`,t)}}(0,i.wB)(q,e=>{te(t,e)},{deep:!0}),(0,i.wB)(j,e=>{te(l,e)},{deep:!0}),(0,i.wB)(Y,e=>{te(h,e)},{deep:!0});const se=(0,i.EW)(()=>{const e=window.innerHeight>window.innerWidth,t=!!document.fullscreenElement,s=16/9;if(e&&t){const e=window.innerHeight;return{width:`${e}px`,aspectRatio:'16 / 9',transform:'rotate(90deg)',transformOrigin:'center center',position:'absolute',left:'50%',top:'50%',marginLeft:`-${e/2}px`,marginTop:`-${e/s/2}px`,background:'transparent'}}return{width:'100%',aspectRatio:'16 / 9',margin:'0 auto',background:'transparent'}}),ie=(0,i.EW)(()=>{const e=v.value;return e?.sceneImageUrl?e.sceneImageUrl:e?.scene&&(e.scene.match(/^https?:\/\//)||e.scene.match(/^\//))?e.scene:null}),re=(0,i.EW)(()=>{const e=v.value;if(e?.sprite?.type)return console.info('[GalgamePlayer] currentSpriteType:  dialogue.sprite.type ',e.sprite.type),e.sprite.type;if(e?.isCG||'cg'===e?.type)return console.info('[GalgamePlayer] currentSpriteType: CG none'),'none';if(e?.character){const t=Z.value.some(t=>t.name===e.character),s=!!e.sprite?.imageUrl;return console.info('[GalgamePlayer] currentSpriteType: ',{character:e.character,hasLive2d:t,hasImage:s,availableModels:Z.value.map(e=>({id:e.id,name:e.name}))}),t?'live2d':s?'image':'none'}return console.info('[GalgamePlayer] currentSpriteType:  none'),'none'}),ne=(0,i.EW)(()=>{const e=v.value;return e?.sprite?.imageUrl||'/placeholder-user.jpg'}),oe=(0,i.EW)(()=>{const e=v.value;if(e?.sprite?.live2dModelId)return console.info('[GalgamePlayer] currentLive2dModelId: ID',{modelId:e.sprite.live2dModelId,character:e.character,source:'dialogue.sprite.live2dModelId (dialogue)'}),e.sprite.live2dModelId;if(e?.character){const t=Z.value.find(t=>t.name===e.character);return console.info('[GalgamePlayer] currentLive2dModelId: ',{character:e.character,foundModel:t?{id:t.id,name:t.name}:null,availableModels:Z.value.map(e=>({id:e.id,name:e.name})),source:'live2dModels.value ()'}),t?.id}console.info('[GalgamePlayer] currentLive2dModelId: ID',{hasDialogue:!!e,hasCharacter:!!e?.character,availableModels:Z.value.map(e=>({id:e.id,name:e.name}))})}),ae=(0,o.KR)(new Map);function le(e,t){return e.unitId===t.unitId&&e.message_id===t.message_id&&(e.character===t.character&&e.text===t.text&&e.type===t.type&&e.role===t.role&&(e.scene===t.scene&&e.sceneImageUrl===t.sceneImageUrl&&e.motion===t.motion&&e.expression===t.expression&&e.isCG===t.isCG&&e.cgImageUrl===t.cgImageUrl&&(e.sprite?.type===t.sprite?.type&&e.sprite?.live2dModelId===t.sprite?.live2dModelId&&e.sprite?.imageUrl===t.sprite?.imageUrl&&(e.options?.length||0)===(t.options?.length||0))))}function he(e){const t=g.value,s=m.value;if(function(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!le(e[s],t[s]))return!1;return!0}(t,e))return!1;if(0===e.length||e.length<t.length)return g.value=e,m.value>=e.length&&(m.value=Math.max(0,e.length-1)),!0;let i=t.length;const r=t.length>0?t[t.length-1].message_id:-1,n=e.length>0?e[e.length-1].message_id:-1;if(void 0!==n&&void 0!==r&&n>r){for(let t=0;t<e.length;t++)if(void 0!==e[t].message_id&&e[t].message_id>r){i=t;break}const n=e.slice(i);if(n.length>0)return g.value=[...t,...n],m.value=s,!0}return g.value=e,m.value>=g.value.length&&(m.value=Math.max(0,g.value.length-1)),!0}async function ue(){try{const e=getChatMessages('0-{{lastMessageId}}'),t=[];let i,r,n,o,a,l,h;if(Z.value.length>0){console.info(`[]  ${Z.value.length}  Live2D `);const{live2dModelManager:e}=await Promise.resolve().then(s.bind(s,958));e.preloadModels(Z.value).catch(e=>{console.warn('[] Live2D :',e)})}const u=e=>{!e.scene&&i&&(e.scene=i),!e.sceneImageUrl&&r&&(!e.scene||i&&e.scene===i)&&(e.sceneImageUrl=r)},c=e=>{'blackscreen'!==e.type&&void 0===e.isCG&&l&&(e.isCG=l,h&&(e.cgImageUrl=h))},d=e=>{'blackscreen'!==e.type&&(n&&(e.sprite={...n}),!e.motion&&o&&(e.motion=o),!e.expression&&a&&(e.expression=a))},p=e=>{'blackscreen'!==e.type&&(e.scene&&(i=e.scene),e.sceneImageUrl&&(r=e.sceneImageUrl))},f=e=>{!1===e.isCG?(n=e.sprite?{...e.sprite}:void 0,o=e.motion,a=e.expression,l=!1,h=void 0):!0===e.isCG?(n=void 0,o=void 0,a=void 0,l=!0,h=e.cgImageUrl):(n=e.sprite?{...e.sprite}:void 0,o=e.motion,a=e.expression,void 0!==e.isCG&&(l=e.isCG,h=e.cgImageUrl))};for(const s of e){const e=s.message||'',r=await M(e,i,K.value);if(0===r.length)continue;const n=S(e);let o=0,a=0;for(;a<r.length;){const e=r[a];if('choice'===e.type){const i=[e];let l=a+1;for(;l<r.length&&'choice'===r[l].type;)i.push(r[l]),l++;const h=i.some(e=>'format1'===e.choiceFormat),f=i.some(e=>'format2'===e.choiceFormat);if(h){const e=[];for(const t of i)t.options&&e.push(...t.options);if(e.length>0){const i=e.map((e,t)=>({...e,id:e.id&&'choice_0'!==e.id?e.id:`choice_${s.message_id}_${o}_${t}`})),r={unitId:`msg_${s.message_id}_unit_${o}`,unitIndex:o++,character:'',text:'',type:'choice',message_id:s.message_id,role:'system',choiceFormat:'format1',options:i,statusBlock:n};u(r),d(r),c(r),t.push(r),p(r)}}else if(f){const e=[];for(const t of i)t.choices&&e.push(...t.choices);if(e.length>0){const i={unitId:`msg_${s.message_id}_unit_${o}`,unitIndex:o++,character:'',text:'',type:'choice',message_id:s.message_id,role:'system',choiceFormat:'format2',options:e.map((e,t)=>({id:`choice_${t}`,text:e})),statusBlock:n};u(i),d(i),c(i),t.push(i),p(i)}}a=l;continue}if('character'===e.type){const i=e.motion||e.motionFile,r=e.expression||e.expressionFile,a=P(e.character||'',i,r,Z.value),l=Z.value.find(t=>t.name===e.character),h=!!e.spriteImageUrl||!!s.extra?.sprite_image;console.info('[] :',{character:e.character,hasLive2dModel:!!l,hasMotionExpr:a,hasSpriteImage:h,spriteImageUrl:e.spriteImageUrl,blockIsCG:e.isCG});const c=!0===e.isCG;console.info('[] CG:',{isCGMode:c,reason:!0===e.isCG?'CGCG':!1===e.isCG?'':'isCG'});const d={unitId:`msg_${s.message_id}_unit_${o}`,unitIndex:o++,character:e.character,text:e.text||'',message_id:s.message_id,role:'assistant',type:c?'cg':void 0,scene:e.scene,sceneImageUrl:e.sceneImageUrl,motion:i,expression:r,isCG:c,cgImageUrl:c?e.cgImageUrl||e.scene:void 0,statusBlock:n,sprite:c?{type:'none'}:(()=>{const t=e.spriteImageUrl||s.extra?.sprite_image||void 0;return l?(console.info('[]  Live2D :',{character:e.character,modelId:l.id,modelName:l.name,source:'live2dModels.value ()'}),{type:'live2d',live2dModelId:l.id,imageUrl:void 0}):t?(console.info('[] :',e.character,'imageUrl:',t),{type:'image',live2dModelId:void 0,imageUrl:t}):(console.info('[] :',e.character,''),{type:'none',live2dModelId:void 0,imageUrl:void 0})})()};u(d),t.push(d),p(d),f(d)}else if('narration'===e.type){const i={unitId:`msg_${s.message_id}_unit_${o}`,unitIndex:o++,character:'',text:e.message||'',type:'narration',message_id:s.message_id,role:'system',scene:e.scene,sceneImageUrl:e.sceneImageUrl,statusBlock:n};u(i),d(i),c(i),t.push(i),p(i)}else if('blacktext'===e.type){const i={unitId:`msg_${s.message_id}_unit_${o}`,unitIndex:o++,character:'',text:e.message||'',type:'blackscreen',message_id:s.message_id,role:'system',statusBlock:n};l=void 0,h=void 0,t.push(i)}else if('user'===e.type){const i={unitId:`msg_${s.message_id}_unit_${o}`,unitIndex:o++,character:'',text:e.message||'',type:'user',message_id:s.message_id,role:'user',scene:e.scene,sceneImageUrl:e.sceneImageUrl,isEditable:!0,statusBlock:n};u(i),d(i),c(i);const r=ae.value.get(s.message_id);r&&(r.deleted?i.isDeleted=!0:void 0!==r.text&&(i.editedText=r.text,i.text=r.text)),t.push(i),p(i)}else if('note'===e.type){let i;for(let e=t.length-1;e>=0;e--){const s=t[e];if('choice'!==s.type&&!s.noteContent){i=s.unitId;break}}if(i){const s=t.find(e=>e.unitId===i);s&&(s.noteContent=e.noteContent,s.noteUnitId=i,e.noteUnitId&&(s.noteUnitId=e.noteUnitId))}else{const i={unitId:`msg_${s.message_id}_unit_${o}`,unitIndex:o++,character:'',text:'',type:'narration',message_id:s.message_id,role:'system',noteContent:e.noteContent,noteUnitId:e.noteUnitId,statusBlock:n};u(i),t.push(i)}}a++}}const v=t.filter(e=>!e.isDeleted),x=g.value.length;he(v),y.value?y.value=!1:0===x&&v.length>0&&(m.value=0),console.info(` ${g.value.length} `),0===g.value.length&&de()}catch(e){console.error(':',e),de()}}function de(){console.info('');let e=0;const t=t=>({unitId:`test_unit_${e}`,unitIndex:e++,message_id:0,role:'assistant',character:'',text:'',...t});g.value=[t({character:'',text:' Galgame ',type:void 0,scene:'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=1920&h=1080&fit=crop',sprite:{type:'image',imageUrl:'/placeholder-user.jpg'}}),t({character:'',text:'',isThrough:!1}),t({character:'',text:'',type:'narration'}),t({character:'',text:'*through*  through ',isThrough:!0}),t({character:'',text:'...',type:'blackscreen'}),t({character:'',text:''}),t({character:'',text:''}),t({character:'',text:'',type:'choice',options:[{id:'opt1',text:''},{id:'opt2',text:''},{id:'opt3',text:''}]}),t({character:'',text:' Live2D '}),t({character:'',text:''}),t({character:'',text:'---  Live2D  ---',type:'narration'}),t({character:'',text:' 1 Live2D  -  + ',type:'narration',scene:''}),t({character:'',text:' Live2D """"',type:void 0,scene:'',motion:'',expression:'',sprite:{type:'live2d',live2dModelId:''}}),t({character:'',text:' 2 Live2D  -  + ',type:'narration',scene:''}),t({character:'',text:'""""',type:void 0,scene:'',motion:'',expression:'',sprite:{type:'live2d',live2dModelId:''}}),t({character:'',text:' 3 Live2D  -  + ',type:'narration',scene:''}),t({character:'',text:'""""',type:void 0,scene:'',motion:'',expression:'',sprite:{type:'live2d',live2dModelId:''}}),t({character:'',text:' 4 Live2D ',type:'narration',scene:''}),t({character:'',text:' Live2D ',type:void 0,scene:'',sprite:{type:'image',imageUrl:'https://iili.io/f01ajiN.png'}}),t({character:'',text:' 5 -  + ',type:'narration'}),t({character:'',text:'""""',type:void 0,motion:'',expression:'',sprite:{type:'live2d',live2dModelId:''}}),t({character:'',text:' 6 Live2D  -  + ',type:'narration',scene:''}),t({character:'',text:'""""',type:void 0,scene:'',motion:'',expression:'',sprite:{type:'live2d',live2dModelId:''}}),t({character:'',text:' 7 Live2D  -  + ',type:'narration',scene:''}),t({character:'',text:'""""',type:void 0,scene:'',motion:'',expression:'',sprite:{type:'live2d',live2dModelId:''}}),t({character:'',text:'--- Live2D  ---',type:'narration'}),t({character:'',text:'',type:'narration'})]}function pe(e=!1){m.value<g.value.length-1&&(m.value++,e&&(F.value=!1),U.value=!1)}function ge(){m.value>0&&(m.value--,U.value=!1)}async function me(){try{if(!document.fullscreenElement&&d.value){if(window.innerHeight>window.innerWidth&&screen.orientation&&'lock'in screen.orientation)try{await screen.orientation.lock('landscape')}catch(e){console.warn(':',e)}await d.value.requestFullscreen(),A.value=!0}else if(await document.exitFullscreen(),A.value=!1,screen.orientation&&'unlock'in screen.orientation)try{screen.orientation.unlock()}catch(e){}L.value=!1}catch(e){console.error(':',e)}}(0,i.wB)(()=>[m.value,v.value],()=>{const e=v.value;e&&('blackscreen'===e.type?(N.value=e.text,F.value=!0,U.value=!1):'choice'===e.type?(U.value=!0,F.value=!1):(F.value=!1,U.value=!1))},{immediate:!0}),(0,i.wB)(()=>[I.value,R.value,m.value,U.value,v.value],()=>{if(p.value&&(clearTimeout(p.value),p.value=null),I.value&&m.value<g.value.length-1&&!U.value){const e=v.value,t='blackscreen'===e?.type?R.value+2e3:R.value;p.value=setTimeout(()=>{pe()},t)}},{immediate:!0});const _e=()=>{A.value=!!document.fullscreenElement,(0,i.dY)(()=>{})},ve=()=>{(0,i.dY)(()=>{})},ye=[];function xe(e){const t=e.currentTarget.getBoundingClientRect();e.clientX-t.left<t.width/2?m.value>0&&(m.value--,F.value=!1):pe(!0)}function be(){C.value||L.value||U.value||F.value||pe()}(0,i.sV)(()=>{if(document.addEventListener('fullscreenchange',_e),window.addEventListener('resize',ve),window.addEventListener('orientationchange',ve),(0,i.dY)(()=>{ve()}),async function(){try{const e=new Map;try{const t=await b();console.info(`[GalgamePlayer]  ${t.models.size}  Live2D `);for(const[s,i]of t.models.entries()){const t=i.files?.model3||'',r=t.startsWith('http://')||t.startsWith('https://'),n=t.substring(0,t.lastIndexOf('/')+1),o=r?t:t?t.split('/').pop():'',a={name:s,id:s,basePath:n,modelPath:o,version:3,textures:i.files?.textures||[],motions:i.motions?.map(e=>({group:e.group??'default',name:e.name,file:e.file,index:e.index,motionType:e.motionType,textMappings:e.textMappings}))||[],expressions:i.expressions?.map(e=>e.name||e.file)||[],defaultAnimation:i.defaultAnimation,textMappings:i.textMappings};console.info(`[GalgamePlayer] : ${s}`,{modelPath:o,basePath:n,isFullUrl:r,motionsCount:a.motions.length,expressionsCount:a.expressions.length,hasTextMappings:!!a.textMappings}),e.set(s,a)}J.value=t.models}catch(e){console.warn('[GalgamePlayer] :',e)}Z.value=Array.from(e.values()),console.info(`[GalgamePlayer]  ${Z.value.length}  Live2D `),console.info('[GalgamePlayer] :',Z.value.map(e=>({id:e.id,name:e.name,modelPath:e.modelPath,basePath:e.basePath,motionsCount:e.motions?.length||0,expressionsCount:e.expressions?.length||0,hasTextMappings:!!e.textMappings})))}catch(e){console.error('[GalgamePlayer]  Live2D :',e)}}(),ue(),'function'==typeof eventOn&&'undefined'!=typeof tavern_events){const e=eventOn(tavern_events.MESSAGE_RECEIVED,async e=>{const t=Number(e);try{const e=getChatMessages(t);if(e.length>0){const t=e[0].message||'';await async function(e){const t=/<phone>([\s\S]*?)<\/phone>/gi,s=Array.from(e.matchAll(t));if(0===s.length)return;const i=new Set;try{let e=null;try{const t=getCharWorldbookNames('current');e=t.primary||t.additional[0]||null}catch(e){console.warn(':',e)}e||(e='-');let t=[];try{t=await getWorldbook(e)}catch{await createOrReplaceWorldbook(e,[]),t=[]}for(const e of s){const s=e[1].trim();if(!s)continue;const r=s.split('\n').filter(e=>e.trim()),n=new Map;for(const e of r){let t=e.match(/^(.+?)[:](.+?)\|(.+)$/),s=null,r=null,o=null,a=null;if(t){const e=t[1].trim(),n=t[2].trim(),l=t[3].trim(),h=e.match(/^(.+?)$/);if(h)s=h[1].trim(),o=n,a=l,o.includes('{{user}}')||o.includes('<user>')?(r='{{user}}',o=o.replace(/{{user}}|<user>/gi,'').trim()):r=s;else{if('{{user}}'===e||'<user>'===e)continue;s=e,r=s,o=n,a=l,i.add(s)}}else t=e.match(/^(.+?)\|(.+?)\|(.+)$/),t&&(s=t[1].trim(),o=t[2].trim(),a=t[3].trim(),r='{{user}}');s&&o&&a&&r&&(n.has(s)||n.set(s,[]),n.get(s).push({speaker:r,content:o,time:a}))}for(const[e,s]of n.entries()){const i=`${e}`;let r=t.find(e=>e.name===i);r||(r={name:i,content:'',comment:'',priority:100,enabled:!0,insertion_order:0,case_sensitive:!1,name_regex:!1,content_regex:!1,exclude_recursion:!1,display_index:0,probability:100,delay:0,delay_on:0,delay_off:0,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},position:{before:[],after:[],order:0},disable:!1,exclude:!1,uid:Date.now().toString()},t.push(r));const n=r.content||'',o=s.map(e=>`${e.speaker}${e.content}|${e.time}`),a=n?`${n}\n${o.join('\n')}`:o.join('\n');r.content=a}}t.length>0&&(await updateWorldbookWith(e,()=>t),console.info(` ${e} `)),i.size>0&&i.forEach(e=>{Te.value.add(e)})}catch(e){console.error(' phone :',e)}}(t)}}catch(e){console.warn(' phone :',e)}const s=m.value;await ue(),s<g.value.length?(m.value=s,console.info(':',s)):g.value.length>0&&(m.value=g.value.length-1,console.info(''))});e&&ye.push(()=>e.stop());const t=eventOn(tavern_events.MESSAGE_UPDATED,async()=>{await ue()});t&&ye.push(()=>t.stop());const s=eventOn(tavern_events.CHAT_CHANGED,()=>{ue(),m.value=0});s&&ye.push(()=>s.stop())}}),(0,i.hi)(()=>{document.removeEventListener('fullscreenchange',_e),window.removeEventListener('resize',ve),window.removeEventListener('orientationchange',ve),p.value&&(clearTimeout(p.value),p.value=null),ye.forEach(e=>e()),ye.length=0});const Te=(0,o.KR)(new Set),we=(0,i.EW)(()=>{if('undefined'!=typeof window&&window.getUnreadContacts){const e=window.getUnreadContacts();return e&&e.length>0}return!1});async function Ee(e){const t=c.getInputTexts(),s=c.getPhoneTexts();console.info('[GalgamePlayer] '),console.info('[GalgamePlayer] GalgamePlayer :',t.length),console.info('[GalgamePlayer] GalgamePlayer :',t.map(e=>e.text)),console.info('[GalgamePlayer] PhonePanel :',s.length),console.info('[GalgamePlayer] PhonePanel :',s.map(e=>e.text));let i='';if(t.length>0){console.info('[GalgamePlayer] ');const e=v.value?.scene||'{{scene}}';i=t.map(t=>`[[user||${e}||${t.text}]]`).join('\n\n')}else i=e;const r=X.value&&'function'==typeof X.value.getPendingMessages?X.value.getPendingMessages():'';if(r&&(i=`${i}\n\n${r}`),s.length>0){console.info('[GalgamePlayer]  PhonePanel store ');const e=new Map;for(const t of s)if(t.contact){const s=e.get(t.contact)||[];s.push(t),e.set(t.contact,s)}const t=[];for(const[s,i]of e.entries())for(const e of i)t.push(`<phone>${s}${e.text}|${e.timestamp}</phone>`);t.length>0&&(i=`${i}\n\n${t.join('\n')}`)}console.info('[GalgamePlayer] :',i),await createChatMessages([{role:'user',message:i}],{refresh:'none'}),c.clearAll(),console.info('[GalgamePlayer] ')}function Ce(e){const t=e.indexOf('<content>');if(-1!==t)return e.substring(t);const s=e.indexOf('</content>');return-1!==s?e.substring(s):e}async function Se(e){try{const t=getCurrentMessageId(),s=getChatMessages(t)[0];if(!s)return void console.warn('');const i=v.value?.scene||'{{scene}}',r=s.message+'\n\n[[user||'+i+'||'+e+']]';await setChatMessages([{message_id:t,message:r}],{refresh:'none'});const n=getLastMessageId()+1,o=g.value.length,a=`msg_${n}_unit_${o}`,l=v.value,h={unitId:a,unitIndex:o,character:'',text:e,type:'user',isEditable:!0,message_id:n,role:'user',scene:l?.scene,sceneImageUrl:l?.sceneImageUrl,sprite:l?.sprite?{...l.sprite}:void 0,motion:l?.motion,expression:l?.expression,isCG:l?.isCG,cgImageUrl:l?.cgImageUrl},u=(new Date).toISOString();c.addInputText(e,u,a);const d=[...g.value];d.splice(m.value+1,0,h),g.value=d,m.value=m.value+1,console.info(':',e)}catch(e){console.error(':',e)}}async function Ae(e,t){console.info(':',e,t);const s=v.value?.message_id;if(void 0===s)return console.warn('ID'),void pe();try{const i=getLastMessageId(),r=m.value>=g.value.length-1;let n,o='';if('custom'===e&&t?o=t.trim():(n=v.value?.options?.find(t=>t.id===e),o=n?.text||''),!o)return console.warn(''),void pe();'custom'===e&&t?await async function(e){try{const t=getChatMessages(e);if(0===t.length)return;const s=t[0].message||'',i=s.match(/<content>([\s\S]*?)<\/content>/i);if(!i)return void console.warn(' <content> ');let r=i[1];const n=/\[\[choice\|\|([^\]]+)\]\]/g;if(n.test(r)){r=r.replace(n,''),r=r.replace(/\n{3,}/g,'\n\n').trim();const t=s.replace(i[0],`<content>${r}</content>`);t!==s&&(await setChatMessages([{message_id:e,message:t}],{refresh:'none'}),console.info(''))}}catch(e){console.error(':',e)}}(s):await async function(e,t){try{const s=getChatMessages(e);if(0===s.length)return;const i=s[0].message||'',r=i.match(/<content>([\s\S]*?)<\/content>/i);if(!r)return void console.warn(' <content> ');let n=r[1],o=!1;const a=/\[\[choice\|\|([^\]]+)\]\]/g,l=[];let h;for(;null!==(h=a.exec(n));)l.push({block:h[0],content:h[1]});console.info(` ${l.length} `);for(const e of l){const s={},i=e.content.split('||');for(const e of i){const t=e.match(/^([^:]+)[:]\s*(.*)$/);if(t){const e=t[1].trim(),i=t[2].trim();s[e]=i}}const r=s['']||s.character||s['']||s.response||s.text||s['']||s.narration,a=[];for(const e in s)if(e.match(/^\d+?$/)){const t=e.replace(/^(\d+)?$/,'$1');a.push(t)}if(1===a.length&&r){const i=`${a[0]}`,r=s[i]||s[`${i}`];r&&r.trim()!==t.trim()?(n=n.replace(e.block,''),o=!0,console.info('1:',r)):r&&r.trim()===t.trim()&&console.info('1:',r)}else if(a.length>1){let i='',r=!1;for(const e of a){const n=s[`${e}`];if(n===t){i=`${e}${n}`,r=!0;break}}if(r){const s=`[[choice||${i}]]`;n=n.replace(e.block,s),o=!0,console.info('2:',t)}}}if(o){n=n.replace(/\n{3,}/g,'\n\n').trim();const t=i.replace(r[0],`<content>${n}</content>`);t!==i&&(await setChatMessages([{message_id:e,message:t}],{refresh:'none'}),console.info(''))}}catch(e){console.error(':',e)}}(s,o);if(n&&n.character&&n.response){const e=v.value?.unitId,t=g.value.findIndex(t=>t.isChoiceResponse&&t.choiceParentId===e&&'user'===t.type),i=g.value.findIndex(t=>t.isChoiceResponse&&t.choiceParentId===e&&'user'!==t.type&&'choice'!==t.type),r=v.value,a=r?.scene,l=r?.sceneImageUrl,h=r?.sprite,u=r?.motion,c=r?.expression,d=r?.isCG,p=r?.cgImageUrl;if(-1!==t)g.value[t].text=o,a&&(g.value[t].scene=a),l&&(g.value[t].sceneImageUrl=l);else{const t={unitId:void 0!==s?`msg_${s}_unit_choice_user`:'temp_unit_choice_user',unitIndex:m.value+1,character:'',text:o,type:'user',message_id:s,role:'user',isChoiceResponse:!0,choiceParentId:e,scene:a,sceneImageUrl:l},i=[...g.value];i.splice(m.value+1,0,t),g.value=i,m.value++}const f=n?.character||'',y=n?.response||'';if(-1!==i)g.value[i].character=f,g.value[i].text=y,a&&(g.value[i].scene=a),l&&(g.value[i].sceneImageUrl=l),h&&(g.value[i].sprite={...h}),u&&(g.value[i].motion=u),c&&(g.value[i].expression=c),void 0!==d&&(g.value[i].isCG=d),p&&(g.value[i].cgImageUrl=p);else{const i={unitId:void 0!==s?`msg_${s}_unit_choice_response`:'temp_unit_choice_response',unitIndex:m.value+1,character:f,text:y,type:void 0,message_id:s,role:'assistant',isChoiceResponse:!0,choiceParentId:e,scene:a,sceneImageUrl:l,sprite:h?{...h}:void 0,motion:u,expression:c,isCG:d,cgImageUrl:p},r=[...g.value],n=-1!==t?t+1:m.value+1;r.splice(n,0,i),g.value=r}}if(r){if(void 0!==s)try{const e=getChatMessages(s);if(e.length>0){const t=e[0].message||'',i=Ce(t);i!==t&&(await setChatMessages([{message_id:s,message:i}],{refresh:'none'}),console.info(' <content>...</content> '))}}catch(e){console.error(':',e)}if(void 0!==s&&s<i){const e=[];for(let t=s+1;t<=i;t++)e.push(t);e.length>0&&(await deleteChatMessages(e,{refresh:'none'}),console.info(` ${e.length} `))}await createChatMessages([{role:'user',message:o}],{refresh:'none'}),console.info(':',o),await triggerSlash('/trigger'),console.info(' AI '),await ue()}if(!r&&'custom'===e&&t){if(void 0!==s)try{const e=getChatMessages(s);if(e.length>0){const t=e[0].message||'',i=function(e){const t=e.indexOf('</content>');return-1!==t?e.substring(t+10):''}(t);i!==t&&(await setChatMessages([{message_id:s,message:i}],{refresh:'none'}),console.info('</content>'))}}catch(e){console.error(':',e)}if(void 0!==s&&s<i){const e=[];for(let t=s+1;t<=i;t++)e.push(t);e.length>0&&(await deleteChatMessages(e,{refresh:'none'}),console.info(` ${e.length} `))}await createChatMessages([{role:'user',message:o}],{refresh:'none'}),console.info(':',o),await triggerSlash('/trigger'),console.info(' AI '),await ue()}else r||pe()}catch(e){console.error(':',e),pe()}}function Pe(){const e=v.value;if(!e)return'';const t=e.text||'';return t||''}const Ie=(0,o.KR)(!1),Re=(0,o.KR)([]);async function Le(){L.value=!1,Ie.value=!0;try{const e=getLastMessageId(),t=[];for(let s=0;s<=e;s++)try{const e=getChatMessages(s);if(e.length>0){const i=e[0],r=i.message||'',n=await M(r,void 0,K.value),o=[];for(const e of n)if('character'===e.type&&e.character&&e.text)o.push({type:'character',character:e.character,text:e.text});else if('user'===e.type){const t='message'in e?e.message:e.text;t&&o.push({type:'user',character:'',text:t})}else if('narration'===e.type){const t='message'in e?e.message:e.text;t&&o.push({type:'narration',text:t})}else if('blacktext'===e.type){const t='message'in e?e.message:e.text;t&&o.push({type:'blacktext',text:t})}else'choice'===e.type&&(e.choiceText||e.text)&&o.push({type:'choice',text:e.choiceText||e.text||''});if(0===o.length){const e=r.replace(/\[\[[^\]]+\]\]/g,'').replace(/<[^>]+>/g,'').trim();e&&o.push({type:'user'===i.role?'user':'character',character:'user'===i.role?'':'AI',text:e})}o.length>0&&t.push({id:s,role:i.role||'user',items:o})}}catch(e){console.warn(` ${s} :`,e)}Re.value=t.reverse(),console.info(` ${Re.value.length} `)}catch(e){console.error(':',e)}}function De(){q.value={...Q.value}}function Be(){L.value?(G.value||(Q.value={...q.value}),C.value=!0,L.value=!1):L.value=!0}function Fe(){k.value?(D.value=!0,k.value=!1):k.value=!0}function Oe(){B.value=!0,k.value=!1}function Ne(){B.value=!0,k.value=!1,(0,i.dY)(()=>{})}function Ue(){V.value=!0,k.value=!1,(0,i.dY)(()=>{W.value?.focus()})}async function Ge(){if(!H.value.trim())return;const e=H.value.trim(),t=(new Date).toISOString();H.value='',V.value=!1;const s=v.value?.message_id,i=getLastMessageId();if(void 0!==s)try{const e=getChatMessages(s);if(e.length>0){const t=e[0].message||'',i=Ce(t);i!==t&&(await setChatMessages([{message_id:s,message:i}],{refresh:'none'}),console.info(' <content>...</content> '))}if(s<i){const e=[];for(let t=s+1;t<=i;t++)e.push(t);e.length>0&&(await deleteChatMessages(e,{refresh:'none'}),console.info(` ${e.length} `))}}catch(e){console.error(':',e)}const r=getLastMessageId()+1,n=g.value.length,o=v.value,a=`msg_${r}_unit_${n}`,l={unitId:a,unitIndex:n,character:'',text:e,type:'user',isEditable:!0,message_id:r,role:'user',scene:o?.scene,sceneImageUrl:o?.sceneImageUrl,sprite:o?.sprite?{...o.sprite}:void 0,motion:o?.motion,expression:o?.expression,isCG:o?.isCG,cgImageUrl:o?.cgImageUrl},h=(c.addInputText(e,t,a),[...g.value]);h.splice(m.value+1,0,l),g.value=h,m.value=m.value+1;try{await async function(){if(0===ae.value.size)return;try{for(const[e,t]of ae.value.entries())t.deleted?(await deleteChatMessages([e],{refresh:'none'}),console.info(':',e)):t.text&&(await $e(e,t.text),console.info(':',e));ae.value.clear()}catch(e){console.error(':',e)}}();const t=`[[user||${v.value?.scene||'{{scene}}'}||${e}]]`;await Ee(t),console.info(':',e),await triggerSlash('/trigger'),console.info(' AI '),await ue();getLastMessageId()>i&&(c.clearByUnitId(a),console.info('[GalgamePlayer] :',a))}catch(e){console.error(':',e)}}async function Ve(){if(!H.value.trim())return;const e=H.value.trim();H.value='',V.value=!1,await Se(e)}async function He(e,t){try{await $e(e,t),ae.value.set(e,{text:t});const s=g.value.findIndex(t=>t.message_id===e);if(-1!==s){const e=[...g.value],i=e[s];e[s]={...i,text:t},g.value=e,i.unitId&&(c.updateTextByUnitId(i.unitId,t),console.info('[GalgamePlayer] :',i.unitId,t))}console.info(':',e,t)}catch(e){console.error(':',e)}}async function We(e){try{ae.value.set(e,{deleted:!0});const t=g.value.findIndex(t=>t.message_id===e);if(-1!==t){const e=[...g.value];e.splice(t,1),g.value=e,m.value>=e.length&&(m.value=Math.max(0,e.length-1))}console.info(':',e)}catch(e){console.error(':',e)}}async function $e(e,t){try{const s=getChatMessages(e);if(s.length>0){const i=s[0].message||'',r=i.match(/<content>([\s\S]*?)<\/content>/i),n=r?r[1]:i,o=/\[\[user\|\|([^\]]+)\]\]/g;let a,l=i,h=!1;for(;null!==(a=o.exec(n));){const e=a[1],s={},o=e.split('||').map(e=>e.trim()).filter(e=>e);for(const e of o){const t=e.match(/^([^:]+)[:]\s*(.+)$/);if(t){const e=t[1].trim(),i=t[2].trim();e&&i&&(s[e]=i)}}if(s['']||s.scene||s['']||s['']||s['']||s.text){const e=s['']||s.scene||'{{scene}}',o=a[0],u=`[[user||${e}||${t}]]`;if(r){const e=n.replace(o,u);l=i.replace(r[0],`<content>${e}</content>`)}else l=i.replace(o,u);h=!0;break}}if(!h)if(r){const e=n+`\n[[user||{{scene}}||${t}]]`;l=i.replace(r[0],`<content>${e}</content>`)}else l=i+`\n[[user||{{scene}}||${t}]]`;await setChatMessages([{message_id:e,message:l}],{refresh:'none'}),console.info(':',e,t)}}catch(e){console.error(':',e)}}return(e,t)=>((0,i.uX)(),(0,i.CE)('div',{ref_key:'containerRef',ref:d,class:'relative w-full overflow-hidden select-none',style:(0,r.Tr)([se.value,{background:'transparent'}])},[(0,i.Q3)('  '),(0,i.Lk)('div',{class:'absolute inset-0 bg-center bg-no-repeat',style:(0,r.Tr)({backgroundImage:ie.value?`url('${ie.value}')`:void 0,backgroundColor:'transparent',backgroundSize:ie.value?'cover':void 0,backgroundPosition:'center',backgroundRepeat:'no-repeat',objectFit:'cover'})},null,4),(0,i.Q3)('  '),t[23]||(t[23]=(0,i.Lk)('div',{class:'bg-primary/5 absolute inset-0'},null,-1)),(0,i.Q3)('  '),(0,i.bF)(O,{'sprite-scale':j.value.scale,'sprite-position-x':j.value.positionX,'sprite-position-y':j.value.positionY,'live2d-scale':Y.value.scale,'live2d-position-x':Y.value.positionX,'live2d-position-y':Y.value.positionY,'sprite-type':re.value,'image-url':ne.value,'live2d-model-id':oe.value,'live2d-models':Z.value,motion:v.value?.motion,expression:v.value?.expression},null,8,['sprite-scale','sprite-position-x','sprite-position-y','live2d-scale','live2d-position-x','live2d-position-y','sprite-type','image-url','live2d-model-id','live2d-models','motion','expression']),(0,i.Q3)(' CGCG '),v.value?.isCG&&v.value.cgImageUrl?((0,i.uX)(),(0,i.CE)('div',{key:0,class:'absolute inset-0 z-5 bg-cover bg-center',style:(0,r.Tr)({backgroundImage:`url('${v.value.cgImageUrl}')`})},null,4)):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),(0,i.Lk)('div',Ys,[(0,i.Q3)('  '),(0,i.Lk)('button',{class:(0,r.C4)(['bg-card/80 text-foreground flex items-center gap-2 rounded-full p-2 shadow-lg backdrop-blur-sm transition-all hover:bg-card',k.value?'pr-4':'']),'aria-label':'',onClick:(0,n.D$)(Fe,['stop'])},[(0,i.Q3)('  SVG '),t[8]||(t[8]=(0,i.Lk)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z'})],-1)),k.value?((0,i.uX)(),(0,i.CE)('span',qs,'')):(0,i.Q3)('v-if',!0)],2),(0,i.Q3)('  '),k.value?((0,i.uX)(),(0,i.CE)('button',{key:0,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card',style:{'animation-delay':'25ms'},'aria-label':'',onClick:(0,n.D$)(Oe,['stop'])},[...t[9]||(t[9]=[(0,i.Lk)('svg',{class:'h-5 w-5',viewBox:'0 0 1024 1024',version:'1.1',xmlns:'http://www.w3.org/2000/svg',fill:'currentColor'},[(0,i.Lk)('path',{d:'M820.409449 797.228346q0 25.19685-10.07874 46.866142t-27.716535 38.299213-41.322835 26.204724-50.897638 9.574803l-357.795276 0q-27.212598 0-50.897638-9.574803t-41.322835-26.204724-27.716535-38.299213-10.07874-46.866142l0-675.275591q0-25.19685 10.07874-47.370079t27.716535-38.80315 41.322835-26.204724 50.897638-9.574803l357.795276 0q27.212598 0 50.897638 9.574803t41.322835 26.204724 27.716535 38.80315 10.07874 47.370079l0 675.275591zM738.771654 170.330709l-455.559055 0 0 577.511811 455.559055 0 0-577.511811zM510.992126 776.062992q-21.165354 0-36.787402 15.11811t-15.622047 37.291339q0 21.165354 15.622047 36.787402t36.787402 15.622047q22.173228 0 37.291339-15.622047t15.11811-36.787402q0-22.173228-15.11811-37.291339t-37.291339-15.11811zM591.622047 84.661417q0-8.062992-5.03937-12.598425t-11.086614-4.535433l-128 0q-5.03937 0-10.582677 4.535433t-5.543307 12.598425 5.03937 12.598425 11.086614 4.535433l128 0q6.047244 0 11.086614-4.535433t5.03937-12.598425z'})],-1),(0,i.Lk)('span',{class:'text-sm'},'',-1)])])):(0,i.Q3)('v-if',!0),k.value?((0,i.uX)(),(0,i.CE)('button',{key:1,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card',style:{'animation-delay':'75ms'},'aria-label':'',onClick:(0,n.D$)(Ue,['stop'])},[...t[10]||(t[10]=[(0,i.Lk)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z'})],-1),(0,i.Lk)('span',{class:'text-sm'},'',-1)])])):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),we.value?((0,i.uX)(),(0,i.CE)('button',{key:2,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center justify-center rounded-full p-2 shadow-lg backdrop-blur-sm transition-all duration-200 hover:bg-card hover:scale-110',style:{'animation-delay':'100ms'},'aria-label':'',onClick:(0,n.D$)(Ne,['stop'])},[...t[11]||(t[11]=[(0,i.Lk)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M7 4h10a1 1 0 011 1v14a1 1 0 01-1 1H7a1 1 0 01-1-1V5a1 1 0 011-1z'}),(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M11 5h2m-2 14h2'})],-1)])])):(0,i.Q3)('v-if',!0)]),(0,i.Q3)('  '),(0,i.Lk)('div',Qs,[(0,i.Q3)('  '),(0,i.Lk)('button',{class:(0,r.C4)(['bg-card/80 text-foreground flex items-center gap-2 rounded-full p-2 shadow-lg backdrop-blur-sm transition-all hover:bg-card',L.value?'pr-4':'']),'aria-label':'',onClick:Be},[t[12]||(t[12]=(0,i.Lk)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z'}),(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 12a3 3 0 11-6 0 3 3 0 016 0z'})],-1)),L.value?((0,i.uX)(),(0,i.CE)('span',Ks,'')):(0,i.Q3)('v-if',!0)],2),(0,i.Q3)('  '),L.value?((0,i.uX)(),(0,i.CE)('button',{key:0,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card','aria-label':A.value?'':'',onClick:me},[A.value?((0,i.uX)(),(0,i.CE)('svg',Js,[...t[13]||(t[13]=[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25'},null,-1)])])):((0,i.uX)(),(0,i.CE)('svg',ei,[...t[14]||(t[14]=[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4'},null,-1)])])),(0,i.Lk)('span',ti,(0,r.v_)(A.value?'':''),1)],8,Zs)):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),L.value?((0,i.uX)(),(0,i.CE)('button',{key:1,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card',style:{'animation-delay':'50ms'},'aria-label':'',onClick:Le},[...t[15]||(t[15]=[(0,i.Lk)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z'})],-1),(0,i.Lk)('span',{class:'text-sm'},'',-1)])])):(0,i.Q3)('v-if',!0)]),(0,i.Q3)('  '),(0,i.Lk)('div',{class:'absolute inset-0 z-10 cursor-pointer',onClick:be}),(0,i.Q3)('  '),L.value||k.value?((0,i.uX)(),(0,i.CE)('div',{key:1,class:'absolute inset-0 z-40',onClick:t[0]||(t[0]=e=>{L.value=!1,k.value=!1})})):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),(0,i.Lk)('div',{class:(0,r.C4)(['absolute inset-0 z-30 flex items-center justify-center bg-black transition-opacity duration-1000',F.value?'opacity-100':'pointer-events-none opacity-0']),onClick:xe},[(0,i.Lk)('p',si,(0,r.v_)(N.value),1),(0,i.Q3)('  '),F.value?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[t[16]||(t[16]=(0,i.Fv)('<div class="absolute top-1/2 left-6 -translate-y-1/2 text-white/40 transition-colors hover:text-white/60" data-v-466895fe><svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-466895fe><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" data-v-466895fe></path></svg></div><div class="absolute top-1/2 right-6 -translate-y-1/2 text-white/40 transition-colors hover:text-white/60" data-v-466895fe><svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-466895fe><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" data-v-466895fe></path></svg></div>',2))],64)):(0,i.Q3)('v-if',!0)],2),(0,i.Q3)('  '),U.value&&v.value?.options?((0,i.uX)(),(0,i.Wv)(fe,{key:2,options:v.value.options,'custom-style':q.value,'on-select':Ae,'on-prev':ge,'on-next':()=>pe(),'on-save':Se},null,8,['options','custom-style','on-next'])):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),!F.value&&!U.value&&v.value&&x.value&&'blackscreen'!==v.value.type&&'choice'!==v.value.type?((0,i.uX)(),(0,i.CE)('div',ii,[(0,i.bF)(ke,{content:x.value,'note-unit-id':T.value,'initial-position':w.value,onPositionChange:E},null,8,['content','note-unit-id','initial-position'])])):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),!F.value&&!U.value&&v.value&&'blackscreen'!==v.value.type&&'choice'!==v.value.type&&Pe()?((0,i.uX)(),(0,i.Wv)(Me,{key:4,character:v.value.character||'',text:Pe(),'is-last-dialogue':m.value>=g.value.length-1,'is-first-dialogue':0===m.value,'on-prev':ge,'on-next':pe,'dialog-key':m.value,'custom-style':q.value,'is-loading':!1,'streaming-text':void 0,'is-through':v.value.isThrough,'is-editable':v.value.isEditable,'message-id':v.value.message_id,'on-edit':He,'on-delete':We},null,8,['character','text','is-last-dialogue','is-first-dialogue','dialog-key','custom-style','is-through','is-editable','message-id'])):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),C.value?((0,i.uX)(),(0,i.Wv)(zs,{key:5,'on-close':()=>C.value=!1,'user-display-name':K.value,'on-user-display-name-change':e=>{K.value=e,te(u,e)},'sprite-settings':j.value,'on-sprite-settings-change':e=>j.value=e,'live2d-settings':Y.value,'on-live2d-settings-change':e=>Y.value=e,'auto-play':I.value,'on-auto-play-change':e=>I.value=e,'auto-play-speed':R.value,'on-auto-play-speed-change':e=>R.value=e,'dialog-style':Q.value,'on-dialog-style-change':e=>Q.value=e,'on-save-style':De,'current-applied-style':q.value,'custom-mode-enabled':G.value,'on-custom-mode-change':e=>G.value=e},null,8,['on-close','user-display-name','on-user-display-name-change','sprite-settings','on-sprite-settings-change','live2d-settings','on-live2d-settings-change','auto-play','on-auto-play-change','auto-play-speed','on-auto-play-speed-change','dialog-style','on-dialog-style-change','current-applied-style','custom-mode-enabled','on-custom-mode-change'])):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),(0,i.bF)(ce,{show:D.value,'message-id':v.value?.message_id,'status-block':v.value?.statusBlock,'on-close':()=>D.value=!1},null,8,['show','message-id','status-block','on-close']),(0,i.Q3)('  +  '),(0,i.bF)(ht,{ref_key:'phonePanelRef',ref:X,show:B.value,'message-id':v.value?.message_id,'status-block':v.value?.statusBlock,'on-close':()=>B.value=!1},null,8,['show','message-id','status-block','on-close']),(0,i.Q3)('  '),Ie.value?((0,i.uX)(),(0,i.CE)('div',{key:6,class:'fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm',onClick:t[2]||(t[2]=(0,n.D$)(e=>Ie.value=!1,['self']))},[(0,i.Lk)('div',ri,[(0,i.Q3)('  '),(0,i.Lk)('div',ni,[t[18]||(t[18]=(0,i.Lk)('h2',{class:'text-lg font-medium'},'',-1)),(0,i.Lk)('button',{class:'hover:bg-muted rounded-full p-1 transition-colors','aria-label':'',onClick:t[1]||(t[1]=e=>Ie.value=!1)},[...t[17]||(t[17]=[(0,i.Lk)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),(0,i.Q3)('  '),(0,i.Lk)('div',oi,[0===Re.value.length?((0,i.uX)(),(0,i.CE)('div',ai,'  ')):(0,i.Q3)('v-if',!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(Re.value,(e,s)=>((0,i.uX)(),(0,i.CE)(i.FK,{key:e.id},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.items,(n,o)=>{return(0,i.uX)(),(0,i.CE)('div',{key:`${e.id}-${o}`,class:'history-message-item group relative cursor-pointer rounded px-3 py-2 transition-all',onClick:t=>async function(e){try{Ie.value=!1;const t=m.value;y.value=!0,await ue(),await(0,i.dY)();let s=-1;if(s=g.value.findIndex(t=>t.message_id===e),s<0){const t=g.value.map((e,t)=>({dialogue:e,index:t})).filter(({dialogue:t})=>t.message_id===e);t.length>0&&(s=t[0].index)}s>=0?(m.value=s,await(0,i.dY)(),console.info(` ${e} ${s}: ${g.value.length}`)):(console.warn(` ${e} : ${g.value.length}`,' message_id :',g.value.map((e,t)=>({index:t,message_id:e.message_id})).slice(0,10)),t>=0&&t<g.value.length?(m.value=t,console.info(` ${t}`)):g.value.length>0&&(m.value=0,console.info('')))}catch(e){console.error(':',e),y.value=!1}}(e.id)},[(0,i.Q3)('  '),'character'===n.type||'user'===n.type?((0,i.uX)(),(0,i.CE)('div',{key:0,class:'leading-relaxed',style:(0,r.Tr)({color:q.value.colors.dialogText,fontSize:`${q.value.fontSize}px`})},[(0,i.Lk)('span',hi,(0,r.v_)(n.character)+'',1),(0,i.Lk)('span',{innerHTML:(a=n.text,a?a.replace(/\*([^*]+)\*/g,(e,t)=>'through'===t.trim()?e:` <span style="color: #9ca3af; font-style: italic;">${t}</span> `):'')},null,8,ui)],4)):'narration'===n.type?((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.Q3)('  '),(0,i.Lk)('div',{class:'ml-6 leading-relaxed italic',style:(0,r.Tr)({color:q.value.colors.narrationText,fontSize:`${q.value.fontSize}px`})},(0,r.v_)(n.text),5)],2112)):'blacktext'===n.type?((0,i.uX)(),(0,i.CE)(i.FK,{key:2},[(0,i.Q3)('  '),(0,i.Lk)('div',{class:'ml-6 leading-relaxed italic opacity-70',style:(0,r.Tr)({color:q.value.colors.narrationText,fontSize:`${q.value.fontSize}px`})},(0,r.v_)(n.text),5)],2112)):'choice'===n.type?((0,i.uX)(),(0,i.CE)(i.FK,{key:3},[(0,i.Q3)('  '),(0,i.Lk)('div',{class:'leading-relaxed',style:(0,r.Tr)({color:q.value.colors.dialogText,fontSize:`${q.value.fontSize}px`})},[t[19]||(t[19]=(0,i.Lk)('span',{class:'font-medium'},'',-1)),(0,i.Lk)('span',null,(0,r.v_)(n.text),1)],4)],2112)):(0,i.Q3)('v-if',!0),(0,i.Q3)(' hover '),o<e.items.length-1||s<Re.value.length-1?((0,i.uX)(),(0,i.CE)('div',ci)):(0,i.Q3)('v-if',!0)],8,li);var a}),128))],64))),128))])])])):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),V.value?((0,i.uX)(),(0,i.CE)('div',{key:7,class:'absolute inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm',onClick:t[7]||(t[7]=()=>V.value=!1)},[(0,i.Lk)('div',{class:'relative mx-4 w-full max-w-lg p-4',style:(0,r.Tr)({backgroundColor:'pill'===q.value.boxShape?'rgba(255, 255, 255, 0.85)':q.value.colors.boxBackground,borderRadius:'16px',borderWidth:'1px',borderStyle:'solid',borderColor:q.value.colors.boxBorder,boxShadow:'0 8px 32px rgba(0,0,0,0.15)',backdropFilter:'pill'===q.value.boxShape?'blur(12px)':void 0}),onClick:t[6]||(t[6]=(0,n.D$)(()=>{},['stop']))},[(0,i.Q3)('  '),(0,i.Lk)('button',{class:'absolute top-2 right-2 rounded-full p-1 transition-colors hover:bg-black/5',onClick:t[3]||(t[3]=()=>V.value=!1)},[...t[20]||(t[20]=[(0,i.Lk)('svg',{class:'text-muted-foreground h-4 w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,i.Lk)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])]),(0,i.Q3)('  '),(0,i.Lk)('div',{class:'mb-3 inline-block px-3 py-1 text-sm font-medium',style:(0,r.Tr)({backgroundColor:q.value.colors.nameBackground,color:q.value.colors.nameText,borderRadius:'6px'})},'  ',4),(0,i.Q3)('  '),(0,i.Lk)('div',di,[(0,i.bo)((0,i.Lk)('input',{ref_key:'inputRef',ref:W,'onUpdate:modelValue':t[4]||(t[4]=e=>H.value=e),type:'text',placeholder:'...',class:'flex-1 bg-transparent text-base outline-none',style:(0,r.Tr)({color:q.value.colors.dialogText}),onKeydown:[(0,n.jR)(Ge,['enter']),t[5]||(t[5]=(0,n.jR)(()=>V.value=!1,['escape']))]},null,36),[[n.Jo,H.value]]),(0,i.Q3)('  '),H.value.trim()?((0,i.uX)(),(0,i.CE)('button',{key:0,class:'p-1 transition-colors hover:opacity-80',style:(0,r.Tr)({color:q.value.colors.nameText}),'aria-label':'',title:'',onClick:(0,n.D$)(Ve,['stop'])},[...t[21]||(t[21]=[(0,i.Lk)('svg',{class:'h-6 w-6',viewBox:'0 0 1024 1024',version:'1.1',xmlns:'http://www.w3.org/2000/svg',fill:'currentColor'},[(0,i.Lk)('path',{d:'M170.666667 128h597.333333l115.498667 115.498667a42.666667 42.666667 0 0 1 12.501333 30.165333V853.333333a42.666667 42.666667 0 0 1-42.666667 42.666667H170.666667a42.666667 42.666667 0 0 1-42.666667-42.666667V170.666667a42.666667 42.666667 0 0 1 42.666667-42.666667z m128 42.666667v213.333333h384V170.666667H298.666667z m-42.666667 341.333333v298.666667h512v-298.666667H256z m298.666667-298.666667h85.333333v128h-85.333333V213.333333z'})],-1)])],4)):(0,i.Q3)('v-if',!0),(0,i.Q3)('  '),H.value.trim()?((0,i.uX)(),(0,i.CE)('button',{key:1,class:'p-1 transition-colors hover:opacity-80',style:(0,r.Tr)({color:q.value.colors.nameText}),'aria-label':'',onClick:(0,n.D$)(Ge,['stop'])},[...t[22]||(t[22]=[(0,i.Lk)('svg',{class:'h-5 w-5',viewBox:'0 0 1024 1024',version:'1.1',xmlns:'http://www.w3.org/2000/svg',fill:'currentColor'},[(0,i.Lk)('path',{d:'M1023.200312 43.682936L877.057399 920.640375c-1.899258 10.995705-8.096837 19.592347-18.292854 25.689965-5.29793 2.898868-11.295588 4.598204-17.693089 4.598204-4.19836 0-8.796564-0.99961-13.69465-2.898868l-236.707536-96.762202c-12.994924-5.29793-27.889106-1.499414-36.785631 9.296368l-123.251855 150.341273c-6.897306 8.796564-16.293635 13.094885-27.989066 13.094885-4.898087 0-9.096447-0.799688-12.695041-2.299102-7.197189-2.698946-12.994924-6.997267-17.393206-13.394768-4.398282-6.29754-6.697384-13.194846-6.697384-20.891839V811.083171c0-14.794221 5.098009-28.988676 14.394377-40.484186l478.912925-587.070676-602.864506 521.796174c-4.598204 3.898477-10.995705 4.998048-16.493557 2.698945L23.390863 619.358063C9.296369 614.060133 1.599375 603.664194 0.599766 587.870363c-0.799688-15.194065 5.29793-26.489652 18.292854-33.786802L968.921515 5.997657c5.797735-3.498633 11.795392-5.098009 18.292854-5.098008 7.696993 0 14.594299 2.199141 20.691918 6.397501 12.695041 8.996486 17.593128 21.291683 15.294025 36.385786z'})],-1)])],4)):(0,i.Q3)('v-if',!0)])],4)])):(0,i.Q3)('v-if',!0)],4))}}),fi=(0,B.A)(pi,[['__scopeId','data-v-466895fe']])},395(e,t,s){function i(e){const t=Object.create(null);for(const s of e.split(','))t[s]=1;return e=>e in t}s.d(t,{$3:()=>p,$H:()=>N,BH:()=>j,BX:()=>ie,Bm:()=>T,C4:()=>J,CE:()=>g,CP:()=>h,DY:()=>U,Gv:()=>w,J$:()=>te,Kg:()=>b,MZ:()=>r,Mp:()=>l,NO:()=>a,Oj:()=>n,PT:()=>k,Qd:()=>M,Ro:()=>H,SU:()=>I,TF:()=>c,Tg:()=>B,Tn:()=>x,Tr:()=>Y,We:()=>X,X$:()=>u,Y2:()=>se,ZH:()=>F,Zf:()=>A,bB:()=>V,cy:()=>f,gd:()=>y,pD:()=>i,rU:()=>O,tE:()=>o,u3:()=>re,vM:()=>m,v_:()=>oe,yI:()=>P,yL:()=>E,yQ:()=>G});const r={},n=[],o=()=>{},a=()=>!1,l=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),h=e=>e.startsWith('onUpdate:'),u=Object.assign,c=(e,t)=>{const s=e.indexOf(t);s>-1&&e.splice(s,1)},d=Object.prototype.hasOwnProperty,p=(e,t)=>d.call(e,t),f=Array.isArray,g=e=>'[object Map]'===S(e),m=e=>'[object Set]'===S(e),v=e=>'[object Date]'===S(e),y=e=>'[object RegExp]'===S(e),x=e=>'function'==typeof e,b=e=>'string'==typeof e,T=e=>'symbol'==typeof e,w=e=>null!==e&&'object'==typeof e,E=e=>(w(e)||x(e))&&x(e.then)&&x(e.catch),C=Object.prototype.toString,S=e=>C.call(e),A=e=>S(e).slice(8,-1),M=e=>'[object Object]'===S(e),P=e=>b(e)&&'NaN'!==e&&'-'!==e[0]&&''+parseInt(e,10)===e,I=i(',key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted'),R=e=>{const t=Object.create(null);return s=>t[s]||(t[s]=e(s))},L=/-\w/g,k=R(e=>e.replace(L,e=>e.slice(1).toUpperCase())),D=/\B([A-Z])/g,B=R(e=>e.replace(D,'-$1').toLowerCase()),F=R(e=>e.charAt(0).toUpperCase()+e.slice(1)),O=R(e=>e?`on${F(e)}`:''),N=(e,t)=>!Object.is(e,t),U=(e,...t)=>{for(let s=0;s<e.length;s++)e[s](...t)},G=(e,t,s,i=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:i,value:s})},V=e=>{const t=parseFloat(e);return isNaN(t)?e:t},H=e=>{const t=b(e)?Number(e):NaN;return isNaN(t)?e:t};let W;const X=()=>W||(W='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof self?self:'undefined'!=typeof window?window:'undefined'!=typeof globalThis?globalThis:{});const j=i('Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error,Symbol');function Y(e){if(f(e)){const t={};for(let s=0;s<e.length;s++){const i=e[s],r=b(i)?Z(i):Y(i);if(r)for(const e in r)t[e]=r[e]}return t}if(b(e)||w(e))return e}const q=/;(?![^(]*\))/g,Q=/:([^]+)/,K=/\/\*[^]*?\*\//g;function Z(e){const t={};return e.replace(K,'').split(q).forEach(e=>{if(e){const s=e.split(Q);s.length>1&&(t[s[0].trim()]=s[1].trim())}}),t}function J(e){let t='';if(b(e))t=e;else if(f(e))for(let s=0;s<e.length;s++){const i=J(e[s]);i&&(t+=i+' ')}else if(w(e))for(const s in e)e[s]&&(t+=s+' ');return t.trim()}const ee='itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly',te=i(ee);function se(e){return!!e||''===e}function ie(e,t){if(e===t)return!0;let s=v(e),i=v(t);if(s||i)return!(!s||!i)&&e.getTime()===t.getTime();if(s=T(e),i=T(t),s||i)return e===t;if(s=f(e),i=f(t),s||i)return!(!s||!i)&&function(e,t){if(e.length!==t.length)return!1;let s=!0;for(let i=0;s&&i<e.length;i++)s=ie(e[i],t[i]);return s}(e,t);if(s=w(e),i=w(t),s||i){if(!s||!i)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e){const i=e.hasOwnProperty(s),r=t.hasOwnProperty(s);if(i&&!r||!i&&r||!ie(e[s],t[s]))return!1}}return String(e)===String(t)}function re(e,t){return e.findIndex(e=>ie(e,t))}const ne=e=>!(!e||!0!==e.__v_isRef),oe=e=>b(e)?e:null==e?'':f(e)||w(e)&&(e.toString===C||!x(e.toString))?ne(e)?oe(e.value):JSON.stringify(e,ae,2):String(e),ae=(e,t)=>ne(t)?ae(e,t.value):g(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((e,[t,s],i)=>(e[le(t,i)+' =>']=s,e),{})}:m(t)?{[`Set(${t.size})`]:[...t.values()].map(e=>le(e))}:T(t)?le(t):!w(t)||f(t)||M(t)?t:String(t),le=(e,t='')=>{var s;return T(e)?`Symbol(${null!=(s=e.description)?s:t})`:e}},502(e,t){t.A=(e,t)=>{const s=e.__vccOpts||e;for(const[e,i]of t)s[e]=i;return s}},609(e,a,l){l.d(a,{Gk:()=>w,CI:()=>ar,aV:()=>lr,nW:()=>Ct,B9:()=>p,wn:()=>d,yw:()=>I,sN:()=>Ms,jH:()=>Ds,LE:()=>ks,t5:()=>bt,hq:()=>Tt,JH:()=>Rt,ch:()=>Cs,LQ:()=>bs,A6:()=>Ps,cc:()=>Ts,OF:()=>R,hp:()=>Et,dZ:()=>vt,yn:()=>ir,fr:()=>E,Eq:()=>M,Bu:()=>hr,jl:()=>Ut,Q1:()=>Te,bD:()=>Rs,WQ:()=>cr,Td:()=>Dt,_4:()=>f,Km:()=>u,Pp:()=>Gt,Ag:()=>nt,hR:()=>g,dJ:()=>As,OO:()=>$s,u9:()=>zs,GW:()=>Ls,nj:()=>Qs,OS:()=>C,pq:()=>Ys,_H:()=>yi,Ru:()=>Hi,yI:()=>fi,V2:()=>It,kb:()=>Zs,n1:()=>vi,Ln:()=>ft,di:()=>dr,Gj:()=>Bs,vg:()=>A,E8:()=>T,he:()=>P,XN:()=>si,iW:()=>ii,uq:()=>Wt,DT:()=>tr,Pt:()=>ws,IH:()=>rr,oA:()=>Zt,TO:()=>Lt,Pk:()=>S,$o:()=>ui,bR:()=>Ft,tS:()=>Vt,BP:()=>_s,hk:()=>ci,kO:()=>Hs,X1:()=>Ws,bO:()=>kt,h3:()=>c,M_:()=>Nt,Y7:()=>Gs,O1:()=>Vs,Bw:()=>_i,A4:()=>or,FW:()=>_t,TE:()=>Ht,by:()=>mt,XZ:()=>y,M6:()=>x,HY:()=>Bt,$f:()=>fr,s9:()=>li,Mt:()=>xs,$P:()=>Bi,ah:()=>ti,fE:()=>Fi,Uw:()=>pt,D8:()=>Ni,iH:()=>hi,zi:()=>Ui,dW:()=>m,QE:()=>v,gP:()=>Us,lB:()=>Vi,NW:()=>ei,vB:()=>Wi,OE:()=>Fs,Rv:()=>qi,y:()=>Qi,dL:()=>es,wF:()=>_r,vT:()=>$i,dQ:()=>ji,k2:()=>ys,xv:()=>vr,A5:()=>mr,vr:()=>Xi,u3:()=>ht,uR:()=>b,q5:()=>Zi,Nc:()=>gt,uC:()=>dt,_J:()=>Mi,Eo:()=>er,MT:()=>Ji,XO:()=>lt,CF:()=>Ei,He:()=>Ii,WD:()=>as,RO:()=>Pi,ER:()=>Kt,Fr:()=>k,W0:()=>L,$Z:()=>ts,ff:()=>Li,Wp:()=>h});var h={};l.r(h),l.d(h,{BaseTextureCache:()=>Ye,BoundingBox:()=>Xe,CanvasRenderTarget:()=>Ke,DATA_URI:()=>Le,EventEmitter:()=>s,ProgramCache:()=>je,TextureCache:()=>ze,clearTextureCache:()=>Qe,correctBlendMode:()=>Me,createIndicesForQuads:()=>ke,decomposeDataUri:()=>st,deprecation:()=>B,destroyTextureCache:()=>qe,detectVideoAlphaMode:()=>H,determineCrossOrigin:()=>it,earcut:()=>i,getBufferType:()=>De,getCanvasBoundingBox:()=>et,getResolutionOfUrl:()=>rt,hex2rgb:()=>we,hex2string:()=>Ee,interleaveTypedArrays:()=>Fe,isMobile:()=>k,isPow2:()=>Ne,isWebGLSupported:()=>j,log2:()=>Ue,nextPow2:()=>Oe,path:()=>U,premultiplyBlendMode:()=>Ae,premultiplyRgba:()=>Pe,premultiplyTint:()=>Ie,premultiplyTintToRgba:()=>Re,removeItems:()=>Ge,rgb2hex:()=>Se,sayHello:()=>X,sign:()=>Ve,skipHello:()=>W,string2hex:()=>Ce,trimCanvas:()=>tt,uid:()=>We,url:()=>F});var u=(e=>(e[e.WEBGL_LEGACY=0]='WEBGL_LEGACY',e[e.WEBGL=1]='WEBGL',e[e.WEBGL2=2]='WEBGL2',e))(u||{}),c=(e=>(e[e.UNKNOWN=0]='UNKNOWN',e[e.WEBGL=1]='WEBGL',e[e.CANVAS=2]='CANVAS',e))(c||{}),d=(e=>(e[e.COLOR=16384]='COLOR',e[e.DEPTH=256]='DEPTH',e[e.STENCIL=1024]='STENCIL',e))(d||{}),p=(e=>(e[e.NORMAL=0]='NORMAL',e[e.ADD=1]='ADD',e[e.MULTIPLY=2]='MULTIPLY',e[e.SCREEN=3]='SCREEN',e[e.OVERLAY=4]='OVERLAY',e[e.DARKEN=5]='DARKEN',e[e.LIGHTEN=6]='LIGHTEN',e[e.COLOR_DODGE=7]='COLOR_DODGE',e[e.COLOR_BURN=8]='COLOR_BURN',e[e.HARD_LIGHT=9]='HARD_LIGHT',e[e.SOFT_LIGHT=10]='SOFT_LIGHT',e[e.DIFFERENCE=11]='DIFFERENCE',e[e.EXCLUSION=12]='EXCLUSION',e[e.HUE=13]='HUE',e[e.SATURATION=14]='SATURATION',e[e.COLOR=15]='COLOR',e[e.LUMINOSITY=16]='LUMINOSITY',e[e.NORMAL_NPM=17]='NORMAL_NPM',e[e.ADD_NPM=18]='ADD_NPM',e[e.SCREEN_NPM=19]='SCREEN_NPM',e[e.NONE=20]='NONE',e[e.SRC_OVER=0]='SRC_OVER',e[e.SRC_IN=21]='SRC_IN',e[e.SRC_OUT=22]='SRC_OUT',e[e.SRC_ATOP=23]='SRC_ATOP',e[e.DST_OVER=24]='DST_OVER',e[e.DST_IN=25]='DST_IN',e[e.DST_OUT=26]='DST_OUT',e[e.DST_ATOP=27]='DST_ATOP',e[e.ERASE=26]='ERASE',e[e.SUBTRACT=28]='SUBTRACT',e[e.XOR=29]='XOR',e))(p||{}),f=(e=>(e[e.POINTS=0]='POINTS',e[e.LINES=1]='LINES',e[e.LINE_LOOP=2]='LINE_LOOP',e[e.LINE_STRIP=3]='LINE_STRIP',e[e.TRIANGLES=4]='TRIANGLES',e[e.TRIANGLE_STRIP=5]='TRIANGLE_STRIP',e[e.TRIANGLE_FAN=6]='TRIANGLE_FAN',e))(f||{}),g=(e=>(e[e.RGBA=6408]='RGBA',e[e.RGB=6407]='RGB',e[e.RG=33319]='RG',e[e.RED=6403]='RED',e[e.RGBA_INTEGER=36249]='RGBA_INTEGER',e[e.RGB_INTEGER=36248]='RGB_INTEGER',e[e.RG_INTEGER=33320]='RG_INTEGER',e[e.RED_INTEGER=36244]='RED_INTEGER',e[e.ALPHA=6406]='ALPHA',e[e.LUMINANCE=6409]='LUMINANCE',e[e.LUMINANCE_ALPHA=6410]='LUMINANCE_ALPHA',e[e.DEPTH_COMPONENT=6402]='DEPTH_COMPONENT',e[e.DEPTH_STENCIL=34041]='DEPTH_STENCIL',e))(g||{}),m=(e=>(e[e.TEXTURE_2D=3553]='TEXTURE_2D',e[e.TEXTURE_CUBE_MAP=34067]='TEXTURE_CUBE_MAP',e[e.TEXTURE_2D_ARRAY=35866]='TEXTURE_2D_ARRAY',e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]='TEXTURE_CUBE_MAP_POSITIVE_X',e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]='TEXTURE_CUBE_MAP_NEGATIVE_X',e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]='TEXTURE_CUBE_MAP_POSITIVE_Y',e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]='TEXTURE_CUBE_MAP_NEGATIVE_Y',e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]='TEXTURE_CUBE_MAP_POSITIVE_Z',e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]='TEXTURE_CUBE_MAP_NEGATIVE_Z',e))(m||{}),v=(e=>(e[e.UNSIGNED_BYTE=5121]='UNSIGNED_BYTE',e[e.UNSIGNED_SHORT=5123]='UNSIGNED_SHORT',e[e.UNSIGNED_SHORT_5_6_5=33635]='UNSIGNED_SHORT_5_6_5',e[e.UNSIGNED_SHORT_4_4_4_4=32819]='UNSIGNED_SHORT_4_4_4_4',e[e.UNSIGNED_SHORT_5_5_5_1=32820]='UNSIGNED_SHORT_5_5_5_1',e[e.UNSIGNED_INT=5125]='UNSIGNED_INT',e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]='UNSIGNED_INT_10F_11F_11F_REV',e[e.UNSIGNED_INT_2_10_10_10_REV=33640]='UNSIGNED_INT_2_10_10_10_REV',e[e.UNSIGNED_INT_24_8=34042]='UNSIGNED_INT_24_8',e[e.UNSIGNED_INT_5_9_9_9_REV=35902]='UNSIGNED_INT_5_9_9_9_REV',e[e.BYTE=5120]='BYTE',e[e.SHORT=5122]='SHORT',e[e.INT=5124]='INT',e[e.FLOAT=5126]='FLOAT',e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]='FLOAT_32_UNSIGNED_INT_24_8_REV',e[e.HALF_FLOAT=36193]='HALF_FLOAT',e))(v||{}),y=(e=>(e[e.FLOAT=0]='FLOAT',e[e.INT=1]='INT',e[e.UINT=2]='UINT',e))(y||{}),x=(e=>(e[e.NEAREST=0]='NEAREST',e[e.LINEAR=1]='LINEAR',e))(x||{}),b=(e=>(e[e.CLAMP=33071]='CLAMP',e[e.REPEAT=10497]='REPEAT',e[e.MIRRORED_REPEAT=33648]='MIRRORED_REPEAT',e))(b||{}),T=(e=>(e[e.OFF=0]='OFF',e[e.POW2=1]='POW2',e[e.ON=2]='ON',e[e.ON_MANUAL=3]='ON_MANUAL',e))(T||{}),w=(e=>(e[e.NPM=0]='NPM',e[e.UNPACK=1]='UNPACK',e[e.PMA=2]='PMA',e[e.NO_PREMULTIPLIED_ALPHA=0]='NO_PREMULTIPLIED_ALPHA',e[e.PREMULTIPLY_ON_UPLOAD=1]='PREMULTIPLY_ON_UPLOAD',e[e.PREMULTIPLIED_ALPHA=2]='PREMULTIPLIED_ALPHA',e))(w||{}),E=(e=>(e[e.NO=0]='NO',e[e.YES=1]='YES',e[e.AUTO=2]='AUTO',e[e.BLEND=0]='BLEND',e[e.CLEAR=1]='CLEAR',e[e.BLIT=2]='BLIT',e))(E||{}),C=(e=>(e[e.AUTO=0]='AUTO',e[e.MANUAL=1]='MANUAL',e))(C||{}),S=(e=>(e.LOW='lowp',e.MEDIUM='mediump',e.HIGH='highp',e))(S||{}),A=(e=>(e[e.NONE=0]='NONE',e[e.SCISSOR=1]='SCISSOR',e[e.STENCIL=2]='STENCIL',e[e.SPRITE=3]='SPRITE',e[e.COLOR=4]='COLOR',e))(A||{}),M=(e=>(e[e.RED=1]='RED',e[e.GREEN=2]='GREEN',e[e.BLUE=4]='BLUE',e[e.ALPHA=8]='ALPHA',e))(M||{}),P=(e=>(e[e.NONE=0]='NONE',e[e.LOW=2]='LOW',e[e.MEDIUM=4]='MEDIUM',e[e.HIGH=8]='HIGH',e))(P||{}),I=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]='ELEMENT_ARRAY_BUFFER',e[e.ARRAY_BUFFER=34962]='ARRAY_BUFFER',e[e.UNIFORM_BUFFER=35345]='UNIFORM_BUFFER',e))(I||{});const R={createCanvas:(e,t)=>{const s=document.createElement('canvas');return s.width=e,s.height=t,s},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>(new DOMParser).parseFromString(e,'text/xml')},L={ADAPTER:R,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},k=(t.default??t)(globalThis.navigator);L.RETINA_PREFIX=/@([0-9\.]+)x/,L.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;const D={};function B(e,t,s=3){if(D[t])return;let i=(new Error).stack;typeof i>'u'?console.warn('PixiJS Deprecation Warning: ',`${t}\nDeprecated since v${e}`):(i=i.split('\n').splice(s).join('\n'),console.groupCollapsed?(console.groupCollapsed('%cPixiJS Deprecation Warning: %c%s','color:#614108;background:#fffbe6','font-weight:normal;color:#614108;background:#fffbe6',`${t}\nDeprecated since v${e}`),console.warn(i),console.groupEnd()):(console.warn('PixiJS Deprecation Warning: ',`${t}\nDeprecated since v${e}`),console.warn(i))),D[t]=!0}const F={get parse(){return B('7.3.0','utils.url.parse is deprecated, use native URL API instead.'),n},get format(){return B('7.3.0','utils.url.format is deprecated, use native URL API instead.'),r},get resolve(){return B('7.3.0','utils.url.resolve is deprecated, use native URL API instead.'),o}};function O(e){if('string'!=typeof e)throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function N(e){return e.split('?')[0].split('#')[0]}const U={toPosix(e){return t='\\',s='/',e.replace(new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'g'),s);var t,s},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl:e=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e),isBlobUrl:e=>e.startsWith('blob:'),hasProtocol(e){return/^[^/:]+:/.test(this.toPosix(e))},getProtocol(e){O(e),e=this.toPosix(e);const t=/^file:\/\/\//.exec(e);if(t)return t[0];const s=/^[^/:]+:\/{0,2}/.exec(e);return s?s[0]:''},toAbsolute(e,t,s){if(O(e),this.isDataUrl(e)||this.isBlobUrl(e))return e;const i=N(this.toPosix(t??L.ADAPTER.getBaseUrl())),r=N(this.toPosix(s??this.rootname(i)));return(e=this.toPosix(e)).startsWith('/')?U.join(r,e.slice(1)):this.isAbsolute(e)?e:this.join(i,e)},normalize(e){if(O(e),0===e.length)return'.';if(this.isDataUrl(e)||this.isBlobUrl(e))return e;let t='';const s=(e=this.toPosix(e)).startsWith('/');this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const i=e.endsWith('/');return e=function(e,t){let s='',i=0,r=-1,n=0,o=-1;for(let a=0;a<=e.length;++a){if(a<e.length)o=e.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(r!==a-1&&1!==n)if(r!==a-1&&2===n){if(s.length<2||2!==i||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2))if(s.length>2){const e=s.lastIndexOf('/');if(e!==s.length-1){-1===e?(s='',i=0):(s=s.slice(0,e),i=s.length-1-s.lastIndexOf('/')),r=a,n=0;continue}}else if(2===s.length||1===s.length){s='',i=0,r=a,n=0;continue}t&&(s.length>0?s+='/..':s='..',i=2)}else s.length>0?s+=`/${e.slice(r+1,a)}`:s=e.slice(r+1,a),i=a-r-1;r=a,n=0}else 46===o&&-1!==n?++n:n=-1}return s}(e,!1),e.length>0&&i&&(e+='/'),s?`/${e}`:t+e},isAbsolute(e){return O(e),e=this.toPosix(e),!!this.hasProtocol(e)||e.startsWith('/')},join(...e){if(0===e.length)return'.';let t;for(let s=0;s<e.length;++s){const i=e[s];if(O(i),i.length>0)if(void 0===t)t=i;else{const r=e[s-1]??'';this.joinExtensions.includes(this.extname(r).toLowerCase())?t+=`/../${i}`:t+=`/${i}`}}return void 0===t?'.':this.normalize(t)},dirname(e){if(O(e),0===e.length)return'.';let t=(e=this.toPosix(e)).charCodeAt(0);const s=47===t;let i=-1,r=!0;const n=this.getProtocol(e),o=e;for(let s=(e=e.slice(n.length)).length-1;s>=1;--s)if(t=e.charCodeAt(s),47===t){if(!r){i=s;break}}else r=!1;return-1===i?s?'/':this.isUrl(o)?n+e:n:s&&1===i?'//':n+e.slice(0,i)},rootname(e){O(e);let t='';if(t=(e=this.toPosix(e)).startsWith('/')?'/':this.getProtocol(e),this.isUrl(e)){const s=e.indexOf('/',t.length);t=-1!==s?e.slice(0,s):e,t.endsWith('/')||(t+='/')}return t},basename(e,t){O(e),t&&O(t),e=N(this.toPosix(e));let s,i=0,r=-1,n=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return'';let o=t.length-1,a=-1;for(s=e.length-1;s>=0;--s){const l=e.charCodeAt(s);if(47===l){if(!n){i=s+1;break}}else-1===a&&(n=!1,a=s+1),o>=0&&(l===t.charCodeAt(o)?-1===--o&&(r=s):(o=-1,r=a))}return i===r?r=a:-1===r&&(r=e.length),e.slice(i,r)}for(s=e.length-1;s>=0;--s)if(47===e.charCodeAt(s)){if(!n){i=s+1;break}}else-1===r&&(n=!1,r=s+1);return-1===r?'':e.slice(i,r)},extname(e){O(e);let t=-1,s=0,i=-1,r=!0,n=0;for(let o=(e=N(this.toPosix(e))).length-1;o>=0;--o){const a=e.charCodeAt(o);if(47!==a)-1===i&&(r=!1,i=o+1),46===a?-1===t?t=o:1!==n&&(n=1):-1!==t&&(n=-1);else if(!r){s=o+1;break}}return-1===t||-1===i||0===n||1===n&&t===i-1&&t===s+1?'':e.slice(t,i)},parse(e){O(e);const t={root:'',dir:'',base:'',ext:'',name:''};if(0===e.length)return t;let s=(e=N(this.toPosix(e))).charCodeAt(0);const i=this.isAbsolute(e);let r;t.root=this.rootname(e),r=i||this.hasProtocol(e)?1:0;let n=-1,o=0,a=-1,l=!0,h=e.length-1,u=0;for(;h>=r;--h)if(s=e.charCodeAt(h),47!==s)-1===a&&(l=!1,a=h+1),46===s?-1===n?n=h:1!==u&&(u=1):-1!==n&&(u=-1);else if(!l){o=h+1;break}return-1===n||-1===a||0===u||1===u&&n===a-1&&n===o+1?-1!==a&&(t.base=t.name=0===o&&i?e.slice(1,a):e.slice(o,a)):(0===o&&i?(t.name=e.slice(1,n),t.base=e.slice(1,a)):(t.name=e.slice(o,n),t.base=e.slice(o,a)),t.ext=e.slice(n,a)),t.dir=this.dirname(e),t},sep:'/',delimiter:':',joinExtensions:['.html']};let G,V;async function H(){return G??(G=(async()=>{const e=document.createElement('canvas').getContext('webgl');if(!e)return w.UNPACK;const t=await new Promise(e=>{const t=document.createElement('video');t.onloadeddata=()=>e(t),t.onerror=()=>e(null),t.autoplay=!1,t.crossOrigin='anonymous',t.preload='auto',t.src='data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=',t.load()});if(!t)return w.UNPACK;const s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);const r=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,r),e.deleteFramebuffer(i),e.deleteTexture(s),e.getExtension('WEBGL_lose_context')?.loseContext(),r[0]<=r[3]?w.PMA:w.UNPACK})()),G}function W(){B('7.0.0','skipHello is deprecated, please use settings.RENDER_OPTIONS.hello')}function X(){B('7.0.0','sayHello is deprecated, please use Renderer\'s "hello" option')}function j(){return typeof V>'u'&&(V=function(){const e={stencil:!0,failIfMajorPerformanceCaveat:L.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!L.ADAPTER.getWebGLRenderingContext())return!1;const t=L.ADAPTER.createCanvas();let s=t.getContext('webgl',e)||t.getContext('experimental-webgl',e);const i=!!s?.getContextAttributes()?.stencil;if(s){const e=s.getExtension('WEBGL_lose_context');e&&e.loseContext()}return s=null,i}catch{return!1}}()),V}var Y={grad:.9,turn:360,rad:360/(2*Math.PI)},q=function(e){return'string'==typeof e?e.length>0:'number'==typeof e},Q=function(e,t,s){return void 0===t&&(t=0),void 0===s&&(s=Math.pow(10,t)),Math.round(s*e)/s+0},K=function(e,t,s){return void 0===t&&(t=0),void 0===s&&(s=1),e>s?s:e>t?e:t},Z=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},J=function(e){return{r:K(e.r,0,255),g:K(e.g,0,255),b:K(e.b,0,255),a:K(e.a)}},ee=function(e){return{r:Q(e.r),g:Q(e.g),b:Q(e.b),a:Q(e.a,3)}},te=/^#([0-9a-f]{3,8})$/i,se=function(e){var t=e.toString(16);return t.length<2?'0'+t:t},ie=function(e){var t=e.r,s=e.g,i=e.b,r=e.a,n=Math.max(t,s,i),o=n-Math.min(t,s,i),a=o?n===t?(s-i)/o:n===s?2+(i-t)/o:4+(t-s)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:r}},re=function(e){var t=e.h,s=e.s,i=e.v,r=e.a;t=t/360*6,s/=100,i/=100;var n=Math.floor(t),o=i*(1-s),a=i*(1-(t-n)*s),l=i*(1-(1-t+n)*s),h=n%6;return{r:255*[i,a,o,o,l,i][h],g:255*[l,i,i,a,o,o][h],b:255*[o,o,l,i,i,a][h],a:r}},ne=function(e){return{h:Z(e.h),s:K(e.s,0,100),l:K(e.l,0,100),a:K(e.a)}},oe=function(e){return{h:Q(e.h),s:Q(e.s),l:Q(e.l),a:Q(e.a,3)}},ae=function(e){return re((s=(t=e).s,{h:t.h,s:(s*=((i=t.l)<50?i:100-i)/100)>0?2*s/(i+s)*100:0,v:i+s,a:t.a}));var t,s,i},le=function(e){return{h:(t=ie(e)).h,s:(r=(200-(s=t.s))*(i=t.v)/100)>0&&r<200?s*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,s,i,r},he=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ue=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ce=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,de=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,pe={string:[[function(e){var t=te.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?Q(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?Q(parseInt(e.substr(6,2),16)/255,2):1}:null:null},'hex'],[function(e){var t=ce.exec(e)||de.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:J({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},'rgb'],[function(e){var t=he.exec(e)||ue.exec(e);if(!t)return null;var s,i,r=ne({h:(s=t[1],i=t[2],void 0===i&&(i='deg'),Number(s)*(Y[i]||1)),s:Number(t[3]),l:Number(t[4]),a:void 0===t[5]?1:Number(t[5])/(t[6]?100:1)});return ae(r)},'hsl']],object:[[function(e){var t=e.r,s=e.g,i=e.b,r=e.a,n=void 0===r?1:r;return q(t)&&q(s)&&q(i)?J({r:Number(t),g:Number(s),b:Number(i),a:Number(n)}):null},'rgb'],[function(e){var t=e.h,s=e.s,i=e.l,r=e.a,n=void 0===r?1:r;if(!q(t)||!q(s)||!q(i))return null;var o=ne({h:Number(t),s:Number(s),l:Number(i),a:Number(n)});return ae(o)},'hsl'],[function(e){var t=e.h,s=e.s,i=e.v,r=e.a,n=void 0===r?1:r;if(!q(t)||!q(s)||!q(i))return null;var o=function(e){return{h:Z(e.h),s:K(e.s,0,100),v:K(e.v,0,100),a:K(e.a)}}({h:Number(t),s:Number(s),v:Number(i),a:Number(n)});return re(o)},'hsv']]},fe=function(e,t){for(var s=0;s<t.length;s++){var i=t[s][0](e);if(i)return[i,t[s][1]]}return[null,void 0]},ge=function(e){return'string'==typeof e?fe(e.trim(),pe.string):'object'==typeof e&&null!==e?fe(e,pe.object):[null,void 0]},me=function(e,t){var s=le(e);return{h:s.h,s:K(s.s+100*t,0,100),l:s.l,a:s.a}},_e=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},$=function(e,t){var s=le(e);return{h:s.h,s:s.s,l:K(s.l+100*t,0,100),a:s.a}},ve=function(){function e(e){this.parsed=ge(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return Q(_e(this.rgba),2)},e.prototype.isDark=function(){return _e(this.rgba)<.5},e.prototype.isLight=function(){return _e(this.rgba)>=.5},e.prototype.toHex=function(){return t=(e=ee(this.rgba)).r,s=e.g,i=e.b,n=(r=e.a)<1?se(Q(255*r)):'','#'+se(t)+se(s)+se(i)+n;var e,t,s,i,r,n},e.prototype.toRgb=function(){return ee(this.rgba)},e.prototype.toRgbString=function(){return t=(e=ee(this.rgba)).r,s=e.g,i=e.b,(r=e.a)<1?'rgba('+t+', '+s+', '+i+', '+r+')':'rgb('+t+', '+s+', '+i+')';var e,t,s,i,r},e.prototype.toHsl=function(){return oe(le(this.rgba))},e.prototype.toHslString=function(){return t=(e=oe(le(this.rgba))).h,s=e.s,i=e.l,(r=e.a)<1?'hsla('+t+', '+s+'%, '+i+'%, '+r+')':'hsl('+t+', '+s+'%, '+i+'%)';var e,t,s,i,r},e.prototype.toHsv=function(){return e=ie(this.rgba),{h:Q(e.h),s:Q(e.s),v:Q(e.v),a:Q(e.a,3)};var e},e.prototype.invert=function(){return ye({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},e.prototype.saturate=function(e){return void 0===e&&(e=.1),ye(me(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),ye(me(this.rgba,-e))},e.prototype.grayscale=function(){return ye(me(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),ye($(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),ye($(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){return'number'==typeof e?ye({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):Q(this.rgba.a,3);var t},e.prototype.hue=function(e){var t=le(this.rgba);return'number'==typeof e?ye({h:e,s:t.s,l:t.l,a:t.a}):Q(t.h)},e.prototype.isEqual=function(e){return this.toHex()===ye(e).toHex()},e}(),ye=function(e){return e instanceof ve?e:new ve(e)},xe=[];!function(e){e.forEach(function(e){xe.indexOf(e)<0&&(e(ve,pe),xe.push(e))})}([function(e,t){var s={white:'#ffffff',bisque:'#ffe4c4',blue:'#0000ff',cadetblue:'#5f9ea0',chartreuse:'#7fff00',chocolate:'#d2691e',coral:'#ff7f50',antiquewhite:'#faebd7',aqua:'#00ffff',azure:'#f0ffff',whitesmoke:'#f5f5f5',papayawhip:'#ffefd5',plum:'#dda0dd',blanchedalmond:'#ffebcd',black:'#000000',gold:'#ffd700',goldenrod:'#daa520',gainsboro:'#dcdcdc',cornsilk:'#fff8dc',cornflowerblue:'#6495ed',burlywood:'#deb887',aquamarine:'#7fffd4',beige:'#f5f5dc',crimson:'#dc143c',cyan:'#00ffff',darkblue:'#00008b',darkcyan:'#008b8b',darkgoldenrod:'#b8860b',darkkhaki:'#bdb76b',darkgray:'#a9a9a9',darkgreen:'#006400',darkgrey:'#a9a9a9',peachpuff:'#ffdab9',darkmagenta:'#8b008b',darkred:'#8b0000',darkorchid:'#9932cc',darkorange:'#ff8c00',darkslateblue:'#483d8b',gray:'#808080',darkslategray:'#2f4f4f',darkslategrey:'#2f4f4f',deeppink:'#ff1493',deepskyblue:'#00bfff',wheat:'#f5deb3',firebrick:'#b22222',floralwhite:'#fffaf0',ghostwhite:'#f8f8ff',darkviolet:'#9400d3',magenta:'#ff00ff',green:'#008000',dodgerblue:'#1e90ff',grey:'#808080',honeydew:'#f0fff0',hotpink:'#ff69b4',blueviolet:'#8a2be2',forestgreen:'#228b22',lawngreen:'#7cfc00',indianred:'#cd5c5c',indigo:'#4b0082',fuchsia:'#ff00ff',brown:'#a52a2a',maroon:'#800000',mediumblue:'#0000cd',lightcoral:'#f08080',darkturquoise:'#00ced1',lightcyan:'#e0ffff',ivory:'#fffff0',lightyellow:'#ffffe0',lightsalmon:'#ffa07a',lightseagreen:'#20b2aa',linen:'#faf0e6',mediumaquamarine:'#66cdaa',lemonchiffon:'#fffacd',lime:'#00ff00',khaki:'#f0e68c',mediumseagreen:'#3cb371',limegreen:'#32cd32',mediumspringgreen:'#00fa9a',lightskyblue:'#87cefa',lightblue:'#add8e6',midnightblue:'#191970',lightpink:'#ffb6c1',mistyrose:'#ffe4e1',moccasin:'#ffe4b5',mintcream:'#f5fffa',lightslategray:'#778899',lightslategrey:'#778899',navajowhite:'#ffdead',navy:'#000080',mediumvioletred:'#c71585',powderblue:'#b0e0e6',palegoldenrod:'#eee8aa',oldlace:'#fdf5e6',paleturquoise:'#afeeee',mediumturquoise:'#48d1cc',mediumorchid:'#ba55d3',rebeccapurple:'#663399',lightsteelblue:'#b0c4de',mediumslateblue:'#7b68ee',thistle:'#d8bfd8',tan:'#d2b48c',orchid:'#da70d6',mediumpurple:'#9370db',purple:'#800080',pink:'#ffc0cb',skyblue:'#87ceeb',springgreen:'#00ff7f',palegreen:'#98fb98',red:'#ff0000',yellow:'#ffff00',slateblue:'#6a5acd',lavenderblush:'#fff0f5',peru:'#cd853f',palevioletred:'#db7093',violet:'#ee82ee',teal:'#008080',slategray:'#708090',slategrey:'#708090',aliceblue:'#f0f8ff',darkseagreen:'#8fbc8f',darkolivegreen:'#556b2f',greenyellow:'#adff2f',seagreen:'#2e8b57',seashell:'#fff5ee',tomato:'#ff6347',silver:'#c0c0c0',sienna:'#a0522d',lavender:'#e6e6fa',lightgreen:'#90ee90',orange:'#ffa500',orangered:'#ff4500',steelblue:'#4682b4',royalblue:'#4169e1',turquoise:'#40e0d0',yellowgreen:'#9acd32',salmon:'#fa8072',saddlebrown:'#8b4513',sandybrown:'#f4a460',rosybrown:'#bc8f8f',darksalmon:'#e9967a',lightgoldenrodyellow:'#fafad2',snow:'#fffafa',lightgrey:'#d3d3d3',lightgray:'#d3d3d3',dimgray:'#696969',dimgrey:'#696969',olivedrab:'#6b8e23',olive:'#808000'},i={};for(var r in s)i[s[r]]=r;var n={};e.prototype.toName=function(t){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return'transparent';var r,o,a=i[this.toHex()];if(a)return a;if(null==t?void 0:t.closest){var l=this.toRgb(),h=1/0,u='black';if(!n.length)for(var c in s)n[c]=new e(s[c]).toRgb();for(var d in s){var p=(r=l,o=n[d],Math.pow(r.r-o.r,2)+Math.pow(r.g-o.g,2)+Math.pow(r.b-o.b,2));p<h&&(h=p,u=d)}return u}},t.string.push([function(t){var i=t.toLowerCase(),r='transparent'===i?'#0000':s[i];return r?new e(r).toRgb():null},'name'])}]);const be=class e{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(t){if(t instanceof e)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw new Error('Cannot set PIXI.Color#value to null');(null===this._value||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(e){return'string'==typeof e||'number'==typeof e||e instanceof Number||null===e?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):'object'==typeof e&&null!==e?{...e}:e}isSourceEqual(e,t){const s=typeof e;if(s!==typeof t)return!1;if('number'===s||'string'===s||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length===t.length&&e.every((e,s)=>e===t[s]);if(null!==e&&null!==t){const s=Object.keys(e),i=Object.keys(t);return s.length===i.length&&s.every(s=>e[s]===t[s])}return e===t}toRgba(){const[e,t,s,i]=this._components;return{r:e,g:t,b:s,a:i}}toRgb(){const[e,t,s]=this._components;return{r:e,g:t,b:s}}toRgbaString(){const[e,t,s]=this.toUint8RgbArray();return`rgba(${e},${t},${s},${this.alpha})`}toUint8RgbArray(e){const[t,s,i]=this._components;return(e=e??[])[0]=Math.round(255*t),e[1]=Math.round(255*s),e[2]=Math.round(255*i),e}toRgbArray(e){e=e??[];const[t,s,i]=this._components;return e[0]=t,e[1]=s,e[2]=i,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(65280&e)+((255&e)<<16)}multiply(t){const[s,i,r,n]=e.temp.setValue(t)._components;return this._components[0]*=s,this._components[1]*=i,this._components[2]*=r,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(1===e)return(255<<24)+this._int;if(0===e)return t?0:this._int;let s=this._int>>16&255,i=this._int>>8&255,r=255&this._int;return t&&(s=s*e+.5|0,i=i*e+.5|0,r=r*e+.5|0),(255*e<<24)+(s<<16)+(i<<8)+r}toHex(){const e=this._int.toString(16);return`#${'000000'.substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(255*this._components[3]).toString(16);return this.toHex()+'00'.substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,s,i]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(s*e)/e,this._components[2]=Math.round(i*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,s,i,r]=this._components;return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e}normalize(t){let s,i,r,n;if(('number'==typeof t||t instanceof Number)&&t>=0&&t<=16777215){s=(t>>16&255)/255,i=(t>>8&255)/255,r=(255&t)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[s,i,r,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[s,i,r,n=255]=t,s/=255,i/=255,r/=255,n/=255;else if('string'==typeof t||'object'==typeof t){if('string'==typeof t){const s=e.HEX_PATTERN.exec(t);s&&(t=`#${s[2]}`)}const o=ye(t);o.isValid()&&(({r:s,g:i,b:r,a:n}=o.rgba),s/=255,i/=255,r/=255)}if(void 0===s)throw new Error(`Unable to convert color ${t}`);this._components[0]=s,this._components[1]=i,this._components[2]=r,this._components[3]=n,this.refreshInt()}refreshInt(){this._clamp(this._components);const[e,t,s]=this._components;this._int=(255*e<<16)+(255*t<<8)+(255*s|0)}_clamp(e,t=0,s=1){return'number'==typeof e?Math.min(Math.max(e,t),s):(e.forEach((i,r)=>{e[r]=Math.min(Math.max(i,t),s)}),e)}};be.shared=new be,be.temp=new be,be.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Te=be;function we(e,t=[]){return B('7.2.0','utils.hex2rgb is deprecated, use Color#toRgbArray instead'),Te.shared.setValue(e).toRgbArray(t)}function Ee(e){return B('7.2.0','utils.hex2string is deprecated, use Color#toHex instead'),Te.shared.setValue(e).toHex()}function Ce(e){return B('7.2.0','utils.string2hex is deprecated, use Color#toNumber instead'),Te.shared.setValue(e).toNumber()}function Se(e){return B('7.2.0','utils.rgb2hex is deprecated, use Color#toNumber instead'),Te.shared.setValue(e).toNumber()}const Ae=function(){const e=[],t=[];for(let s=0;s<32;s++)e[s]=s,t[s]=s;e[p.NORMAL_NPM]=p.NORMAL,e[p.ADD_NPM]=p.ADD,e[p.SCREEN_NPM]=p.SCREEN,t[p.NORMAL]=p.NORMAL_NPM,t[p.ADD]=p.ADD_NPM,t[p.SCREEN]=p.SCREEN_NPM;const s=[];return s.push(t),s.push(e),s}();function Me(e,t){return Ae[t?1:0][e]}function Pe(e,t,s,i=!0){return B('7.2.0','utils.premultiplyRgba has moved to Color.premultiply'),Te.shared.setValue(e).premultiply(t,i).toArray(s??new Float32Array(4))}function Ie(e,t){return B('7.2.0','utils.premultiplyTint has moved to Color.toPremultiplied'),Te.shared.setValue(e).toPremultiplied(t)}function Re(e,t,s,i=!0){return B('7.2.0','utils.premultiplyTintToRgba has moved to Color.premultiply'),Te.shared.setValue(e).premultiply(t,i).toArray(s??new Float32Array(4))}const Le=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function ke(e,t=null){const s=6*e;if((t=t||new Uint16Array(s)).length!==s)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${s}`);for(let e=0,i=0;e<s;e+=6,i+=4)t[e+0]=i+0,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i+0,t[e+4]=i+2,t[e+5]=i+3;return t}function De(e){if(4===e.BYTES_PER_ELEMENT)return e instanceof Float32Array?'Float32Array':e instanceof Uint32Array?'Uint32Array':'Int32Array';if(2===e.BYTES_PER_ELEMENT){if(e instanceof Uint16Array)return'Uint16Array'}else if(1===e.BYTES_PER_ELEMENT&&e instanceof Uint8Array)return'Uint8Array';return null}const Be={Float32Array,Uint32Array,Int32Array,Uint8Array};function Fe(e,t){let s=0,i=0;const r={};for(let r=0;r<e.length;r++)i+=t[r],s+=e[r].length;const n=new ArrayBuffer(4*s);let o=null,a=0;for(let s=0;s<e.length;s++){const l=t[s],h=e[s],u=De(h);r[u]||(r[u]=new Be[u](n)),o=r[u];for(let e=0;e<h.length;e++){o[(e/l|0)*i+a+e%l]=h[e]}a+=l}return new Float32Array(n)}function Oe(e){return e+=0===e?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1}function Ne(e){return!(e&e-1||!e)}function Ue(e){let t=(e>65535?1:0)<<4,s=((e>>>=t)>255?1:0)<<3;return t|=s,s=((e>>>=s)>15?1:0)<<2,t|=s,s=((e>>>=s)>3?1:0)<<1,t|=s,t|(e>>>=s)>>1}function Ge(e,t,s){const i=e.length;let r;if(t>=i||0===s)return;const n=i-(s=t+s>i?i-t:s);for(r=t;r<n;++r)e[r]=e[r+s];e.length=n}function Ve(e){return 0===e?0:e<0?-1:1}let He=0;function We(){return++He}const $e=class{constructor(e,t,s,i){this.left=e,this.top=t,this.right=s,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};$e.EMPTY=new $e(0,0,0,0);let Xe=$e;const je={},ze=Object.create(null),Ye=Object.create(null);function qe(){let e;for(e in ze)ze[e].destroy();for(e in Ye)Ye[e].destroy()}function Qe(){let e;for(e in ze)delete ze[e];for(e in Ye)delete Ye[e]}class Ke{constructor(e,t,s){this._canvas=L.ADAPTER.createCanvas(),this._context=this._canvas.getContext('2d'),this.resolution=s||L.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError('The CanvasRenderTarget has already been destroyed')}}function Ze(e,t,s){for(let i=0,r=4*s*t;i<t;++i,r+=4)if(0!==e[r+3])return!1;return!0}function Je(e,t,s,i,r){const n=4*t;for(let t=i,o=i*n+4*s;t<=r;++t,o+=n)if(0!==e[o+3])return!1;return!0}function et(e){const{width:t,height:s}=e,i=e.getContext('2d',{willReadFrequently:!0});if(null===i)throw new TypeError('Failed to get canvas 2D context');const r=i.getImageData(0,0,t,s).data;let n=0,o=0,a=t-1,l=s-1;for(;o<s&&Ze(r,t,o);)++o;if(o===s)return Xe.EMPTY;for(;Ze(r,t,l);)--l;for(;Je(r,t,n,o,l);)++n;for(;Je(r,t,a,o,l);)--a;return++a,++l,new Xe(n,o,a,l)}function tt(e){const t=et(e),{width:s,height:i}=t;let r=null;if(!t.isEmpty()){const n=e.getContext('2d');if(null===n)throw new TypeError('Failed to get canvas 2D context');r=n.getImageData(t.left,t.top,s,i)}return{width:s,height:i,data:r}}function st(e){const t=Le.exec(e);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}function it(e,t=globalThis.location){if(e.startsWith('data:'))return'';t=t||globalThis.location;const s=new URL(e,document.baseURI);return s.hostname!==t.hostname||s.port!==t.port||s.protocol!==t.protocol?'anonymous':''}function rt(e,t=1){const s=L.RETINA_PREFIX?.exec(e);return s?parseFloat(s[1]):t}var nt=(e=>(e.Renderer='renderer',e.Application='application',e.RendererSystem='renderer-webgl-system',e.RendererPlugin='renderer-webgl-plugin',e.CanvasRendererSystem='renderer-canvas-system',e.CanvasRendererPlugin='renderer-canvas-plugin',e.Asset='asset',e.LoadParser='load-parser',e.ResolveParser='resolve-parser',e.CacheParser='cache-parser',e.DetectionParser='detection-parser',e))(nt||{});const ot=e=>{if('function'==typeof e||'object'==typeof e&&e.extension){if(!e.extension)throw new Error('Extension class must have an extension object');e={...'object'!=typeof e.extension?{type:e.extension}:e.extension,ref:e}}if('object'!=typeof e)throw new Error('Invalid extension type');return'string'==typeof(e={...e}).type&&(e.type=[e.type]),e},at=(e,t)=>ot(e).priority??t,lt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(ot).forEach(e=>{e.type.forEach(t=>this._removeHandlers[t]?.(e))}),this},add(...e){return e.map(ot).forEach(e=>{e.type.forEach(t=>{const s=this._addHandlers,i=this._queue;s[t]?s[t]?.(e):(i[t]=i[t]||[],i[t]?.push(e))})}),this},handle(e,t,s){const i=this._addHandlers,r=this._removeHandlers;if(i[e]||r[e])throw new Error(`Extension type ${e} already has a handler`);i[e]=t,r[e]=s;const n=this._queue;return n[e]&&(n[e]?.forEach(e=>t(e)),delete n[e]),this},handleByMap(e,t){return this.handle(e,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(e,t,s=-1){return this.handle(e,e=>{t.includes(e.ref)||(t.push(e.ref),t.sort((e,t)=>at(t,s)-at(e,s)))},e=>{const s=t.indexOf(e.ref);-1!==s&&t.splice(s,1)})}};class ht{constructor(e){'number'==typeof e?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case'int8':case'uint8':return 1;case'int16':case'uint16':return 2;case'int32':case'uint32':case'float32':return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const ut=['precision mediump float;','void main(void){','float test = 0.1;','%forloop%','gl_FragColor = vec4(0.0);','}'].join('\n');function ct(e){let t='';for(let s=0;s<e;++s)s>0&&(t+='\nelse '),s<e-1&&(t+=`if(test == ${s}.0){}`);return t}function dt(e,t){if(0===e)throw new Error('Invalid value of `0` passed to `checkMaxIfStatementsInShader`');const s=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=ut.replace(/%forloop%/gi,ct(e));if(t.shaderSource(s,i),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS))break;e=e/2|0}return e}class pt{constructor(){this.data=0,this.blendMode=p.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(e){!!(1&this.data)!==e&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(e){!!(2&this.data)!==e&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(e){!!(4&this.data)!==e&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(e){!!(8&this.data)!==e&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(e){!!(32&this.data)!==e&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(e){!!(16&this.data)!==e&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==p.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new pt;return e.depthTest=!1,e.blend=!0,e}}pt.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const ft=[];function gt(e,t){if(!e)return null;let s='';if('string'==typeof e){const t=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);t&&(s=t[1].toLowerCase())}for(let i=ft.length-1;i>=0;--i){const r=ft[i];if(r.test&&r.test(e,s))return new r(e,t)}throw new Error('Unrecognized source type to auto-detect Resource')}class mt{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,s,i,r,n,o,a){if(arguments.length>8)throw new Error('max arguments reached');const{name:l,items:h}=this;this._aliasCount++;for(let u=0,c=h.length;u<c;u++)h[u][l](e,t,s,i,r,n,o,a);return h===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return-1!==t&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=''}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(mt.prototype,{dispatch:{value:mt.prototype.emit},run:{value:mt.prototype.emit}});class _t{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new mt('setRealSize'),this.onUpdate=new mt('update'),this.onError=new mt('onError')}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,s){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class vt extends _t{constructor(e,t){const{width:s,height:i}=t||{};if(!s||!i)throw new Error('BufferResource width or height invalid');super(s,i),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,s){const i=e.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===w.UNPACK);const r=t.realWidth,n=t.realHeight;return s.width===r&&s.height===n?i.texSubImage2D(t.target,0,0,0,r,n,t.format,s.type,this.data):(s.width=r,s.height=n,i.texImage2D(t.target,0,s.internalFormat,r,n,0,t.format,s.type,this.data)),!0}dispose(){this.data=null}static test(e){return null===e||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const yt={scaleMode:x.NEAREST,alphaMode:w.NPM},xt=class e extends s{constructor(t=null,s=null){super(),s=Object.assign({},e.defaultOptions,s);const{alphaMode:i,mipmap:r,anisotropicLevel:n,scaleMode:o,width:a,height:l,wrapMode:h,format:u,type:c,target:d,resolution:p,resourceOptions:f}=s;t&&!(t instanceof _t)&&((t=gt(t,f)).internal=!0),this.resolution=p||L.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=n,this._wrapMode=h,this._scaleMode=o,this.format=u,this.type=c,this.target=d,this.alphaMode=i,this.uid=We(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let s;return void 0!==e&&e!==this.scaleMode&&(this.scaleMode=e,s=!0),void 0!==t&&t!==this.mipmap&&(this.mipmap=t,s=!0),s&&this.dirtyStyleId++,this}setSize(e,t,s){return s=s||this.resolution,this.setRealSize(e*s,t*s,s)}setRealSize(e,t,s){return this.resolution=s||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Ne(this.realWidth)&&Ne(this.realHeight)}setResolution(e){const t=this.resolution;return t===e||(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit('update',this)),this._refreshPOT()),this}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error('Resource can be set only once');return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit('update',this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit('loaded',this),this.emit('update',this))}onError(e){this.emit('error',this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Ye[this.cacheId],delete ze[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit('destroyed',this),this.removeAllListeners()}dispose(){this.emit('dispose',this)}castToBaseTexture(){return this}static from(t,s,i=L.STRICT_TEXTURE_CACHE){const r='string'==typeof t;let n=null;if(r)n=t;else{if(!t._pixiId){const e=s?.pixiIdPrefix||'pixiid';t._pixiId=`${e}_${We()}`}n=t._pixiId}let o=Ye[n];if(r&&i&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new e(t,s),o.cacheId=n,e.addToCache(o,n)),o}static fromBuffer(t,s,i,r){t=t||new Float32Array(s*i*4);const n=new vt(t,{width:s,height:i,...r?.resourceOptions});let o,a;return t instanceof Float32Array?(o=g.RGBA,a=v.FLOAT):t instanceof Int32Array?(o=g.RGBA_INTEGER,a=v.INT):t instanceof Uint32Array?(o=g.RGBA_INTEGER,a=v.UNSIGNED_INT):t instanceof Int16Array?(o=g.RGBA_INTEGER,a=v.SHORT):t instanceof Uint16Array?(o=g.RGBA_INTEGER,a=v.UNSIGNED_SHORT):t instanceof Int8Array?(o=g.RGBA,a=v.BYTE):(o=g.RGBA,a=v.UNSIGNED_BYTE),n.internal=!0,new e(n,Object.assign({},yt,{type:a,format:o},r))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Ye[t]&&Ye[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Ye[t]=e)}static removeFromCache(e){if('string'==typeof e){const t=Ye[e];if(t){const s=t.textureCacheIds.indexOf(e);return s>-1&&t.textureCacheIds.splice(s,1),delete Ye[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete Ye[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};xt.defaultOptions={mipmap:T.POW2,anisotropicLevel:0,scaleMode:x.LINEAR,wrapMode:b.CLAMP,alphaMode:w.UNPACK,target:m.TEXTURE_2D,format:g.RGBA,type:v.UNSIGNED_BYTE},xt._globalBatch=0;let bt=xt;class Tt{constructor(){this.texArray=null,this.blend=0,this.type=f.TRIANGLES,this.start=0,this.size=0,this.data=null}}let wt=0;class Et{constructor(e,t=!0,s=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=s,this.static=t,this.id=wt++,this.disposeRunner=new mt('disposeBuffer')}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?I.ELEMENT_ARRAY_BUFFER:I.ARRAY_BUFFER}get index(){return this.type===I.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new Et(e)}}class Ct{constructor(e,t=0,s=!1,i=v.FLOAT,r,n,o,a=1){this.buffer=e,this.size=t,this.normalized=s,this.type=i,this.stride=r,this.start=n,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(e,t,s,i,r){return new Ct(e,t,s,i,r)}}const St={Float32Array,Uint32Array,Int32Array,Uint8Array};const At={5126:4,5123:2,5121:1};let Mt=0;const Pt={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class It{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=Mt++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new mt('disposeGeometry'),this.refCount=0}addAttribute(e,t,s=0,i=!1,r,n,o,a=!1){if(!t)throw new Error('You must pass a buffer when creating an attribute');t instanceof Et||(t instanceof Array&&(t=new Float32Array(t)),t=new Et(t));const l=e.split('|');if(l.length>1){for(let e=0;e<l.length;e++)this.addAttribute(l[e],t,s,i,r);return this}let h=this.buffers.indexOf(t);return-1===h&&(this.buffers.push(t),h=this.buffers.length-1),this.attributes[e]=new Ct(h,s,i,r,n,o,a),this.instanced=this.instanced||a,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof Et||(e instanceof Array&&(e=new Uint16Array(e)),e=new Et(e)),e.type=I.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const e=[],t=[],s=new Et;let i;for(i in this.attributes){const s=this.attributes[i],r=this.buffers[s.buffer];e.push(r.data),t.push(s.size*At[s.type]/4),s.buffer=0}for(s.data=function(e,t){let s=0,i=0;const r={};for(let r=0;r<e.length;r++)i+=t[r],s+=e[r].length;const n=new ArrayBuffer(4*s);let o=null,a=0;for(let s=0;s<e.length;s++){const l=t[s],h=e[s],u=De(h);r[u]||(r[u]=new St[u](n)),o=r[u];for(let e=0;e<h.length;e++)o[(e/l|0)*i+a+e%l]=h[e];a+=l}return new Float32Array(n)}(e,t),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[s],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new It;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new Et(this.buffers[t].data.slice(0));for(const t in this.attributes){const s=this.attributes[t];e.attributes[t]=new Ct(s.buffer,s.size,s.normalized,s.type,s.stride,s.start,s.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=I.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new It,s=[],i=[],r=[];let n;for(let t=0;t<e.length;t++){n=e[t];for(let e=0;e<n.buffers.length;e++)i[e]=i[e]||0,i[e]+=n.buffers[e].data.length,r[e]=0}for(let e=0;e<n.buffers.length;e++)s[e]=new(Pt[De(n.buffers[e].data)])(i[e]),t.buffers[e]=new Et(s[e]);for(let t=0;t<e.length;t++){n=e[t];for(let e=0;e<n.buffers.length;e++)s[e].set(n.buffers[e].data,r[e]),r[e]+=n.buffers[e].data.length}if(t.attributes=n.attributes,n.indexBuffer){t.indexBuffer=t.buffers[n.buffers.indexOf(n.indexBuffer)],t.indexBuffer.type=I.ELEMENT_ARRAY_BUFFER;let s=0,i=0,r=0,o=0;for(let e=0;e<n.buffers.length;e++)if(n.buffers[e]!==n.indexBuffer){o=e;break}for(const e in n.attributes){const t=n.attributes[e];(0|t.buffer)===o&&(i+=t.size*At[t.type]/4)}for(let n=0;n<e.length;n++){const a=e[n].indexBuffer.data;for(let e=0;e<a.length;e++)t.indexBuffer.data[e+r]+=s;s+=e[n].buffers[o].data.length/i,r+=a.length}}return t}}class Rt extends It{constructor(e=!1){super(),this._buffer=new Et(null,e,!1),this._indexBuffer=new Et(null,e,!0),this.addAttribute('aVertexPosition',this._buffer,2,!1,v.FLOAT).addAttribute('aTextureCoord',this._buffer,2,!1,v.FLOAT).addAttribute('aColor',this._buffer,4,!0,v.UNSIGNED_BYTE).addAttribute('aTextureId',this._buffer,1,!0,v.FLOAT).addIndex(this._indexBuffer)}}const Lt=2*Math.PI,kt=180/Math.PI,Dt=Math.PI/180;var Bt=(e=>(e[e.POLY=0]='POLY',e[e.RECT=1]='RECT',e[e.CIRC=2]='CIRC',e[e.ELIP=3]='ELIP',e[e.RREC=4]='RREC',e))(Bt||{});class Ft{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new Ft(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}}Ft.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Ot=[new Ft,new Ft,new Ft,new Ft];class Nt{constructor(e=0,t=0,s=0,i=0){this.x=Number(e),this.y=Number(t),this.width=Number(s),this.height=Number(i),this.type=Bt.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Nt(0,0,0,0)}clone(){return new Nt(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return!(this.width<=0||this.height<=0)&&(e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height)}intersects(e,t){if(!t){const t=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=t)return!1;const s=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>s}const s=this.left,i=this.right,r=this.top,n=this.bottom;if(i<=s||n<=r)return!1;const o=Ot[0].set(e.left,e.top),a=Ot[1].set(e.left,e.bottom),l=Ot[2].set(e.right,e.top),h=Ot[3].set(e.right,e.bottom);if(l.x<=o.x||a.y<=o.y)return!1;const u=Math.sign(t.a*t.d-t.b*t.c);if(0===u||(t.apply(o,o),t.apply(a,a),t.apply(l,l),t.apply(h,h),Math.max(o.x,a.x,l.x,h.x)<=s||Math.min(o.x,a.x,l.x,h.x)>=i||Math.max(o.y,a.y,l.y,h.y)<=r||Math.min(o.y,a.y,l.y,h.y)>=n))return!1;const c=u*(a.y-o.y),d=u*(o.x-a.x),p=c*s+d*r,f=c*i+d*r,g=c*s+d*n,m=c*i+d*n;if(Math.max(p,f,g,m)<=c*o.x+d*o.y||Math.min(p,f,g,m)>=c*h.x+d*h.y)return!1;const v=u*(o.y-l.y),y=u*(l.x-o.x),x=v*s+y*r,b=v*i+y*r,T=v*s+y*n,w=v*i+y*n;return!(Math.max(x,b,T,w)<=v*o.x+y*o.y||Math.min(x,b,T,w)>=v*h.x+y*h.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t,this}fit(e){const t=Math.max(this.x,e.x),s=Math.min(this.x+this.width,e.x+e.width),i=Math.max(this.y,e.y),r=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(s-t,0),this.y=i,this.height=Math.max(r-i,0),this}ceil(e=1,t=.001){const s=Math.ceil((this.x+this.width-t)*e)/e,i=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=s-this.x,this.height=i-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),s=Math.max(this.x+this.width,e.x+e.width),i=Math.min(this.y,e.y),r=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=s-t,this.y=i,this.height=r-i,this}}Nt.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Ut{constructor(e=0,t=0,s=0){this.x=e,this.y=t,this.radius=s,this.type=Bt.CIRC}clone(){return new Ut(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const s=this.radius*this.radius;let i=this.x-e,r=this.y-t;return i*=i,r*=r,i+r<=s}getBounds(){return new Nt(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}Ut.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Gt{constructor(e=0,t=0,s=0,i=0){this.x=e,this.y=t,this.width=s,this.height=i,this.type=Bt.ELIP}clone(){return new Gt(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let s=(e-this.x)/this.width,i=(t-this.y)/this.height;return s*=s,i*=i,s+i<=1}getBounds(){return new Nt(this.x-this.width,this.y-this.height,this.width,this.height)}}Gt.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Vt{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if('number'!=typeof t[0]){const e=[];for(let s=0,i=t.length;s<i;s++)e.push(t[s].x,t[s].y);t=e}this.points=t,this.type=Bt.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new Vt(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let s=!1;const i=this.points.length/2;for(let r=0,n=i-1;r<i;n=r++){const i=this.points[2*r],o=this.points[2*r+1],a=this.points[2*n],l=this.points[2*n+1];o>t!=l>t&&e<(t-o)/(l-o)*(a-i)+i&&(s=!s)}return s}}Vt.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((e,t)=>`${e}, ${t}`,'')}]`};class Ht{constructor(e=0,t=0,s=0,i=0,r=20){this.x=e,this.y=t,this.width=s,this.height=i,this.radius=r,this.type=Bt.RREC}clone(){return new Ht(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+s&&t<=this.y+this.height-s||e>=this.x+s&&e<=this.x+this.width-s)return!0;let i=e-(this.x+s),r=t-(this.y+s);const n=s*s;if(i*i+r*r<=n||(i=e-(this.x+this.width-s),i*i+r*r<=n)||(r=t-(this.y+this.height-s),i*i+r*r<=n)||(i=e-(this.x+s),i*i+r*r<=n))return!0}return!1}}Ht.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Wt{constructor(e=1,t=0,s=0,i=1,r=0,n=0){this.array=null,this.a=e,this.b=t,this.c=s,this.d=i,this.tx=r,this.ty=n}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,s,i,r,n){return this.a=e,this.b=t,this.c=s,this.d=i,this.tx=r,this.ty=n,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const s=t||this.array;return e?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(e,t){t=t||new Ft;const s=e.x,i=e.y;return t.x=this.a*s+this.c*i+this.tx,t.y=this.b*s+this.d*i+this.ty,t}applyInverse(e,t){t=t||new Ft;const s=1/(this.a*this.d+this.c*-this.b),i=e.x,r=e.y;return t.x=this.d*s*i+-this.c*s*r+(this.ty*this.c-this.tx*this.d)*s,t.y=this.a*s*r+-this.b*s*i+(-this.ty*this.a+this.tx*this.b)*s,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),s=Math.sin(e),i=this.a,r=this.c,n=this.tx;return this.a=i*t-this.b*s,this.b=i*s+this.b*t,this.c=r*t-this.d*s,this.d=r*s+this.d*t,this.tx=n*t-this.ty*s,this.ty=n*s+this.ty*t,this}append(e){const t=this.a,s=this.b,i=this.c,r=this.d;return this.a=e.a*t+e.b*i,this.b=e.a*s+e.b*r,this.c=e.c*t+e.d*i,this.d=e.c*s+e.d*r,this.tx=e.tx*t+e.ty*i+this.tx,this.ty=e.tx*s+e.ty*r+this.ty,this}setTransform(e,t,s,i,r,n,o,a,l){return this.a=Math.cos(o+l)*r,this.b=Math.sin(o+l)*r,this.c=-Math.sin(o-a)*n,this.d=Math.cos(o-a)*n,this.tx=e-(s*this.a+i*this.c),this.ty=t-(s*this.b+i*this.d),this}prepend(e){const t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){const t=this.a,s=this.c;this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=s*e.a+this.d*e.c,this.d=s*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,s=this.b,i=this.c,r=this.d,n=e.pivot,o=-Math.atan2(-i,r),a=Math.atan2(s,t),l=Math.abs(o+a);return l<1e-5||Math.abs(Lt-l)<1e-5?(e.rotation=a,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=a),e.scale.x=Math.sqrt(t*t+s*s),e.scale.y=Math.sqrt(i*i+r*r),e.position.x=this.tx+(n.x*t+n.y*i),e.position.y=this.ty+(n.x*s+n.y*r),e}invert(){const e=this.a,t=this.b,s=this.c,i=this.d,r=this.tx,n=e*i-t*s;return this.a=i/n,this.b=-t/n,this.c=-s/n,this.d=e/n,this.tx=(s*this.ty-i*r)/n,this.ty=-(e*this.ty-t*r)/n,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new Wt;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new Wt}static get TEMP_MATRIX(){return new Wt}}Wt.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const $t=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Xt=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],jt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],zt=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Yt=[],qt=[],Qt=Math.sign;!function(){for(let e=0;e<16;e++){const t=[];Yt.push(t);for(let s=0;s<16;s++){const i=Qt($t[e]*$t[s]+jt[e]*Xt[s]),r=Qt(Xt[e]*$t[s]+zt[e]*Xt[s]),n=Qt($t[e]*jt[s]+jt[e]*zt[s]),o=Qt(Xt[e]*jt[s]+zt[e]*zt[s]);for(let e=0;e<16;e++)if($t[e]===i&&Xt[e]===r&&jt[e]===n&&zt[e]===o){t.push(e);break}}}for(let e=0;e<16;e++){const t=new Wt;t.set($t[e],Xt[e],jt[e],zt[e],0,0),qt.push(t)}}();const Kt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>$t[e],uY:e=>Xt[e],vX:e=>jt[e],vY:e=>zt[e],inv:e=>8&e?15&e:7&-e,add:(e,t)=>Yt[e][t],sub:(e,t)=>Yt[e][Kt.inv(t)],rotate180:e=>4^e,isVertical:e=>2==(3&e),byDirection:(e,t)=>2*Math.abs(e)<=Math.abs(t)?t>=0?Kt.S:Kt.N:2*Math.abs(t)<=Math.abs(e)?e>0?Kt.E:Kt.W:t>0?e>0?Kt.SE:Kt.SW:e>0?Kt.NE:Kt.NW,matrixAppendRotationInv:(e,t,s=0,i=0)=>{const r=qt[Kt.inv(t)];r.tx=s,r.ty=i,e.append(r)}};class Zt{constructor(e,t,s=0,i=0){this._x=s,this._y=i,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new Zt(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}Zt.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Jt=class{constructor(){this.worldTransform=new Wt,this.localTransform=new Wt,this.position=new Zt(this.onChange,this,0,0),this.scale=new Zt(this.onChange,this,1,1),this.pivot=new Zt(this.onChange,this,0,0),this.skew=new Zt(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const s=e.worldTransform,i=this.worldTransform;i.a=t.a*s.a+t.b*s.c,i.b=t.a*s.b+t.b*s.d,i.c=t.c*s.a+t.d*s.c,i.d=t.c*s.b+t.d*s.d,i.tx=t.tx*s.a+t.ty*s.c+s.tx,i.ty=t.tx*s.b+t.ty*s.d+s.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};Jt.IDENTITY=new Jt;let es=Jt;es.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};const ts=[{test:e=>'float'===e.type&&1===e.size&&!e.isArray,code:e=>`\n            if(uv["${e}"] !== ud["${e}"].value)\n            {\n                ud["${e}"].value = uv["${e}"]\n                gl.uniform1f(ud["${e}"].location, uv["${e}"])\n            }\n            `},{test:(e,t)=>!('sampler2D'!==e.type&&'samplerCube'!==e.type&&'sampler2DArray'!==e.type||1!==e.size||e.isArray||null!=t&&void 0===t.castToBaseTexture),code:e=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${e}"], t);\n\n            if(ud["${e}"].value !== t)\n            {\n                ud["${e}"].value = t;\n                gl.uniform1i(ud["${e}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(e,t)=>'mat3'===e.type&&1===e.size&&!e.isArray&&void 0!==t.a,code:e=>`\n            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));\n            `,codeUbo:e=>`\n                var ${e}_matrix = uv.${e}.toArray(true);\n\n                data[offset] = ${e}_matrix[0];\n                data[offset+1] = ${e}_matrix[1];\n                data[offset+2] = ${e}_matrix[2];\n        \n                data[offset + 4] = ${e}_matrix[3];\n                data[offset + 5] = ${e}_matrix[4];\n                data[offset + 6] = ${e}_matrix[5];\n        \n                data[offset + 8] = ${e}_matrix[6];\n                data[offset + 9] = ${e}_matrix[7];\n                data[offset + 10] = ${e}_matrix[8];\n            `},{test:(e,t)=>'vec2'===e.type&&1===e.size&&!e.isArray&&void 0!==t.x,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${e}"].location, v.x, v.y);\n                }`,codeUbo:e=>`\n                v = uv.${e};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:e=>'vec2'===e.type&&1===e.size&&!e.isArray,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);\n                }\n            `},{test:(e,t)=>'vec4'===e.type&&1===e.size&&!e.isArray&&void 0!==t.width,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(e,t)=>'vec4'===e.type&&1===e.size&&!e.isArray&&void 0!==t.red,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${e}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(e,t)=>'vec3'===e.type&&1===e.size&&!e.isArray&&void 0!==t.red,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${e}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:e=>`\n                    v = uv.${e};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:e=>'vec4'===e.type&&1===e.size&&!e.isArray,code:e=>`\n                cv = ud["${e}"].value;\n                v = uv["${e}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])\n                }`}],ss={float:'\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }',vec2:'\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }',vec3:'\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }',vec4:'\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }',int:'\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }',ivec2:'\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }',ivec3:'\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }',ivec4:'\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }',uint:'\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }',uvec2:'\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }',uvec3:'\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }',uvec4:'\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }',bool:'\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }',bvec2:'\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }',bvec3:'\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }',bvec4:'\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }',mat2:'gl.uniformMatrix2fv(location, false, v)',mat3:'gl.uniformMatrix3fv(location, false, v)',mat4:'gl.uniformMatrix4fv(location, false, v)',sampler2D:'\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }',samplerCube:'\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }',sampler2DArray:'\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }'},is={float:'gl.uniform1fv(location, v)',vec2:'gl.uniform2fv(location, v)',vec3:'gl.uniform3fv(location, v)',vec4:'gl.uniform4fv(location, v)',mat4:'gl.uniformMatrix4fv(location, false, v)',mat3:'gl.uniformMatrix3fv(location, false, v)',mat2:'gl.uniformMatrix2fv(location, false, v)',int:'gl.uniform1iv(location, v)',ivec2:'gl.uniform2iv(location, v)',ivec3:'gl.uniform3iv(location, v)',ivec4:'gl.uniform4iv(location, v)',uint:'gl.uniform1uiv(location, v)',uvec2:'gl.uniform2uiv(location, v)',uvec3:'gl.uniform3uiv(location, v)',uvec4:'gl.uniform4uiv(location, v)',bool:'gl.uniform1iv(location, v)',bvec2:'gl.uniform2iv(location, v)',bvec3:'gl.uniform3iv(location, v)',bvec4:'gl.uniform4iv(location, v)',sampler2D:'gl.uniform1iv(location, v)',samplerCube:'gl.uniform1iv(location, v)',sampler2DArray:'gl.uniform1iv(location, v)'};const rs={};let ns,os=rs;function as(){if(os===rs||os?.isContextLost()){const e=L.ADAPTER.createCanvas();let t;L.PREFER_ENV>=u.WEBGL2&&(t=e.getContext('webgl2',{})),t||(t=e.getContext('webgl',{})||e.getContext('experimental-webgl',{}),t?t.getExtension('WEBGL_draw_buffers'):t=null),os=t}return os}const ls={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function hs(e){return ls[e]}let us=null;const cs={FLOAT:'float',FLOAT_VEC2:'vec2',FLOAT_VEC3:'vec3',FLOAT_VEC4:'vec4',INT:'int',INT_VEC2:'ivec2',INT_VEC3:'ivec3',INT_VEC4:'ivec4',UNSIGNED_INT:'uint',UNSIGNED_INT_VEC2:'uvec2',UNSIGNED_INT_VEC3:'uvec3',UNSIGNED_INT_VEC4:'uvec4',BOOL:'bool',BOOL_VEC2:'bvec2',BOOL_VEC3:'bvec3',BOOL_VEC4:'bvec4',FLOAT_MAT2:'mat2',FLOAT_MAT3:'mat3',FLOAT_MAT4:'mat4',SAMPLER_2D:'sampler2D',INT_SAMPLER_2D:'sampler2D',UNSIGNED_INT_SAMPLER_2D:'sampler2D',SAMPLER_CUBE:'samplerCube',INT_SAMPLER_CUBE:'samplerCube',UNSIGNED_INT_SAMPLER_CUBE:'samplerCube',SAMPLER_2D_ARRAY:'sampler2DArray',INT_SAMPLER_2D_ARRAY:'sampler2DArray',UNSIGNED_INT_SAMPLER_2D_ARRAY:'sampler2DArray'};function ds(e,t){if(!us){const t=Object.keys(cs);us={};for(let s=0;s<t.length;++s){const i=t[s];us[e[i]]=cs[i]}}return us[t]}function ps(e,t,s){if('precision'!==e.substring(0,9)){let i=t;return t===S.HIGH&&s!==S.HIGH&&(i=S.MEDIUM),`precision ${i} float;\n${e}`}return s!==S.HIGH&&'precision highp'===e.substring(0,15)?e.replace('precision highp','precision mediump'):e}let fs=0;const gs={},ms=class e{constructor(t,s,i='pixi-shader',r={}){this.extra={},this.id=fs++,this.vertexSrc=t||e.defaultVertexSrc,this.fragmentSrc=s||e.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,'#version'!==this.vertexSrc.substring(0,8)&&(i=i.replace(/\s+/g,'-'),gs[i]?(gs[i]++,i+=`-${gs[i]}`):gs[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}\n${this.fragmentSrc}`,this.vertexSrc=ps(this.vertexSrc,e.defaultVertexPrecision,S.HIGH),this.fragmentSrc=ps(this.fragmentSrc,e.defaultFragmentPrecision,function(){if(!ns){ns=S.MEDIUM;const e=as();if(e&&e.getShaderPrecisionFormat){const t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);t&&(ns=t.precision?S.HIGH:S.MEDIUM)}}return ns}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return'attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n'}static get defaultFragmentSrc(){return'varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}'}static from(t,s,i){const r=t+s;let n=je[r];return n||(je[r]=n=new e(t,s,i)),n}};ms.defaultVertexPrecision=S.HIGH,ms.defaultFragmentPrecision=k.apple.device?S.HIGH:S.MEDIUM;let _s=ms,vs=0;class ys{constructor(e,t,s){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=vs++,this.static=!!t,this.ubo=!!s,e instanceof Et?(this.buffer=e,this.buffer.type=I.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Et(new Float32Array(1)),this.buffer.type=I.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,s){if(this.ubo)throw new Error('[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them');this.uniforms[e]=new ys(t,s)}static from(e,t,s){return new ys(e,t,s)}static uboFrom(e,t){return new ys(e,t??!0,!0)}}class xs{constructor(e,t){this.uniformBindCount=0,this.program=e,this.uniformGroup=t?t instanceof ys?t:new ys(t):new ys({}),this.disposeRunner=new mt('disposeShader')}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const s in t.uniforms){const i=t.uniforms[s];if(!0===i.group&&this.checkUniformExists(e,i))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,s){const i=_s.from(e,t);return new xs(i,s)}}class bs{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes('%count%'))throw new Error('Fragment template must contain "%count%".');if(!t.includes('%forloop%'))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const t=new Int32Array(e);for(let s=0;s<e;s++)t[s]=s;this.defaultGroupCache[e]=ys.from({uSamplers:t},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${e}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new _s(this.vertexSrc,s)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new Wt,default:this.defaultGroupCache[e]};return new xs(this.programCache[e],t)}generateSampleSrc(e){let t='';t+='\n',t+='\n';for(let s=0;s<e;s++)s>0&&(t+='\nelse '),s<e-1&&(t+=`if(vTextureId < ${s}.5)`),t+='\n{',t+=`\n\tcolor = texture2D(uSamplers[${s}], vTextureCoord);`,t+='\n}';return t+='\n',t+='\n',t}}class Ts{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}class ws{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}const Es=class e extends ws{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Rt,this.vertexSize=6,this.state=pt.for2d(),this.size=4*e.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on('prerender',this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(e){let t=!0;const s=L.ADAPTER.getNavigator();if(k.tablet||k.phone){if(k.apple.device){const e=s.userAgent.match(/OS (\d+)_(\d+)?/);e&&parseInt(e[1],10)<11&&(t=!1)}if(k.android.device){const e=s.userAgent.match(/Android\s([0-9.]*)/);e&&parseInt(e[1],10)<7&&(t=!1)}}return t?e:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!k.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return B('7.1.0','BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures'),this.maxTextures}static get defaultVertexSrc(){return'precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n'}static get defaultFragmentTemplate(){return'varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n'}setShaderGenerator({vertex:t=e.defaultVertexSrc,fragment:s=e.defaultFragmentTemplate}={}){this.shaderGenerator=new bs(t,s)}contextChange(){const t=this.renderer.gl;L.PREFER_ENV===u.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),e.defaultMaxTextures),this.maxTextures=dt(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:s}=e,i=this.size/4,r=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new Tt);for(;s.length<r;)s.push(new Ts);for(let e=0;e<this.maxTextures;e++)this._tempBoundTextures[e]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:s}=this,i=e._textureArrayPool,r=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++bt._globalBatch,l=0,h=i[0],u=0;r.copyBoundTextures(n,s);for(let e=0;e<this._bufferSize;++e){const c=t[e];t[e]=null,c._batchEnabled!==a&&(h.count>=s&&(r.boundArray(h,n,a,s),this.buildDrawCalls(h,u,e),u=e,h=i[++l],++a),c._batchEnabled=a,c.touched=o,h.elements[h.count++]=c)}h.count>0&&(r.boundArray(h,n,a,s),this.buildDrawCalls(h,u,this._bufferSize),++l,++a);for(let e=0;e<n.length;e++)n[e]=null;bt._globalBatch=a}buildDrawCalls(t,s,i){const{_bufferedElements:r,_attributeBuffer:n,_indexBuffer:o,vertexSize:a}=this,l=e._drawCallPool;let h=this._dcIndex,u=this._aIndex,c=this._iIndex,d=l[h];d.start=this._iIndex,d.texArray=t;for(let e=s;e<i;++e){const i=r[e],p=i._texture.baseTexture,f=Ae[p.alphaMode?1:0][i.blendMode];r[e]=null,s<e&&d.blend!==f&&(d.size=c-d.start,s=e,d=l[++h],d.texArray=t,d.start=c),this.packInterleavedGeometry(i,n,o,u,c),u+=i.vertexData.length/2*a,c+=i.indices.length,d.blend=f}s<i&&(d.size=c-d.start,++h),this._dcIndex=h,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(e){const t=this.renderer.texture;for(let s=0;s<e.count;s++)t.bind(e.elements[s],e.ids[s]),e.elements[s]=null;e.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:s,_indexBuffer:i}=this;e.canUploadSameBuffer?(t[this._flushId]._buffer.update(s.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(s.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:s,state:i}=this.renderer,r=e._drawCallPool;let n=null;for(let e=0;e<t;e++){const{texArray:t,type:o,size:a,start:l,blend:h}=r[e];n!==t&&(n=t,this.bindAndClearTexArray(t)),this.state.blendMode=h,i.set(this.state),s.drawElements(o,a,s.UNSIGNED_SHORT,2*l)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),e.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off('prerender',this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=Oe(Math.ceil(e/8)),s=Ue(t),i=8*t;this._aBuffers.length<=s&&(this._iBuffers.length=s+1);let r=this._aBuffers[i];return r||(this._aBuffers[i]=r=new ht(i*this.vertexSize*4)),r}getIndexBuffer(e){const t=Oe(Math.ceil(e/12)),s=Ue(t),i=12*t;this._iBuffers.length<=s&&(this._iBuffers.length=s+1);let r=this._iBuffers[s];return r||(this._iBuffers[s]=r=new Uint16Array(i)),r}packInterleavedGeometry(e,t,s,i,r){const{uint32View:n,float32View:o}=t,a=i/this.vertexSize,l=e.uvs,h=e.indices,u=e.vertexData,c=e._texture.baseTexture._batchLocation,d=Math.min(e.worldAlpha,1),p=Te.shared.setValue(e._tintRGB).toPremultiplied(d,e._texture.baseTexture.alphaMode>0);for(let e=0;e<u.length;e+=2)o[i++]=u[e],o[i++]=u[e+1],o[i++]=l[e],o[i++]=l[e+1],n[i++]=p,o[i++]=c;for(let e=0;e<h.length;e++)s[r++]=a+h[e]}};Es.defaultBatchSize=4096,Es.extension={name:'batch',type:nt.RendererPlugin},Es._drawCallPool=[],Es._textureArrayPool=[];let Cs=Es;lt.add(Cs);const Ss=class e extends xs{constructor(t,s,i){super(_s.from(t||e.defaultVertexSrc,s||e.defaultFragmentSrc),i),this.padding=0,this.resolution=e.defaultResolution,this.multisample=e.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new pt}apply(e,t,s,i,r){e.applyFilter(this,t,s,i)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return'attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n'}static get defaultFragmentSrc(){return'varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n'}};Ss.defaultResolution=1,Ss.defaultMultisample=P.NONE;let As=Ss;class Ms{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Te(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:s,backgroundAlpha:i}=e,r=s??t;void 0!==r&&(this.color=r),this.alpha=i}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}Ms.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Ms.extension={type:[nt.RendererSystem,nt.CanvasRendererSystem],name:'background'},lt.add(Ms);class Ps{constructor(e){this.renderer=e,this.emptyRenderer=new ws(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:s}=this.renderer.texture;for(let i=t-1;i>=0;--i)e[i]=s[i]||null,e[i]&&(e[i]._batchLocation=i)}boundArray(e,t,s,i){const{elements:r,ids:n,count:o}=e;let a=0;for(let e=0;e<o;e++){const o=r[e],l=o._batchLocation;if(l>=0&&l<i&&t[l]===o)n[e]=l;else for(;a<i;){const i=t[a];if(!i||i._batchEnabled!==s||i._batchLocation!==a){n[e]=a,o._batchLocation=a,t[a]=o;break}a++}}}destroy(){this.renderer=null}}Ps.extension={type:nt.RendererSystem,name:'batch'},lt.add(Ps);let Is=0;class Rs{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=Is++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,s=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:s,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=Is++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;void 0!==t.addEventListener&&(t.addEventListener('webglcontextlost',this.handleContextLost,!1),t.addEventListener('webglcontextrestored',this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let s;if(L.PREFER_ENV>=u.WEBGL2&&(s=e.getContext('webgl2',t)),s)this.webGLVersion=2;else if(this.webGLVersion=1,s=e.getContext('webgl',t)||e.getContext('experimental-webgl',t),!s)throw new Error('This browser does not support WebGL. Try using the canvas renderer');return this.gl=s,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension('WEBGL_lose_context'),anisotropicFiltering:e.getExtension('EXT_texture_filter_anisotropic'),floatTextureLinear:e.getExtension('OES_texture_float_linear'),s3tc:e.getExtension('WEBGL_compressed_texture_s3tc'),s3tc_sRGB:e.getExtension('WEBGL_compressed_texture_s3tc_srgb'),etc:e.getExtension('WEBGL_compressed_texture_etc'),etc1:e.getExtension('WEBGL_compressed_texture_etc1'),pvrtc:e.getExtension('WEBGL_compressed_texture_pvrtc')||e.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc'),atc:e.getExtension('WEBGL_compressed_texture_atc'),astc:e.getExtension('WEBGL_compressed_texture_astc'),bptc:e.getExtension('EXT_texture_compression_bptc')};1===this.webGLVersion?Object.assign(this.extensions,t,{drawBuffers:e.getExtension('WEBGL_draw_buffers'),depthTexture:e.getExtension('WEBGL_depth_texture'),vertexArrayObject:e.getExtension('OES_vertex_array_object')||e.getExtension('MOZ_OES_vertex_array_object')||e.getExtension('WEBKIT_OES_vertex_array_object'),uint32ElementIndex:e.getExtension('OES_element_index_uint'),floatTexture:e.getExtension('OES_texture_float'),floatTextureLinear:e.getExtension('OES_texture_float_linear'),textureHalfFloat:e.getExtension('OES_texture_half_float'),textureHalfFloatLinear:e.getExtension('OES_texture_half_float_linear')}):2===this.webGLVersion&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension('EXT_color_buffer_float')})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,void 0!==e.removeEventListener&&(e.removeEventListener('webglcontextlost',this.handleContextLost),e.removeEventListener('webglcontextrestored',this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),s='WebGL2RenderingContext'in globalThis&&e instanceof globalThis.WebGL2RenderingContext;s&&(this.webGLVersion=2),t&&!t.stencil&&console.warn('Provided WebGL context does not have a stencil buffer, masks may not render correctly');const i=s||!!e.getExtension('OES_element_index_uint');this.supports.uint32Indices=i,i||console.warn('Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly')}}Rs.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:'default'},Rs.extension={type:nt.RendererSystem,name:'context'},lt.add(Rs);class Ls{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error('Framebuffer width or height is zero');this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new mt('disposeFramebuffer'),this.multisample=P.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new bt(null,{scaleMode:x.NEAREST,resolution:1,mipmap:T.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new bt(null,{scaleMode:x.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:T.OFF,format:g.DEPTH_COMPONENT,type:v.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error('Framebuffer width and height must not be zero');if(e!==this.width||t!==this.height){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let s=0;s<this.colorTextures.length;s++){const i=this.colorTextures[s],r=i.resolution;i.setSize(e/r,t/r)}if(this.depthTexture){const s=this.depthTexture.resolution;this.depthTexture.setSize(e/s,t/s)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class ks extends bt{constructor(e={}){if('number'==typeof e){e={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=P.NONE),super(null,e),this.mipmap=T.OFF,this.valid=!0,this._clear=new Te([0,0,0,0]),this.framebuffer=new Ls(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Ds extends _t{constructor(e){const t=e;super(t.naturalWidth||t.videoWidth||t.displayWidth||t.width,t.naturalHeight||t.videoHeight||t.displayHeight||t.height),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,s){void 0!==s||t.startsWith('data:')?!1!==s&&(e.crossOrigin='string'==typeof s?s:'anonymous'):e.crossOrigin=it(t)}upload(e,t,s,i){const r=e.gl,n=t.realWidth,o=t.realHeight;if(i=i||this.source,typeof HTMLImageElement<'u'&&i instanceof HTMLImageElement){if(!i.complete||0===i.naturalWidth)return!1}else if(typeof HTMLVideoElement<'u'&&i instanceof HTMLVideoElement&&i.readyState<=1)return!1;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===w.UNPACK),this.noSubImage||t.target!==r.TEXTURE_2D||s.width!==n||s.height!==o?(s.width=n,s.height=o,r.texImage2D(t.target,0,s.internalFormat,t.format,s.type,i)):r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.format,s.type,i),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,s=e.naturalHeight||e.videoHeight||e.height;this.resize(t,s),super.update()}dispose(){this.source=null}}class Bs extends Ds{constructor(e,t){if(t=t||{},'string'==typeof e){const s=new Image;Ds.crossOrigin(s,e,t.crossorigin),s.src=e,e=s}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??L.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode='number'==typeof t.alphaMode?t.alphaMode:null,this.bitmap=null,this._load=null,!1!==t.autoLoad&&this.load()}load(e){return this._load||(void 0!==e&&(this.createBitmap=e),this._load=new Promise((e,t)=>{const s=this.source;this.url=s.src;const i=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?i():(s.onload=i,s.onerror=e=>{t(e),this.onError.emit(e)})})),this._load}process(){const e=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,s=!e.crossOrigin||'anonymous'===e.crossOrigin;return this._process=fetch(e.src,{mode:s?'cors':'no-cors'}).then(e=>e.blob()).then(s=>t(s,0,0,e.width,e.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===w.UNPACK?'premultiply':'none'})).then(e=>this.destroyed?Promise.reject():(this.bitmap=e,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,s){if('number'==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,s);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,s,this.bitmap),!this.preserveBitmap){let e=!0;const i=t._glTextures;for(const r in i){const n=i[r];if(n!==s&&n.dirtyId!==t.dirtyId){e=!1;break}}e&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<'u'&&('string'==typeof e||e instanceof HTMLImageElement)}}class Fs{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,s){const i=t.width,r=t.height;if(s){const t=e.width/2/i,n=e.height/2/r,o=e.x/i+t,a=e.y/r+n;s=Kt.add(s,Kt.NW),this.x0=o+t*Kt.uX(s),this.y0=a+n*Kt.uY(s),s=Kt.add(s,2),this.x1=o+t*Kt.uX(s),this.y1=a+n*Kt.uY(s),s=Kt.add(s,2),this.x2=o+t*Kt.uX(s),this.y2=a+n*Kt.uY(s),s=Kt.add(s,2),this.x3=o+t*Kt.uX(s),this.y3=a+n*Kt.uY(s)}else this.x0=e.x/i,this.y0=e.y/r,this.x1=(e.x+e.width)/i,this.y1=e.y/r,this.x2=(e.x+e.width)/i,this.y2=(e.y+e.height)/r,this.x3=e.x/i,this.y3=(e.y+e.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}Fs.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Os=new Fs;function Ns(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class Us extends s{constructor(e,t,s,i,r,n,o){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new Nt(0,0,1,1)),e instanceof Us&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=i,this.valid=!1,this.destroyed=!1,this._uvs=Os,this.uvMatrix=null,this.orig=s||t,this._rotate=Number(r||0),!0===r)this._rotate=2;else if(this._rotate%2!=0)throw new Error('attempt to use diamond-shaped UVs. If you are sure, set rotation manually');this.defaultAnchor=n?new Ft(n.x,n.y):new Ft(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once('loaded',this.onBaseTextureUpdated,this),this.noFrame&&e.on('update',this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit('update',this)}destroy(e){if(this.baseTexture){if(e){const{resource:e}=this.baseTexture;e?.url&&ze[e.url]&&Us.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off('loaded',this.onBaseTextureUpdated,this),this.baseTexture.off('update',this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Us.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit('destroyed',this),this.removeAllListeners()}clone(){const e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),s=new Us(this.baseTexture,!this.noFrame&&e,t,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(s._frame=e),s}updateUvs(){this._uvs===Os&&(this._uvs=new Fs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},s=L.STRICT_TEXTURE_CACHE){const i='string'==typeof e;let r=null;if(i)r=e;else if(e instanceof bt){if(!e.cacheId){const s=t?.pixiIdPrefix||'pixiid';e.cacheId=`${s}-${We()}`,bt.addToCache(e,e.cacheId)}r=e.cacheId}else{if(!e._pixiId){const s=t?.pixiIdPrefix||'pixiid';e._pixiId=`${s}_${We()}`}r=e._pixiId}let n=ze[r];if(i&&s&&!n)throw new Error(`The cacheId "${r}" does not exist in TextureCache.`);return n||e instanceof bt?!n&&e instanceof bt&&(n=new Us(e),Us.addToCache(n,r)):(t.resolution||(t.resolution=rt(e)),n=new Us(new bt(e,t)),n.baseTexture.cacheId=r,bt.addToCache(n.baseTexture,r),Us.addToCache(n,r)),n}static fromURL(e,t){const s=Object.assign({autoLoad:!1},t?.resourceOptions),i=Us.from(e,Object.assign({resourceOptions:s},t),!1),r=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):r.load().then(()=>Promise.resolve(i))}static fromBuffer(e,t,s,i){return new Us(bt.fromBuffer(e,t,s,i))}static fromLoader(e,t,s,i){const r=new bt(e,Object.assign({scaleMode:bt.defaultOptions.scaleMode,resolution:rt(t)},i)),{resource:n}=r;n instanceof Bs&&(n.url=t);const o=new Us(r);return s||(s=t),bt.addToCache(o.baseTexture,s),Us.addToCache(o,s),s!==t&&(bt.addToCache(o.baseTexture,t),Us.addToCache(o,t)),o.baseTexture.valid?Promise.resolve(o):new Promise(e=>{o.baseTexture.once('loaded',()=>e(o))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),ze[t]&&ze[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),ze[t]=e)}static removeFromCache(e){if('string'==typeof e){const t=ze[e];if(t){const s=t.textureCacheIds.indexOf(e);return s>-1&&t.textureCacheIds.splice(s,1),delete ze[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)ze[e.textureCacheIds[t]]===e&&delete ze[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:s,width:i,height:r}=e,n=t+i>this.baseTexture.width,o=s+r>this.baseTexture.height;if(n||o){const e=n&&o?'and':'or',a=`X: ${t} + ${i} = ${t+i} > ${this.baseTexture.width}`,l=`Y: ${s} + ${r} = ${s+r} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${e} ${l}`)}this.valid=i&&r&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Us._EMPTY||(Us._EMPTY=new Us(new bt),Ns(Us._EMPTY),Ns(Us._EMPTY.baseTexture)),Us._EMPTY}static get WHITE(){if(!Us._WHITE){const e=L.ADAPTER.createCanvas(16,16),t=e.getContext('2d');e.width=16,e.height=16,t.fillStyle='white',t.fillRect(0,0,16,16),Us._WHITE=new Us(bt.from(e)),Ns(Us._WHITE),Ns(Us._WHITE.baseTexture)}return Us._WHITE}}class Gs extends Us{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,s=!0){const i=this.baseTexture.resolution,r=Math.round(e*i)/i,n=Math.round(t*i)/i;this.valid=r>0&&n>0,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=n,s&&this.baseTexture.resize(r,n),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new Gs(new ks(e))}}class Vs{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,s=P.NONE){const i=new ks(Object.assign({width:e,height:t,resolution:1,multisample:s},this.textureOptions));return new Gs(i)}getOptimalTexture(e,t,s=1,i=P.NONE){let r;e=Math.max(Math.ceil(e*s-1e-6),1),t=Math.max(Math.ceil(t*s-1e-6),1),this.enableFullScreen&&e===this._pixelsWidth&&t===this._pixelsHeight?r=i>1?-i:-1:(r=((65535&(e=Oe(e)))<<16|65535&(t=Oe(t)))>>>0,i>1&&(r+=4294967296*i)),this.texturePool[r]||(this.texturePool[r]=[]);let n=this.texturePool[r].pop();return n||(n=this.createTexture(e,t,i)),n.filterPoolKey=r,n.setResolution(s),n}getFilterTexture(e,t,s){const i=this.getOptimalTexture(e.width,e.height,t||e.resolution,s||P.NONE);return i.filterFrame=e.filterFrame,i}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=!1!==e)for(const e in this.texturePool){const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this.texturePool={}}setScreenSize(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){this.enableFullScreen=e.width>0&&e.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}Vs.SCREEN_KEY=-1;class Hs extends It{constructor(){super(),this.addAttribute('aVertexPosition',new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Ws extends It{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Et(this.vertices),this.uvBuffer=new Et(this.uvs),this.addAttribute('aVertexPosition',this.vertexBuffer).addAttribute('aTextureCoord',this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let s=0,i=0;return this.uvs[0]=s,this.uvs[1]=i,this.uvs[2]=s+t.width/e.width,this.uvs[3]=i,this.uvs[4]=s+t.width/e.width,this.uvs[5]=i+t.height/e.height,this.uvs[6]=s,this.uvs[7]=i+t.height/e.height,s=t.x,i=t.y,this.vertices[0]=s,this.vertices[1]=i,this.vertices[2]=s+t.width,this.vertices[3]=i,this.vertices[4]=s+t.width,this.vertices[5]=i+t.height,this.vertices[6]=s,this.vertices[7]=i+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class $s{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=P.NONE,this.sourceFrame=new Nt,this.destinationFrame=new Nt,this.bindingSourceFrame=new Nt,this.bindingDestinationFrame=new Nt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Xs=[new Ft,new Ft,new Ft,new Ft],js=new Wt;class zs{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new Vs,this.statePool=[],this.quad=new Hs,this.quadUv=new Ws,this.tempRect=new Nt,this.activeState={},this.globalUniforms=new ys({outputFrame:new Nt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const s=this.renderer,i=this.defaultFilterStack,r=this.statePool.pop()||new $s,n=s.renderTexture;let o,a;if(n.current){const e=n.current;o=e.resolution,a=e.multisample}else o=s.resolution,a=s.multisample;let l=t[0].resolution||o,h=t[0].multisample??a,u=t[0].padding,c=t[0].autoFit,d=t[0].legacy??!0;for(let e=1;e<t.length;e++){const s=t[e];l=Math.min(l,s.resolution||o),h=Math.min(h,s.multisample??a),u=this.useMaxPadding?Math.max(u,s.padding):u+s.padding,c=c&&s.autoFit,d=d||(s.legacy??!0)}1===i.length&&(this.defaultFilterStack[0].renderTexture=n.current),i.push(r),r.resolution=l,r.multisample=h,r.legacy=d,r.target=e,r.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),r.sourceFrame.pad(u);const p=this.tempRect.copyFrom(n.sourceFrame);s.projection.transform&&this.transformAABB(js.copyFrom(s.projection.transform).invert(),p),c?(r.sourceFrame.fit(p),(r.sourceFrame.width<=0||r.sourceFrame.height<=0)&&(r.sourceFrame.width=0,r.sourceFrame.height=0)):r.sourceFrame.intersects(p)||(r.sourceFrame.width=0,r.sourceFrame.height=0),this.roundFrame(r.sourceFrame,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),r.renderTexture=this.getOptimalFilterTexture(r.sourceFrame.width,r.sourceFrame.height,l,h),r.filters=t,r.destinationFrame.width=r.renderTexture.width,r.destinationFrame.height=r.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=r.sourceFrame.width,f.height=r.sourceFrame.height,r.renderTexture.filterFrame=r.sourceFrame,r.bindingSourceFrame.copyFrom(n.sourceFrame),r.bindingDestinationFrame.copyFrom(n.destinationFrame),r.transform=s.projection.transform,s.projection.transform=null,n.bind(r.renderTexture,r.sourceFrame,f),s.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),s=t.filters;this.activeState=t;const i=this.globalUniforms.uniforms;i.outputFrame=t.sourceFrame,i.resolution=t.resolution;const r=i.inputSize,n=i.inputPixel,o=i.inputClamp;if(r[0]=t.destinationFrame.width,r[1]=t.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],n[0]=Math.round(r[0]*t.resolution),n[1]=Math.round(r[1]*t.resolution),n[2]=1/n[0],n[3]=1/n[1],o[0]=.5*n[2],o[1]=.5*n[3],o[2]=t.sourceFrame.width*r[2]-.5*n[2],o[3]=t.sourceFrame.height*r[3]-.5*n[3],t.legacy){const e=i.filterArea;e[0]=t.destinationFrame.width,e[1]=t.destinationFrame.height,e[2]=t.sourceFrame.x,e[3]=t.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();const a=e[e.length-1];if(this.renderer.framebuffer.blit(),1===s.length)s[0].apply(this,t.renderTexture,a.renderTexture,E.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let e=t.renderTexture,i=this.getOptimalFilterTexture(e.width,e.height,t.resolution);i.filterFrame=e.filterFrame;let r=0;for(r=0;r<s.length-1;++r){1===r&&t.multisample>1&&(i=this.getOptimalFilterTexture(e.width,e.height,t.resolution),i.filterFrame=e.filterFrame),s[r].apply(this,e,i,E.CLEAR,t);const n=e;e=i,i=n}s[r].apply(this,e,a.renderTexture,E.BLEND,t),r>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(e),this.returnFilterTexture(i)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=E.CLEAR){const{renderTexture:s,state:i}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e?.filterFrame){const t=this.tempRect;t.x=0,t.y=0,t.width=e.filterFrame.width,t.height=e.filterFrame.height,s.bind(e,e.filterFrame,t)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?s.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const r=1&i.stateId||this.forceClear;(t===E.CLEAR||t===E.BLIT&&r)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,s,i){const r=this.renderer;r.state.set(e.state),this.bindAndClear(s,i),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(f.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(f.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:s,destinationFrame:i}=this.activeState,{orig:r}=t._texture,n=e.set(i.width,0,0,i.height,s.x,s.y),o=t.worldTransform.copyTo(Wt.TEMP_MATRIX);return o.invert(),n.prepend(o),n.scale(1/r.width,1/r.height),n.translate(t.anchor.x,t.anchor.y),n}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,s=1,i=P.NONE){return this.texturePool.getOptimalTexture(e,t,s,i)}getFilterTexture(e,t,s){if('number'==typeof e){const s=e;e=t,t=s}e=e||this.activeState.renderTexture;const i=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,s||P.NONE);return i.filterFrame=e.filterFrame,i}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const s=Xs[0],i=Xs[1],r=Xs[2],n=Xs[3];s.set(t.left,t.top),i.set(t.left,t.bottom),r.set(t.right,t.top),n.set(t.right,t.bottom),e.apply(s,s),e.apply(i,i),e.apply(r,r),e.apply(n,n);const o=Math.min(s.x,i.x,r.x,n.x),a=Math.min(s.y,i.y,r.y,n.y),l=Math.max(s.x,i.x,r.x,n.x),h=Math.max(s.y,i.y,r.y,n.y);t.x=o,t.y=a,t.width=l-o,t.height=h-a}roundFrame(e,t,s,i,r){if(!(e.width<=0||e.height<=0||s.width<=0||s.height<=0)){if(r){const{a:e,b:t,c:s,d:i}=r;if((Math.abs(t)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(i)>1e-4))return}(r=r?js.copyFrom(r):js.identity()).translate(-s.x,-s.y).scale(i.width/s.width,i.height/s.height).translate(i.x,i.y),this.transformAABB(r,e),e.ceil(t),this.transformAABB(r.invert(),e)}}}zs.extension={type:nt.RendererSystem,name:'filter'},lt.add(zs);class Ys{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=P.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const qs=new Nt;class Qs{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new Ls(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Nt,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let t=this.renderer.context.extensions.drawBuffers,s=this.renderer.context.extensions.depthTexture;L.PREFER_ENV===u.WEBGL_LEGACY&&(t=null,s=null),t?e.drawBuffers=e=>t.drawBuffersWEBGL(e):(this.hasMRT=!1,e.drawBuffers=()=>{}),s||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,s=0){const{gl:i}=this;if(e){const r=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,i.bindFramebuffer(i.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==s&&(e.dirtyId++,e.dirtyFormat++,r.mipLevel=s),r.dirtyId!==e.dirtyId&&(r.dirtyId=e.dirtyId,r.dirtyFormat!==e.dirtyFormat?(r.dirtyFormat=e.dirtyFormat,r.dirtySize=e.dirtySize,this.updateFramebuffer(e,s)):r.dirtySize!==e.dirtySize&&(r.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let t=0;t<e.colorTextures.length;t++){const s=e.colorTextures[t];this.renderer.texture.unbind(s.parentTextureArray||s)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const e=t.width>>s,i=t.height>>s,r=e/t.width;this.setViewport(t.x*r,t.y*r,e,i)}else{const t=e.width>>s,i=e.height>>s;this.setViewport(0,0,t,i)}}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,s,i){const r=this.viewport;e=Math.round(e),t=Math.round(t),s=Math.round(s),i=Math.round(i),(r.width!==s||r.height!==i||r.x!==e||r.y!==t)&&(r.x=e,r.y=t,r.width=s,r.height=i,this.gl.viewport(e,t,s,i))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,s,i,r=d.COLOR|d.DEPTH){const{gl:n}=this;n.clearColor(e,t,s,i),n.clear(r)}initFramebuffer(e){const{gl:t}=this,s=new Ys(t.createFramebuffer());return s.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=s,this.managedFramebuffers.push(e),e.disposeRunner.add(this),s}resizeFramebuffer(e){const{gl:t}=this,s=e.glFramebuffers[this.CONTEXT_UID];if(s.stencil){let i;t.bindRenderbuffer(t.RENDERBUFFER,s.stencil),i=1===this.renderer.context.webGLVersion?t.DEPTH_STENCIL:e.depth&&e.stencil?t.DEPTH24_STENCIL8:e.depth?t.DEPTH_COMPONENT24:t.STENCIL_INDEX8,s.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,s.multisample,i,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,i,e.width,e.height)}const i=e.colorTextures;let r=i.length;t.drawBuffers||(r=Math.min(r,1));for(let n=0;n<r;n++){const r=i[n],o=r.parentTextureArray||r;this.renderer.texture.bind(o,0),0===n&&s.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,s.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,s.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:s}=this,i=e.glFramebuffers[this.CONTEXT_UID],r=e.colorTextures;let n=r.length;s.drawBuffers||(n=Math.min(n,1)),i.multisample>1&&this.canMultisampleFramebuffer(e)?i.msaaBuffer=i.msaaBuffer||s.createRenderbuffer():i.msaaBuffer&&(s.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null,i.blitFramebuffer&&(i.blitFramebuffer.dispose(),i.blitFramebuffer=null));const o=[];for(let a=0;a<n;a++){const n=r[a],l=n.parentTextureArray||n;this.renderer.texture.bind(l,0),0===a&&i.msaaBuffer?(s.bindRenderbuffer(s.RENDERBUFFER,i.msaaBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,i.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,i.msaaBuffer)):(s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+a,n.target,l._glTextures[this.CONTEXT_UID].texture,t),o.push(s.COLOR_ATTACHMENT0+a))}if(o.length>1&&s.drawBuffers(o),e.depthTexture&&this.writeDepthTexture){const i=e.depthTexture;this.renderer.texture.bind(i,0),s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,i._glTextures[this.CONTEXT_UID].texture,t)}if(!e.stencil&&!e.depth||e.depthTexture&&this.writeDepthTexture)i.stencil&&(s.deleteRenderbuffer(i.stencil),i.stencil=null);else{let t,r;i.stencil=i.stencil||s.createRenderbuffer(),1===this.renderer.context.webGLVersion?(t=s.DEPTH_STENCIL_ATTACHMENT,r=s.DEPTH_STENCIL):e.depth&&e.stencil?(t=s.DEPTH_STENCIL_ATTACHMENT,r=s.DEPTH24_STENCIL8):e.depth?(t=s.DEPTH_ATTACHMENT,r=s.DEPTH_COMPONENT24):(t=s.STENCIL_ATTACHMENT,r=s.STENCIL_INDEX8),s.bindRenderbuffer(s.RENDERBUFFER,i.stencil),i.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,i.multisample,r,e.width,e.height):s.renderbufferStorage(s.RENDERBUFFER,r,e.width,e.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,t,s.RENDERBUFFER,i.stencil)}}canMultisampleFramebuffer(e){return 1!==this.renderer.context.webGLVersion&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let s=P.NONE;if(e<=1||null===t)return s;for(let i=0;i<t.length;i++)if(t[i]<=e){s=t[i];break}return 1===s&&(s=P.NONE),s}blit(e,t,s){const{current:i,renderer:r,gl:n,CONTEXT_UID:o}=this;if(2!==r.context.webGLVersion||!i)return;const a=i.glFramebuffers[o];if(!a)return;if(!e){if(!a.msaaBuffer)return;const t=i.colorTextures[0];if(!t)return;a.blitFramebuffer||(a.blitFramebuffer=new Ls(i.width,i.height),a.blitFramebuffer.addColorTexture(0,t)),(e=a.blitFramebuffer).colorTextures[0]!==t&&(e.colorTextures[0]=t,e.dirtyId++,e.dirtyFormat++),(e.width!==i.width||e.height!==i.height)&&(e.width=i.width,e.height=i.height,e.dirtyId++,e.dirtySize++)}t||((t=qs).width=i.width,t.height=i.height),s||(s=t);const l=t.width===s.width&&t.height===s.height;this.bind(e),n.bindFramebuffer(n.READ_FRAMEBUFFER,a.framebuffer),n.blitFramebuffer(t.left,t.top,t.right,t.bottom,s.left,s.top,s.right,s.bottom,n.COLOR_BUFFER_BIT,l?n.NEAREST:n.LINEAR),n.bindFramebuffer(n.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){const s=e.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(!s)return;delete e.glFramebuffers[this.CONTEXT_UID];const r=this.managedFramebuffers.indexOf(e);r>=0&&this.managedFramebuffers.splice(r,1),e.disposeRunner.remove(this),t||(i.deleteFramebuffer(s.framebuffer),s.msaaBuffer&&i.deleteRenderbuffer(s.msaaBuffer),s.stencil&&i.deleteRenderbuffer(s.stencil)),s.blitFramebuffer&&this.disposeFramebuffer(s.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let s=0;s<t.length;s++)this.disposeFramebuffer(t[s],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil&&e.stencil)return;e.stencil=!0;const s=e.width,i=e.height,r=this.gl,n=t.stencil=r.createRenderbuffer();let o,a;r.bindRenderbuffer(r.RENDERBUFFER,n),1===this.renderer.context.webGLVersion?(o=r.DEPTH_STENCIL_ATTACHMENT,a=r.DEPTH_STENCIL):e.depth?(o=r.DEPTH_STENCIL_ATTACHMENT,a=r.DEPTH24_STENCIL8):(o=r.STENCIL_ATTACHMENT,a=r.STENCIL_INDEX8),t.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,t.multisample,a,s,i):r.renderbufferStorage(r.RENDERBUFFER,a,s,i),r.framebufferRenderbuffer(r.FRAMEBUFFER,o,r.RENDERBUFFER,n)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Nt}destroy(){this.renderer=null}}Qs.extension={type:nt.RendererSystem,name:'framebuffer'},lt.add(Qs);const Ks={5126:4,5123:2,5121:1};class Zs{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==t.webGLVersion){let t=this.renderer.context.extensions.vertexArrayObject;L.PREFER_ENV===u.WEBGL_LEGACY&&(t=null),t?(e.createVertexArray=()=>t.createVertexArrayOES(),e.bindVertexArray=e=>t.bindVertexArrayOES(e),e.deleteVertexArray=e=>t.deleteVertexArrayOES(e)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(2!==t.webGLVersion){const t=e.getExtension('ANGLE_instanced_arrays');t?(e.vertexAttribDivisor=(e,s)=>t.vertexAttribDivisorANGLE(e,s),e.drawElementsInstanced=(e,s,i,r,n)=>t.drawElementsInstancedANGLE(e,s,i,r,n),e.drawArraysInstanced=(e,s,i,r)=>t.drawArraysInstancedANGLE(e,s,i,r)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===t.webGLVersion||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:s}=this;let i=e.glVertexArrayObjects[this.CONTEXT_UID],r=!1;i||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=i={},r=!0);const n=i[t.program.id]||this.initGeometryVao(e,t,r);this._activeGeometry=e,this._activeVao!==n&&(this._activeVao=n,this.hasVao?s.bindVertexArray(n):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let s=0;s<e.buffers.length;s++){const i=e.buffers[s];t.update(i)}}checkCompatibility(e,t){const s=e.attributes,i=t.attributeData;for(const e in i)if(!s[e])throw new Error(`shader and geometry incompatible, geometry missing the "${e}" attribute`)}getSignature(e,t){const s=e.attributes,i=t.attributeData,r=['g',e.id];for(const e in s)i[e]&&r.push(e,i[e].location);return r.join('-')}initGeometryVao(e,t,s=!0){const i=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,o=t.program;o.glPrograms[r]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,o);const a=this.getSignature(e,o),l=e.glVertexArrayObjects[this.CONTEXT_UID];let h=l[a];if(h)return l[o.id]=h,h;const u=e.buffers,c=e.attributes,d={},p={};for(const e in u)d[e]=0,p[e]=0;for(const e in c)!c[e].size&&o.attributeData[e]?c[e].size=o.attributeData[e].size:c[e].size||console.warn(`PIXI Geometry attribute '${e}' size cannot be determined (likely the bound shader does not have the attribute)`),d[c[e].buffer]+=c[e].size*Ks[c[e].type];for(const e in c){const t=c[e],s=t.size;void 0===t.stride&&(d[t.buffer]===s*Ks[t.type]?t.stride=0:t.stride=d[t.buffer]),void 0===t.start&&(t.start=p[t.buffer],p[t.buffer]+=s*Ks[t.type])}h=i.createVertexArray(),i.bindVertexArray(h);for(let e=0;e<u.length;e++){const t=u[e];n.bind(t),s&&t._glBuffers[r].refCount++}return this.activateVao(e,o),l[o.id]=h,l[a]=h,i.bindVertexArray(null),n.unbind(I.ARRAY_BUFFER),h}disposeGeometry(e,t){if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const s=e.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,r=e.buffers,n=this.renderer?.buffer;if(e.disposeRunner.remove(this),s){if(n)for(let e=0;e<r.length;e++){const s=r[e]._glBuffers[this.CONTEXT_UID];s&&(s.refCount--,0===s.refCount&&!t&&n.dispose(r[e],t))}if(!t)for(const e in s)if('g'===e[0]){const t=s[e];this._activeVao===t&&this.unbind(),i.deleteVertexArray(t)}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let s=0;s<t.length;s++)this.disposeGeometry(this.managedGeometries[t[s]],e)}activateVao(e,t){const s=this.gl,i=this.CONTEXT_UID,r=this.renderer.buffer,n=e.buffers,o=e.attributes;e.indexBuffer&&r.bind(e.indexBuffer);let a=null;for(const e in o){const l=o[e],h=n[l.buffer],u=h._glBuffers[i];if(t.attributeData[e]){a!==u&&(r.bind(h),a=u);const i=t.attributeData[e].location;if(s.enableVertexAttribArray(i),s.vertexAttribPointer(i,l.size,l.type||s.FLOAT,l.normalized,l.stride,l.start),l.instance){if(!this.hasInstance)throw new Error('geometry error, GPU Instancing is not supported on this device');s.vertexAttribDivisor(i,l.divisor)}}}}draw(e,t,s,i){const{gl:r}=this,n=this._activeGeometry;if(n.indexBuffer){const o=n.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?r.UNSIGNED_SHORT:r.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?n.instanced?r.drawElementsInstanced(e,t||n.indexBuffer.data.length,a,(s||0)*o,i||1):r.drawElements(e,t||n.indexBuffer.data.length,a,(s||0)*o):console.warn('unsupported index buffer type: uint32')}else n.instanced?r.drawArraysInstanced(e,s,t||n.getSize(),i||1):r.drawArrays(e,s,t||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Zs.extension={type:nt.RendererSystem,name:'geometry'},lt.add(Zs);const Js=new Wt;class ei{constructor(e,t){this._texture=e,this.mapCoord=new Wt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>'u'?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){void 0===t&&(t=e);const s=this.mapCoord;for(let i=0;i<e.length;i+=2){const r=e[i],n=e[i+1];t[i]=r*s.a+n*s.c+s.tx,t[i+1]=r*s.b+n*s.d+s.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const s=t._uvs;this.mapCoord.set(s.x1-s.x0,s.y1-s.y0,s.x3-s.x0,s.y3-s.y0,s.x0,s.y0);const i=t.orig,r=t.trim;r&&(Js.set(i.width/r.width,0,0,i.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(Js));const n=t.baseTexture,o=this.uClampFrame,a=this.clampMargin/n.resolution,l=this.clampOffset;return o[0]=(t._frame.x+a+l)/n.width,o[1]=(t._frame.y+a+l)/n.height,o[2]=(t._frame.x+t._frame.width-a+l)/n.width,o[3]=(t._frame.y+t._frame.height-a+l)/n.height,this.uClampOffset[0]=l/n.realWidth,this.uClampOffset[1]=l/n.realHeight,this.isSimple=t._frame.width===n.width&&t._frame.height===n.height&&0===t.rotate,!0}}class ti extends As{constructor(e,t,s){let i=null;'string'!=typeof e&&void 0===t&&void 0===s&&(i=e,e=void 0,t=void 0,s=void 0),super(e||'attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n',t||'varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n',s),this.maskSprite=i,this.maskMatrix=new Wt}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,s,i){const r=this._maskSprite,n=r._texture;n.valid&&(n.uvMatrix||(n.uvMatrix=new ei(n,0)),n.uvMatrix.update(),this.uniforms.npmAlpha=n.baseTexture.alphaMode?0:1,this.uniforms.mask=n,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,r).prepend(n.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=n.uvMatrix.uClampFrame,e.applyFilter(this,t,s,i))}}class si{constructor(e=null){this.type=A.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=As.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=A.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class ii{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let s=t;if(!s.isMaskData){const e=this.maskDataPool.pop()||new si;e.pooled=!0,e.maskObject=t,s=e}const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(s.copyCountersOrReset(i),s._colorMask=i?i._colorMask:15,s.autoDetect&&this.detect(s),s._target=e,s.type!==A.SPRITE&&this.maskStack.push(s),s.enabled)switch(s.type){case A.SCISSOR:this.renderer.scissor.push(s);break;case A.STENCIL:this.renderer.stencil.push(s);break;case A.SPRITE:s.copyCountersOrReset(null),this.pushSpriteMask(s);break;case A.COLOR:this.pushColorMask(s)}s.type===A.SPRITE&&this.maskStack.push(s)}pop(e){const t=this.maskStack.pop();if(t&&t._target===e){if(t.enabled)switch(t.type){case A.SCISSOR:this.renderer.scissor.pop(t);break;case A.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case A.SPRITE:this.popSpriteMask(t);break;case A.COLOR:this.popColorMask(t)}if(t.reset(),t.pooled&&this.maskDataPool.push(t),0!==this.maskStack.length){const e=this.maskStack[this.maskStack.length-1];e.type===A.SPRITE&&e._filters&&(e._filters[0].maskSprite=e.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=A.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=A.SCISSOR:e.type=A.STENCIL:e.type=A.COLOR}pushSpriteMask(e){const{maskObject:t}=e,s=e._target;let i=e._filters;i||(i=this.alphaMaskPool[this.alphaMaskIndex],i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new ti])),i[0].resolution=e.resolution,i[0].multisample=e.multisample,i[0].maskSprite=t;const r=s.filterArea;s.filterArea=t.getBounds(!0),this.renderer.filter.push(s,i),s.filterArea=r,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,s=e._colorMask=t&e.colorMask;s!==t&&this.renderer.gl.colorMask(!!(1&s),!!(2&s),!!(4&s),!!(8&s))}popColorMask(e){const t=e._colorMask,s=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;s!==t&&this.renderer.gl.colorMask(!!(1&s),!!(2&s),!!(4&s),!!(8&s))}destroy(){this.renderer=null}}ii.extension={type:nt.RendererSystem,name:'mask'},lt.add(ii);class ri{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,s=this.getStackLength();this.maskStack=e;const i=this.getStackLength();i!==s&&(0===i?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const ni=new Wt,oi=[],ai=class e extends ri{constructor(e){super(e),this.glConst=L.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:s}=e,{renderer:i}=this,r=i.renderTexture,n=s.getBounds(!0,oi.pop()??new Nt);this.roundFrameToPixels(n,r.current?r.current.resolution:i.resolution,r.sourceFrame,r.destinationFrame,i.projection.transform),t&&n.fit(t),e._scissorRectLocal=n}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:s,c:i,d:r}=e;return(Math.abs(s)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4)}testScissor(t){const{maskObject:s}=t;if(!s.isFastRect||!s.isFastRect()||e.isMatrixRotated(s.worldTransform)||e.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,s,i,r,n){e.isMatrixRotated(n)||((n=n?ni.copyFrom(n):ni.identity()).translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.renderer.filter.transformAABB(n,t),t.fit(r),t.x=Math.round(t.x*s),t.y=Math.round(t.y*s),t.width=Math.round(t.width*s),t.height=Math.round(t.height*s))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&oi.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;t=this.renderer.renderTexture.current?e.y:this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};ai.extension={type:nt.RendererSystem,name:'scissor'};let li=ai;lt.add(li);class hi extends ri{constructor(e){super(e),this.glConst=L.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:s}=this.renderer,i=e._stencilCounter;0===i&&(this.renderer.framebuffer.forceStencil(),s.clearStencil(0),s.clear(s.STENCIL_BUFFER_BIT),s.enable(s.STENCIL_TEST)),e._stencilCounter++;const r=e._colorMask;0!==r&&(e._colorMask=0,s.colorMask(!1,!1,!1,!1)),s.stencilFunc(s.EQUAL,i,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==r&&(e._colorMask=r,s.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))),this._useCurrent()}pop(e){const t=this.renderer.gl;if(0===this.getStackLength())t.disable(t.STENCIL_TEST);else{const s=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,i=s?s._colorMask:15;0!==i&&(s._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==i&&(s._colorMask=i,t.colorMask(!!(1&i),!!(2&i),!!(4&i),!!(8&i))),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}hi.extension={type:nt.RendererSystem,name:'stencil'},lt.add(hi);class ui{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(B('7.0.0','renderer.plugins.extract has moved to renderer.extract'),e.extract)},prepare:{enumerable:!1,get:()=>(B('7.0.0','renderer.plugins.prepare has moved to renderer.prepare'),e.prepare)},interaction:{enumerable:!1,get:()=>(B('7.0.0','renderer.plugins.interaction has been deprecated, use renderer.events'),e.events)}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}ui.extension={type:[nt.RendererSystem,nt.CanvasRendererSystem],name:'_plugin'},lt.add(ui);class ci{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Wt,this.transform=null}update(e,t,s,i){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,s,i),this.transform&&this.projectionMatrix.append(this.transform);const r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)}calculateProjection(e,t,s,i){const r=this.projectionMatrix,n=i?-1:1;r.identity(),r.a=1/t.width*2,r.d=n*(1/t.height*2),r.tx=-1-t.x*r.a,r.ty=-n-t.y*r.d}setTransform(e){}destroy(){this.renderer=null}}ci.extension={type:nt.RendererSystem,name:'projection'},lt.add(ci);const di=new es,pi=new Nt;class fi{constructor(e){this.renderer=e,this._tempMatrix=new Wt}generateTexture(e,t){const{region:s,...i}=t||{},r=s?.copyTo(pi)||e.getLocalBounds(pi,!0),n=i.resolution||this.renderer.resolution;r.width=Math.max(r.width,1/n),r.height=Math.max(r.height,1/n),i.width=r.width,i.height=r.height,i.resolution=n,i.multisample??(i.multisample=this.renderer.multisample);const o=Gs.create(i);this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const a=e.transform;return e.transform=di,this.renderer.render(e,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=a,o}destroy(){}}fi.extension={type:[nt.RendererSystem,nt.CanvasRendererSystem],name:'textureGenerator'},lt.add(fi);const gi=new Nt,mi=new Nt;class _i{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Nt,this.destinationFrame=new Nt,this.viewportFrame=new Nt}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,t,s){const i=this.renderer;let r,n,o;this.current=e,e?(r=e.baseTexture,o=r.resolution,t||(gi.width=e.frame.width,gi.height=e.frame.height,t=gi),s||(mi.x=e.frame.x,mi.y=e.frame.y,mi.width=t.width,mi.height=t.height,s=mi),n=r.framebuffer):(o=i.resolution,t||(gi.width=i._view.screen.width,gi.height=i._view.screen.height,t=gi),s||((s=gi).width=t.width,s.height=t.height));const a=this.viewportFrame;a.x=s.x*o,a.y=s.y*o,a.width=s.width*o,a.height=s.height*o,e||(a.y=i.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(n,a),this.renderer.projection.update(s,t,o,!n),e?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(s)}clear(e,t){const s=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,i=Te.shared.setValue(e||s);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&i.premultiply(i.alpha);const r=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,o=r.width!==n.width||r.height!==n.height;if(o){let{x:e,y:t,width:s,height:i}=this.viewportFrame;e=Math.round(e),t=Math.round(t),s=Math.round(s),i=Math.round(i),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(e,t,s,i)}this.renderer.framebuffer.clear(i.red,i.green,i.blue,i.alpha,t),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}_i.extension={type:nt.RendererSystem,name:'renderTexture'},lt.add(_i);class vi{}class yi{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function xi(e,t,s){const i=e.createShader(t);return e.shaderSource(i,s),e.compileShader(i),i}function bi(e){const t=new Array(e);for(let e=0;e<t.length;e++)t[e]=!1;return t}function Ti(e,t){switch(e){case'float':case'int':case'uint':case'sampler2D':case'sampler2DArray':return 0;case'vec2':return new Float32Array(2*t);case'vec3':return new Float32Array(3*t);case'vec4':return new Float32Array(4*t);case'ivec2':return new Int32Array(2*t);case'ivec3':return new Int32Array(3*t);case'ivec4':return new Int32Array(4*t);case'uvec2':return new Uint32Array(2*t);case'uvec3':return new Uint32Array(3*t);case'uvec4':return new Uint32Array(4*t);case'bool':return!1;case'bvec2':return bi(2*t);case'bvec3':return bi(3*t);case'bvec4':return bi(4*t);case'mat2':return new Float32Array([1,0,0,1]);case'mat3':return new Float32Array([1,0,0,0,1,0,0,0,1]);case'mat4':return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function wi(e,t){const s=e.getShaderSource(t).split('\n').map((e,t)=>`${t}: ${e}`),i=e.getShaderInfoLog(t),r=i.split('\n'),n={},o=r.map(e=>parseFloat(e.replace(/^ERROR\: 0\:([\d]+)\:.*$/,'$1'))).filter(e=>!(!e||n[e])&&(n[e]=!0,!0)),a=[''];o.forEach(e=>{s[e-1]=`%c${s[e-1]}%c`,a.push('background: #FF0000; color:#FFFFFF; font-size: 10px','font-size: 10px')});const l=s.join('\n');a[0]=l,console.error(i),console.groupCollapsed('click to view full shader code'),console.warn(...a),console.groupEnd()}function Ei(e,t){const s=xi(e,e.VERTEX_SHADER,t.vertexSrc),i=xi(e,e.FRAGMENT_SHADER,t.fragmentSrc),r=e.createProgram();e.attachShader(r,s),e.attachShader(r,i);const n=t.extra?.transformFeedbackVaryings;if(n&&('function'!=typeof e.transformFeedbackVaryings?console.warn('TransformFeedback is not supported but TransformFeedbackVaryings are given.'):e.transformFeedbackVaryings(r,n.names,'separate'===n.bufferMode?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||function(e,t,s,i){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(s,e.COMPILE_STATUS)||wi(e,s),e.getShaderParameter(i,e.COMPILE_STATUS)||wi(e,i),console.error('PixiJS Error: Could not initialize shader.'),''!==e.getProgramInfoLog(t)&&console.warn('PixiJS Warning: gl.getProgramInfoLog()',e.getProgramInfoLog(t)))}(e,r,s,i),t.attributeData=function(e,t){const s={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r);if(i.name.startsWith('gl_'))continue;const n=ds(t,i.type),o={type:n,name:i.name,size:hs(n),location:t.getAttribLocation(e,i.name)};s[i.name]=o}return s}(r,e),t.uniformData=function(e,t){const s={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<i;r++){const i=t.getActiveUniform(e,r),n=i.name.replace(/\[.*?\]$/,''),o=!!i.name.match(/\[.*?\]$/),a=ds(t,i.type);s[n]={name:n,index:r,type:a,size:i.size,isArray:o,value:Ti(a,i.size)}}return s}(r,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const s=Object.keys(t.attributeData);s.sort((e,t)=>e>t?1:-1);for(let i=0;i<s.length;i++)t.attributeData[s[i]].location=i,e.bindAttribLocation(r,i,s[i]);e.linkProgram(r)}e.deleteShader(s),e.deleteShader(i);const o={};for(const s in t.uniformData){const i=t.uniformData[s];o[s]={location:e.getUniformLocation(r,s),value:Ti(i.type,i.size)}}return new yi(r,o)}function Ci(e,t,s,i,r){s.buffer.update(r)}const Si={float:'\n        data[offset] = v;\n    ',vec2:'\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ',vec3:'\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ',vec4:'\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ',mat2:'\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ',mat3:'\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ',mat4:'\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    '},Ai={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function Mi(e){const t=e.map(e=>({data:e,offset:0,dataLen:0,dirty:0}));let s=0,i=0,r=0;for(let e=0;e<t.length;e++){const n=t[e];if(s=Ai[n.data.type],n.data.size>1&&(s=Math.max(s,16)*n.data.size),n.dataLen=s,i%s!==0&&i<16){const e=i%s%16;i+=e,r+=e}i+s>16?(r=16*Math.ceil(r/16),n.offset=r,r+=s,i=s):(n.offset=r,i+=s,r+=s)}return r=16*Math.ceil(r/16),{uboElements:t,size:r}}function Pi(e,t){const s=[];for(const i in e)t[i]&&s.push(t[i]);return s.sort((e,t)=>e.index-t.index),s}function Ii(e,t){if(!e.autoManage)return{size:0,syncFunc:Ci};const s=Pi(e.uniforms,t),{uboElements:i,size:r}=Mi(s),n=['\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    '];for(let t=0;t<i.length;t++){const s=i[t],r=e.uniforms[s.data.name],o=s.data.name;let a=!1;for(let e=0;e<ts.length;e++){const t=ts[e];if(t.codeUbo&&t.test(s.data,r)){n.push(`offset = ${s.offset/4};`,ts[e].codeUbo(s.data.name,r)),a=!0;break}}if(!a)if(s.data.size>1){const e=hs(s.data.type),t=Math.max(Ai[s.data.type]/16,1),i=e/t,r=(4-i%4)%4;n.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${s.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${s.data.size*t}; i++)\n                {\n                    for(var j = 0; j < ${i}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${r};\n                }\n\n                `)}else{const e=Si[s.data.type];n.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${s.offset/4};\n                ${e};\n                `)}}return n.push('\n       renderer.buffer.update(buffer);\n    '),{size:r,syncFunc:new Function('ud','uv','renderer','syncData','buffer',n.join('\n'))}}let Ri;function Li(){if('boolean'==typeof Ri)return Ri;try{Ri=!0===new Function('param1','param2','param3','return param1[param2] === param3;')({a:'b'},'a','b')}catch{Ri=!1}return Ri}let ki=0;const Di={textureCount:0,uboCount:0};class Bi{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=ki++}systemCheck(){if(!Li())throw new Error('Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.')}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const s=e.program,i=s.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==s&&(this.program=s,this.gl.useProgram(i.program)),t||(Di.textureCount=0,Di.uboCount=0,this.syncUniformGroup(e.uniformGroup,Di)),i}setUniforms(e){const t=this.shader.program,s=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(s.uniformData,e,this.renderer)}syncUniformGroup(e,t){const s=this.getGlProgram();(!e.static||e.dirtyId!==s.uniformDirtyGroups[e.id])&&(s.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,s,t))}syncUniforms(e,t,s){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,s)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,'u');return this.cache[t]||(this.cache[t]=function(e,t){const s=['\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    '];for(const i in e.uniforms){const r=t[i];if(!r){!0===e.uniforms[i]?.group&&(e.uniforms[i].ubo?s.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');\n                    `):s.push(`\n                        renderer.shader.syncUniformGroup(uv.${i}, syncData);\n                    `));continue}const n=e.uniforms[i];let o=!1;for(let e=0;e<ts.length;e++)if(ts[e].test(r,n)){s.push(ts[e].code(i,n)),o=!0;break}if(!o){const e=(1!==r.size||r.isArray?is:ss)[r.type].replace('location',`ud["${i}"].location`);s.push(`\n            cu = ud["${i}"];\n            cv = cu.value;\n            v = uv["${i}"];\n            ${e};`)}}return new Function('ud','uv','renderer','syncData',s.join('\n'))}(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const s=this.getGlProgram();if(!e.static||0!==e.dirtyId||!s.uniformGroups[e.id]){e.dirtyId=0;const i=s.uniformGroups[e.id]||this.createSyncBufferGroup(e,s,t);e.buffer.update(),i(s.uniformData,e.uniforms,this.renderer,Di,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,s.uniformBufferBindings[t])}createSyncBufferGroup(e,t,s){const{gl:i}=this.renderer;this.renderer.buffer.bind(e.buffer);const r=this.gl.getUniformBlockIndex(t.program,s);t.uniformBufferBindings[s]=this.shader.uniformBindCount,i.uniformBlockBinding(t.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;const n=this.getSignature(e,this.shader.program.uniformData,'ubo');let o=this._uboCache[n];if(o||(o=this._uboCache[n]=Ii(e,this.shader.program.uniformData)),e.autoManage){const t=new Float32Array(o.size/4);e.buffer.update(t)}return t.uniformGroups[e.id]=o.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,s){const i=e.uniforms,r=[`${s}-`];for(const e in i)r.push(e),t[e]&&r.push(t[e].type);return r.join('-')}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,s=e.program,i=Ei(t,s);return s.glPrograms[this.renderer.CONTEXT_UID]=i,i}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Bi.extension={type:nt.RendererSystem,name:'shader'},lt.add(Bi);class Fi{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.3 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}Fi.defaultOptions={hello:!1},Fi.extension={type:[nt.RendererSystem,nt.CanvasRendererSystem],name:'startup'},lt.add(Fi);const Oi=class e{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=p.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new pt,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=function(e,t=[]){return t[p.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.ADD]=[e.ONE,e.ONE],t[p.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.NONE]=[0,0],t[p.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[p.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[p.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[p.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[p.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[p.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[p.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[p.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[p.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[p.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[p.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,s=0;for(;t;)1&t&&this.map[s].call(this,!!(e.data&1<<s)),t>>=1,s++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?'enable':'disable'](this.gl.BLEND)}setOffset(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?'enable':'disable'](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?'enable':'disable'](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?'enable':'disable'](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?'CW':'CCW'])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],s=this.gl;2===t.length?s.blendFunc(t[0],t[1]):s.blendFuncSeparate(t[0],t[1],t[2],t[3]),6===t.length?(this._blendEq=!0,s.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const s=this.checks.indexOf(e);t&&-1===s?this.checks.push(e):!t&&-1!==s&&this.checks.splice(s,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};Oi.extension={type:nt.RendererSystem,name:'state'};let Ni=Oi;lt.add(Ni);class Ui extends s{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter(t=>e.systems[t]),s=[...t,...Object.keys(e.systems).filter(e=>!t.includes(e))];for(const t of s)this.addSystem(e.systems[t],t)}addRunners(...e){e.forEach(e=>{this.runners[e]=new mt(e)})}addSystem(e,t){const s=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=s,this._systemsHash[t]=s;for(const e in this.runners)this.runners[e].add(s);return this}emitWithCustomOptions(e,t){const s=Object.keys(this._systemsHash);e.items.forEach(i=>{const r=s.find(e=>this._systemsHash[e]===i);i[e.name](t[r])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const Gi=class e{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=e.defaultMaxIdle,this.checkCountMax=e.defaultCheckCountMax,this.mode=e.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==C.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let s=!1;for(let i=0;i<t.length;i++){const r=t[i];r.resource&&this.count-r.touched>this.maxIdle&&(e.destroyTexture(r,!0),t[i]=null,s=!0)}if(s){let e=0;for(let s=0;s<t.length;s++)null!==t[s]&&(t[e++]=t[s]);t.length=e}}unload(e){const t=this.renderer.texture,s=e._texture;s&&!s.framebuffer&&t.destroyTexture(s);for(let t=e.children.length-1;t>=0;t--)this.unload(e.children[t])}destroy(){this.renderer=null}};Gi.defaultMode=C.AUTO,Gi.defaultMaxIdle=3600,Gi.defaultCheckCountMax=600,Gi.extension={type:nt.RendererSystem,name:'textureGC'};let Vi=Gi;lt.add(Vi);class Hi{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=v.UNSIGNED_BYTE,this.internalFormat=g.RGBA,this.samplerType=0}}class Wi{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new bt,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(e){let t;return t='WebGL2RenderingContext'in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[v.UNSIGNED_BYTE]:{[g.RGBA]:e.RGBA8,[g.RGB]:e.RGB8,[g.RG]:e.RG8,[g.RED]:e.R8,[g.RGBA_INTEGER]:e.RGBA8UI,[g.RGB_INTEGER]:e.RGB8UI,[g.RG_INTEGER]:e.RG8UI,[g.RED_INTEGER]:e.R8UI,[g.ALPHA]:e.ALPHA,[g.LUMINANCE]:e.LUMINANCE,[g.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[v.BYTE]:{[g.RGBA]:e.RGBA8_SNORM,[g.RGB]:e.RGB8_SNORM,[g.RG]:e.RG8_SNORM,[g.RED]:e.R8_SNORM,[g.RGBA_INTEGER]:e.RGBA8I,[g.RGB_INTEGER]:e.RGB8I,[g.RG_INTEGER]:e.RG8I,[g.RED_INTEGER]:e.R8I},[v.UNSIGNED_SHORT]:{[g.RGBA_INTEGER]:e.RGBA16UI,[g.RGB_INTEGER]:e.RGB16UI,[g.RG_INTEGER]:e.RG16UI,[g.RED_INTEGER]:e.R16UI,[g.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[v.SHORT]:{[g.RGBA_INTEGER]:e.RGBA16I,[g.RGB_INTEGER]:e.RGB16I,[g.RG_INTEGER]:e.RG16I,[g.RED_INTEGER]:e.R16I},[v.UNSIGNED_INT]:{[g.RGBA_INTEGER]:e.RGBA32UI,[g.RGB_INTEGER]:e.RGB32UI,[g.RG_INTEGER]:e.RG32UI,[g.RED_INTEGER]:e.R32UI,[g.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[v.INT]:{[g.RGBA_INTEGER]:e.RGBA32I,[g.RGB_INTEGER]:e.RGB32I,[g.RG_INTEGER]:e.RG32I,[g.RED_INTEGER]:e.R32I},[v.FLOAT]:{[g.RGBA]:e.RGBA32F,[g.RGB]:e.RGB32F,[g.RG]:e.RG32F,[g.RED]:e.R32F,[g.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[v.HALF_FLOAT]:{[g.RGBA]:e.RGBA16F,[g.RGB]:e.RGB16F,[g.RG]:e.RG16F,[g.RED]:e.R16F},[v.UNSIGNED_SHORT_5_6_5]:{[g.RGB]:e.RGB565},[v.UNSIGNED_SHORT_4_4_4_4]:{[g.RGBA]:e.RGBA4},[v.UNSIGNED_SHORT_5_5_5_1]:{[g.RGBA]:e.RGB5_A1},[v.UNSIGNED_INT_2_10_10_10_REV]:{[g.RGBA]:e.RGB10_A2,[g.RGBA_INTEGER]:e.RGB10_A2UI},[v.UNSIGNED_INT_10F_11F_11F_REV]:{[g.RGB]:e.R11F_G11F_B10F},[v.UNSIGNED_INT_5_9_9_9_REV]:{[g.RGB]:e.RGB9_E5},[v.UNSIGNED_INT_24_8]:{[g.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[v.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[g.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:{[v.UNSIGNED_BYTE]:{[g.RGBA]:e.RGBA,[g.RGB]:e.RGB,[g.ALPHA]:e.ALPHA,[g.LUMINANCE]:e.LUMINANCE,[g.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[v.UNSIGNED_SHORT_5_6_5]:{[g.RGB]:e.RGB},[v.UNSIGNED_SHORT_4_4_4_4]:{[g.RGBA]:e.RGBA},[v.UNSIGNED_SHORT_5_5_5_1]:{[g.RGBA]:e.RGBA}},t}(e),this.samplerTypes=function(e){let t;return t='WebGL2RenderingContext'in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[e.RGB]:y.FLOAT,[e.RGBA]:y.FLOAT,[e.ALPHA]:y.FLOAT,[e.LUMINANCE]:y.FLOAT,[e.LUMINANCE_ALPHA]:y.FLOAT,[e.R8]:y.FLOAT,[e.R8_SNORM]:y.FLOAT,[e.RG8]:y.FLOAT,[e.RG8_SNORM]:y.FLOAT,[e.RGB8]:y.FLOAT,[e.RGB8_SNORM]:y.FLOAT,[e.RGB565]:y.FLOAT,[e.RGBA4]:y.FLOAT,[e.RGB5_A1]:y.FLOAT,[e.RGBA8]:y.FLOAT,[e.RGBA8_SNORM]:y.FLOAT,[e.RGB10_A2]:y.FLOAT,[e.RGB10_A2UI]:y.FLOAT,[e.SRGB8]:y.FLOAT,[e.SRGB8_ALPHA8]:y.FLOAT,[e.R16F]:y.FLOAT,[e.RG16F]:y.FLOAT,[e.RGB16F]:y.FLOAT,[e.RGBA16F]:y.FLOAT,[e.R32F]:y.FLOAT,[e.RG32F]:y.FLOAT,[e.RGB32F]:y.FLOAT,[e.RGBA32F]:y.FLOAT,[e.R11F_G11F_B10F]:y.FLOAT,[e.RGB9_E5]:y.FLOAT,[e.R8I]:y.INT,[e.R8UI]:y.UINT,[e.R16I]:y.INT,[e.R16UI]:y.UINT,[e.R32I]:y.INT,[e.R32UI]:y.UINT,[e.RG8I]:y.INT,[e.RG8UI]:y.UINT,[e.RG16I]:y.INT,[e.RG16UI]:y.UINT,[e.RG32I]:y.INT,[e.RG32UI]:y.UINT,[e.RGB8I]:y.INT,[e.RGB8UI]:y.UINT,[e.RGB16I]:y.INT,[e.RGB16UI]:y.UINT,[e.RGB32I]:y.INT,[e.RGB32UI]:y.UINT,[e.RGBA8I]:y.INT,[e.RGBA8UI]:y.UINT,[e.RGBA16I]:y.INT,[e.RGBA16UI]:y.UINT,[e.RGBA32I]:y.INT,[e.RGBA32UI]:y.UINT,[e.DEPTH_COMPONENT16]:y.FLOAT,[e.DEPTH_COMPONENT24]:y.FLOAT,[e.DEPTH_COMPONENT32F]:y.FLOAT,[e.DEPTH_STENCIL]:y.FLOAT,[e.DEPTH24_STENCIL8]:y.FLOAT,[e.DEPTH32F_STENCIL8]:y.FLOAT}:{[e.RGB]:y.FLOAT,[e.RGBA]:y.FLOAT,[e.ALPHA]:y.FLOAT,[e.LUMINANCE]:y.FLOAT,[e.LUMINANCE_ALPHA]:y.FLOAT,[e.DEPTH_STENCIL]:y.FLOAT},t}(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let e=0;e<t;e++)this.boundTextures[e]=null;this.emptyTextures={};const s=new Hi(e.createTexture());e.bindTexture(e.TEXTURE_2D,s.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=s,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new Hi(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let t=0;t<6;t++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let e=0;e<this.boundTextures.length;e++)this.bind(null,e)}bind(e,t=0){const{gl:s}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const i=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,s.activeTexture(s.TEXTURE0+t)),s.bindTexture(e.target,i.texture)),i.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,s.activeTexture(s.TEXTURE0+t)),this.updateTexture(e)):i.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,s.activeTexture(s.TEXTURE0+t)),s.bindTexture(s.TEXTURE_2D,this.emptyTextures[s.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:s}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let e=0;e<s.length;e++)s[e]===this.unknownTexture&&this.bind(null,e)}for(let i=0;i<s.length;i++)s[i]===e&&(this.currentLocation!==i&&(t.activeTexture(t.TEXTURE0+i),this.currentLocation=i),t.bindTexture(e.target,this.emptyTextures[e.target].texture),s[i]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:s,CONTEXT_UID:i}=this;if(s)for(let s=e-1;s>=0;--s){const e=t[s];e&&e._glTextures[i].samplerType!==y.FLOAT&&this.renderer.texture.unbind(e)}}initTexture(e){const t=new Hi(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on('dispose',this.destroyTexture,this),t}initTextureType(e,t){t.internalFormat=this.internalFormats[e.type]?.[e.format]??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??y.FLOAT,2===this.webGLVersion&&e.type===v.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){const t=e._glTextures[this.CONTEXT_UID];if(!t)return;const s=this.renderer;if(this.initTextureType(e,t),e.resource?.upload(s,e,t))t.samplerType!==y.FLOAT&&(this.hasIntegerTextures=!0);else{const i=e.realWidth,r=e.realHeight,n=s.gl;(t.width!==i||t.height!==r||t.dirtyId<0)&&(t.width=i,t.height=r,n.texImage2D(e.target,0,t.internalFormat,i,r,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:s}=this;if((e=e.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(e),s.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off('dispose',this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const t=this.managedTextures.indexOf(e);-1!==t&&Ge(this.managedTextures,t,1)}}updateTextureStyle(e){const t=e._glTextures[this.CONTEXT_UID];t&&(e.mipmap!==T.POW2&&2===this.webGLVersion||e.isPowerOfTwo?t.mipmap=e.mipmap>=1:t.mipmap=!1,2===this.webGLVersion||e.isPowerOfTwo?t.wrapMode=e.wrapMode:t.wrapMode=b.CLAMP,e.resource?.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const s=this.gl;if(t.mipmap&&e.mipmap!==T.ON_MANUAL&&s.generateMipmap(e.target),s.texParameteri(e.target,s.TEXTURE_WRAP_S,t.wrapMode),s.texParameteri(e.target,s.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){s.texParameteri(e.target,s.TEXTURE_MIN_FILTER,e.scaleMode===x.LINEAR?s.LINEAR_MIPMAP_LINEAR:s.NEAREST_MIPMAP_NEAREST);const t=this.renderer.context.extensions.anisotropicFiltering;if(t&&e.anisotropicLevel>0&&e.scaleMode===x.LINEAR){const i=Math.min(e.anisotropicLevel,s.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT));s.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY_EXT,i)}}else s.texParameteri(e.target,s.TEXTURE_MIN_FILTER,e.scaleMode===x.LINEAR?s.LINEAR:s.NEAREST);s.texParameteri(e.target,s.TEXTURE_MAG_FILTER,e.scaleMode===x.LINEAR?s.LINEAR:s.NEAREST)}destroy(){this.renderer=null}}Wi.extension={type:nt.RendererSystem,name:'texture'},lt.add(Wi);class $i{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:s}=this,i=e._glTransformFeedbacks[s]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,i)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:s,renderer:i}=this;t&&i.shader.bind(t),s.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:s,CONTEXT_UID:i}=this,r=t.createTransformFeedback();e._glTransformFeedbacks[i]=r,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,r);for(let r=0;r<e.buffers.length;r++){const n=e.buffers[r];n&&(s.buffer.update(n),n._glBuffers[i].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,r,n._glBuffers[i].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),r}disposeTransformFeedback(e,t){const s=e._glTransformFeedbacks[this.CONTEXT_UID],i=this.gl;e.disposeRunner.remove(this);const r=this.renderer.buffer;if(r)for(let s=0;s<e.buffers.length;s++){const i=e.buffers[s];if(!i)continue;const n=i._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0===n.refCount&&!t&&r.dispose(i,t))}s&&(t||i.deleteTransformFeedback(s),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}$i.extension={type:nt.RendererSystem,name:'transformFeedback'},lt.add($i);class Xi{constructor(e){this.renderer=e}init(e){this.screen=new Nt(0,0,e.width,e.height),this.element=e.view||L.ADAPTER.createCanvas(),this.resolution=e.resolution||L.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const s=this.element.width/this.resolution,i=this.element.height/this.resolution;this.screen.width=s,this.screen.height=i,this.autoDensity&&(this.element.style.width=`${s}px`,this.element.style.height=`${i}px`),this.renderer.emit('resize',s,i),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){e&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Xi.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Xi.extension={type:[nt.RendererSystem,nt.CanvasRendererSystem],name:'_view'},lt.add(Xi),L.PREFER_ENV=u.WEBGL2,L.STRICT_TEXTURE_CACHE=!1,L.RENDER_OPTIONS={...Rs.defaultOptions,...Ms.defaultOptions,...Xi.defaultOptions,...Fi.defaultOptions},Object.defineProperties(L,{WRAP_MODE:{get:()=>bt.defaultOptions.wrapMode,set(e){B('7.1.0','settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode'),bt.defaultOptions.wrapMode=e}},SCALE_MODE:{get:()=>bt.defaultOptions.scaleMode,set(e){B('7.1.0','settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode'),bt.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get:()=>bt.defaultOptions.mipmap,set(e){B('7.1.0','settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap'),bt.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get:()=>bt.defaultOptions.anisotropicLevel,set(e){B('7.1.0','settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel'),bt.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get:()=>(B('7.1.0','settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution'),As.defaultResolution),set(e){As.defaultResolution=e}},FILTER_MULTISAMPLE:{get:()=>(B('7.1.0','settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample'),As.defaultMultisample),set(e){As.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get:()=>Cs.defaultMaxTextures,set(e){B('7.1.0','settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures'),Cs.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get:()=>Cs.defaultBatchSize,set(e){B('7.1.0','settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize'),Cs.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get:()=>Cs.canUploadSameBuffer,set(e){B('7.1.0','settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer'),Cs.canUploadSameBuffer=e}},GC_MODE:{get:()=>Vi.defaultMode,set(e){B('7.1.0','settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode'),Vi.defaultMode=e}},GC_MAX_IDLE:{get:()=>Vi.defaultMaxIdle,set(e){B('7.1.0','settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle'),Vi.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get:()=>Vi.defaultCheckCountMax,set(e){B('7.1.0','settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax'),Vi.defaultCheckCountMax=e}},PRECISION_VERTEX:{get:()=>_s.defaultVertexPrecision,set(e){B('7.1.0','settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision'),_s.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get:()=>_s.defaultFragmentPrecision,set(e){B('7.1.0','settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision'),_s.defaultFragmentPrecision=e}}});var ji=(e=>(e[e.INTERACTION=50]='INTERACTION',e[e.HIGH=25]='HIGH',e[e.NORMAL=0]='NORMAL',e[e.LOW=-25]='LOW',e[e.UTILITY=-50]='UTILITY',e))(ji||{});class zi{constructor(e,t=null,s=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=s,this.once=i}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const Yi=class e{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new zi(null,null,1/0),this.deltaMS=1/e.targetFPMS,this.elapsedMS=1/e.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,s=ji.NORMAL){return this._addListener(new zi(e,t,s))}addOnce(e,t,s=ji.NORMAL){return this._addListener(new zi(e,t,s,!0))}_addListener(e){let t=this._head.next,s=this._head;if(t){for(;t;){if(e.priority>t.priority){e.connect(s);break}s=t,t=t.next}e.previous||e.connect(s)}else e.connect(s);return this._startIfPossible(),this}remove(e,t){let s=this._head.next;for(;s;)s=s.match(e,t)?s.destroy():s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let s;if(t>this.lastTime){if(s=this.elapsedMS=t-this.lastTime,s>this._maxElapsedMS&&(s=this._maxElapsedMS),s*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=s,this.deltaTime=this.deltaMS*e.targetFPMS;const i=this._head;let r=i.next;for(;r;)r=r.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const s=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,s)/1e3,e.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(0===e)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!e._shared){const t=e._shared=new e;t.autoStart=!0,t._protected=!0}return e._shared}static get system(){if(!e._system){const t=e._system=new e;t.autoStart=!0,t._protected=!0}return e._system}};Yi.targetFPMS=.06;let qi=Yi;Object.defineProperties(L,{TARGET_FPMS:{get:()=>qi.targetFPMS,set(e){B('7.1.0','settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS'),qi.targetFPMS=e}}});class Qi{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,'ticker',{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,ji.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?qi.shared:new qi,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}Qi.extension=nt.Application,lt.add(Qi);const Ki=[];function Zi(e){for(const t of Ki)if(t.test(e))return new t(e);throw new Error('Unable to auto-detect a suitable renderer.')}lt.handleByList(nt.Renderer,Ki);const Ji='attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}',er='attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n';class tr{constructor(e){this.renderer=e}contextChange(e){let t;if(1===this.renderer.context.webGLVersion){const s=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,s)}else{const s=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,s)}t>=P.HIGH?this.multisample=P.HIGH:t>=P.MEDIUM?this.multisample=P.MEDIUM:t>=P.LOW?this.multisample=P.LOW:this.multisample=P.NONE}destroy(){}}tr.extension={type:nt.RendererSystem,name:'_multisample'},lt.add(tr);class sr{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class ir{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:s}=this,i=e._glBuffers[s]||this.createGLBuffer(e);t.bindBuffer(e.type,i.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:s,CONTEXT_UID:i}=this;if(this.boundBufferBases[t]!==e){const r=e._glBuffers[i]||this.createGLBuffer(e);this.boundBufferBases[t]=e,s.bindBufferBase(s.UNIFORM_BUFFER,t,r.buffer)}}bindBufferRange(e,t,s){const{gl:i,CONTEXT_UID:r}=this;s=s||0;const n=e._glBuffers[r]||this.createGLBuffer(e);i.bindBufferRange(i.UNIFORM_BUFFER,t||0,n.buffer,256*s,256)}update(e){const{gl:t,CONTEXT_UID:s}=this,i=e._glBuffers[s]||this.createGLBuffer(e);if(e._updateID!==i.updateID)if(i.updateID=e._updateID,t.bindBuffer(e.type,i.buffer),i.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const s=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;i.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,s)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const s=e._glBuffers[this.CONTEXT_UID],i=this.gl;e.disposeRunner.remove(this),s&&(t||i.deleteBuffer(s.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let s=0;s<t.length;s++)this.dispose(this.managedBuffers[t[s]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:s}=this;return e._glBuffers[t]=new sr(s.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}ir.extension={type:nt.RendererSystem,name:'buffer'},lt.add(ir);class rr{constructor(e){this.renderer=e}render(e,t){const s=this.renderer;let i,r,n,o;if(t&&(i=t.renderTexture,r=t.clear,n=t.transform,o=t.skipUpdateTransform),this.renderingToScreen=!i,s.runners.prerender.emit(),s.emit('prerender'),s.projection.transform=n,!s.context.isLost){if(i||(this.lastObjectRendered=e),!o){const t=e.enableTempParent();e.updateTransform(),e.disableTempParent(t)}s.renderTexture.bind(i),s.batch.currentRenderer.start(),(r??s.background.clearBeforeRender)&&s.renderTexture.clear(),e.render(s),s.batch.currentRenderer.flush(),i&&(t.blit&&s.framebuffer.blit(),i.baseTexture.update()),s.runners.postrender.emit(),s.projection.transform=null,s.emit('postrender')}}destroy(){this.renderer=null,this.lastObjectRendered=null}}rr.extension={type:nt.RendererSystem,name:'objectRenderer'},lt.add(rr);const nr=class e extends Ui{constructor(t){super(),this.type=c.WEBGL,t=Object.assign({},L.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new ys({projectionMatrix:new Wt},!0);const s={runners:['init','destroy','contextChange','resolutionChange','reset','update','postrender','prerender','resize'],systems:e.__systems,priority:['_view','textureGenerator','background','_plugin','startup','context','state','texture','buffer','geometry','framebuffer','transformFeedback','mask','scissor','stencil','projection','textureGC','filter','renderTexture','batch','objectRenderer','_multisample']};this.setup(s),'useContextAlpha'in t&&(B('7.0.0','options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead'),t.premultipliedAlpha=t.useContextAlpha&&'notMultiplied'!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=e.__plugins,this.options=t,this.startup.run(this.options)}static test(e){return!e?.forceCanvas&&j()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return B('7.0.0','renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead.'),this.background.clearBeforeRender}get useContextAlpha(){return B('7.0.0','renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead.'),this.context.useContextAlpha}get preserveDrawingBuffer(){return B('7.0.0','renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context'),this.context.preserveDrawingBuffer}get backgroundColor(){return B('7.0.0','renderer.backgroundColor has been deprecated, use renderer.background.color instead.'),this.background.color}set backgroundColor(e){B('7.0.0','renderer.backgroundColor has been deprecated, use renderer.background.color instead.'),this.background.color=e}get backgroundAlpha(){return B('7.0.0','renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead.'),this.background.alpha}set backgroundAlpha(e){B('7.0.0','renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead.'),this.background.alpha=e}get powerPreference(){return B('7.0.0','renderer.powerPreference has been deprecated, we can only know this if pixi creates the context'),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};nr.extension={type:nt.Renderer,priority:1},nr.__plugins={},nr.__systems={};let or=nr;lt.handleByMap(nt.RendererPlugin,or.__plugins),lt.handleByMap(nt.RendererSystem,or.__systems),lt.add(or);class ar extends _t{constructor(e,t){const{width:s,height:i}=t||{};super(s,i),this.items=[],this.itemDirtyIds=[];for(let t=0;t<e;t++){const e=new bt;this.items.push(e),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let s=0;s<this.length;s++)e[s]&&(e[s].castToBaseTexture?this.addBaseTextureAt(e[s].castToBaseTexture(),s):e[s]instanceof _t?this.addResourceAt(e[s],s):this.addResourceAt(gt(e[s],t),s))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(null!==this.baseTexture)throw new Error('Only one base texture per TextureArray is allowed');super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on('update',e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off('update',e.update,e)}load(){if(this._load)return this._load;const e=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(e).then(()=>{const{realWidth:e,realHeight:t}=this.items[0];return this.resize(e,t),this.update(),Promise.resolve(this)}),this._load}}class lr extends ar{constructor(e,t){const{width:s,height:i}=t||{};let r,n;Array.isArray(e)?(r=e,n=e.length):n=e,super(n,{width:s,height:i}),r&&this.initFromArray(r,t)}addBaseTextureAt(e,t){if(!e.resource)throw new Error('ArrayResource does not support RenderTexture');return this.addResourceAt(e.resource,t),this}bind(e){super.bind(e),e.target=m.TEXTURE_2D_ARRAY}upload(e,t,s){const{length:i,itemDirtyIds:r,items:n}=this,{gl:o}=e;s.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,s.internalFormat,this._width,this._height,i,0,t.format,s.type,null);for(let e=0;e<i;e++){const i=n[e];r[e]<i.dirtyId&&(r[e]=i.dirtyId,i.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,e,i.resource.width,i.resource.height,1,t.format,s.type,i.resource.source))}return!0}}class hr extends Ds{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return!!(t&&e instanceof t)||globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}}const ur=class e extends ar{constructor(t,s){const{width:i,height:r,autoLoad:n,linkBaseTexture:o}=s||{};if(t&&t.length!==e.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:r});for(let t=0;t<e.SIDES;t++)this.items[t].target=m.TEXTURE_CUBE_MAP_POSITIVE_X+t;this.linkBaseTexture=!1!==o,t&&this.initFromArray(t,s),!1!==n&&this.load()}bind(e){super.bind(e),e.target=m.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,s){if(void 0===s&&(s=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0){if(!e.resource)throw new Error('CubeResource does not support copying of renderTexture.');this.addResourceAt(e.resource,t)}else e.target=m.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(t,s,i){const r=this.itemDirtyIds;for(let n=0;n<e.SIDES;n++){const e=this.items[n];(r[n]<e.dirtyId||i.dirtyId<s.dirtyId)&&(e.valid&&e.resource?(e.resource.upload(t,e,i),r[n]=e.dirtyId):r[n]<-1&&(t.gl.texImage2D(e.target,0,i.internalFormat,s.realWidth,s.realHeight,0,s.format,i.type,null),r[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===e.SIDES}};ur.SIDES=6;let cr=ur;class dr extends Ds{constructor(e,t){let s,i,r;t=t||{},'string'==typeof e?(s=dr.EMPTY,i=e,r=!0):(s=e,i=null,r=!1),super(s),this.url=i,this.crossOrigin=t.crossOrigin??!0,this.alphaMode='number'==typeof t.alphaMode?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??r,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(async(e,t)=>{if(null!==this.url)try{const t=await L.ADAPTER.fetch(this.url,{mode:this.crossOrigin?'cors':'no-cors'});if(this.destroyed)return;const s=await t.blob();if(this.destroyed)return;const i=await createImageBitmap(s,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===w.UNPACK?'premultiply':'none'});if(this.destroyed)return void i.close();this.source=i,this.update(),e(this)}catch(e){if(this.destroyed)return;t(e),this.onError.emit(e)}else e(this)})),this._load}upload(e,t,s){return this.source instanceof ImageBitmap?('number'==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),super.upload(e,t,s)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<'u'&&('string'==typeof e||e instanceof ImageBitmap)}static get EMPTY(){return dr._EMPTY=dr._EMPTY??L.ADAPTER.createCanvas(0,0),dr._EMPTY}}const pr=class e extends Ds{constructor(e,t){t=t||{},super(L.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},e.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error('Your browser doesn\'t support base64 conversions.');this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()})),this._load}_loadSvg(){const e=new Image;Ds.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,s=e.height;if(!t||!s)throw new Error('The SVG image must have width and height defined (in pixels), canvas API needs them.');let i=t*this.scale,r=s*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/s*t,r=this._overrideHeight||this._overrideWidth/t*s),i=Math.round(i),r=Math.round(r);const n=this.source;n.width=i,n.height=r,n._pixiId=`canvas_${We()}`,n.getContext('2d').drawImage(e,0,0,t,s,0,0,i,r),this._resolve(),this._resolve=null}}static getSize(t){const s=e.SVG_SIZE.exec(t),i={};return s&&(i[s[1]]=Math.round(parseFloat(s[3])),i[s[5]]=Math.round(parseFloat(s[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,s){return'svg'===s||'string'==typeof t&&t.startsWith('data:image/svg+xml')||'string'==typeof t&&e.SVG_XML.test(t)}};pr.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,pr.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let fr=pr;const gr=class e extends Ds{constructor(t,s){if(s=s||{},!(t instanceof HTMLVideoElement)){const i=document.createElement('video');!1!==s.autoLoad&&i.setAttribute('preload','auto'),!1!==s.playsinline&&(i.setAttribute('webkit-playsinline',''),i.setAttribute('playsinline','')),!0===s.muted&&(i.setAttribute('muted',''),i.muted=!0),!0===s.loop&&i.setAttribute('loop',''),!1!==s.autoPlay&&i.setAttribute('autoplay',''),'string'==typeof t&&(t=[t]);const r=t[0].src||t[0];Ds.crossOrigin(i,r,s.crossorigin);for(let s=0;s<t.length;++s){const r=document.createElement('source');let{src:n,mime:o}=t[s];if(n=n||t[s],n.startsWith('data:'))o=n.slice(5,n.indexOf(';'));else if(!n.startsWith('blob:')){const t=n.split('?').shift().toLowerCase(),s=t.slice(t.lastIndexOf('.')+1);o=o||e.MIME_TYPES[s]||`video/${s}`}r.src=n,o&&(r.type=o),i.appendChild(r)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=s.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==s.autoPlay,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==s.autoLoad&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){const e=qi.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener('play',this._onPlayStart),e.addEventListener('pause',this._onPlayStop),e.addEventListener('seeked',this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener('canplay',this._onCanPlay),e.addEventListener('canplaythrough',this._onCanPlay),e.addEventListener('error',this._onError,!0)),this._load=new Promise((t,s)=>{this.valid?t(this):(this._resolve=t,this._reject=s,e.load())}),this._load}_onError(e){this.source.removeEventListener('error',this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener('canplay',this._onCanPlay),e.removeEventListener('canplaythrough',this._onCanPlay);const t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener('play',this._onPlayStart),e.removeEventListener('pause',this._onPlayStop),e.removeEventListener('seeked',this._onSeeked),e.removeEventListener('canplay',this._onCanPlay),e.removeEventListener('canplaythrough',this._onCanPlay),e.removeEventListener('error',this._onError,!0),e.pause(),e.src='',e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(qi.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(qi.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(qi.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,s){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.includes(s)}};gr.TYPES=['mp4','m4v','webm','ogg','ogv','h264','avi','mov'],gr.MIME_TYPES={ogv:'video/ogg',mov:'video/quicktime',m4v:'video/mp4'};let mr=gr;ft.push(dr,Bs,hr,mr,class extends Ds{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}},fr,vt,cr,lr);class _r{constructor(){this._glTransformFeedbacks={},this.buffers=[],this.disposeRunner=new mt('disposeTransformFeedback')}bindBuffer(e,t){this.buffers[e]=t}destroy(){this.disposeRunner.emit(this,!1)}}const vr='7.4.3'},677(e,t,s){s.d(t,{D$:()=>G,Ef:()=>Y,Jo:()=>O,jR:()=>H});var i=s(990),r=(s(926),s(395));let n;const o='undefined'!=typeof window&&window.trustedTypes;if(o)try{n=o.createPolicy('vue',{createHTML:e=>e})}catch(e){}const a=n?e=>n.createHTML(e):e=>e,l='undefined'!=typeof document?document:null,h=l&&l.createElement('template'),u={insert:(e,t,s)=>{t.insertBefore(e,s||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,s,i)=>{const r='svg'===t?l.createElementNS('http://www.w3.org/2000/svg',e):'mathml'===t?l.createElementNS('http://www.w3.org/1998/Math/MathML',e):s?l.createElement(e,{is:s}):l.createElement(e);return'select'===e&&i&&null!=i.multiple&&r.setAttribute('multiple',i.multiple),r},createText:e=>l.createTextNode(e),createComment:e=>l.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>l.querySelector(e),setScopeId(e,t){e.setAttribute(t,'')},insertStaticContent(e,t,s,i,r,n){const o=s?s.previousSibling:t.lastChild;if(r&&(r===n||r.nextSibling))for(;t.insertBefore(r.cloneNode(!0),s),r!==n&&(r=r.nextSibling););else{h.innerHTML=a('svg'===i?`<svg>${e}</svg>`:'mathml'===i?`<math>${e}</math>`:e);const r=h.content;if('svg'===i||'mathml'===i){const e=r.firstChild;for(;e.firstChild;)r.appendChild(e.firstChild);r.removeChild(e)}t.insertBefore(r,s)}return[o?o.nextSibling:t.firstChild,s?s.previousSibling:t.lastChild]}},c=Symbol('_vtc'),d={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};i.QP;const p=Symbol('_vod'),f=Symbol('_vsh');const g=Symbol('');const m=/(?:^|;)\s*display\s*:/;const v=/\s*!important$/;function y(e,t,s){if((0,r.cy)(s))s.forEach(s=>y(e,t,s));else if(null==s&&(s=''),t.startsWith('--'))e.setProperty(t,s);else{const i=function(e,t){const s=b[t];if(s)return s;let i=(0,r.PT)(t);if('filter'!==i&&i in e)return b[t]=i;i=(0,r.ZH)(i);for(let s=0;s<x.length;s++){const r=x[s]+i;if(r in e)return b[t]=r}return t}(e,t);v.test(s)?e.setProperty((0,r.Tg)(i),s.replace(v,''),'important'):e[i]=s}}const x=['Webkit','Moz','ms'],b={};const T='http://www.w3.org/1999/xlink';function w(e,t,s,i,n,o=(0,r.J$)(t)){i&&t.startsWith('xlink:')?null==s?e.removeAttributeNS(T,t.slice(6,t.length)):e.setAttributeNS(T,t,s):null==s||o&&!(0,r.Y2)(s)?e.removeAttribute(t):e.setAttribute(t,o?'':(0,r.Bm)(s)?String(s):s)}function E(e,t,s,i,n){if('innerHTML'===t||'textContent'===t)return void(null!=s&&(e[t]='innerHTML'===t?a(s):s));const o=e.tagName;if('value'===t&&'PROGRESS'!==o&&!o.includes('-')){const i='OPTION'===o?e.getAttribute('value')||'':e.value,r=null==s?'checkbox'===e.type?'on':'':String(s);return i===r&&'_value'in e||(e.value=r),null==s&&e.removeAttribute(t),void(e._value=s)}let l=!1;if(''===s||null==s){const i=typeof e[t];'boolean'===i?s=(0,r.Y2)(s):null==s&&'string'===i?(s='',l=!0):'number'===i&&(s=0,l=!0)}try{e[t]=s}catch(e){0}l&&e.removeAttribute(n||t)}function C(e,t,s,i){e.addEventListener(t,s,i)}const S=Symbol('_vei');function A(e,t,s,n,o=null){const a=e[S]||(e[S]={}),l=a[t];if(n&&l)l.value=n;else{const[s,h]=function(e){let t;if(M.test(e)){let s;for(t={};s=e.match(M);)e=e.slice(0,e.length-s[0].length),t[s[0].toLowerCase()]=!0}const s=':'===e[2]?e.slice(3):(0,r.Tg)(e.slice(2));return[s,t]}(t);if(n){const l=a[t]=function(e,t){const s=e=>{if(e._vts){if(e._vts<=s.attached)return}else e._vts=Date.now();(0,i.qL)(function(e,t){if((0,r.cy)(t)){const s=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{s.call(e),e._stopped=!0},t.map(e=>t=>!t._stopped&&e&&e(t))}return t}(e,s.value),t,5,[e])};return s.value=e,s.attached=(()=>P||(I.then(()=>P=0),P=Date.now()))(),s}(n,o);C(e,s,l,h)}else l&&(!function(e,t,s,i){e.removeEventListener(t,s,i)}(e,s,l,h),a[t]=void 0)}}const M=/(?:Once|Passive|Capture)$/;let P=0;const I=Promise.resolve();const R=e=>111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123;'undefined'!=typeof HTMLElement&&HTMLElement;const L=e=>{const t=e.props['onUpdate:modelValue']||!1;return(0,r.cy)(t)?e=>(0,r.DY)(t,e):t};function k(e){e.target.composing=!0}function D(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event('input')))}const B=Symbol('_assign');function F(e,t,s){return t&&(e=e.trim()),s&&(e=(0,r.bB)(e)),e}const O={created(e,{modifiers:{lazy:t,trim:s,number:i}},r){e[B]=L(r);const n=i||r.props&&'number'===r.props.type;C(e,t?'change':'input',t=>{t.target.composing||e[B](F(e.value,s,n))}),(s||n)&&C(e,'change',()=>{e.value=F(e.value,s,n)}),t||(C(e,'compositionstart',k),C(e,'compositionend',D),C(e,'change',D))},mounted(e,{value:t}){e.value=null==t?'':t},beforeUpdate(e,{value:t,oldValue:s,modifiers:{lazy:i,trim:n,number:o}},a){if(e[B]=L(a),e.composing)return;const l=null==t?'':t;if((!o&&'number'!==e.type||/^0\d/.test(e.value)?e.value:(0,r.bB)(e.value))!==l){if(document.activeElement===e&&'range'!==e.type){if(i&&t===s)return;if(n&&e.value.trim()===l)return}e.value=l}}};const N=['ctrl','shift','alt','meta'],U={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>'button'in e&&0!==e.button,middle:e=>'button'in e&&1!==e.button,right:e=>'button'in e&&2!==e.button,exact:(e,t)=>N.some(s=>e[`${s}Key`]&&!t.includes(s))},G=(e,t)=>{const s=e._withMods||(e._withMods={}),i=t.join('.');return s[i]||(s[i]=(s,...i)=>{for(let e=0;e<t.length;e++){const i=U[t[e]];if(i&&i(s,t))return}return e(s,...i)})},V={esc:'escape',space:' ',up:'arrow-up',left:'arrow-left',right:'arrow-right',down:'arrow-down',delete:'backspace'},H=(e,t)=>{const s=e._withKeys||(e._withKeys={}),i=t.join('.');return s[i]||(s[i]=s=>{if(!('key'in s))return;const i=(0,r.Tg)(s.key);return t.some(e=>e===i||V[e]===i)?e(s):void 0})},W=(0,r.X$)({patchProp:(e,t,s,i,n,o)=>{const a='svg'===n;'class'===t?function(e,t,s){const i=e[c];i&&(t=(t?[t,...i]:[...i]).join(' ')),null==t?e.removeAttribute('class'):s?e.setAttribute('class',t):e.className=t}(e,i,a):'style'===t?function(e,t,s){const i=e.style,n=(0,r.Kg)(s);let o=!1;if(s&&!n){if(t)if((0,r.Kg)(t))for(const e of t.split(';')){const t=e.slice(0,e.indexOf(':')).trim();null==s[t]&&y(i,t,'')}else for(const e in t)null==s[e]&&y(i,e,'');for(const e in s)'display'===e&&(o=!0),y(i,e,s[e])}else if(n){if(t!==s){const e=i[g];e&&(s+=';'+e),i.cssText=s,o=m.test(s)}}else t&&e.removeAttribute('style');p in e&&(e[p]=o?i.display:'',e[f]&&(i.display='none'))}(e,s,i):(0,r.Mp)(t)?(0,r.CP)(t)||A(e,t,0,i,o):('.'===t[0]?(t=t.slice(1),1):'^'===t[0]?(t=t.slice(1),0):function(e,t,s,i){if(i)return'innerHTML'===t||'textContent'===t||!!(t in e&&R(t)&&(0,r.Tn)(s));if('spellcheck'===t||'draggable'===t||'translate'===t||'autocorrect'===t)return!1;if('sandbox'===t&&'IFRAME'===e.tagName)return!1;if('form'===t)return!1;if('list'===t&&'INPUT'===e.tagName)return!1;if('type'===t&&'TEXTAREA'===e.tagName)return!1;if('width'===t||'height'===t){const t=e.tagName;if('IMG'===t||'VIDEO'===t||'CANVAS'===t||'SOURCE'===t)return!1}if(R(t)&&(0,r.Kg)(s))return!1;return t in e}(e,t,i,a))?(E(e,t,i),e.tagName.includes('-')||'value'!==t&&'checked'!==t&&'selected'!==t||w(e,t,i,a,0,'value'!==t)):!e._isVueCE||!/[A-Z]/.test(t)&&(0,r.Kg)(i)?('true-value'===t?e._trueValue=i:'false-value'===t&&(e._falseValue=i),w(e,t,i,a)):E(e,(0,r.PT)(t),i,0,t)}},u);let X;function j(){return X||(X=(0,i.K9)(W))}const Y=(...e)=>{const t=j().createApp(...e);const{mount:s}=t;return t.mount=e=>{const i=Q(e);if(!i)return;const n=t._component;(0,r.Tn)(n)||n.render||n.template||(n.template=i.innerHTML),1===i.nodeType&&(i.textContent='');const o=s(i,!1,q(i));return i instanceof Element&&(i.removeAttribute('v-cloak'),i.setAttribute('data-v-app','')),o},t};function q(e){return e instanceof SVGElement?'svg':'function'==typeof MathMLElement&&e instanceof MathMLElement?'mathml':void 0}function Q(e){if((0,r.Kg)(e)){return document.querySelector(e)}return e}},685(e,t,s){s.d(t,{cz:()=>r,mc:()=>u,q9:()=>n,dC:()=>o});var i=s(609);class r{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?i.M_.EMPTY:((e=e||new i.M_(0,0,1,1)).x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:s,b:i,c:r,d:n,tx:o,ty:a}=e,l=s*t.x+r*t.y+o,h=i*t.x+n*t.y+a;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,h),this.maxY=Math.max(this.maxY,h)}addQuad(e){let t=this.minX,s=this.minY,i=this.maxX,r=this.maxY,n=e[0],o=e[1];t=n<t?n:t,s=o<s?o:s,i=n>i?n:i,r=o>r?o:r,n=e[2],o=e[3],t=n<t?n:t,s=o<s?o:s,i=n>i?n:i,r=o>r?o:r,n=e[4],o=e[5],t=n<t?n:t,s=o<s?o:s,i=n>i?n:i,r=o>r?o:r,n=e[6],o=e[7],t=n<t?n:t,s=o<s?o:s,i=n>i?n:i,r=o>r?o:r,this.minX=t,this.minY=s,this.maxX=i,this.maxY=r}addFrame(e,t,s,i,r){this.addFrameMatrix(e.worldTransform,t,s,i,r)}addFrameMatrix(e,t,s,i,r){const n=e.a,o=e.b,a=e.c,l=e.d,h=e.tx,u=e.ty;let c=this.minX,d=this.minY,p=this.maxX,f=this.maxY,g=n*t+a*s+h,m=o*t+l*s+u;c=g<c?g:c,d=m<d?m:d,p=g>p?g:p,f=m>f?m:f,g=n*i+a*s+h,m=o*i+l*s+u,c=g<c?g:c,d=m<d?m:d,p=g>p?g:p,f=m>f?m:f,g=n*t+a*r+h,m=o*t+l*r+u,c=g<c?g:c,d=m<d?m:d,p=g>p?g:p,f=m>f?m:f,g=n*i+a*r+h,m=o*i+l*r+u,c=g<c?g:c,d=m<d?m:d,p=g>p?g:p,f=m>f?m:f,this.minX=c,this.minY=d,this.maxX=p,this.maxY=f}addVertexData(e,t,s){let i=this.minX,r=this.minY,n=this.maxX,o=this.maxY;for(let a=t;a<s;a+=2){const t=e[a],s=e[a+1];i=t<i?t:i,r=s<r?s:r,n=t>n?t:n,o=s>o?s:o}this.minX=i,this.minY=r,this.maxX=n,this.maxY=o}addVertices(e,t,s,i){this.addVerticesMatrix(e.worldTransform,t,s,i)}addVerticesMatrix(e,t,s,i,r=0,n=r){const o=e.a,a=e.b,l=e.c,h=e.d,u=e.tx,c=e.ty;let d=this.minX,p=this.minY,f=this.maxX,g=this.maxY;for(let e=s;e<i;e+=2){const s=t[e],i=t[e+1],m=o*s+l*i+u,v=h*i+a*s+c;d=Math.min(d,m-r),f=Math.max(f,m+r),p=Math.min(p,v-n),g=Math.max(g,v+n)}this.minX=d,this.minY=p,this.maxX=f,this.maxY=g}addBounds(e){const t=this.minX,s=this.minY,i=this.maxX,r=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<s?e.minY:s,this.maxX=e.maxX>i?e.maxX:i,this.maxY=e.maxY>r?e.maxY:r}addBoundsMask(e,t){const s=e.minX>t.minX?e.minX:t.minX,i=e.minY>t.minY?e.minY:t.minY,r=e.maxX<t.maxX?e.maxX:t.maxX,n=e.maxY<t.maxY?e.maxY:t.maxY;if(s<=r&&i<=n){const e=this.minX,t=this.minY,o=this.maxX,a=this.maxY;this.minX=s<e?s:e,this.minY=i<t?i:t,this.maxX=r>o?r:o,this.maxY=n>a?n:a}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const s=e.minX>t.x?e.minX:t.x,i=e.minY>t.y?e.minY:t.y,r=e.maxX<t.x+t.width?e.maxX:t.x+t.width,n=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(s<=r&&i<=n){const e=this.minX,t=this.minY,o=this.maxX,a=this.maxY;this.minX=s<e?s:e,this.minY=i<t?i:t,this.maxX=r>o?r:o,this.maxY=n>a?n:a}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,s,i,r,n){e-=r,t-=n,s+=r,i+=n,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>s?this.maxX:s,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>i?this.maxY:i}}class n extends i.Wp.EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new i.dL,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new r,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let s=0;s<t.length;++s){const i=t[s];Object.defineProperty(n.prototype,i,Object.getOwnPropertyDescriptor(e,i))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new i.M_),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new i.M_),e=this._localBoundsRect),this._localBounds||(this._localBounds=new r);const t=this.transform,s=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=s?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,o=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,e);return this.parent=s,this.transform=t,this._bounds=n,this._bounds.updateID+=this._boundsID-o,a}toGlobal(e,t,s=!1){return s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,s,i){return t&&(e=t.toGlobal(e,s,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,s)}setParent(e){if(!e||!e.addChild)throw new Error('setParent: Argument must be a Container');return e.addChild(this),e}removeFromParent(){this.parent?.removeChild(this)}setTransform(e=0,t=0,s=1,i=1,r=0,n=0,o=0,a=0,l=0){return this.position.x=e,this.position.y=t,this.scale.x=s||1,this.scale.y=i||1,this.rotation=r,this.skew.x=n,this.skew.y=o,this.pivot.x=a,this.pivot.y=l,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode='auto',this.interactiveChildren=!1,this.emit('destroyed'),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new o),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*i.bO}set angle(e){this.transform.rotation=e*i.Td}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,0===e._maskRefCount&&(e.renderable=!0,e.isMask=!1))}if(this._mask=e,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(0===e._maskRefCount&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class o extends n{constructor(){super(...arguments),this.sortDirty=null}}n.prototype.displayObjectUpdateTransform=n.prototype.updateTransform;const a=new i.uq;function l(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const h=class e extends n{constructor(){super(),this.children=[],this.sortableChildren=e.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit('childAdded',t,this,this.children.length-1),t.emit('added',this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit('added',this),this.emit('childAdded',e,this,t),e}swapChildren(e,t){if(e===t)return;const s=this.getChildIndex(e),i=this.getChildIndex(t);this.children[s]=t,this.children[i]=e,this.onChildrenChange(s<i?s:i)}getChildIndex(e){const t=this.children.indexOf(e);if(-1===t)throw new Error('The supplied DisplayObject must be a child of the caller');return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const s=this.getChildIndex(e);i.Wp.removeItems(this.children,s,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],s=this.children.indexOf(t);if(-1===s)return null;t.parent=null,t.transform._parentID=-1,i.Wp.removeItems(this.children,s,1),this._boundsID++,this.onChildrenChange(s),t.emit('removed',this),this.emit('childRemoved',t,this,s)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,i.Wp.removeItems(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit('removed',this),this.emit('childRemoved',t,this,e),t}removeChildren(e=0,t=this.children.length){const s=e,i=t-s;let r;if(i>0&&i<=t){r=this.children.splice(s,i);for(let e=0;e<r.length;++e)r[e].parent=null,r[e].transform&&(r[e].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let e=0;e<r.length;++e)r[e].emit('removed',this),this.emit('childRemoved',r[e],this,e);return r}if(0===i&&0===this.children.length)return[];throw new RangeError('removeChildren: numeric values are outside the acceptable range.')}sortChildren(){let e=!1;for(let t=0,s=this.children.length;t<s;++t){const s=this.children[t];s._lastSortedIndex=t,!e&&0!==s.zIndex&&(e=!0)}e&&this.children.length>1&&this.children.sort(l),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const t=this.children[e];t.visible&&t.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(t.visible&&t.renderable)if(t.calculateBounds(),t._mask){const e=t._mask.isMaskData?t._mask.maskObject:t._mask;e?(e.calculateBounds(),this._bounds.addBoundsMask(t._bounds,e._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const s=super.getLocalBounds(e);if(!t)for(let e=0,t=this.children.length;e<t;++e){const t=this.children[e];t.visible&&t.updateTransform()}return s}_calculateBounds(){}_renderWithCulling(t){const s=t.renderTexture.sourceFrame;if(!(s.width>0&&s.height>0))return;let i,r;this.cullArea?(i=this.cullArea,r=this.worldTransform):this._render!==e.prototype._render&&(i=this.getBounds(!0));const n=t.projection.transform;if(n&&(r?(r=a.copyFrom(r),r.prepend(n)):r=n),i&&s.intersects(i,r))this._render(t);else if(this.cullArea)return;for(let e=0,s=this.children.length;e<s;++e){const s=this.children[e],i=s.cullable;s.cullable=i||!this.cullArea,s.render(t),s.cullable=i}}render(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,s=this.children.length;t<s;++t)this.children[t].render(e)}}renderAdvanced(e){const t=this.filters,s=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let e=0;e<t.length;e++)t[e].enabled&&this._enabledFilters.push(t[e])}const r=t&&this._enabledFilters?.length||s&&(!s.isMaskData||s.enabled&&(s.autoDetect||s.type!==i.vg.NONE));if(r&&e.batch.flush(),t&&this._enabledFilters?.length&&e.filter.push(this,this._enabledFilters),s&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,s=this.children.length;t<s;++t)this.children[t].render(e)}r&&e.batch.flush(),s&&e.mask.pop(this),t&&this._enabledFilters?.length&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t='boolean'==typeof e?e:e?.children,s=this.removeChildren(0,this.children.length);if(t)for(let t=0;t<s.length;++t)s[t].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;this.scale.x=0!==t?e/t:1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;this.scale.y=0!==t?e/t:1,this._height=e}};h.defaultSortableChildren=!1;let u=h;u.prototype.containerUpdateTransform=u.prototype.updateTransform,Object.defineProperties(i.W0,{SORTABLE_CHILDREN:{get:()=>u.defaultSortableChildren,set(e){i.Wp.deprecation('7.1.0','settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren'),u.defaultSortableChildren=e}}})},926(e,t,s){s.d(t,{C4:()=>E,EW:()=>Oe,Gc:()=>_e,IG:()=>Ce,IJ:()=>Ie,KR:()=>Pe,Pr:()=>Be,R1:()=>ke,Tm:()=>be,X2:()=>l,a1:()=>Ae,bl:()=>C,fE:()=>Te,g8:()=>xe,hV:()=>He,hZ:()=>F,i9:()=>Me,ju:()=>we,lJ:()=>Se,qA:()=>N,u4:()=>B,ux:()=>Ee,wB:()=>Ve,yC:()=>o});var i=s(395);let r,n;class o{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=r,!e&&r&&(this.index=(r.scopes||(r.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){let e,t;if(this._isPaused=!0,this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){let e,t;if(this._isPaused=!1,this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=r;try{return r=this,e()}finally{r=t}}else 0}on(){1===++this._on&&(this.prevScope=r,r=this)}off(){this._on>0&&0===--this._on&&(r=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){let t,s;for(this._active=!1,t=0,s=this.effects.length;t<s;t++)this.effects[t].stop();for(this.effects.length=0,t=0,s=this.cleanups.length;t<s;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=void 0}}}const a=new WeakSet;class l{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,r&&r.active&&r.effects.push(this)}pause(){this.flags|=64}resume(){64&this.flags&&(this.flags&=-65,a.has(this)&&(a.delete(this),this.trigger()))}notify(){2&this.flags&&!(32&this.flags)||8&this.flags||d(this)}run(){if(!(1&this.flags))return this.fn();this.flags|=2,S(this),g(this);const e=n,t=T;n=this,T=!0;try{return this.fn()}finally{0,m(this),n=e,T=t,this.flags&=-3}}stop(){if(1&this.flags){for(let e=this.deps;e;e=e.nextDep)x(e);this.deps=this.depsTail=void 0,S(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){64&this.flags?a.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){v(this)&&this.run()}get dirty(){return v(this)}}let h,u,c=0;function d(e,t=!1){if(e.flags|=8,t)return e.next=u,void(u=e);e.next=h,h=e}function p(){c++}function f(){if(--c>0)return;if(u){let e=u;for(u=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let e;for(;h;){let t=h;for(h=void 0;t;){const s=t.next;if(t.next=void 0,t.flags&=-9,1&t.flags)try{t.trigger()}catch(t){e||(e=t)}t=s}}if(e)throw e}function g(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function m(e){let t,s=e.depsTail,i=s;for(;i;){const e=i.prevDep;-1===i.version?(i===s&&(s=e),x(i),b(i)):t=i,i.dep.activeLink=i.prevActiveLink,i.prevActiveLink=void 0,i=e}e.deps=t,e.depsTail=s}function v(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(y(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function y(e){if(4&e.flags&&!(16&e.flags))return;if(e.flags&=-17,e.globalVersion===A)return;if(e.globalVersion=A,!e.isSSR&&128&e.flags&&(!e.deps&&!e._dirty||!v(e)))return;e.flags|=2;const t=e.dep,s=n,r=T;n=e,T=!0;try{g(e);const s=e.fn(e._value);(0===t.version||(0,i.$H)(s,e._value))&&(e.flags|=128,e._value=s,t.version++)}catch(e){throw t.version++,e}finally{n=s,T=r,m(e),e.flags&=-3}}function x(e,t=!1){const{dep:s,prevSub:i,nextSub:r}=e;if(i&&(i.nextSub=r,e.prevSub=void 0),r&&(r.prevSub=i,e.nextSub=void 0),s.subs===e&&(s.subs=i,!i&&s.computed)){s.computed.flags&=-5;for(let e=s.computed.deps;e;e=e.nextDep)x(e,!0)}t||--s.sc||!s.map||s.map.delete(s.key)}function b(e){const{prevDep:t,nextDep:s}=e;t&&(t.nextDep=s,e.prevDep=void 0),s&&(s.prevDep=t,e.nextDep=void 0)}let T=!0;const w=[];function E(){w.push(T),T=!1}function C(){const e=w.pop();T=void 0===e||e}function S(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const e=n;n=void 0;try{t()}finally{n=e}}}let A=0;class M{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class P{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!n||!T||n===this.computed)return;let t=this.activeLink;if(void 0===t||t.sub!==n)t=this.activeLink=new M(n,this),n.deps?(t.prevDep=n.depsTail,n.depsTail.nextDep=t,n.depsTail=t):n.deps=n.depsTail=t,I(t);else if(-1===t.version&&(t.version=this.version,t.nextDep)){const e=t.nextDep;e.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=e),t.prevDep=n.depsTail,t.nextDep=void 0,n.depsTail.nextDep=t,n.depsTail=t,n.deps===t&&(n.deps=e)}return t}trigger(e){this.version++,A++,this.notify(e)}notify(e){p();try{0;for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{f()}}}function I(e){if(e.dep.sc++,4&e.sub.flags){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let e=t.deps;e;e=e.nextDep)I(e)}const s=e.dep.subs;s!==e&&(e.prevSub=s,s&&(s.nextSub=e)),e.dep.subs=e}}const R=new WeakMap,L=Symbol(''),k=Symbol(''),D=Symbol('');function B(e,t,s){if(T&&n){let t=R.get(e);t||R.set(e,t=new Map);let i=t.get(s);i||(t.set(s,i=new P),i.map=t,i.key=s),i.track()}}function F(e,t,s,r,n,o){const a=R.get(e);if(!a)return void A++;const l=e=>{e&&e.trigger()};if(p(),'clear'===t)a.forEach(l);else{const n=(0,i.cy)(e),o=n&&(0,i.yI)(s);if(n&&'length'===s){const e=Number(r);a.forEach((t,s)=>{('length'===s||s===D||!(0,i.Bm)(s)&&s>=e)&&l(t)})}else switch((void 0!==s||a.has(void 0))&&l(a.get(s)),o&&l(a.get(D)),t){case'add':n?o&&l(a.get('length')):(l(a.get(L)),(0,i.CE)(e)&&l(a.get(k)));break;case'delete':n||(l(a.get(L)),(0,i.CE)(e)&&l(a.get(k)));break;case'set':(0,i.CE)(e)&&l(a.get(L))}}f()}function O(e){const t=Ee(e);return t===e?t:(B(t,0,D),Te(e)?t:t.map(Se))}function N(e){return B(e=Ee(e),0,D),e}function U(e,t){return be(e)?xe(e)?Ae(Se(t)):Ae(t):Se(t)}const G={__proto__:null,[Symbol.iterator](){return V(this,Symbol.iterator,e=>U(this,e))},concat(...e){return O(this).concat(...e.map(e=>(0,i.cy)(e)?O(e):e))},entries(){return V(this,'entries',e=>(e[1]=U(this,e[1]),e))},every(e,t){return W(this,'every',e,t,void 0,arguments)},filter(e,t){return W(this,'filter',e,t,e=>e.map(e=>U(this,e)),arguments)},find(e,t){return W(this,'find',e,t,e=>U(this,e),arguments)},findIndex(e,t){return W(this,'findIndex',e,t,void 0,arguments)},findLast(e,t){return W(this,'findLast',e,t,e=>U(this,e),arguments)},findLastIndex(e,t){return W(this,'findLastIndex',e,t,void 0,arguments)},forEach(e,t){return W(this,'forEach',e,t,void 0,arguments)},includes(...e){return j(this,'includes',e)},indexOf(...e){return j(this,'indexOf',e)},join(e){return O(this).join(e)},lastIndexOf(...e){return j(this,'lastIndexOf',e)},map(e,t){return W(this,'map',e,t,void 0,arguments)},pop(){return Y(this,'pop')},push(...e){return Y(this,'push',e)},reduce(e,...t){return X(this,'reduce',e,t)},reduceRight(e,...t){return X(this,'reduceRight',e,t)},shift(){return Y(this,'shift')},some(e,t){return W(this,'some',e,t,void 0,arguments)},splice(...e){return Y(this,'splice',e)},toReversed(){return O(this).toReversed()},toSorted(e){return O(this).toSorted(e)},toSpliced(...e){return O(this).toSpliced(...e)},unshift(...e){return Y(this,'unshift',e)},values(){return V(this,'values',e=>U(this,e))}};function V(e,t,s){const i=N(e),r=i[t]();return i===e||Te(e)||(r._next=r.next,r.next=()=>{const e=r._next();return e.done||(e.value=s(e.value)),e}),r}const H=Array.prototype;function W(e,t,s,i,r,n){const o=N(e),a=o!==e&&!Te(e),l=o[t];if(l!==H[t]){const t=l.apply(e,n);return a?Se(t):t}let h=s;o!==e&&(a?h=function(t,i){return s.call(this,U(e,t),i,e)}:s.length>2&&(h=function(t,i){return s.call(this,t,i,e)}));const u=l.call(o,h,i);return a&&r?r(u):u}function X(e,t,s,i){const r=N(e);let n=s;return r!==e&&(Te(e)?s.length>3&&(n=function(t,i,r){return s.call(this,t,i,r,e)}):n=function(t,i,r){return s.call(this,t,U(e,i),r,e)}),r[t](n,...i)}function j(e,t,s){const i=Ee(e);B(i,0,D);const r=i[t](...s);return-1!==r&&!1!==r||!we(s[0])?r:(s[0]=Ee(s[0]),i[t](...s))}function Y(e,t,s=[]){E(),p();const i=Ee(e)[t].apply(e,s);return f(),C(),i}const q=(0,i.pD)('__proto__,__v_isRef,__isVue'),Q=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>'arguments'!==e&&'caller'!==e).map(e=>Symbol[e]).filter(i.Bm));function K(e){(0,i.Bm)(e)||(e=String(e));const t=Ee(this);return B(t,0,e),t.hasOwnProperty(e)}class Z{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,s){if('__v_skip'===t)return e.__v_skip;const r=this._isReadonly,n=this._isShallow;if('__v_isReactive'===t)return!r;if('__v_isReadonly'===t)return r;if('__v_isShallow'===t)return n;if('__v_raw'===t)return s===(r?n?ge:fe:n?pe:de).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const o=(0,i.cy)(e);if(!r){let e;if(o&&(e=G[t]))return e;if('hasOwnProperty'===t)return K}const a=Reflect.get(e,t,Me(e)?e:s);if((0,i.Bm)(t)?Q.has(t):q(t))return a;if(r||B(e,0,t),n)return a;if(Me(a)){const e=o&&(0,i.yI)(t)?a:a.value;return r&&(0,i.Gv)(e)?ve(e):e}return(0,i.Gv)(a)?r?ve(a):me(a):a}}class J extends Z{constructor(e=!1){super(!1,e)}set(e,t,s,r){let n=e[t];const o=(0,i.cy)(e)&&(0,i.yI)(t);if(!this._isShallow){const e=be(n);if(Te(s)||be(s)||(n=Ee(n),s=Ee(s)),!o&&Me(n)&&!Me(s))return e||(n.value=s),!0}const a=o?Number(t)<e.length:(0,i.$3)(e,t),l=Reflect.set(e,t,s,Me(e)?e:r);return e===Ee(r)&&(a?(0,i.$H)(s,n)&&F(e,'set',t,s):F(e,'add',t,s)),l}deleteProperty(e,t){const s=(0,i.$3)(e,t),r=(e[t],Reflect.deleteProperty(e,t));return r&&s&&F(e,'delete',t,void 0),r}has(e,t){const s=Reflect.has(e,t);return(0,i.Bm)(t)&&Q.has(t)||B(e,0,t),s}ownKeys(e){return B(e,0,(0,i.cy)(e)?'length':L),Reflect.ownKeys(e)}}class ee extends Z{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const te=new J,se=new ee,ie=new J(!0),re=e=>e,ne=e=>Reflect.getPrototypeOf(e);function oe(e){return function(...t){return'delete'!==e&&('clear'===e?void 0:this)}}function ae(e,t){const s={get(s){const r=this.__v_raw,n=Ee(r),o=Ee(s);e||((0,i.$H)(s,o)&&B(n,0,s),B(n,0,o));const{has:a}=ne(n),l=t?re:e?Ae:Se;return a.call(n,s)?l(r.get(s)):a.call(n,o)?l(r.get(o)):void(r!==n&&r.get(s))},get size(){const t=this.__v_raw;return!e&&B(Ee(t),0,L),t.size},has(t){const s=this.__v_raw,r=Ee(s),n=Ee(t);return e||((0,i.$H)(t,n)&&B(r,0,t),B(r,0,n)),t===n?s.has(t):s.has(t)||s.has(n)},forEach(s,i){const r=this,n=r.__v_raw,o=Ee(n),a=t?re:e?Ae:Se;return!e&&B(o,0,L),n.forEach((e,t)=>s.call(i,a(e),a(t),r))}};(0,i.X$)(s,e?{add:oe('add'),set:oe('set'),delete:oe('delete'),clear:oe('clear')}:{add(e){t||Te(e)||be(e)||(e=Ee(e));const s=Ee(this);return ne(s).has.call(s,e)||(s.add(e),F(s,'add',e,e)),this},set(e,s){t||Te(s)||be(s)||(s=Ee(s));const r=Ee(this),{has:n,get:o}=ne(r);let a=n.call(r,e);a||(e=Ee(e),a=n.call(r,e));const l=o.call(r,e);return r.set(e,s),a?(0,i.$H)(s,l)&&F(r,'set',e,s):F(r,'add',e,s),this},delete(e){const t=Ee(this),{has:s,get:i}=ne(t);let r=s.call(t,e);r||(e=Ee(e),r=s.call(t,e));i&&i.call(t,e);const n=t.delete(e);return r&&F(t,'delete',e,void 0),n},clear(){const e=Ee(this),t=0!==e.size,s=e.clear();return t&&F(e,'clear',void 0,void 0),s}});return['keys','values','entries',Symbol.iterator].forEach(r=>{s[r]=function(e,t,s){return function(...r){const n=this.__v_raw,o=Ee(n),a=(0,i.CE)(o),l='entries'===e||e===Symbol.iterator&&a,h='keys'===e&&a,u=n[e](...r),c=s?re:t?Ae:Se;return!t&&B(o,0,h?k:L),{next(){const{value:e,done:t}=u.next();return t?{value:e,done:t}:{value:l?[c(e[0]),c(e[1])]:c(e),done:t}},[Symbol.iterator](){return this}}}}(r,e,t)}),s}function le(e,t){const s=ae(e,t);return(t,r,n)=>'__v_isReactive'===r?!e:'__v_isReadonly'===r?e:'__v_raw'===r?t:Reflect.get((0,i.$3)(s,r)&&r in t?s:t,r,n)}const he={get:le(!1,!1)},ue={get:le(!1,!0)},ce={get:le(!0,!1)};const de=new WeakMap,pe=new WeakMap,fe=new WeakMap,ge=new WeakMap;function me(e){return be(e)?e:ye(e,!1,te,he,de)}function _e(e){return ye(e,!1,ie,ue,pe)}function ve(e){return ye(e,!0,se,ce,fe)}function ye(e,t,s,r,n){if(!(0,i.Gv)(e))return e;if(e.__v_raw&&(!t||!e.__v_isReactive))return e;const o=(a=e).__v_skip||!Object.isExtensible(a)?0:function(e){switch(e){case'Object':case'Array':return 1;case'Map':case'Set':case'WeakMap':case'WeakSet':return 2;default:return 0}}((0,i.Zf)(a));var a;if(0===o)return e;const l=n.get(e);if(l)return l;const h=new Proxy(e,2===o?r:s);return n.set(e,h),h}function xe(e){return be(e)?xe(e.__v_raw):!(!e||!e.__v_isReactive)}function be(e){return!(!e||!e.__v_isReadonly)}function Te(e){return!(!e||!e.__v_isShallow)}function we(e){return!!e&&!!e.__v_raw}function Ee(e){const t=e&&e.__v_raw;return t?Ee(t):e}function Ce(e){return!(0,i.$3)(e,'__v_skip')&&Object.isExtensible(e)&&(0,i.yQ)(e,'__v_skip',!0),e}const Se=e=>(0,i.Gv)(e)?me(e):e,Ae=e=>(0,i.Gv)(e)?ve(e):e;function Me(e){return!!e&&!0===e.__v_isRef}function Pe(e){return Re(e,!1)}function Ie(e){return Re(e,!0)}function Re(e,t){return Me(e)?e:new Le(e,t)}class Le{constructor(e,t){this.dep=new P,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Ee(e),this._value=t?e:Se(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,s=this.__v_isShallow||Te(e)||be(e);e=s?e:Ee(e),(0,i.$H)(e,t)&&(this._rawValue=e,this._value=s?e:Se(e),this.dep.trigger())}}function ke(e){return Me(e)?e.value:e}const De={get:(e,t,s)=>'__v_raw'===t?e:ke(Reflect.get(e,t,s)),set:(e,t,s,i)=>{const r=e[t];return Me(r)&&!Me(s)?(r.value=s,!0):Reflect.set(e,t,s,i)}};function Be(e){return xe(e)?e:new Proxy(e,De)}class Fe{constructor(e,t,s){this.fn=e,this.setter=t,this._value=void 0,this.dep=new P(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=A-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=s}notify(){if(this.flags|=16,!(8&this.flags||n===this))return d(this,!0),!0}get value(){const e=this.dep.track();return y(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function Oe(e,t,s=!1){let r,n;(0,i.Tn)(e)?r=e:(r=e.get,n=e.set);return new Fe(r,n,s)}const Ne={},Ue=new WeakMap;let Ge;function Ve(e,t,s=i.MZ){const{immediate:n,deep:o,once:a,scheduler:h,augmentJob:u,call:c}=s,d=e=>o?e:Te(e)||!1===o||0===o?He(e,1):He(e);let p,f,g,m,v=!1,y=!1;if(Me(e)?(f=()=>e.value,v=Te(e)):xe(e)?(f=()=>d(e),v=!0):(0,i.cy)(e)?(y=!0,v=e.some(e=>xe(e)||Te(e)),f=()=>e.map(e=>Me(e)?e.value:xe(e)?d(e):(0,i.Tn)(e)?c?c(e,2):e():void 0)):f=(0,i.Tn)(e)?t?c?()=>c(e,2):e:()=>{if(g){E();try{g()}finally{C()}}const t=Ge;Ge=p;try{return c?c(e,3,[m]):e(m)}finally{Ge=t}}:i.tE,t&&o){const e=f,t=!0===o?1/0:o;f=()=>He(e(),t)}const x=r,b=()=>{p.stop(),x&&x.active&&(0,i.TF)(x.effects,p)};if(a&&t){const e=t;t=(...t)=>{e(...t),b()}}let T=y?new Array(e.length).fill(Ne):Ne;const w=e=>{if(1&p.flags&&(p.dirty||e))if(t){const e=p.run();if(o||v||(y?e.some((e,t)=>(0,i.$H)(e,T[t])):(0,i.$H)(e,T))){g&&g();const s=Ge;Ge=p;try{const s=[e,T===Ne?void 0:y&&T[0]===Ne?[]:T,m];T=e,c?c(t,3,s):t(...s)}finally{Ge=s}}}else p.run()};return u&&u(w),p=new l(f),p.scheduler=h?()=>h(w,!1):w,m=e=>function(e,t=!1,s=Ge){if(s){let t=Ue.get(s);t||Ue.set(s,t=[]),t.push(e)}}(e,!1,p),g=p.onStop=()=>{const e=Ue.get(p);if(e){if(c)c(e,4);else for(const t of e)t();Ue.delete(p)}},t?n?w(!0):T=p.run():h?h(w.bind(null,!0),!0):p.run(),b.pause=p.pause.bind(p),b.resume=p.resume.bind(p),b.stop=b,b}function He(e,t=1/0,s){if(t<=0||!(0,i.Gv)(e)||e.__v_skip)return e;if(((s=s||new Map).get(e)||0)>=t)return e;if(s.set(e,t),t--,Me(e))He(e.value,t,s);else if((0,i.cy)(e))for(let i=0;i<e.length;i++)He(e[i],t,s);else if((0,i.vM)(e)||(0,i.CE)(e))e.forEach(e=>{He(e,t,s)});else if((0,i.Qd)(e)){for(const i in e)He(e[i],t,s);for(const i of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,i)&&He(e[i],t,s)}return e}},958(e,t,s){s.d(t,{live2dModelManager:()=>Ss});var i=s(609),r=s(685),n=Object.defineProperty,o=Math.pow,a=(e,t,s)=>(((e,t,s)=>{t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,'symbol'!=typeof t?t+'':t,s),s),l=(e,t,s)=>new Promise((i,r)=>{var n=e=>{try{a(s.next(e))}catch(e){r(e)}},o=e=>{try{a(s.throw(e))}catch(e){r(e)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(n,o);a((s=s.apply(e,t)).next())});var h,u;(u=h||(h={})).supportMoreMaskDivisions=!0,u.setOpacityFromMotion=!1;const c=0,d=1,p=2,f=1,g=!0,m=!0,v=500,y=2e3,x=500,b=!0,T={log(e,...t){f<=c&&console.log(`[${e}]`,...t)},warn(e,...t){f<=d&&console.warn(`[${e}]`,...t)},error(e,...t){f<=p&&console.error(`[${e}]`,...t)}};function w(e,t,s){return e<t?t:e>s?s:e}function E(e,t,s,i,r){const n=t[i];null!==n&&typeof n===e&&(s[r]=n)}function C(e,t,s,i,r){const n=t[i];Array.isArray(n)&&(s[r]=n.filter(t=>null!==t&&typeof t===e))}class S extends i.Wp.EventEmitter{constructor(e,t){super(),a(this,'tag'),a(this,'settings'),a(this,'expressions',[]),a(this,'defaultExpression'),a(this,'currentExpression'),a(this,'reserveExpressionIndex',-1),a(this,'destroyed',!1),this.settings=e,this.tag=`ExpressionManager(${e.name})`}init(){this.defaultExpression=this.createExpression({},void 0),this.currentExpression=this.defaultExpression,this.stopAllExpressions()}loadExpression(e){return l(this,null,function*(){if(!this.definitions[e])return void T.warn(this.tag,`Undefined expression at [${e}]`);if(null===this.expressions[e])return void T.warn(this.tag,`Cannot set expression at [${e}] because it's already failed in loading.`);if(this.expressions[e])return this.expressions[e];const t=yield this._loadExpression(e);return this.expressions[e]=t,t})}_loadExpression(e){throw new Error('Not implemented.')}setRandomExpression(){return l(this,null,function*(){if(this.definitions.length){const e=[];for(let t=0;t<this.definitions.length;t++)null!==this.expressions[t]&&this.expressions[t]!==this.currentExpression&&t!==this.reserveExpressionIndex&&e.push(t);if(e.length){const t=Math.floor(Math.random()*e.length);return this.setExpression(t)}}return!1})}resetExpression(){this._setExpression(this.defaultExpression)}restoreExpression(){this._setExpression(this.currentExpression)}setExpression(e){return l(this,null,function*(){if('number'!=typeof e&&(e=this.getExpressionIndex(e)),!(e>-1&&e<this.definitions.length))return!1;if(e===this.expressions.indexOf(this.currentExpression))return!1;this.reserveExpressionIndex=e;const t=yield this.loadExpression(e);return!(!t||this.reserveExpressionIndex!==e)&&(this.reserveExpressionIndex=-1,this.currentExpression=t,this._setExpression(t),!0)})}update(e,t){return!this.isFinished()&&this.updateParameters(e,t)}destroy(){this.destroyed=!0,this.emit('destroy');this.definitions=void 0,this.expressions=void 0}}const A=40/7.5,M=1/150;class P{constructor(){a(this,'targetX',0),a(this,'targetY',0),a(this,'x',0),a(this,'y',0),a(this,'vx',0),a(this,'vy',0)}focus(e,t,s=!1){this.targetX=w(e,-1,1),this.targetY=w(t,-1,1),s&&(this.x=this.targetX,this.y=this.targetY)}update(e){const t=this.targetX-this.x,s=this.targetY-this.y;if(Math.abs(t)<.01&&Math.abs(s)<.01)return;const i=Math.sqrt(o(t,2)+o(s,2)),r=A/(1e3/e);let n=r*(t/i)-this.vx,a=r*(s/i)-this.vy;const l=Math.sqrt(o(n,2)+o(a,2)),h=r*M*e;l>h&&(n*=h/l,a*=h/l),this.vx+=n,this.vy+=a;const u=Math.sqrt(o(this.vx,2)+o(this.vy,2)),c=.5*(Math.sqrt(o(h,2)+8*h*i)-h);u>c&&(this.vx*=c/u,this.vy*=c/u),this.x+=this.vx,this.y+=this.vy}}class I{constructor(e){a(this,'json'),a(this,'name'),a(this,'url'),a(this,'pose'),a(this,'physics'),this.json=e;const t=e.url;if('string'!=typeof t)throw new TypeError('The `url` field in settings JSON must be defined as a string.');this.url=t,this.name=function(e){let t=e.lastIndexOf('/');return-1!=t&&(e=e.slice(0,t)),t=e.lastIndexOf('/'),-1!==t&&(e=e.slice(t+1)),e}(this.url)}resolveURL(e){return i.Wp.url.resolve(this.url,e)}replaceFiles(e){this.moc=e(this.moc,'moc'),void 0!==this.pose&&(this.pose=e(this.pose,'pose')),void 0!==this.physics&&(this.physics=e(this.physics,'physics'));for(let t=0;t<this.textures.length;t++)this.textures[t]=e(this.textures[t],`textures[${t}]`)}getDefinedFiles(){const e=[];return this.replaceFiles(t=>(e.push(t),t)),e}validateFiles(e){const t=(t,s)=>{const i=this.resolveURL(t);if(!e.includes(i)){if(s)throw new Error(`File "${t}" is defined in settings, but doesn't exist in given files`);return!1}return!0};[this.moc,...this.textures].forEach(e=>t(e,!0));return this.getDefinedFiles().filter(e=>t(e,!1))}}var R=(e=>(e[e.NONE=0]='NONE',e[e.IDLE=1]='IDLE',e[e.NORMAL=2]='NORMAL',e[e.FORCE=3]='FORCE',e))(R||{});class L{constructor(){a(this,'tag'),a(this,'debug',!1),a(this,'currentPriority',0),a(this,'reservePriority',0),a(this,'currentGroup'),a(this,'currentIndex'),a(this,'reservedGroup'),a(this,'reservedIndex'),a(this,'reservedIdleGroup'),a(this,'reservedIdleIndex')}reserve(e,t,s){if(s<=0)return T.log(this.tag,'Cannot start a motion with MotionPriority.NONE.'),!1;if(e===this.currentGroup&&t===this.currentIndex)return T.log(this.tag,'Motion is already playing.',this.dump(e,t)),!1;if(e===this.reservedGroup&&t===this.reservedIndex||e===this.reservedIdleGroup&&t===this.reservedIdleIndex)return T.log(this.tag,'Motion is already reserved.',this.dump(e,t)),!1;if(1===s){if(0!==this.currentPriority)return T.log(this.tag,'Cannot start idle motion because another motion is playing.',this.dump(e,t)),!1;if(void 0!==this.reservedIdleGroup)return T.log(this.tag,'Cannot start idle motion because another idle motion has reserved.',this.dump(e,t)),!1;this.setReservedIdle(e,t)}else{if(s<3){if(s<=this.currentPriority)return T.log(this.tag,'Cannot start motion because another motion is playing as an equivalent or higher priority.',this.dump(e,t)),!1;if(s<=this.reservePriority)return T.log(this.tag,'Cannot start motion because another motion has reserved as an equivalent or higher priority.',this.dump(e,t)),!1}this.setReserved(e,t,s)}return!0}start(e,t,s,i){if(1===i){if(this.setReservedIdle(void 0,void 0),0!==this.currentPriority)return T.log(this.tag,'Cannot start idle motion because another motion is playing.',this.dump(t,s)),!1}else{if(t!==this.reservedGroup||s!==this.reservedIndex)return T.log(this.tag,'Cannot start motion because another motion has taken the place.',this.dump(t,s)),!1;this.setReserved(void 0,void 0,0)}return!!e&&(this.setCurrent(t,s,i),!0)}complete(){this.setCurrent(void 0,void 0,0)}setCurrent(e,t,s){this.currentPriority=s,this.currentGroup=e,this.currentIndex=t}setReserved(e,t,s){this.reservePriority=s,this.reservedGroup=e,this.reservedIndex=t}setReservedIdle(e,t){this.reservedIdleGroup=e,this.reservedIdleIndex=t}isActive(e,t){return e===this.currentGroup&&t===this.currentIndex||e===this.reservedGroup&&t===this.reservedIndex||e===this.reservedIdleGroup&&t===this.reservedIdleIndex}reset(){this.setCurrent(void 0,void 0,0),this.setReserved(void 0,void 0,0),this.setReservedIdle(void 0,void 0)}shouldRequestIdleMotion(){return void 0===this.currentGroup&&void 0===this.reservedIdleGroup}shouldOverrideExpression(){return!b&&this.currentPriority>1}dump(e,t){if(this.debug){return`\n<Requested> group = "${e}", index = ${t}\n`+['currentPriority','reservePriority','currentGroup','currentIndex','reservedGroup','reservedIndex','reservedIdleGroup','reservedIdleIndex'].map(e=>'['+e+'] '+this[e]).join('\n')}return''}}class k{static get volume(){return this._volume}static set volume(e){this._volume=(e>1?1:e<0?0:e)||0,this.audios.forEach(e=>e.volume=this._volume)}static add(e,t,s){const i=new Audio(e);return i.volume=this._volume,i.preload='auto',i.addEventListener('ended',()=>{this.dispose(i),null==t||t()}),i.addEventListener('error',t=>{this.dispose(i),T.warn('SoundManager',`Error occurred on "${e}"`,t.error),null==s||s(t.error)}),this.audios.push(i),i}static play(e){return new Promise((t,s)=>{var i;null==(i=e.play())||i.catch(t=>{e.dispatchEvent(new ErrorEvent('error',{error:t})),s(t)}),e.readyState===e.HAVE_ENOUGH_DATA?t():e.addEventListener('canplaythrough',t)})}static dispose(e){e.pause(),e.removeAttribute('src'),function(e,t){const s=e.indexOf(t);-1!==s&&e.splice(s,1)}(this.audios,e)}static destroy(){for(let e=this.audios.length-1;e>=0;e--)this.dispose(this.audios[e])}}a(k,'audios',[]),a(k,'_volume',.5);class D extends i.Wp.EventEmitter{constructor(e,t){super(),a(this,'tag'),a(this,'settings'),a(this,'motionGroups',{}),a(this,'state',new L),a(this,'currentAudio'),a(this,'playing',!1),a(this,'destroyed',!1),this.settings=e,this.tag=`MotionManager(${e.name})`,this.state.tag=this.tag}init(e){(null==e?void 0:e.idleMotionGroup)&&(this.groups.idle=e.idleMotionGroup),this.setupMotions(e),this.stopAllMotions()}setupMotions(e){for(const e of Object.keys(this.definitions))this.motionGroups[e]=[];let t;switch(null==e?void 0:e.motionPreload){case'NONE':return;case'ALL':t=Object.keys(this.definitions);break;default:t=[this.groups.idle]}for(const e of t)if(this.definitions[e])for(let t=0;t<this.definitions[e].length;t++)this.loadMotion(e,t).then()}loadMotion(e,t){return l(this,null,function*(){var s;if(!(null==(s=this.definitions[e])?void 0:s[t]))return void T.warn(this.tag,`Undefined motion at "${e}"[${t}]`);if(null===this.motionGroups[e][t])return void T.warn(this.tag,`Cannot start motion at "${e}"[${t}] because it's already failed in loading.`);if(this.motionGroups[e][t])return this.motionGroups[e][t];const i=yield this._loadMotion(e,t);return this.destroyed?void 0:(this.motionGroups[e][t]=null!=i?i:null,i)})}_loadMotion(e,t){throw new Error('Not implemented.')}startMotion(e,t){return l(this,arguments,function*(e,t,s=R.NORMAL){var i;if(!this.state.reserve(e,t,s))return!1;const r=null==(i=this.definitions[e])?void 0:i[t];if(!r)return!1;let n;if(this.currentAudio&&k.dispose(this.currentAudio),g){const e=this.getSoundFile(r);if(e)try{n=k.add(this.settings.resolveURL(e),()=>this.currentAudio=void 0,()=>this.currentAudio=void 0),this.currentAudio=n}catch(t){T.warn(this.tag,'Failed to create audio',e,t)}}const o=yield this.loadMotion(e,t);if(n){const e=k.play(n).catch(e=>T.warn(this.tag,'Failed to play audio',n.src,e));m&&(yield e)}return this.state.start(o,e,t,s)?(T.log(this.tag,'Start motion:',this.getMotionName(r)),this.emit('motionStart',e,t,n),this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),this.playing=!0,this._startMotion(o),!0):(n&&(k.dispose(n),this.currentAudio=void 0),!1)})}startRandomMotion(e,t){return l(this,null,function*(){const s=this.definitions[e];if(null==s?void 0:s.length){const i=[];for(let t=0;t<s.length;t++)null===this.motionGroups[e][t]||this.state.isActive(e,t)||i.push(t);if(i.length){const s=Math.floor(Math.random()*i.length);return this.startMotion(e,i[s],t)}}return!1})}stopAllMotions(){this._stopAllMotions(),this.state.reset(),this.currentAudio&&(k.dispose(this.currentAudio),this.currentAudio=void 0)}update(e,t){var s;return this.isFinished()&&(this.playing&&(this.playing=!1,this.emit('motionFinish')),this.state.shouldOverrideExpression()&&(null==(s=this.expressionManager)||s.restoreExpression()),this.state.complete(),this.state.shouldRequestIdleMotion()&&this.startRandomMotion(this.groups.idle,R.IDLE)),this.updateParameters(e,t)}destroy(){var e;this.destroyed=!0,this.emit('destroy'),this.stopAllMotions(),null==(e=this.expressionManager)||e.destroy();this.definitions=void 0,this.motionGroups=void 0}}const B={x:0,y:0,width:0,height:0};class F extends i.Wp.EventEmitter{constructor(){super(...arguments),a(this,'focusController',new P),a(this,'pose'),a(this,'physics'),a(this,'originalWidth',0),a(this,'originalHeight',0),a(this,'width',0),a(this,'height',0),a(this,'localTransform',new i.uq),a(this,'drawingMatrix',new i.uq),a(this,'hitAreas',{}),a(this,'textureFlipY',!1),a(this,'viewport',[0,0,0,0]),a(this,'destroyed',!1)}init(){this.setupLayout(),this.setupHitAreas()}setupLayout(){const e=this,t=this.getSize();e.originalWidth=t[0],e.originalHeight=t[1];const s=Object.assign({width:2,height:2},this.getLayout());this.localTransform.scale(s.width/2,s.height/2),e.width=this.originalWidth*this.localTransform.a,e.height=this.originalHeight*this.localTransform.d;const i=void 0!==s.x&&s.x-s.width/2||void 0!==s.centerX&&s.centerX||void 0!==s.left&&s.left-s.width/2||void 0!==s.right&&s.right+s.width/2||0,r=void 0!==s.y&&s.y-s.height/2||void 0!==s.centerY&&s.centerY||void 0!==s.top&&s.top-s.height/2||void 0!==s.bottom&&s.bottom+s.height/2||0;this.localTransform.translate(this.width*i,-this.height*r)}setupHitAreas(){const e=this.getHitAreaDefs().filter(e=>e.index>=0);for(const t of e)this.hitAreas[t.name]=t}hitTest(e,t){return Object.keys(this.hitAreas).filter(s=>this.isHit(s,e,t))}isHit(e,t,s){if(!this.hitAreas[e])return!1;const i=this.hitAreas[e].index,r=this.getDrawableBounds(i,B);return r.x<=t&&t<=r.x+r.width&&r.y<=s&&s<=r.y+r.height}getDrawableBounds(e,t){const s=this.getDrawableVertices(e);let i=s[0],r=s[0],n=s[1],o=s[1];for(let e=0;e<s.length;e+=2){const t=s[e],a=s[e+1];i=Math.min(t,i),r=Math.max(t,r),n=Math.min(a,n),o=Math.max(a,o)}return null!=t||(t={}),t.x=i,t.y=n,t.width=r-i,t.height=o-n,t}updateTransform(e){this.drawingMatrix.copyFrom(e).append(this.localTransform)}update(e,t){this.focusController.update(e)}destroy(){this.destroyed=!0,this.emit('destroy'),this.motionManager.destroy(),this.motionManager=void 0}}class O extends Error{constructor(e,t,s,i=!1){super(e),this.url=t,this.status=s,this.aborted=i}}const N=class e{static createXHR(t,s,i,r,n){const o=new XMLHttpRequest;if(e.allXhrSet.add(o),t){let s=e.xhrMap.get(t);s?s.add(o):(s=new Set([o]),e.xhrMap.set(t,s)),t.listeners('destroy').includes(e.cancelXHRs)||t.once('destroy',e.cancelXHRs)}return o.open('GET',s),o.responseType=i,o.onload=()=>{200!==o.status&&0!==o.status||!o.response?o.onerror():r(o.response)},o.onerror=()=>{T.warn('XHRLoader',`Failed to load resource as ${o.responseType} (Status ${o.status}): ${s}`),n(new O('Network error.',s,o.status))},o.onabort=()=>n(new O('Aborted.',s,o.status,!0)),o.onloadend=()=>{var s;e.allXhrSet.delete(o),t&&(null==(s=e.xhrMap.get(t))||s.delete(o))},o}static cancelXHRs(){var t;null==(t=e.xhrMap.get(this))||t.forEach(t=>{t.abort(),e.allXhrSet.delete(t)}),e.xhrMap.delete(this)}static release(){e.allXhrSet.forEach(e=>e.abort()),e.allXhrSet.clear(),e.xhrMap=new WeakMap}};a(N,'xhrMap',new WeakMap),a(N,'allXhrSet',new Set),a(N,'loader',(e,t)=>new Promise((t,s)=>{N.createXHR(e.target,e.settings?e.settings.resolveURL(e.url):e.url,e.type,s=>{e.result=s,t()},s).send()}));let U=N;function G(e,t){let s=-1;return function i(r,n){if(n)return Promise.reject(n);if(r<=s)return Promise.reject(new Error('next() called multiple times'));s=r;const o=e[r];if(!o)return Promise.resolve();try{return Promise.resolve(o(t,i.bind(null,r+1)))}catch(e){return Promise.reject(e)}}(0)}class V{static load(e){return G(this.middlewares,e).then(()=>e.result)}}function H(){}a(V,'middlewares',[U.loader]);const W='Live2DFactory',X=(e,t)=>l(void 0,null,function*(){if('string'==typeof e.source){const t=yield V.load({url:e.source,type:'json',target:e.live2dModel});t.url=e.source,e.source=t,e.live2dModel.emit('settingsJSONLoaded',t)}return t()}),j=(e,t)=>l(void 0,null,function*(){if(e.source instanceof I)return e.settings=e.source,t();if('object'==typeof e.source){const s=ie.findRuntime(e.source);if(s){const i=s.createModelSettings(e.source);return e.settings=i,e.live2dModel.emit('settingsLoaded',i),t()}}throw new TypeError('Unknown settings format.')}),Y=(e,t)=>{if(e.settings){const s=ie.findRuntime(e.settings);if(s)return s.ready().then(t)}return t()},q=(e,t)=>l(void 0,null,function*(){yield t();const s=e.internalModel;if(s){const t=e.settings,i=ie.findRuntime(t);if(i){const r=[];t.pose&&r.push(V.load({settings:t,url:t.pose,type:'json',target:s}).then(t=>{s.pose=i.createPose(s.coreModel,t),e.live2dModel.emit('poseLoaded',s.pose)}).catch(t=>{e.live2dModel.emit('poseLoadError',t),T.warn(W,'Failed to load pose.',t)})),t.physics&&r.push(V.load({settings:t,url:t.physics,type:'json',target:s}).then(t=>{s.physics=i.createPhysics(s.coreModel,t),e.live2dModel.emit('physicsLoaded',s.physics)}).catch(t=>{e.live2dModel.emit('physicsLoadError',t),T.warn(W,'Failed to load physics.',t)})),r.length&&(yield Promise.all(r))}}}),Q=(e,t)=>l(void 0,null,function*(){if(!e.settings)throw new TypeError('Missing settings.');{const s=e.live2dModel,r=Promise.all(e.settings.textures.map(t=>function(e,t={}){const s={resourceOptions:{crossorigin:t.crossOrigin}};if(i.gP.fromURL)return i.gP.fromURL(e,s).catch(e=>{if(e instanceof Error)throw e;const t=new Error('Texture loading error');throw t.event=e,t});s.resourceOptions.autoLoad=!1;const r=i.gP.from(e,s);if(r.baseTexture.valid)return Promise.resolve(r);const n=r.baseTexture.resource;return null!=n._live2d_load||(n._live2d_load=new Promise((e,t)=>{const s=e=>{n.source.removeEventListener('error',s);const i=new Error('Texture loading error');i.event=e,t(i)};n.source.addEventListener('error',s),n.load().then(()=>e(r)).catch(s)})),n._live2d_load}(e.settings.resolveURL(t),{crossOrigin:e.options.crossOrigin})));if(r.catch(H),yield t(),!e.internalModel)throw new TypeError('Missing internal model.');s.internalModel=e.internalModel,s.emit('modelLoaded',e.internalModel),s.textures=yield r,s.emit('textureLoaded',s.textures)}}),K=(e,t)=>l(void 0,null,function*(){const s=e.settings;if(s instanceof I){const i=ie.findRuntime(s);if(!i)throw new TypeError('Unknown model settings.');const r=yield V.load({settings:s,url:s.moc,type:'arraybuffer',target:e.live2dModel});if(!i.isValidMoc(r))throw new Error('Invalid moc data');const n=i.createCoreModel(r);return e.internalModel=i.createInternalModel(n,s,e.options),t()}throw new TypeError('Missing settings.')}),Z=class e{static unzip(t,s){return l(this,null,function*(){const r=yield e.getFilePaths(t),n=[];for(const e of s.getDefinedFiles()){const t=decodeURI(i.Wp.url.resolve(s.url,e));r.includes(t)&&n.push(t)}const o=yield e.getFiles(t,n);for(let e=0;e<o.length;e++){const t=n[e],s=o[e];Object.defineProperty(s,'webkitRelativePath',{value:t})}return o})}static createSettings(t){return l(this,null,function*(){const s=(yield e.getFilePaths(t)).find(e=>e.endsWith('model.json')||e.endsWith('model3.json'));if(!s)throw new Error('Settings file not found');const i=yield e.readText(t,s);if(!i)throw new Error('Empty settings file: '+s);const r=JSON.parse(i);r.url=s;const n=e.live2dFactory.findRuntime(r);if(!n)throw new Error('Unknown settings JSON');return n.createModelSettings(r)})}static zipReader(e,t){return l(this,null,function*(){throw new Error('Not implemented')})}static getFilePaths(e){return l(this,null,function*(){throw new Error('Not implemented')})}static getFiles(e,t){return l(this,null,function*(){throw new Error('Not implemented')})}static readText(e,t){return l(this,null,function*(){throw new Error('Not implemented')})}static releaseReader(e){}};a(Z,'live2dFactory'),a(Z,'ZIP_PROTOCOL','zip://'),a(Z,'uid',0),a(Z,'factory',(e,t)=>l(Z,null,function*(){const s=e.source;let i,r,n;if('string'==typeof s&&(s.endsWith('.zip')||s.startsWith(Z.ZIP_PROTOCOL))?(i=s.startsWith(Z.ZIP_PROTOCOL)?s.slice(Z.ZIP_PROTOCOL.length):s,r=yield V.load({url:i,type:'blob',target:e.live2dModel})):Array.isArray(s)&&1===s.length&&s[0]instanceof File&&s[0].name.endsWith('.zip')&&(r=s[0],i=URL.createObjectURL(r),n=s.settings),r){if(!r.size)throw new Error('Empty zip file');const t=yield Z.zipReader(r,i);n||(n=yield Z.createSettings(t)),n._objectURL=Z.ZIP_PROTOCOL+Z.uid+'/'+n.url;const s=yield Z.unzip(t,n);s.settings=n,e.source=s,i.startsWith('blob:')&&e.live2dModel.once('modelLoaded',e=>{e.once('destroy',function(){URL.revokeObjectURL(i)})}),Z.releaseReader(t)}return t()}));let J=Z;const ee=class e{static resolveURL(t,s){var i;const r=null==(i=e.filesMap[t])?void 0:i[s];if(void 0===r)throw new Error('Cannot find this file from uploaded files: '+s);return r}static upload(t,s){return l(this,null,function*(){const r={};for(const e of s.getDefinedFiles()){const n=decodeURI(i.Wp.url.resolve(s.url,e)),o=t.find(e=>e.webkitRelativePath===n);o&&(r[e]=URL.createObjectURL(o))}e.filesMap[s._objectURL]=r})}static createSettings(t){return l(this,null,function*(){const s=t.find(e=>e.name.endsWith('model.json')||e.name.endsWith('model3.json'));if(!s)throw new TypeError('Settings file not found');const i=yield e.readText(s),r=JSON.parse(i);r.url=s.webkitRelativePath;const n=ie.findRuntime(r);if(!n)throw new Error('Unknown settings JSON');const o=n.createModelSettings(r);return o._objectURL=URL.createObjectURL(s),o})}static readText(e){return l(this,null,function*(){return new Promise((t,s)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=s,i.readAsText(e,'utf8')})})}};a(ee,'live2dFactory'),a(ee,'filesMap',{}),a(ee,'factory',(e,t)=>l(ee,null,function*(){if(Array.isArray(e.source)&&e.source[0]instanceof File){const t=e.source;let s=t.settings;if(s){if(!s._objectURL)throw new Error('"_objectURL" must be specified in ModelSettings')}else s=yield ee.createSettings(t);s.validateFiles(t.map(e=>encodeURI(e.webkitRelativePath))),yield ee.upload(t,s),s.resolveURL=function(e){return ee.resolveURL(this._objectURL,e)},e.source=s,e.live2dModel.once('modelLoaded',e=>{e.once('destroy',function(){const e=this.settings._objectURL;if(URL.revokeObjectURL(e),ee.filesMap[e])for(const t of Object.values(ee.filesMap[e]))URL.revokeObjectURL(t);delete ee.filesMap[e]})})}return t()}));let te=ee;const se=class e{static registerRuntime(t){e.runtimes.push(t),e.runtimes.sort((e,t)=>t.version-e.version)}static findRuntime(t){for(const s of e.runtimes)if(s.test(t))return s}static setupLive2DModel(t,s,i){return l(this,null,function*(){const r=new Promise(e=>t.once('textureLoaded',e)),n=new Promise(e=>t.once('modelLoaded',e)),o=Promise.all([r,n]).then(()=>t.emit('ready'));yield G(e.live2DModelMiddlewares,{live2dModel:t,source:s,options:i||{}}),yield o,t.emit('load')})}static loadMotion(t,s,i){var r;const n=e=>t.emit('motionLoadError',s,i,e);try{const o=null==(r=t.definitions[s])?void 0:r[i];if(!o)return Promise.resolve(void 0);t.listeners('destroy').includes(e.releaseTasks)||t.once('destroy',e.releaseTasks);let a=e.motionTasksMap.get(t);a||(a={},e.motionTasksMap.set(t,a));let l=a[s];l||(l=[],a[s]=l);const h=t.getMotionFile(o);return null!=l[i]||(l[i]=V.load({url:h,settings:t.settings,type:t.motionDataType,target:t}).then(r=>{var n;const a=null==(n=e.motionTasksMap.get(t))?void 0:n[s];a&&delete a[i];const l=t.createMotion(r,s,o);return t.emit('motionLoaded',s,i,l),l}).catch(e=>{T.warn(t.tag,`Failed to load motion: ${h}\n`,e),n(e)})),l[i]}catch(e){T.warn(t.tag,`Failed to load motion at "${s}"[${i}]\n`,e),n(e)}return Promise.resolve(void 0)}static loadExpression(t,s){const i=e=>t.emit('expressionLoadError',s,e);try{const r=t.definitions[s];if(!r)return Promise.resolve(void 0);t.listeners('destroy').includes(e.releaseTasks)||t.once('destroy',e.releaseTasks);let n=e.expressionTasksMap.get(t);n||(n=[],e.expressionTasksMap.set(t,n));const o=t.getExpressionFile(r);return null!=n[s]||(n[s]=V.load({url:o,settings:t.settings,type:'json',target:t}).then(i=>{const n=e.expressionTasksMap.get(t);n&&delete n[s];const o=t.createExpression(i,r);return t.emit('expressionLoaded',s,o),o}).catch(e=>{T.warn(t.tag,`Failed to load expression: ${o}\n`,e),i(e)})),n[s]}catch(e){T.warn(t.tag,`Failed to load expression at [${s}]\n`,e),i(e)}return Promise.resolve(void 0)}static releaseTasks(){this instanceof D?e.motionTasksMap.delete(this):e.expressionTasksMap.delete(this)}};a(se,'runtimes',[]),a(se,'urlToJSON',X),a(se,'jsonToSettings',j),a(se,'waitUntilReady',Y),a(se,'setupOptionals',q),a(se,'setupEssentials',Q),a(se,'createInternalModel',K),a(se,'live2DModelMiddlewares',[J.factory,te.factory,X,j,Y,q,Q,K]),a(se,'motionTasksMap',new WeakMap),a(se,'expressionTasksMap',new WeakMap);let ie=se;D.prototype._loadMotion=function(e,t){return ie.loadMotion(this,e,t)},S.prototype._loadExpression=function(e){return ie.loadExpression(this,e)},te.live2dFactory=ie,J.live2dFactory=ie;const re=class e{constructor(t,{autoUpdate:s=!0,autoHitTest:i=!0,autoFocus:r=!0,autoInteract:n,ticker:o}={}){a(this,'model'),a(this,'destroyed',!1),a(this,'_ticker'),a(this,'_autoUpdate',!1),a(this,'_autoHitTest',!1),a(this,'_autoFocus',!1),o||(e.defaultTicker?o=e.defaultTicker:'undefined'!=typeof PIXI&&(o=PIXI.Ticker.shared)),void 0!==n&&(i=n,r=n,T.warn(t.tag,'options.autoInteract is deprecated since v0.5.0, use autoHitTest and autoFocus instead.')),this.model=t,this.ticker=o,this.autoUpdate=s,this.autoHitTest=i,this.autoFocus=r,(i||r)&&(this.model.eventMode='static')}get ticker(){return this._ticker}set ticker(e){var t;this._ticker&&this._ticker.remove(oe,this),this._ticker=e,this._autoUpdate&&(null==(t=this._ticker)||t.add(oe,this))}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){var t;this.destroyed||(e?this._ticker?(this._ticker.add(oe,this),this._autoUpdate=!0):T.warn(this.model.tag,'No Ticker to be used for automatic updates. Either set option.ticker when creating Live2DModel, or expose PIXI to global scope (window.PIXI = PIXI).'):(null==(t=this._ticker)||t.remove(oe,this),this._autoUpdate=!1))}get autoHitTest(){return this._autoHitTest}set autoHitTest(e){e!==this.autoHitTest&&(e?this.model.on('pointertap',ae,this):this.model.off('pointertap',ae,this),this._autoHitTest=e)}get autoFocus(){return this._autoFocus}set autoFocus(e){e!==this.autoFocus&&(e?this.model.on('globalpointermove',le,this):this.model.off('globalpointermove',le,this),this._autoFocus=e)}get autoInteract(){return this._autoHitTest&&this._autoFocus}set autoInteract(e){this.autoHitTest=e,this.autoFocus=e}onTickerUpdate(){const e=this.ticker.deltaMS;this.model.update(e)}onTap(e){this.model.tap(e.global.x,e.global.y)}onPointerMove(e){this.model.focus(e.global.x,e.global.y)}destroy(){this.autoFocus=!1,this.autoHitTest=!1,this.autoUpdate=!1,this.ticker=void 0,this.destroyed=!0}};a(re,'defaultTicker');let ne=re;function oe(){this.onTickerUpdate()}function ae(e){this.onTap(e)}function le(e){this.onPointerMove(e)}class he extends i.dL{}const ue=new i.bR,ce=new i.uq;class de extends r.mc{constructor(e){super(),a(this,'tag','Live2DModel(uninitialized)'),a(this,'internalModel'),a(this,'textures',[]),a(this,'transform',new he),a(this,'anchor',new i.oA(this.onAnchorChange,this,0,0)),a(this,'glContextID',-1),a(this,'elapsedTime',0),a(this,'deltaTime',0),a(this,'automator'),this.automator=new ne(this,e),this.once('modelLoaded',()=>this.init(e))}static from(e,t){const s=new this(t);return ie.setupLive2DModel(s,e,t).then(()=>s)}static fromSync(e,t){const s=new this(t);return ie.setupLive2DModel(s,e,t).then(null==t?void 0:t.onLoad).catch(null==t?void 0:t.onError),s}static registerTicker(e){ne.defaultTicker=e.shared}init(e){this.tag=`Live2DModel(${this.internalModel.settings.name})`}onAnchorChange(){this.pivot.set(this.anchor.x*this.internalModel.width,this.anchor.y*this.internalModel.height)}motion(e,t,s){return void 0===t?this.internalModel.motionManager.startRandomMotion(e,s):this.internalModel.motionManager.startMotion(e,t,s)}expression(e){return this.internalModel.motionManager.expressionManager?void 0===e?this.internalModel.motionManager.expressionManager.setRandomExpression():this.internalModel.motionManager.expressionManager.setExpression(e):Promise.resolve(!1)}focus(e,t,s=!1){ue.x=e,ue.y=t,this.toModelPosition(ue,ue,!0);const i=ue.x/this.internalModel.originalWidth*2-1,r=ue.y/this.internalModel.originalHeight*2-1,n=Math.atan2(r,i);this.internalModel.focusController.focus(Math.cos(n),-Math.sin(n),s)}tap(e,t){const s=this.hitTest(e,t);s.length&&(T.log(this.tag,'Hit',s),this.emit('hit',s))}hitTest(e,t){return ue.x=e,ue.y=t,this.toModelPosition(ue,ue),this.internalModel.hitTest(ue.x,ue.y)}toModelPosition(e,t=e.clone(),s){return s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.transform.worldTransform.applyInverse(e,t),this.internalModel.localTransform.applyInverse(t,t),t}containsPoint(e){return this.getBounds(!0).contains(e.x,e.y)}_calculateBounds(){this._bounds.addFrame(this.transform,0,0,this.internalModel.width,this.internalModel.height)}update(e){this.deltaTime+=e,this.elapsedTime+=e}_render(e){e.batch.reset(),e.geometry.reset(),e.shader.reset(),e.state.reset();let t=!1;this.glContextID!==e.CONTEXT_UID&&(this.glContextID=e.CONTEXT_UID,this.internalModel.updateWebGLContext(e.gl,this.glContextID),t=!0);for(let s=0;s<this.textures.length;s++){const i=this.textures[s];i.valid&&(!t&&i.baseTexture._glTextures[this.glContextID]||(e.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,this.internalModel.textureFlipY),e.texture.bind(i.baseTexture,0)),this.internalModel.bindTexture(s,i.baseTexture._glTextures[this.glContextID].texture),i.baseTexture.touched=e.textureGC.count)}const s=e.framebuffer.viewport;this.internalModel.viewport=[s.x,s.y,s.width,s.height],this.deltaTime&&(this.internalModel.update(this.deltaTime,this.elapsedTime),this.deltaTime=0);const i=ce.copyFrom(e.globalUniforms.uniforms.projectionMatrix).append(this.worldTransform);this.internalModel.updateTransform(i),this.internalModel.draw(e.gl),e.state.reset(),e.texture.reset()}destroy(e){this.emit('destroy'),(null==e?void 0:e.texture)&&this.textures.forEach(t=>t.destroy(e.baseTexture)),this.automator.destroy(),this.internalModel.destroy(),super.destroy(e)}}if(!window.Live2D)throw new Error('Could not find Cubism 2 runtime. This plugin requires live2d.min.js to be loaded.');const pe=Live2DMotion.prototype.updateParam;Live2DMotion.prototype.updateParam=function(e,t){pe.call(this,e,t),t.isFinished()&&this.onFinishHandler&&(this.onFinishHandler(this),delete this.onFinishHandler)};class fe extends AMotion{constructor(e){super(),a(this,'params',[]),this.setFadeIn(e.fade_in>0?e.fade_in:x),this.setFadeOut(e.fade_out>0?e.fade_out:x),Array.isArray(e.params)&&e.params.forEach(e=>{const t=e.calc||'add';if('add'===t){const t=e.def||0;e.val-=t}else if('mult'===t){const t=e.def||1;e.val/=t}this.params.push({calc:t,val:e.val,id:e.id})})}updateParamExe(e,t,s,i){this.params.forEach(t=>{e.setParamFloat(t.id,t.val*s)})}}class ge extends S{constructor(e,t){var s;super(e,t),a(this,'queueManager',new MotionQueueManager),a(this,'definitions'),this.definitions=null!=(s=this.settings.expressions)?s:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(e){return this.definitions.findIndex(t=>t.name===e)}getExpressionFile(e){return e.file}createExpression(e,t){return new fe(e)}_setExpression(e){return this.queueManager.startMotion(e)}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(e,t){return this.queueManager.updateParam(e)}}class me extends D{constructor(e,t){super(e,t),a(this,'definitions'),a(this,'groups',{idle:'idle'}),a(this,'motionDataType','arraybuffer'),a(this,'queueManager',new MotionQueueManager),a(this,'expressionManager'),this.definitions=this.settings.motions,this.init(t)}init(e){super.init(e),this.settings.expressions&&(this.expressionManager=new ge(this.settings,e))}isFinished(){return this.queueManager.isFinished()}createMotion(e,t,s){const i=Live2DMotion.loadMotion(e),r=t===this.groups.idle?y:v;return i.setFadeIn(s.fade_in>0?s.fade_in:r),i.setFadeOut(s.fade_out>0?s.fade_out:r),i}getMotionFile(e){return e.file}getMotionName(e){return e.file}getSoundFile(e){return e.sound}_startMotion(e,t){return e.onFinishHandler=t,this.queueManager.stopAllMotions(),this.queueManager.startMotion(e)}_stopAllMotions(){this.queueManager.stopAllMotions()}updateParameters(e,t){return this.queueManager.updateParam(e)}destroy(){super.destroy(),this.queueManager=void 0}}class _e{constructor(e){a(this,'leftParam'),a(this,'rightParam'),a(this,'blinkInterval',4e3),a(this,'closingDuration',100),a(this,'closedDuration',50),a(this,'openingDuration',150),a(this,'eyeState',0),a(this,'eyeParamValue',1),a(this,'closedTimer',0),a(this,'nextBlinkTimeLeft',this.blinkInterval),this.coreModel=e,this.leftParam=e.getParamIndex('PARAM_EYE_L_OPEN'),this.rightParam=e.getParamIndex('PARAM_EYE_R_OPEN')}setEyeParams(e){this.eyeParamValue=w(e,0,1),this.coreModel.setParamFloat(this.leftParam,this.eyeParamValue),this.coreModel.setParamFloat(this.rightParam,this.eyeParamValue)}update(e){switch(this.eyeState){case 0:this.nextBlinkTimeLeft-=e,this.nextBlinkTimeLeft<0&&(this.eyeState=1,this.nextBlinkTimeLeft=this.blinkInterval+this.closingDuration+this.closedDuration+this.openingDuration+(t=0,s=2e3,Math.random()*(s-t)+t));break;case 1:this.setEyeParams(this.eyeParamValue+e/this.closingDuration),this.eyeParamValue<=0&&(this.eyeState=2,this.closedTimer=0);break;case 2:this.closedTimer+=e,this.closedTimer>=this.closedDuration&&(this.eyeState=3);break;case 3:this.setEyeParams(this.eyeParamValue+e/this.openingDuration),this.eyeParamValue>=1&&(this.eyeState=0)}var t,s}}const ve=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ye extends F{constructor(e,t,s){super(),a(this,'settings'),a(this,'coreModel'),a(this,'motionManager'),a(this,'eyeBlink'),a(this,'eyeballXParamIndex'),a(this,'eyeballYParamIndex'),a(this,'angleXParamIndex'),a(this,'angleYParamIndex'),a(this,'angleZParamIndex'),a(this,'bodyAngleXParamIndex'),a(this,'breathParamIndex'),a(this,'textureFlipY',!0),a(this,'drawDataCount',0),a(this,'disableCulling',!1),a(this,'hasDrawn',!1),this.coreModel=e,this.settings=t,this.motionManager=new me(t,s),this.eyeBlink=new _e(e),this.eyeballXParamIndex=e.getParamIndex('PARAM_EYE_BALL_X'),this.eyeballYParamIndex=e.getParamIndex('PARAM_EYE_BALL_Y'),this.angleXParamIndex=e.getParamIndex('PARAM_ANGLE_X'),this.angleYParamIndex=e.getParamIndex('PARAM_ANGLE_Y'),this.angleZParamIndex=e.getParamIndex('PARAM_ANGLE_Z'),this.bodyAngleXParamIndex=e.getParamIndex('PARAM_BODY_ANGLE_X'),this.breathParamIndex=e.getParamIndex('PARAM_BREATH'),this.init()}init(){super.init(),this.settings.initParams&&this.settings.initParams.forEach(({id:e,value:t})=>this.coreModel.setParamFloat(e,t)),this.settings.initOpacities&&this.settings.initOpacities.forEach(({id:e,value:t})=>this.coreModel.setPartsOpacity(e,t)),this.coreModel.saveParam();const e=this.coreModel.getModelContext()._$aS;(null==e?void 0:e.length)&&(this.drawDataCount=e.length);let t=this.coreModel.drawParamWebGL.culling;Object.defineProperty(this.coreModel.drawParamWebGL,'culling',{set:e=>t=e,get:()=>!this.disableCulling&&t});const s=this.coreModel.getModelContext().clipManager,i=s.setupClip;s.setupClip=(e,t)=>{i.call(s,e,t),t.gl.viewport(...this.viewport)}}getSize(){return[this.coreModel.getCanvasWidth(),this.coreModel.getCanvasHeight()]}getLayout(){const e={};if(this.settings.layout)for(const[t,s]of Object.entries(this.settings.layout)){let i=t;'center_x'===t?i='centerX':'center_y'===t&&(i='centerY'),e[i]=s}return e}updateWebGLContext(e,t){const s=this.coreModel.drawParamWebGL;s.firstDraw=!0,s.setGL(e),s.glno=t;for(const[e,t]of Object.entries(s))t instanceof WebGLBuffer&&(s[e]=null);const i=this.coreModel.getModelContext().clipManager;i.curFrameNo=t;const r=e.getParameter(e.FRAMEBUFFER_BINDING);i.getMaskRenderTexture(),e.bindFramebuffer(e.FRAMEBUFFER,r)}bindTexture(e,t){this.coreModel.setTexture(e,t)}getHitAreaDefs(){var e;return(null==(e=this.settings.hitAreas)?void 0:e.map(e=>({id:e.id,name:e.name,index:this.coreModel.getDrawDataIndex(e.id)})))||[]}getDrawableIDs(){const e=this.coreModel.getModelContext(),t=[];for(let s=0;s<this.drawDataCount;s++){const i=e.getDrawData(s);i&&t.push(i.getDrawDataID().id)}return t}getDrawableIndex(e){return this.coreModel.getDrawDataIndex(e)}getDrawableVertices(e){if('string'==typeof e&&-1===(e=this.coreModel.getDrawDataIndex(e)))throw new TypeError('Unable to find drawable ID: '+e);return this.coreModel.getTransformedPoints(e).slice()}hitTest(e,t){return this.hasDrawn||T.warn('Trying to hit-test a Cubism 2 model that has not been rendered yet. The result will always be empty since the draw data is not ready.'),super.hitTest(e,t)}update(e,t){var s,i,r,n;super.update(e,t);const o=this.coreModel;this.emit('beforeMotionUpdate');const a=this.motionManager.update(this.coreModel,t);this.emit('afterMotionUpdate'),o.saveParam(),null==(s=this.motionManager.expressionManager)||s.update(o,t),a||null==(i=this.eyeBlink)||i.update(e),this.updateFocus(),this.updateNaturalMovements(e,t),null==(r=this.physics)||r.update(t),null==(n=this.pose)||n.update(e),this.emit('beforeModelUpdate'),o.update(),o.loadParam()}updateFocus(){this.coreModel.addToParamFloat(this.eyeballXParamIndex,this.focusController.x),this.coreModel.addToParamFloat(this.eyeballYParamIndex,this.focusController.y),this.coreModel.addToParamFloat(this.angleXParamIndex,30*this.focusController.x),this.coreModel.addToParamFloat(this.angleYParamIndex,30*this.focusController.y),this.coreModel.addToParamFloat(this.angleZParamIndex,this.focusController.x*this.focusController.y*-30),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,10*this.focusController.x)}updateNaturalMovements(e,t){const s=t/1e3*2*Math.PI;this.coreModel.addToParamFloat(this.angleXParamIndex,15*Math.sin(s/6.5345)*.5),this.coreModel.addToParamFloat(this.angleYParamIndex,8*Math.sin(s/3.5345)*.5),this.coreModel.addToParamFloat(this.angleZParamIndex,10*Math.sin(s/5.5345)*.5),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,4*Math.sin(s/15.5345)*.5),this.coreModel.setParamFloat(this.breathParamIndex,.5+.5*Math.sin(s/3.2345))}draw(e){const t=this.disableCulling;e.getParameter(e.FRAMEBUFFER_BINDING)&&(this.disableCulling=!0);const s=this.drawingMatrix;ve[0]=s.a,ve[1]=s.b,ve[4]=s.c,ve[5]=s.d,ve[12]=s.tx,ve[13]=s.ty,this.coreModel.setMatrix(ve),this.coreModel.draw(),this.hasDrawn=!0,this.disableCulling=t}destroy(){super.destroy(),this.coreModel=void 0}}class xe extends I{constructor(e){if(super(e),a(this,'moc'),a(this,'textures'),a(this,'layout'),a(this,'hitAreas'),a(this,'initParams'),a(this,'initOpacities'),a(this,'expressions'),a(this,'motions',{}),!xe.isValidJSON(e))throw new TypeError('Invalid JSON.');this.moc=e.model,C('string',e,this,'textures','textures'),this.copy(e)}static isValidJSON(e){var t;return!!e&&'string'==typeof e.model&&(null==(t=e.textures)?void 0:t.length)>0&&e.textures.every(e=>'string'==typeof e)}copy(e){E('string',e,this,'name','name'),E('string',e,this,'pose','pose'),E('string',e,this,'physics','physics'),E('object',e,this,'layout','layout'),E('object',e,this,'motions','motions'),C('object',e,this,'hit_areas','hitAreas'),C('object',e,this,'expressions','expressions'),C('object',e,this,'init_params','initParams'),C('object',e,this,'init_opacities','initOpacities')}replaceFiles(e){super.replaceFiles(e);for(const[t,s]of Object.entries(this.motions))for(let i=0;i<s.length;i++)s[i].file=e(s[i].file,`motions.${t}[${i}].file`),void 0!==s[i].sound&&(s[i].sound=e(s[i].sound,`motions.${t}[${i}].sound`));if(this.expressions)for(let t=0;t<this.expressions.length;t++)this.expressions[t].file=e(this.expressions[t].file,`expressions[${t}].file`)}}const be={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE},Te={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE};class we{constructor(e,t){a(this,'physicsHairs',[]),this.coreModel=e,t.physics_hair&&(this.physicsHairs=t.physics_hair.map(e=>{const t=new PhysicsHair;return t.setup(e.setup.length,e.setup.regist,e.setup.mass),e.src.forEach(({id:e,ptype:s,scale:i,weight:r})=>{const n=be[s];n&&t.addSrcParam(n,e,i,r)}),e.targets.forEach(({id:e,ptype:s,scale:i,weight:r})=>{const n=Te[s];n&&t.addTargetParam(n,e,i,r)}),t}))}update(e){this.physicsHairs.forEach(t=>t.update(this.coreModel,e))}}class Ee{constructor(e){a(this,'paramIndex',-1),a(this,'partsIndex',-1),a(this,'link',[]),this.id=e}initIndex(e){this.paramIndex=e.getParamIndex('VISIBLE:'+this.id),this.partsIndex=e.getPartsDataIndex(PartsDataID.getID(this.id)),e.setParamFloat(this.paramIndex,1)}}class Ce{constructor(e,t){a(this,'opacityAnimDuration',500),a(this,'partsGroups',[]),this.coreModel=e,t.parts_visible&&(this.partsGroups=t.parts_visible.map(({group:e})=>e.map(({id:e,link:t})=>{const s=new Ee(e);return t&&(s.link=t.map(e=>new Ee(e))),s})),this.init())}init(){this.partsGroups.forEach(e=>{e.forEach(e=>{if(e.initIndex(this.coreModel),e.paramIndex>=0){const t=0!==this.coreModel.getParamFloat(e.paramIndex);this.coreModel.setPartsOpacity(e.partsIndex,t?1:0),this.coreModel.setParamFloat(e.paramIndex,t?1:0),e.link.length>0&&e.link.forEach(e=>e.initIndex(this.coreModel))}})})}normalizePartsOpacityGroup(e,t){const s=this.coreModel,i=.5;let r=1,n=e.findIndex(({paramIndex:e,partsIndex:t})=>t>=0&&0!==s.getParamFloat(e));if(n>=0){const i=s.getPartsOpacity(e[n].partsIndex);r=w(i+t/this.opacityAnimDuration,0,1)}else n=0,r=1;e.forEach(({partsIndex:e},t)=>{if(e>=0)if(n==t)s.setPartsOpacity(e,r);else{let t,n=s.getPartsOpacity(e);t=r<i?-.5*r/i+1:(1-r)*i/.5;(1-t)*(1-r)>.15&&(t=1-.15/(1-r)),n>t&&(n=t),s.setPartsOpacity(e,n)}})}copyOpacity(e){const t=this.coreModel;e.forEach(({partsIndex:e,link:s})=>{if(e>=0&&s){const i=t.getPartsOpacity(e);s.forEach(({partsIndex:e})=>{e>=0&&t.setPartsOpacity(e,i)})}})}update(e){this.partsGroups.forEach(t=>{this.normalizePartsOpacityGroup(t,e),this.copyOpacity(t)})}}if(ie.registerRuntime({version:2,test:e=>e instanceof xe||xe.isValidJSON(e),ready:()=>Promise.resolve(),isValidMoc(e){if(e.byteLength<3)return!1;const t=new Int8Array(e,0,3);return'moc'===String.fromCharCode(...t)},createModelSettings:e=>new xe(e),createCoreModel(e){const t=Live2DModelWebGL.loadModel(e),s=Live2D.getError();if(s)throw s;return t},createInternalModel:(e,t,s)=>new ye(e,t,s),createPose:(e,t)=>new Ce(e,t),createPhysics:(e,t)=>new we(e,t)}),!window.Live2DCubismCore)throw new Error('Could not find Cubism 4 runtime. This plugin requires live2dcubismcore.js to be loaded.');class Se{constructor(e,t){this.x=e||0,this.y=t||0}add(e){const t=new Se(0,0);return t.x=this.x+e.x,t.y=this.y+e.y,t}substract(e){const t=new Se(0,0);return t.x=this.x-e.x,t.y=this.y-e.y,t}multiply(e){const t=new Se(0,0);return t.x=this.x*e.x,t.y=this.y*e.y,t}multiplyByScaler(e){return this.multiply(new Se(e,e))}division(e){const t=new Se(0,0);return t.x=this.x/e.x,t.y=this.y/e.y,t}divisionByScalar(e){return this.division(new Se(e,e))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(e){return Math.sqrt((this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y))}dot(e){return this.x*e.x+this.y*e.y}normalize(){const e=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/e,this.y=this.y/e}isEqual(e){return this.x==e.x&&this.y==e.y}isNotEqual(e){return!this.isEqual(e)}}const Ae=class e{static range(e,t,s){return e<t?e=t:e>s&&(e=s),e}static sin(e){return Math.sin(e)}static cos(e){return Math.cos(e)}static abs(e){return Math.abs(e)}static sqrt(e){return Math.sqrt(e)}static cbrt(e){if(0===e)return e;let t=e;const s=t<0;let i;return s&&(t=-t),t===1/0?i=1/0:(i=Math.exp(Math.log(t)/3),i=(t/(i*i)+2*i)/3),s?-i:i}static getEasingSine(e){return e<0?0:e>1?1:.5-.5*this.cos(e*Math.PI)}static max(e,t){return e>t?e:t}static min(e,t){return e>t?t:e}static degreesToRadian(e){return e/180*Math.PI}static radianToDegrees(e){return 180*e/Math.PI}static directionToRadian(e,t){let s=Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x);for(;s<-Math.PI;)s+=2*Math.PI;for(;s>Math.PI;)s-=2*Math.PI;return s}static directionToDegrees(e,t){const s=this.directionToRadian(e,t);let i=this.radianToDegrees(s);return t.x-e.x>0&&(i=-i),i}static radianToDirection(e){const t=new Se;return t.x=this.sin(e),t.y=this.cos(e),t}static quadraticEquation(t,s,i){return this.abs(t)<e.Epsilon?this.abs(s)<e.Epsilon?-i:-i/s:-(s+this.sqrt(s*s-4*t*i))/(2*t)}static cardanoAlgorithmForBezier(t,s,i,r){if(this.sqrt(t)<e.Epsilon)return this.range(this.quadraticEquation(s,i,r),0,1);const n=s/t,o=i/t,a=(3*o-n*n)/3,l=a/3,h=(2*n*n*n-9*n*o+27*(r/t))/27,u=h/2,c=u*u+l*l*l,d=.5,p=.51;if(c<0){const e=-a/3,t=e*e*e,s=this.sqrt(t),i=-h/(2*s),r=this.range(i,-1,1),o=Math.acos(r),l=2*this.cbrt(s),u=l*this.cos(o/3)-n/3;if(this.abs(u-d)<p)return this.range(u,0,1);const c=l*this.cos((o+2*Math.PI)/3)-n/3;if(this.abs(c-d)<p)return this.range(c,0,1);const f=l*this.cos((o+4*Math.PI)/3)-n/3;return this.range(f,0,1)}if(0==c){let e;e=u<0?this.cbrt(-u):-this.cbrt(u);const t=2*e-n/3;if(this.abs(t-d)<p)return this.range(t,0,1);const s=-e-n/3;return this.range(s,0,1)}const f=this.sqrt(c),g=this.cbrt(f-u)-this.cbrt(f+u)-n/3;return this.range(g,0,1)}constructor(){}};Ae.Epsilon=1e-5;let Me=Ae;class Pe{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(e,t,s){const i=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let s=0;s<4;++s)for(let r=0;r<4;++r)for(let n=0;n<4;++n)i[r+4*s]+=e[n+4*s]*t[r+4*n];for(let e=0;e<16;++e)s[e]=i[e]}loadIdentity(){const e=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(e)}setMatrix(e){for(let t=0;t<16;++t)this._tr[t]=e[t]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(e){return this._tr[0]*e+this._tr[12]}transformY(e){return this._tr[5]*e+this._tr[13]}invertTransformX(e){return(e-this._tr[12])/this._tr[0]}invertTransformY(e){return(e-this._tr[13])/this._tr[5]}translateRelative(e,t){const s=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]);Pe.multiply(s,this._tr,this._tr)}translate(e,t){this._tr[12]=e,this._tr[13]=t}translateX(e){this._tr[12]=e}translateY(e){this._tr[13]=e}scaleRelative(e,t){const s=new Float32Array([e,0,0,0,0,t,0,0,0,0,1,0,0,0,0,1]);Pe.multiply(s,this._tr,this._tr)}scale(e,t){this._tr[0]=e,this._tr[5]=t}multiplyByMatrix(e){Pe.multiply(e.getArray(),this._tr,this._tr)}clone(){const e=new Pe;for(let t=0;t<this._tr.length;t++)e._tr[t]=this._tr[t];return e}}class Ie{initialize(e){this._model=e}drawModel(){null!=this.getModel()&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(e){this._mvpMatrix4x4.setMatrix(e.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(e,t,s,i){e<0?e=0:e>1&&(e=1),t<0?t=0:t>1&&(t=1),s<0?s=0:s>1&&(s=1),i<0?i=0:i>1&&(i=1),this._modelColor.R=e,this._modelColor.G=t,this._modelColor.B=s,this._modelColor.A=i}getModelColor(){return Object.assign({},this._modelColor)}setIsPremultipliedAlpha(e){this._isPremultipliedAlpha=e}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(e){this._isCulling=e}isCulling(){return this._isCulling}setAnisotropy(e){this._anisotropy=e}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(e){this._useHighPrecisionMask=e}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._modelColor=new Le,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new Pe,this._mvpMatrix4x4.loadIdentity()}}var Re=(e=>(e[e.CubismBlendMode_Normal=0]='CubismBlendMode_Normal',e[e.CubismBlendMode_Additive=1]='CubismBlendMode_Additive',e[e.CubismBlendMode_Multiplicative=2]='CubismBlendMode_Multiplicative',e))(Re||{});class Le{constructor(e=1,t=1,s=1,i=1){this.R=e,this.G=t,this.B=s,this.A=i}}let ke,De=!1,Be=!1;const Fe=0,Oe=2;class Ne{static startUp(e){if(De)return He('CubismFramework.startUp() is already done.'),De;if(Live2DCubismCore._isStarted)return De=!0,!0;if(Live2DCubismCore._isStarted=!0,ke=e,ke&&Live2DCubismCore.Logging.csmSetLogFunction(ke.logFunction),De=!0,De){const e=Live2DCubismCore.Version.csmGetVersion(),t=(16711680&e)>>16,s=65535&e,i=e;He('Live2D Cubism Core version: {0}.{1}.{2} ({3})',('00'+((4278190080&e)>>24)).slice(-2),('00'+t).slice(-2),('0000'+s).slice(-4),i)}return He('CubismFramework.startUp() is complete.'),De}static cleanUp(){De=!1,Be=!1,ke=void 0}static initialize(e=0){De?Be?We('CubismFramework.initialize() skipped, already initialized.'):(Live2DCubismCore.Memory.initializeAmountOfMemory(e),Be=!0,He('CubismFramework.initialize() is complete.')):We('CubismFramework is not started.')}static dispose(){De?Be?(Ie.staticRelease(),Be=!1,He('CubismFramework.dispose() is complete.')):We('CubismFramework.dispose() skipped, not initialized.'):We('CubismFramework is not started.')}static isStarted(){return De}static isInitialized(){return Be}static coreLogFunction(e){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(e)}static getLoggingLevel(){return null!=ke?ke.loggingLevel:5}constructor(){}}var Ue=(e=>(e[e.LogLevel_Verbose=0]='LogLevel_Verbose',e[e.LogLevel_Debug=1]='LogLevel_Debug',e[e.LogLevel_Info=2]='LogLevel_Info',e[e.LogLevel_Warning=3]='LogLevel_Warning',e[e.LogLevel_Error=4]='LogLevel_Error',e[e.LogLevel_Off=5]='LogLevel_Off',e))(Ue||{});const Ge=()=>{};function Ve(e,...t){Xe.print(Ue.LogLevel_Debug,'[CSM][D]'+e+'\n',t)}function He(e,...t){Xe.print(Ue.LogLevel_Info,'[CSM][I]'+e+'\n',t)}function We(e,...t){Xe.print(Ue.LogLevel_Warning,'[CSM][W]'+e+'\n',t)}function $e(e,...t){Xe.print(Ue.LogLevel_Error,'[CSM][E]'+e+'\n',t)}class Xe{static print(e,t,s){if(e<Ne.getLoggingLevel())return;const i=Ne.coreLogFunction;if(!i)return;i(t.replace(/{(\d+)}/g,(e,t)=>s[t]))}static dumpBytes(e,t,s){for(let i=0;i<s;i++)i%16==0&&i>0?this.print(e,'\n'):i%8==0&&i>0&&this.print(e,'  '),this.print(e,'{0} ',[255&t[i]]);this.print(e,'\n')}constructor(){}}class je{constructor(){this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=[]}release(){this._weight=0}updateParameters(e,t,s){if(!t.isAvailable()||t.isFinished())return;if(!t.isStarted()){t.setIsStarted(!0),t.setStartTime(s-this._offsetSeconds),t.setFadeInStartTime(s);const e=this.getDuration();t.getEndTime()<0&&t.setEndTime(e<=0?-1:t.getStartTime()+e)}let i=this._weight;i=i*(0==this._fadeInSeconds?1:Me.getEasingSine((s-t.getFadeInStartTime())/this._fadeInSeconds))*(0==this._fadeOutSeconds||t.getEndTime()<0?1:Me.getEasingSine((t.getEndTime()-s)/this._fadeOutSeconds)),t.setState(s,i),Ge(0<=i&&i<=1),this.doUpdateParameters(e,s,i,t),t.getEndTime()>0&&t.getEndTime()<s&&t.setIsFinished(!0)}setFadeInTime(e){this._fadeInSeconds=e}setFadeOutTime(e){this._fadeOutSeconds=e}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(e){this._weight=e}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(e){this._offsetSeconds=e}getFiredEvent(e,t){return this._firedEventValues}setFinishedMotionHandler(e){this._onFinishedMotion=e}getFinishedMotionHandler(){return this._onFinishedMotion}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(e){}getModelOpacityValue(){return 1}}class ze extends je{constructor(){super(),this._parameters=[]}static create(e){const t=new ze;return t.parse(e),t}doUpdateParameters(e,t,s,i){for(let t=0;t<this._parameters.length;++t){const i=this._parameters[t];switch(i.blendType){case 0:e.addParameterValueById(i.parameterId,i.value,s);break;case 1:e.multiplyParameterValueById(i.parameterId,i.value,s);break;case 2:e.setParameterValueById(i.parameterId,i.value,s)}}}parse(e){this.setFadeInTime(null!=e.FadeInTime?e.FadeInTime:1),this.setFadeOutTime(null!=e.FadeOutTime?e.FadeOutTime:1);const t=(e.Parameters||[]).length;for(let s=0;s<t;++s){const t=e.Parameters[s],i=t.Id,r=t.Value;let n;n=t.Blend&&'Add'!==t.Blend?'Multiply'===t.Blend?1:'Overwrite'===t.Blend?2:0:0;const o={parameterId:i,blendType:n,value:r};this._parameters.push(o)}}}class Ye{constructor(){this._autoDelete=!1,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&this._motion.release()}setFadeOut(e){this._fadeOutSeconds=e,this._isTriggeredFadeOut=!0}startFadeOut(e,t){const s=t+e;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||s<this._endTimeSeconds)&&(this._endTimeSeconds=s)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(e){this._startTimeSeconds=e}setFadeInStartTime(e){this._fadeInStartTimeSeconds=e}setEndTime(e){this._endTimeSeconds=e}setIsFinished(e){this._finished=e}setIsStarted(e){this._started=e}isAvailable(){return this._available}setIsAvailable(e){this._available=e}setState(e,t){this._stateTimeSeconds=e,this._stateWeight=t}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(e){this._lastEventCheckSeconds=e}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}class qe{constructor(){this._userTimeSeconds=0,this._eventCustomData=null,this._motions=[]}release(){for(let e=0;e<this._motions.length;++e)this._motions[e]&&this._motions[e].release();this._motions=void 0}startMotion(e,t,s){if(null==e)return Qe;let i;for(let e=0;e<this._motions.length;++e)i=this._motions[e],null!=i&&i.setFadeOut(i._motion.getFadeOutTime());return i=new Ye,i._autoDelete=t,i._motion=e,this._motions.push(i),i._motionQueueEntryHandle}isFinished(){let e=0;for(;e<this._motions.length;){const t=this._motions[e];if(null==t){this._motions.splice(e,1);continue}if(null!=t._motion){if(!t.isFinished())return!1;e++}else t.release(),this._motions.splice(e,1)}return!0}isFinishedByHandle(e){for(let t=0;t<this._motions.length;t++){const s=this._motions[t];if(null!=s&&(s._motionQueueEntryHandle==e&&!s.isFinished()))return!1}return!0}stopAllMotions(){for(let e=0;e<this._motions.length;e++){const t=this._motions[e];null!=t&&t.release()}this._motions=[]}getCubismMotionQueueEntry(e){return this._motions.find(t=>null!=t&&t._motionQueueEntryHandle==e)}setEventCallback(e,t=null){this._eventCallBack=e,this._eventCustomData=t}doUpdateMotion(e,t){let s=!1,i=0;for(;i<this._motions.length;){const r=this._motions[i];if(null==r){this._motions.splice(i,1);continue}const n=r._motion;if(null==n){r.release(),this._motions.splice(i,1);continue}n.updateParameters(e,r,t),s=!0;const o=n.getFiredEvent(r.getLastCheckEventSeconds()-r.getStartTime(),t-r.getStartTime());for(let e=0;e<o.length;++e)this._eventCallBack(this,o[e],this._eventCustomData);r.setLastCheckEventSeconds(t),r.isFinished()?(r.release(),this._motions.splice(i,1)):(r.isTriggeredFadeOut()&&r.startFadeOut(r.getFadeOutSeconds(),t),i++)}return s}}const Qe=-1;class Ke extends S{constructor(e,t){var s;super(e,t),a(this,'queueManager',new qe),a(this,'definitions'),this.definitions=null!=(s=e.expressions)?s:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(e){return this.definitions.findIndex(t=>t.Name===e)}getExpressionFile(e){return e.File}createExpression(e,t){return ze.create(e)}_setExpression(e){return this.queueManager.startMotion(e,!1,performance.now())}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(e,t){return this.queueManager.doUpdateMotion(e,t)}}var Ze=(e=>(e[e.CubismMotionCurveTarget_Model=0]='CubismMotionCurveTarget_Model',e[e.CubismMotionCurveTarget_Parameter=1]='CubismMotionCurveTarget_Parameter',e[e.CubismMotionCurveTarget_PartOpacity=2]='CubismMotionCurveTarget_PartOpacity',e))(Ze||{}),Je=(e=>(e[e.CubismMotionSegmentType_Linear=0]='CubismMotionSegmentType_Linear',e[e.CubismMotionSegmentType_Bezier=1]='CubismMotionSegmentType_Bezier',e[e.CubismMotionSegmentType_Stepped=2]='CubismMotionSegmentType_Stepped',e[e.CubismMotionSegmentType_InverseStepped=3]='CubismMotionSegmentType_InverseStepped',e))(Je||{});class et{constructor(e=0,t=0){this.time=e,this.value=t}}class tt{constructor(){this.basePointIndex=0,this.segmentType=0}}class st{constructor(){this.id='',this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class it{constructor(){this.fireTime=0,this.value=''}}class rt{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=[],this.segments=[],this.points=[],this.events=[]}}class nt{constructor(e){this._json=e}release(){this._json=void 0}getMotionDuration(){return this._json.Meta.Duration}isMotionLoop(){return this._json.Meta.Loop||!1}getEvaluationOptionFlag(e){return 0==e&&!!this._json.Meta.AreBeziersRestricted}getMotionCurveCount(){return this._json.Meta.CurveCount}getMotionFps(){return this._json.Meta.Fps}getMotionTotalSegmentCount(){return this._json.Meta.TotalSegmentCount}getMotionTotalPointCount(){return this._json.Meta.TotalPointCount}getMotionFadeInTime(){return this._json.Meta.FadeInTime}getMotionFadeOutTime(){return this._json.Meta.FadeOutTime}getMotionCurveTarget(e){return this._json.Curves[e].Target}getMotionCurveId(e){return this._json.Curves[e].Id}getMotionCurveFadeInTime(e){return this._json.Curves[e].FadeInTime}getMotionCurveFadeOutTime(e){return this._json.Curves[e].FadeOutTime}getMotionCurveSegmentCount(e){return this._json.Curves[e].Segments.length}getMotionCurveSegment(e,t){return this._json.Curves[e].Segments[t]}getEventCount(){return this._json.Meta.UserDataCount||0}getTotalEventValueSize(){return this._json.Meta.TotalUserDataSize}getEventTime(e){return this._json.UserData[e].Time}getEventValue(e){return this._json.UserData[e].Value}}var ot=(e=>(e[e.EvaluationOptionFlag_AreBeziersRistricted=0]='EvaluationOptionFlag_AreBeziersRistricted',e))(ot||{});const at='Opacity';function lt(e,t,s){const i=new et;return i.time=e.time+(t.time-e.time)*s,i.value=e.value+(t.value-e.value)*s,i}function ht(e,t){let s=(t-e[0].time)/(e[1].time-e[0].time);return s<0&&(s=0),e[0].value+(e[1].value-e[0].value)*s}function ut(e,t){let s=(t-e[0].time)/(e[3].time-e[0].time);s<0&&(s=0);const i=lt(e[0],e[1],s),r=lt(e[1],e[2],s),n=lt(e[2],e[3],s),o=lt(i,r,s),a=lt(r,n,s);return lt(o,a,s).value}function ct(e,t){const s=t,i=e[0].time,r=e[3].time,n=e[1].time,o=e[2].time,a=r-3*o+3*n-i,l=3*o-6*n+3*i,h=3*n-3*i,u=i-s,c=Me.cardanoAlgorithmForBezier(a,l,h,u),d=lt(e[0],e[1],c),p=lt(e[1],e[2],c),f=lt(e[2],e[3],c),g=lt(d,p,c),m=lt(p,f,c);return lt(g,m,c).value}function dt(e,t){return e[0].value}function pt(e,t){return e[1].value}function ft(e,t,s){const i=e.curves[t];let r=-1;const n=i.baseSegmentIndex+i.segmentCount;let o=0;for(let t=i.baseSegmentIndex;t<n;++t)if(o=e.segments[t].basePointIndex+(e.segments[t].segmentType==Je.CubismMotionSegmentType_Bezier?3:1),e.points[o].time>s){r=t;break}if(-1==r)return e.points[o].value;const a=e.segments[r];return a.evaluate(e.points.slice(a.basePointIndex),s)}class gt extends je{constructor(){super(),this._eyeBlinkParameterIds=[],this._lipSyncParameterIds=[],this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._modelOpacity=1}static create(e,t){const s=new gt;return s.parse(e),s._sourceFrameRate=s._motionData.fps,s._loopDurationSeconds=s._motionData.duration,s._onFinishedMotion=t,s}doUpdateParameters(e,t,s,i){null==this._modelCurveIdEyeBlink&&(this._modelCurveIdEyeBlink='EyeBlink'),null==this._modelCurveIdLipSync&&(this._modelCurveIdLipSync='LipSync'),null==this._modelCurveIdOpacity&&(this._modelCurveIdOpacity=at);let r=t-i.getStartTime();r<0&&(r=0);let n=Number.MAX_VALUE,o=Number.MAX_VALUE;const a=64;let l=0,u=0;this._eyeBlinkParameterIds.length>a&&Ve('too many eye blink targets : {0}',this._eyeBlinkParameterIds.length),this._lipSyncParameterIds.length>a&&Ve('too many lip sync targets : {0}',this._lipSyncParameterIds.length);const c=this._fadeInSeconds<=0?1:Me.getEasingSine((t-i.getFadeInStartTime())/this._fadeInSeconds),d=this._fadeOutSeconds<=0||i.getEndTime()<0?1:Me.getEasingSine((i.getEndTime()-t)/this._fadeOutSeconds);let p,f,g,m=r;if(this._isLoop)for(;m>this._motionData.duration;)m-=this._motionData.duration;const v=this._motionData.curves;for(f=0;f<this._motionData.curveCount&&v[f].type==Ze.CubismMotionCurveTarget_Model;++f)p=ft(this._motionData,f,m),v[f].id==this._modelCurveIdEyeBlink?o=p:v[f].id==this._modelCurveIdLipSync?n=p:v[f].id==this._modelCurveIdOpacity&&(this._modelOpacity=p,e.setModelOapcity(this.getModelOpacityValue()));for(;f<this._motionData.curveCount&&v[f].type==Ze.CubismMotionCurveTarget_Parameter;++f){if(g=e.getParameterIndex(v[f].id),-1==g)continue;const r=e.getParameterValueByIndex(g);if(p=ft(this._motionData,f,m),o!=Number.MAX_VALUE)for(let e=0;e<this._eyeBlinkParameterIds.length&&e<a;++e)if(this._eyeBlinkParameterIds[e]==v[f].id){p*=o,u|=1<<e;break}if(n!=Number.MAX_VALUE)for(let e=0;e<this._lipSyncParameterIds.length&&e<a;++e)if(this._lipSyncParameterIds[e]==v[f].id){p+=n,l|=1<<e;break}let h;if(v[f].fadeInTime<0&&v[f].fadeOutTime<0)h=r+(p-r)*s;else{let e,s;e=v[f].fadeInTime<0?c:0==v[f].fadeInTime?1:Me.getEasingSine((t-i.getFadeInStartTime())/v[f].fadeInTime),s=v[f].fadeOutTime<0?d:0==v[f].fadeOutTime||i.getEndTime()<0?1:Me.getEasingSine((i.getEndTime()-t)/v[f].fadeOutTime);h=r+(p-r)*(this._weight*e*s)}e.setParameterValueByIndex(g,h,1)}if(o!=Number.MAX_VALUE)for(let t=0;t<this._eyeBlinkParameterIds.length&&t<a;++t){const i=e.getParameterValueById(this._eyeBlinkParameterIds[t]);if(u>>t&1)continue;const r=i+(o-i)*s;e.setParameterValueById(this._eyeBlinkParameterIds[t],r)}if(n!=Number.MAX_VALUE)for(let t=0;t<this._lipSyncParameterIds.length&&t<a;++t){const i=e.getParameterValueById(this._lipSyncParameterIds[t]);if(l>>t&1)continue;const r=i+(n-i)*s;e.setParameterValueById(this._lipSyncParameterIds[t],r)}for(;f<this._motionData.curveCount&&v[f].type==Ze.CubismMotionCurveTarget_PartOpacity;++f)if(p=ft(this._motionData,f,m),h.setOpacityFromMotion)e.setPartOpacityById(v[f].id,p);else{if(g=e.getParameterIndex(v[f].id),-1==g)continue;e.setParameterValueByIndex(g,p)}r>=this._motionData.duration&&(this._isLoop?(i.setStartTime(t),this._isLoopFadeIn&&i.setFadeInStartTime(t)):(this._onFinishedMotion&&this._onFinishedMotion(this),i.setIsFinished(!0))),this._lastWeight=s}setIsLoop(e){this._isLoop=e}isLoop(){return this._isLoop}setIsLoopFadeIn(e){this._isLoopFadeIn=e}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(e,t){const s=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(e==s[i].id)return void(s[i].fadeInTime=t)}setParameterFadeOutTime(e,t){const s=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(e==s[i].id)return void(s[i].fadeOutTime=t)}getParameterFadeInTime(e){const t=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(e==t[s].id)return t[s].fadeInTime;return-1}getParameterFadeOutTime(e){const t=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(e==t[s].id)return t[s].fadeOutTime;return-1}setEffectIds(e,t){this._eyeBlinkParameterIds=e,this._lipSyncParameterIds=t}release(){this._motionData=void 0}parse(e){this._motionData=new rt;const t=new nt(e);this._motionData.duration=t.getMotionDuration(),this._motionData.loop=t.isMotionLoop(),this._motionData.curveCount=t.getMotionCurveCount(),this._motionData.fps=t.getMotionFps(),this._motionData.eventCount=t.getEventCount();const s=t.getEvaluationOptionFlag(ot.EvaluationOptionFlag_AreBeziersRistricted),i=t.getMotionFadeInTime(),r=t.getMotionFadeOutTime();this._fadeInSeconds=void 0!==i?i<0?1:i:1,this._fadeOutSeconds=void 0!==r?r<0?1:r:1,this._motionData.curves=Array.from({length:this._motionData.curveCount}).map(()=>new st),this._motionData.segments=Array.from({length:t.getMotionTotalSegmentCount()}).map(()=>new tt),this._motionData.events=Array.from({length:this._motionData.eventCount}).map(()=>new it),this._motionData.points=[];let n=0,o=0;for(let e=0;e<this._motionData.curveCount;++e){const i=this._motionData.curves[e];switch(t.getMotionCurveTarget(e)){case'Model':i.type=Ze.CubismMotionCurveTarget_Model;break;case'Parameter':i.type=Ze.CubismMotionCurveTarget_Parameter;break;case'PartOpacity':i.type=Ze.CubismMotionCurveTarget_PartOpacity;break;default:We('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!')}i.id=t.getMotionCurveId(e),i.baseSegmentIndex=o;const r=t.getMotionCurveFadeInTime(e),a=t.getMotionCurveFadeOutTime(e);i.fadeInTime=void 0!==r?r:-1,i.fadeOutTime=void 0!==a?a:-1;for(let r=0;r<t.getMotionCurveSegmentCount(e);){0==r?(this._motionData.segments[o].basePointIndex=n,this._motionData.points[n]=new et(t.getMotionCurveSegment(e,r),t.getMotionCurveSegment(e,r+1)),n+=1,r+=2):this._motionData.segments[o].basePointIndex=n-1;switch(t.getMotionCurveSegment(e,r)){case Je.CubismMotionSegmentType_Linear:this._motionData.segments[o].segmentType=Je.CubismMotionSegmentType_Linear,this._motionData.segments[o].evaluate=ht,this._motionData.points[n]=new et(t.getMotionCurveSegment(e,r+1),t.getMotionCurveSegment(e,r+2)),n+=1,r+=3;break;case Je.CubismMotionSegmentType_Bezier:this._motionData.segments[o].segmentType=Je.CubismMotionSegmentType_Bezier,this._motionData.segments[o].evaluate=s?ut:ct,this._motionData.points[n]=new et(t.getMotionCurveSegment(e,r+1),t.getMotionCurveSegment(e,r+2)),this._motionData.points[n+1]=new et(t.getMotionCurveSegment(e,r+3),t.getMotionCurveSegment(e,r+4)),this._motionData.points[n+2]=new et(t.getMotionCurveSegment(e,r+5),t.getMotionCurveSegment(e,r+6)),n+=3,r+=7;break;case Je.CubismMotionSegmentType_Stepped:this._motionData.segments[o].segmentType=Je.CubismMotionSegmentType_Stepped,this._motionData.segments[o].evaluate=dt,this._motionData.points[n]=new et(t.getMotionCurveSegment(e,r+1),t.getMotionCurveSegment(e,r+2)),n+=1,r+=3;break;case Je.CubismMotionSegmentType_InverseStepped:this._motionData.segments[o].segmentType=Je.CubismMotionSegmentType_InverseStepped,this._motionData.segments[o].evaluate=pt,this._motionData.points[n]=new et(t.getMotionCurveSegment(e,r+1),t.getMotionCurveSegment(e,r+2)),n+=1,r+=3;break;default:Ge(0)}++i.segmentCount,++o}this._motionData.curves.push(i)}for(let e=0;e<t.getEventCount();++e)this._motionData.events[e].fireTime=t.getEventTime(e),this._motionData.events[e].value=t.getEventValue(e);t.release()}getFiredEvent(e,t){this._firedEventValues.length=0;for(let s=0;s<this._motionData.eventCount;++s)this._motionData.events[s].fireTime>e&&this._motionData.events[s].fireTime<=t&&this._firedEventValues.push(this._motionData.events[s].value);return this._firedEventValues}isExistModelOpacity(){for(let e=0;e<this._motionData.curveCount;e++){const t=this._motionData.curves[e];if(t.type==Ze.CubismMotionCurveTarget_Model&&t.id===at)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let e=0;e<this._motionData.curveCount;e++){const t=this._motionData.curves[e];if(t.type==Ze.CubismMotionCurveTarget_Model&&t.id===at)return e}return-1}getModelOpacityId(e){if(-1!=e){const t=this._motionData.curves[e];if(t.type==Ze.CubismMotionCurveTarget_Model&&t.id===at)return t.id}}getModelOpacityValue(){return this._modelOpacity}}class mt extends D{constructor(e,t){var s;super(e,t),a(this,'definitions'),a(this,'groups',{idle:'Idle'}),a(this,'motionDataType','json'),a(this,'queueManager',new qe),a(this,'expressionManager'),a(this,'eyeBlinkIds'),a(this,'lipSyncIds'),this.definitions=null!=(s=e.motions)?s:{},this.eyeBlinkIds=e.getEyeBlinkParameters()||[],this.lipSyncIds=e.getLipSyncParameters()||[],this.init(t)}init(e){super.init(e),this.settings.expressions&&(this.expressionManager=new Ke(this.settings,e)),this.queueManager.setEventCallback((e,t,s)=>{this.emit('motion:'+t)})}isFinished(){return this.queueManager.isFinished()}_startMotion(e,t){return e.setFinishedMotionHandler(t),this.queueManager.stopAllMotions(),this.queueManager.startMotion(e,!1,performance.now())}_stopAllMotions(){this.queueManager.stopAllMotions()}createMotion(e,t,s){const i=gt.create(e),r=new nt(e),n=(t===this.groups.idle?y:v)/1e3;return void 0===r.getMotionFadeInTime()&&i.setFadeInTime(s.FadeInTime>0?s.FadeInTime:n),void 0===r.getMotionFadeOutTime()&&i.setFadeOutTime(s.FadeOutTime>0?s.FadeOutTime:n),i.setEffectIds(this.eyeBlinkIds,this.lipSyncIds),i}getMotionFile(e){return e.File}getMotionName(e){return e.File}getSoundFile(e){return e.Sound}updateParameters(e,t){return this.queueManager.doUpdateMotion(e,t)}destroy(){super.destroy(),this.queueManager.release(),this.queueManager=void 0}}class _t{constructor(){this._breathParameters=[],this._currentTime=0}static create(){return new _t}setParameters(e){this._breathParameters=e}getParameters(){return this._breathParameters}updateParameters(e,t){this._currentTime+=t;const s=2*this._currentTime*3.14159;for(let t=0;t<this._breathParameters.length;++t){const i=this._breathParameters[t];e.addParameterValueById(i.parameterId,i.offset+i.peak*Math.sin(s/i.cycle),i.weight)}}}class vt{constructor(e,t,s,i,r){this.parameterId=null==e?void 0:e,this.offset=null==t?0:t,this.peak=null==s?0:s,this.cycle=null==i?0:i,this.weight=null==r?0:r}}const yt=class e{static create(t){return new e(t)}setBlinkingInterval(e){this._blinkingIntervalSeconds=e}setBlinkingSetting(e,t,s){this._closingSeconds=e,this._closedSeconds=t,this._openingSeconds=s}setParameterIds(e){this._parameterIds=e}getParameterIds(){return this._parameterIds}updateParameters(t,s){let i;this._userTimeSeconds+=s;let r=0;switch(this._blinkingState){case 2:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,r>=1&&(r=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-r;break;case 3:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,r>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case 4:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,r>=1&&(r=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=r;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1}e.CloseIfZero||(i=-i);for(let e=0;e<this._parameterIds.length;++e)t.setParameterValueById(this._parameterIds[e],i)}constructor(e){var t,s;this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=[],null!=e&&(this._parameterIds=null!=(s=null==(t=e.getEyeBlinkParameters())?void 0:t.slice())?s:this._parameterIds)}determinNextBlinkingTiming(){const e=Math.random();return this._userTimeSeconds+e*(2*this._blinkingIntervalSeconds-1)}};yt.CloseIfZero=!0;let xt=yt;class bt{constructor(e=0,t=0,s=0,i=0){this.x=e,this.y=t,this.width=s,this.height=i}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}expand(e,t){this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t}}let Tt,wt,Et;class Ct{getChannelFlagAsColor(e){return this._channelColors[e]}getMaskRenderTexture(){if(this._maskTexture&&null!=this._maskTexture.textures)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures=[],this._maskColorBuffers=[];const e=this._clippingMaskBufferSize;for(let t=0;t<this._renderTextureCount;t++)this._maskColorBuffers.push(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers[t]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.push(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures[t]),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers[t],0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Et),this._maskTexture=new St(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(e){this.gl=e}calcClippedDrawTotalBounds(e,t){let s=Number.MAX_VALUE,i=Number.MAX_VALUE,r=Number.MIN_VALUE,n=Number.MIN_VALUE;const o=t._clippedDrawableIndexList.length;for(let a=0;a<o;a++){const o=t._clippedDrawableIndexList[a],l=e.getDrawableVertexCount(o),h=e.getDrawableVertices(o);let u=Number.MAX_VALUE,c=Number.MAX_VALUE,d=-Number.MAX_VALUE,p=-Number.MAX_VALUE;const f=l*Oe;for(let e=Fe;e<f;e+=Oe){const t=h[e],s=h[e+1];t<u&&(u=t),t>d&&(d=t),s<c&&(c=s),s>p&&(p=s)}if(u!=Number.MAX_VALUE)if(u<s&&(s=u),c<i&&(i=c),d>r&&(r=d),p>n&&(n=p),s==Number.MAX_VALUE)t._allClippedDrawRect.x=0,t._allClippedDrawRect.y=0,t._allClippedDrawRect.width=0,t._allClippedDrawRect.height=0,t._isUsing=!1;else{t._isUsing=!0;const e=r-s,o=n-i;t._allClippedDrawRect.x=s,t._allClippedDrawRect.y=i,t._allClippedDrawRect.width=e,t._allClippedDrawRect.height=o}}}constructor(){this._currentMaskRenderTexture=null,this._currentFrameNo=0,this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=[],this._clippingContextListForDraw=[],this._channelColors=[],this._tmpBoundsOnModel=new bt,this._tmpMatrix=new Pe,this._tmpMatrixForMask=new Pe,this._tmpMatrixForDraw=new Pe;let e=new Le;e.R=1,e.G=0,e.B=0,e.A=0,this._channelColors.push(e),e=new Le,e.R=0,e.G=1,e.B=0,e.A=0,this._channelColors.push(e),e=new Le,e.R=0,e.G=0,e.B=1,e.A=0,this._channelColors.push(e),e=new Le,e.R=0,e.G=0,e.B=0,e.A=1,this._channelColors.push(e)}release(){var e;const t=this;for(let t=0;t<this._clippingContextListForMask.length;t++)this._clippingContextListForMask[t]&&(null==(e=this._clippingContextListForMask[t])||e.release());if(t._clippingContextListForMask=void 0,t._clippingContextListForDraw=void 0,this._maskTexture){for(let e=0;e<this._maskTexture.textures.length;e++)this.gl.deleteFramebuffer(this._maskTexture.textures[e]);this._maskTexture=void 0}if(t._channelColors=void 0,this._maskColorBuffers)for(let e=0;e<this._maskColorBuffers.length;e++)this.gl.deleteTexture(this._maskColorBuffers[e]);this._maskColorBuffers=void 0,this._maskRenderTextures=void 0,this._clearedFrameBufferflags=void 0}initialize(e,t,s,i,r){r%1!=0&&(We('The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer.'),r=~~r),r<1&&We('The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1.'),this._renderTextureCount=r<1?1:r,this._clearedFrameBufferflags=[];for(let e=0;e<t;e++){if(i[e]<=0){this._clippingContextListForDraw.push(null);continue}let t=this.findSameClip(s[e],i[e]);null==t&&(t=new At(this,s[e],i[e]),this._clippingContextListForMask.push(t)),t.addClippedDrawable(e),this._clippingContextListForDraw.push(t)}}setupClippingContext(e,t){this._currentFrameNo++;let s=0;for(let t=0;t<this._clippingContextListForMask.length;t++){const i=this._clippingContextListForMask[t];this.calcClippedDrawTotalBounds(e,i),i._isUsing&&s++}if(s>0){this.setupLayoutBounds(t.isUsingHighPrecisionMask()?0:s),t.isUsingHighPrecisionMask()||(this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture()[0],t.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._clearedFrameBufferflags||(this._clearedFrameBufferflags=[]);for(let e=0;e<this._renderTextureCount;e++)this._clearedFrameBufferflags[e]=!1;for(let s=0;s<this._clippingContextListForMask.length;s++){const i=this._clippingContextListForMask[s],r=i._allClippedDrawRect,n=i._layoutBounds,o=.05;let a=0,l=0;const h=this.getMaskRenderTexture()[i._bufferIndex];if(this._currentMaskRenderTexture==h||t.isUsingHighPrecisionMask()||(this._currentMaskRenderTexture=h,t.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),t.isUsingHighPrecisionMask()){const t=e.getPixelsPerUnit(),s=i.getClippingManager()._clippingMaskBufferSize,h=n.width*s,u=n.height*s;this._tmpBoundsOnModel.setRect(r),this._tmpBoundsOnModel.width*t>h?(this._tmpBoundsOnModel.expand(r.width*o,0),a=n.width/this._tmpBoundsOnModel.width):a=t/h,this._tmpBoundsOnModel.height*t>u?(this._tmpBoundsOnModel.expand(0,r.height*o),l=n.height/this._tmpBoundsOnModel.height):l=t/u}else this._tmpBoundsOnModel.setRect(r),this._tmpBoundsOnModel.expand(r.width*o,r.height*o),a=n.width/this._tmpBoundsOnModel.width,l=n.height/this._tmpBoundsOnModel.height;if(this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(a,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(a,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),i._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),i._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray()),!t.isUsingHighPrecisionMask()){const s=i._clippingIdCount;for(let r=0;r<s;r++){const s=i._clippingIdList[r];e.getDrawableDynamicFlagVertexPositionsDidChange(s)&&(t.setIsCulling(0!=e.getDrawableCulling(s)),this._clearedFrameBufferflags[i._bufferIndex]||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferflags[i._bufferIndex]=!0),t.setClippingContextBufferForMask(i),t.drawMesh(e.getDrawableTextureIndex(s),e.getDrawableVertexIndexCount(s),e.getDrawableVertexCount(s),e.getDrawableVertexIndices(s),e.getDrawableVertices(s),e.getDrawableVertexUvs(s),e.getMultiplyColor(s),e.getScreenColor(s),e.getDrawableOpacity(s),Re.CubismBlendMode_Normal,!1))}}}t.isUsingHighPrecisionMask()||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Et),t.setClippingContextBufferForMask(null),this.gl.viewport(wt[0],wt[1],wt[2],wt[3]))}}findSameClip(e,t){for(let s=0;s<this._clippingContextListForMask.length;s++){const i=this._clippingContextListForMask[s],r=i._clippingIdCount;if(r!=t)continue;let n=0;for(let t=0;t<r;t++){const s=i._clippingIdList[t];for(let t=0;t<r;t++)if(e[t]==s){n++;break}}if(n==r)return i}return null}setupLayoutBounds(e){const t=this._renderTextureCount<=1?36:32*this._renderTextureCount;if(e<=0||e>t){e>t&&$e('not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}',e-t,this._renderTextureCount,e);for(let e=0;e<this._clippingContextListForMask.length;e++){const t=this._clippingContextListForMask[e];t._layoutChannelNo=0,t._layoutBounds.x=0,t._layoutBounds.y=0,t._layoutBounds.width=1,t._layoutBounds.height=1,t._bufferIndex=0}return}const s=this._renderTextureCount<=1?9:8;let i=e/this._renderTextureCount,r=e%this._renderTextureCount;i=~~i,r=~~r;let n=i/4,o=i%4;n=~~n,o=~~o;let a=0;for(let i=0;i<this._renderTextureCount;i++)for(let l=0;l<4;l++){let u=n+(l<o?1:0);if(u<s&&l==(o+1>=4?0:o+1)&&(u+=i<r?1:0),0==u);else if(1==u){const e=this._clippingContextListForMask[a++];e._layoutChannelNo=l,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1,e._bufferIndex=i}else if(2==u)for(let e=0;e<u;e++){let t=e%2;t=~~t;const s=this._clippingContextListForMask[a++];s._layoutChannelNo=l,s._layoutBounds.x=.5*t,s._layoutBounds.y=0,s._layoutBounds.width=.5,s._layoutBounds.height=1,s._bufferIndex=i}else if(u<=4)for(let e=0;e<u;e++){let t=e%2,s=e/2;t=~~t,s=~~s;const r=this._clippingContextListForMask[a++];r._layoutChannelNo=l,r._layoutBounds.x=.5*t,r._layoutBounds.y=.5*s,r._layoutBounds.width=.5,r._layoutBounds.height=.5,r._bufferIndex=i}else if(u<=s)for(let e=0;e<u;e++){let t=e%3,s=e/3;t=~~t,s=~~s;const r=this._clippingContextListForMask[a++];r._layoutChannelNo=l,r._layoutBounds.x=t/3,r._layoutBounds.y=s/3,r._layoutBounds.width=1/3,r._layoutBounds.height=1/3,r._bufferIndex=i}else if(h.supportMoreMaskDivisions&&u<=16)for(let e=0;e<u;e++){let t=e%4,s=e/4;t=~~t,s=~~s;const r=this._clippingContextListForMask[a++];r._layoutChannelNo=l,r._layoutBounds.x=t/4,r._layoutBounds.y=s/4,r._layoutBounds.width=1/4,r._layoutBounds.height=1/4,r._bufferIndex=i}else{$e('not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}',e-t,this._renderTextureCount,e);for(let e=0;e<u;e++){const e=this._clippingContextListForMask[a++];e._layoutChannelNo=0,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1,e._bufferIndex=0}}}}getColorBuffer(){return this._maskColorBuffers}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskCount(){return this._clippingContextListForMask.length}setClippingMaskBufferSize(e){this._clippingMaskBufferSize=e}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}}class St{constructor(e,t){this.frameNo=e,this.textures=t}}class At{constructor(e,t,s){this._isUsing=!1,this._owner=e,this._clippingIdList=t,this._clippingIdCount=s,this._allClippedDrawRect=new bt,this._layoutBounds=new bt,this._clippedDrawableIndexList=[],this._matrixForMask=new Pe,this._matrixForDraw=new Pe,this._bufferIndex=0}release(){const e=this;e._layoutBounds=void 0,e._allClippedDrawRect=void 0,e._clippedDrawableIndexList=void 0}addClippedDrawable(e){this._clippedDrawableIndexList.push(e)}getClippingManager(){return this._owner}setGl(e){this._owner.setGL(e)}}class Mt{setGlEnable(e,t){t?this.gl.enable(e):this.gl.disable(e)}setGlEnableVertexAttribArray(e,t){t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e)}save(){null!=this.gl?(this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)):$e('\'gl\' is null. WebGLRenderingContext is required.\nPlease call \'CubimRenderer_WebGL.startUp\' function.')}restore(){null!=this.gl?(this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])):$e('\'gl\' is null. WebGLRenderingContext is required.\nPlease call \'CubimRenderer_WebGL.startUp\' function.')}setGl(e){this.gl=e}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class Pt{static getInstance(){return null==Tt?(Tt=new Pt,Tt):Tt}static deleteInstance(){Tt&&(Tt.release(),Tt=void 0)}constructor(){this._shaderSets=[]}release(){this.releaseShaderProgram()}setupShaderProgram(e,t,s,i,r,n,o,a,l,h,u,c,d,p,f){let g,m,v,y;d||$e('NoPremultipliedAlpha is not allowed'),0==this._shaderSets.length&&this.generateShaders();const x=e.getClippingContextBufferForMask();if(null!=x){const e=this._shaderSets[0];this.gl.useProgram(e.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(e.samplerTexture0Location,0),null==o.vertex&&(o.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(e.attributePositionLocation),this.gl.vertexAttribPointer(e.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==o.uv&&(o.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(e.attributeTexCoordLocation),this.gl.vertexAttribPointer(e.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const s=x._layoutChannelNo,r=x.getClippingManager().getChannelFlagAsColor(s);this.gl.uniform4f(e.uniformChannelFlagLocation,r.R,r.G,r.B,r.A),this.gl.uniformMatrix4fv(e.uniformClipMatrixLocation,!1,x._matrixForMask.getArray());const a=x._layoutBounds;this.gl.uniform4f(e.uniformBaseColorLocation,2*a.x-1,2*a.y-1,2*a.getRight()-1,2*a.getBottom()-1),this.gl.uniform4f(e.uniformMultiplyColorLocation,u.R,u.G,u.B,u.A),this.gl.uniform4f(e.uniformScreenColorLocation,c.R,c.G,c.B,c.A),g=this.gl.ZERO,m=this.gl.ONE_MINUS_SRC_COLOR,v=this.gl.ZERO,y=this.gl.ONE_MINUS_SRC_ALPHA}else{const s=e.getClippingContextBufferForDraw(),r=null!=s?f?2:1:0;let a;switch(l){case Re.CubismBlendMode_Normal:default:a=this._shaderSets[1+r],g=this.gl.ONE,m=this.gl.ONE_MINUS_SRC_ALPHA,v=this.gl.ONE,y=this.gl.ONE_MINUS_SRC_ALPHA;break;case Re.CubismBlendMode_Additive:a=this._shaderSets[4+r],g=this.gl.ONE,m=this.gl.ONE,v=this.gl.ZERO,y=this.gl.ONE;break;case Re.CubismBlendMode_Multiplicative:a=this._shaderSets[7+r],g=this.gl.DST_COLOR,m=this.gl.ONE_MINUS_SRC_ALPHA,v=this.gl.ZERO,y=this.gl.ONE}if(this.gl.useProgram(a.shaderProgram),null==o.vertex&&(o.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(a.attributePositionLocation),this.gl.vertexAttribPointer(a.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==o.uv&&(o.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(a.attributeTexCoordLocation),this.gl.vertexAttribPointer(a.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),null!=s){this.gl.activeTexture(this.gl.TEXTURE1);const t=s.getClippingManager().getColorBuffer()[e.getClippingContextBufferForDraw()._bufferIndex];this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(a.samplerTexture1Location,1),this.gl.uniformMatrix4fv(a.uniformClipMatrixLocation,!1,s._matrixForDraw.getArray());const i=s._layoutChannelNo,r=s.getClippingManager().getChannelFlagAsColor(i);this.gl.uniform4f(a.uniformChannelFlagLocation,r.R,r.G,r.B,r.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(a.samplerTexture0Location,0),this.gl.uniformMatrix4fv(a.uniformMatrixLocation,!1,p.getArray()),this.gl.uniform4f(a.uniformBaseColorLocation,h.R,h.G,h.B,h.A),this.gl.uniform4f(a.uniformMultiplyColorLocation,u.R,u.G,u.B,u.A),this.gl.uniform4f(a.uniformScreenColorLocation,c.R,c.G,c.B,c.A)}null==o.index&&(o.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,o.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(g,m,v,y)}releaseShaderProgram(){for(let e=0;e<this._shaderSets.length;e++)this.gl.deleteProgram(this._shaderSets[e].shaderProgram),this._shaderSets[e].shaderProgram=0;this._shaderSets=[]}generateShaders(){for(let e=0;e<10;e++)this._shaderSets.push({});this._shaderSets[0].shaderProgram=this.loadShaderProgram(It,Rt),this._shaderSets[1].shaderProgram=this.loadShaderProgram(Lt,Dt),this._shaderSets[2].shaderProgram=this.loadShaderProgram(kt,Bt),this._shaderSets[3].shaderProgram=this.loadShaderProgram(kt,Ft),this._shaderSets[4].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[5].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[6].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[7].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[8].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[9].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[0].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,'a_position'),this._shaderSets[0].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,'a_texCoord'),this._shaderSets[0].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,'s_texture0'),this._shaderSets[0].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,'u_clipMatrix'),this._shaderSets[0].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,'u_channelFlag'),this._shaderSets[0].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,'u_baseColor'),this._shaderSets[0].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,'u_multiplyColor'),this._shaderSets[0].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,'u_screenColor'),this._shaderSets[1].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,'a_position'),this._shaderSets[1].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,'a_texCoord'),this._shaderSets[1].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,'s_texture0'),this._shaderSets[1].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,'u_matrix'),this._shaderSets[1].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,'u_baseColor'),this._shaderSets[1].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,'u_multiplyColor'),this._shaderSets[1].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,'u_screenColor'),this._shaderSets[2].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,'a_position'),this._shaderSets[2].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,'a_texCoord'),this._shaderSets[2].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'s_texture0'),this._shaderSets[2].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'s_texture1'),this._shaderSets[2].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'u_matrix'),this._shaderSets[2].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'u_clipMatrix'),this._shaderSets[2].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'u_channelFlag'),this._shaderSets[2].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'u_baseColor'),this._shaderSets[2].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'u_multiplyColor'),this._shaderSets[2].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,'u_screenColor'),this._shaderSets[3].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,'a_position'),this._shaderSets[3].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,'a_texCoord'),this._shaderSets[3].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'s_texture0'),this._shaderSets[3].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'s_texture1'),this._shaderSets[3].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'u_matrix'),this._shaderSets[3].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'u_clipMatrix'),this._shaderSets[3].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'u_channelFlag'),this._shaderSets[3].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'u_baseColor'),this._shaderSets[3].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'u_multiplyColor'),this._shaderSets[3].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,'u_screenColor'),this._shaderSets[4].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,'a_position'),this._shaderSets[4].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,'a_texCoord'),this._shaderSets[4].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,'s_texture0'),this._shaderSets[4].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,'u_matrix'),this._shaderSets[4].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,'u_baseColor'),this._shaderSets[4].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,'u_multiplyColor'),this._shaderSets[4].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,'u_screenColor'),this._shaderSets[5].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,'a_position'),this._shaderSets[5].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,'a_texCoord'),this._shaderSets[5].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'s_texture0'),this._shaderSets[5].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'s_texture1'),this._shaderSets[5].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'u_matrix'),this._shaderSets[5].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'u_clipMatrix'),this._shaderSets[5].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'u_channelFlag'),this._shaderSets[5].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'u_baseColor'),this._shaderSets[5].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'u_multiplyColor'),this._shaderSets[5].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,'u_screenColor'),this._shaderSets[6].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,'a_position'),this._shaderSets[6].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,'a_texCoord'),this._shaderSets[6].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'s_texture0'),this._shaderSets[6].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'s_texture1'),this._shaderSets[6].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'u_matrix'),this._shaderSets[6].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'u_clipMatrix'),this._shaderSets[6].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'u_channelFlag'),this._shaderSets[6].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'u_baseColor'),this._shaderSets[6].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'u_multiplyColor'),this._shaderSets[6].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,'u_screenColor'),this._shaderSets[7].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,'a_position'),this._shaderSets[7].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,'a_texCoord'),this._shaderSets[7].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,'s_texture0'),this._shaderSets[7].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,'u_matrix'),this._shaderSets[7].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,'u_baseColor'),this._shaderSets[7].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,'u_multiplyColor'),this._shaderSets[7].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,'u_screenColor'),this._shaderSets[8].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,'a_position'),this._shaderSets[8].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,'a_texCoord'),this._shaderSets[8].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'s_texture0'),this._shaderSets[8].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'s_texture1'),this._shaderSets[8].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'u_matrix'),this._shaderSets[8].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'u_clipMatrix'),this._shaderSets[8].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'u_channelFlag'),this._shaderSets[8].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'u_baseColor'),this._shaderSets[8].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'u_multiplyColor'),this._shaderSets[8].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,'u_screenColor'),this._shaderSets[9].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,'a_position'),this._shaderSets[9].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,'a_texCoord'),this._shaderSets[9].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'s_texture0'),this._shaderSets[9].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'s_texture1'),this._shaderSets[9].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'u_matrix'),this._shaderSets[9].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'u_clipMatrix'),this._shaderSets[9].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'u_channelFlag'),this._shaderSets[9].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'u_baseColor'),this._shaderSets[9].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'u_multiplyColor'),this._shaderSets[9].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,'u_screenColor')}loadShaderProgram(e,t){const s=this.gl.createProgram(),i=this.compileShaderSource(this.gl.VERTEX_SHADER,e);if(!i)return $e('Vertex shader compile error!'),0;const r=this.compileShaderSource(this.gl.FRAGMENT_SHADER,t);if(!r)return $e('Vertex shader compile error!'),0;this.gl.attachShader(s,i),this.gl.attachShader(s,r),this.gl.linkProgram(s);return this.gl.getProgramParameter(s,this.gl.LINK_STATUS)?(this.gl.deleteShader(i),this.gl.deleteShader(r),s):($e('Failed to link program: {0}',s),this.gl.deleteShader(i),this.gl.deleteShader(r),s&&this.gl.deleteProgram(s),0)}compileShaderSource(e,t){const s=t,i=this.gl.createShader(e);if(this.gl.shaderSource(i,s),this.gl.compileShader(i),!i){$e('Shader compile log: {0} ',this.gl.getShaderInfoLog(i))}return this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(this.gl.deleteShader(i),null)}setGl(e){this.gl=e}}const It='attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}',Rt='precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}',Lt='attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}',kt='attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}',Dt='precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}',Bt='precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}',Ft='precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}';class Ot extends Ie{constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new Mt,this.firstDraw=!0,this._textures={},this._sortedDrawableIndexList=[],this._bufferData={vertex:null,uv:null,index:null}}initialize(e,t=1){e.isUsingMasking()&&(this._clippingManager=new Ct,this._clippingManager.initialize(e,e.getDrawableCount(),e.getDrawableMasks(),e.getDrawableMaskCounts(),t));for(let t=e.getDrawableCount()-1;t>=0;t--)this._sortedDrawableIndexList[t]=0;super.initialize(e)}bindTexture(e,t){this._textures[e]=t}getBindedTextures(){return this._textures}setClippingMaskBufferSize(e){if(!this._model.isUsingMasking())return;const t=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=new Ct,this._clippingManager.setClippingMaskBufferSize(e),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts(),t)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}release(){var e,t,s;const i=this;this._clippingManager.release(),i._clippingManager=void 0,null==(e=this.gl)||e.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,null==(t=this.gl)||t.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,null==(s=this.gl)||s.deleteBuffer(this._bufferData.index),this._bufferData.index=null,i._bufferData=void 0,i._textures=void 0}doDrawModel(){if(null==this.gl)return void $e('\'gl\' is null. WebGLRenderingContext is required.\nPlease call \'CubimRenderer_WebGL.startUp\' function.');null!=this._clippingManager&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const e=this.getModel().getDrawableCount(),t=this.getModel().getDrawableRenderOrders();for(let s=0;s<e;++s){const e=t[s];this._sortedDrawableIndexList[e]=s}for(let t=0;t<e;++t){const e=this._sortedDrawableIndexList[t];if(!this.getModel().getDrawableDynamicFlagIsVisible(e))continue;const s=null!=this._clippingManager?this._clippingManager.getClippingContextListForDraw()[e]:null;if(null!=s&&this.isUsingHighPrecisionMask()){s._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,s.getClippingManager().getMaskRenderTexture()[s._bufferIndex]),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const e=s._clippingIdCount;for(let t=0;t<e;t++){const e=s._clippingIdList[t];this._model.getDrawableDynamicFlagVertexPositionsDidChange(e)&&(this.setIsCulling(0!=this._model.getDrawableCulling(e)),this.setClippingContextBufferForMask(s),this.drawMesh(this.getModel().getDrawableTextureIndex(e),this.getModel().getDrawableVertexIndexCount(e),this.getModel().getDrawableVertexCount(e),this.getModel().getDrawableVertexIndices(e),this.getModel().getDrawableVertices(e),this.getModel().getDrawableVertexUvs(e),this.getModel().getMultiplyColor(e),this.getModel().getScreenColor(e),this.getModel().getDrawableOpacity(e),Re.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Et),this.setClippingContextBufferForMask(null),this.gl.viewport(wt[0],wt[1],wt[2],wt[3]),this.preDraw()}this.setClippingContextBufferForDraw(s),this.setIsCulling(this.getModel().getDrawableCulling(e)),this.drawMesh(this.getModel().getDrawableTextureIndex(e),this.getModel().getDrawableVertexIndexCount(e),this.getModel().getDrawableVertexCount(e),this.getModel().getDrawableVertexIndices(e),this.getModel().getDrawableVertices(e),this.getModel().getDrawableVertexUvs(e),this.getModel().getMultiplyColor(e),this.getModel().getScreenColor(e),this.getModel().getDrawableOpacity(e),this.getModel().getDrawableBlendMode(e),this.getModel().getDrawableInvertedMaskBit(e))}}drawMesh(e,t,s,i,r,n,o,a,l,h,u){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const c=this.getModelColor();null==this.getClippingContextBufferForMask()&&(c.A*=l,this.isPremultipliedAlpha()&&(c.R*=c.A,c.G*=c.A,c.B*=c.A));let d=null;null!=this._textures[e]&&(d=this._textures[e]),Pt.getInstance().setupShaderProgram(this,d,s,r,i,n,this._bufferData,l,h,c,o,a,this.isPremultipliedAlpha(),this.getMvpMatrix(),u),this.gl.drawElements(this.gl.TRIANGLES,t,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){Pt.deleteInstance()}setRenderState(e,t){Et=e,wt=t}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(const e of Object.entries(this._textures))this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(e){this._clippingContextBufferForMask=e}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(e){this._clippingContextBufferForDraw=e}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(e){this.gl=e,this._clippingManager&&this._clippingManager.setGL(e),Pt.getInstance().setGl(e),this._rendererProfile.setGl(e),this._extension=this.gl.getExtension('EXT_texture_filter_anisotropic')||this.gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic')||this.gl.getExtension('MOZ_EXT_texture_filter_anisotropic')}}Ie.staticRelease=()=>{Ot.doStaticRelease()};const Nt=new Pe;class Ut extends F{constructor(e,t,s){super(),a(this,'settings'),a(this,'coreModel'),a(this,'motionManager'),a(this,'lipSync',!0),a(this,'breath',_t.create()),a(this,'eyeBlink'),a(this,'userData'),a(this,'renderer',new Ot),a(this,'idParamAngleX','ParamAngleX'),a(this,'idParamAngleY','ParamAngleY'),a(this,'idParamAngleZ','ParamAngleZ'),a(this,'idParamEyeBallX','ParamEyeBallX'),a(this,'idParamEyeBallY','ParamEyeBallY'),a(this,'idParamBodyAngleX','ParamBodyAngleX'),a(this,'idParamBreath','ParamBreath'),a(this,'pixelsPerUnit',1),a(this,'centeringTransform',new i.uq),this.coreModel=e,this.settings=t,this.motionManager=new mt(t,s),this.init()}init(){var e;super.init(),(null==(e=this.settings.getEyeBlinkParameters())?void 0:e.length)&&(this.eyeBlink=xt.create(this.settings)),this.breath.setParameters([new vt(this.idParamAngleX,0,15,6.5345,.5),new vt(this.idParamAngleY,0,8,3.5345,.5),new vt(this.idParamAngleZ,0,10,5.5345,.5),new vt(this.idParamBodyAngleX,0,4,15.5345,.5),new vt(this.idParamBreath,0,.5,3.2345,.5)]),this.renderer.initialize(this.coreModel),this.renderer.setIsPremultipliedAlpha(!0)}getSize(){return[this.coreModel.getModel().canvasinfo.CanvasWidth,this.coreModel.getModel().canvasinfo.CanvasHeight]}getLayout(){const e={};if(this.settings.layout)for(const[t,s]of Object.entries(this.settings.layout)){e[t.charAt(0).toLowerCase()+t.slice(1)]=s}return e}setupLayout(){super.setupLayout(),this.pixelsPerUnit=this.coreModel.getModel().canvasinfo.PixelsPerUnit,this.centeringTransform.scale(this.pixelsPerUnit,this.pixelsPerUnit).translate(this.originalWidth/2,this.originalHeight/2)}updateWebGLContext(e,t){this.renderer.firstDraw=!0,this.renderer._bufferData={vertex:null,uv:null,index:null},this.renderer.startUp(e),this.renderer._clippingManager._currentFrameNo=t,this.renderer._clippingManager._maskTexture=void 0,Pt.getInstance()._shaderSets=[]}bindTexture(e,t){this.renderer.bindTexture(e,t)}getHitAreaDefs(){var e,t;return null!=(t=null==(e=this.settings.hitAreas)?void 0:e.map(e=>({id:e.Id,name:e.Name,index:this.coreModel.getDrawableIndex(e.Id)})))?t:[]}getDrawableIDs(){return this.coreModel.getDrawableIds()}getDrawableIndex(e){return this.coreModel.getDrawableIndex(e)}getDrawableVertices(e){if('string'==typeof e&&-1===(e=this.coreModel.getDrawableIndex(e)))throw new TypeError('Unable to find drawable ID: '+e);const t=this.coreModel.getDrawableVertices(e).slice();for(let e=0;e<t.length;e+=2)t[e]=t[e]*this.pixelsPerUnit+this.originalWidth/2,t[e+1]=-t[e+1]*this.pixelsPerUnit+this.originalHeight/2;return t}updateTransform(e){this.drawingMatrix.copyFrom(this.centeringTransform).prepend(this.localTransform).prepend(e)}update(e,t){var s,i,r,n;super.update(e,t),e/=1e3,t/=1e3;const o=this.coreModel;this.emit('beforeMotionUpdate');const a=this.motionManager.update(this.coreModel,t);this.emit('afterMotionUpdate'),o.saveParameters(),null==(s=this.motionManager.expressionManager)||s.update(o,t),a||null==(i=this.eyeBlink)||i.updateParameters(o,e),this.updateFocus(),this.updateNaturalMovements(1e3*e,1e3*t),null==(r=this.physics)||r.evaluate(o,e),null==(n=this.pose)||n.updateParameters(o,e),this.emit('beforeModelUpdate'),o.update(),o.loadParameters()}updateFocus(){this.coreModel.addParameterValueById(this.idParamEyeBallX,this.focusController.x),this.coreModel.addParameterValueById(this.idParamEyeBallY,this.focusController.y),this.coreModel.addParameterValueById(this.idParamAngleX,30*this.focusController.x),this.coreModel.addParameterValueById(this.idParamAngleY,30*this.focusController.y),this.coreModel.addParameterValueById(this.idParamAngleZ,this.focusController.x*this.focusController.y*-30),this.coreModel.addParameterValueById(this.idParamBodyAngleX,10*this.focusController.x)}updateNaturalMovements(e,t){var s;null==(s=this.breath)||s.updateParameters(this.coreModel,e/1e3)}draw(e){const t=this.drawingMatrix,s=Nt.getArray();s[0]=t.a,s[1]=t.b,s[4]=-t.c,s[5]=-t.d,s[12]=t.tx,s[13]=t.ty,this.renderer.setMvpMatrix(Nt),this.renderer.setRenderState(e.getParameter(e.FRAMEBUFFER_BINDING),this.viewport),this.renderer.drawModel()}destroy(){super.destroy(),this.renderer.release(),this.coreModel.release(),this.renderer=void 0,this.coreModel=void 0}}class Gt{constructor(e){this.groups=e.Groups,this.hitAreas=e.HitAreas,this.layout=e.Layout,this.moc=e.FileReferences.Moc,this.expressions=e.FileReferences.Expressions,this.motions=e.FileReferences.Motions,this.textures=e.FileReferences.Textures,this.physics=e.FileReferences.Physics,this.pose=e.FileReferences.Pose}getEyeBlinkParameters(){var e,t;return null==(t=null==(e=this.groups)?void 0:e.find(e=>'EyeBlink'===e.Name))?void 0:t.Ids}getLipSyncParameters(){var e,t;return null==(t=null==(e=this.groups)?void 0:e.find(e=>'LipSync'===e.Name))?void 0:t.Ids}}class Vt extends I{constructor(e){if(super(e),a(this,'moc'),a(this,'textures'),!Vt.isValidJSON(e))throw new TypeError('Invalid JSON.');Object.assign(this,new Gt(e))}static isValidJSON(e){var t;return!!(null==e?void 0:e.FileReferences)&&'string'==typeof e.FileReferences.Moc&&(null==(t=e.FileReferences.Textures)?void 0:t.length)>0&&e.FileReferences.Textures.every(e=>'string'==typeof e)}replaceFiles(e){if(super.replaceFiles(e),this.motions)for(const[t,s]of Object.entries(this.motions))for(let i=0;i<s.length;i++)s[i].File=e(s[i].File,`motions.${t}[${i}].File`),void 0!==s[i].Sound&&(s[i].Sound=e(s[i].Sound,`motions.${t}[${i}].Sound`));if(this.expressions)for(let t=0;t<this.expressions.length;t++)this.expressions[t].File=e(this.expressions[t].File,`expressions[${t}].File`)}}var Ht;let Wt;Ht=Vt,[Gt].forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(t=>{'constructor'!==t&&Object.defineProperty(Ht.prototype,t,Object.getOwnPropertyDescriptor(e.prototype,t))})});let $t=20;class Xt{static create(e){const t=new Xt;'number'==typeof e.FadeInTime&&(t._fadeTimeSeconds=e.FadeInTime,t._fadeTimeSeconds<=0&&(t._fadeTimeSeconds=.5));const s=e.Groups,i=s.length;for(let e=0;e<i;++e){const i=s[e],r=i.length;let n=0;for(let e=0;e<r;++e){const s=i[e],r=new jt;r.partId=s.Id;const o=s.Link;if(o){const e=o.length;for(let t=0;t<e;++t){const e=new jt;e.partId=o[t],r.link.push(e)}}t._partGroups.push(r),++n}t._partGroupCounts.push(n)}return t}updateParameters(e,t){e!=this._lastModel&&this.reset(e),this._lastModel=e,t<0&&(t=0);let s=0;for(let i=0;i<this._partGroupCounts.length;i++){const r=this._partGroupCounts[i];this.doFade(e,t,s,r),s+=r}this.copyPartOpacities(e)}reset(e){let t=0;for(let s=0;s<this._partGroupCounts.length;++s){const i=this._partGroupCounts[s];for(let s=t;s<t+i;++s){this._partGroups[s].initialize(e);const i=this._partGroups[s].partIndex,r=this._partGroups[s].parameterIndex;if(!(i<0)){e.setPartOpacityByIndex(i,s==t?1:0),e.setParameterValueByIndex(r,s==t?1:0);for(let t=0;t<this._partGroups[s].link.length;++t)this._partGroups[s].link[t].initialize(e)}}t+=i}}copyPartOpacities(e){for(let t=0;t<this._partGroups.length;++t){const s=this._partGroups[t];if(0==s.link.length)continue;const i=this._partGroups[t].partIndex,r=e.getPartOpacityByIndex(i);for(let t=0;t<s.link.length;++t){const i=s.link[t].partIndex;i<0||e.setPartOpacityByIndex(i,r)}}}doFade(e,t,s,i){let r=-1,n=1;const o=.5;for(let o=s;o<s+i;++o){const s=this._partGroups[o].partIndex,i=this._partGroups[o].parameterIndex;if(e.getParameterValueByIndex(i)>.001){if(r>=0)break;r=o,n=e.getPartOpacityByIndex(s),n+=t/this._fadeTimeSeconds,n>1&&(n=1)}}r<0&&(r=0,n=1);for(let t=s;t<s+i;++t){const s=this._partGroups[t].partIndex;if(r==t)e.setPartOpacityByIndex(s,n);else{let t,i=e.getPartOpacityByIndex(s);t=n<o?-.5*n/o+1:(1-n)*o/.5;(1-t)*(1-n)>.15&&(t=1-.15/(1-n)),i>t&&(i=t),e.setPartOpacityByIndex(s,i)}}}constructor(){this._fadeTimeSeconds=.5,this._lastModel=void 0,this._partGroups=[],this._partGroupCounts=[]}}class jt{constructor(e){this.parameterIndex=0,this.partIndex=0,this.partId='',this.link=[],null!=e&&this.assignment(e)}assignment(e){return this.partId=e.partId,this.link=e.link.map(e=>e.clone()),this}initialize(e){this.parameterIndex=e.getParameterIndex(this.partId),this.partIndex=e.getPartIndex(this.partId),e.setParameterValueByIndex(this.parameterIndex,1)}clone(){const e=new jt;return e.partId=this.partId,e.parameterIndex=this.parameterIndex,e.partIndex=this.partIndex,e.link=this.link.map(e=>e.clone()),e}}class zt{constructor(e=!1,t=new Le){this.isOverwritten=e,this.Color=t}}class Yt{constructor(e=!1,t=new Le){this.isOverwritten=e,this.Color=t}}class qt{constructor(e=!1,t=!1){this.isOverwritten=e,this.isCulling=t}}class Qt{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return null==this._model?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return null==this._model?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return null==this._model?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const e=this._model.parameters.count,t=this._savedParameters.length;for(let s=0;s<e;++s)s<t?this._savedParameters[s]=this._parameterValues[s]:this._savedParameters.push(this._parameterValues[s])}getMultiplyColor(e){if(this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(e))return this._userMultiplyColors[e].Color;return this.getDrawableMultiplyColor(e)}getScreenColor(e){if(this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(e))return this._userScreenColors[e].Color;return this.getDrawableScreenColor(e)}setMultiplyColorByTextureColor(e,t){this.setMultiplyColorByRGBA(e,t.R,t.G,t.B,t.A)}setMultiplyColorByRGBA(e,t,s,i,r=1){this._userMultiplyColors[e].Color.R=t,this._userMultiplyColors[e].Color.G=s,this._userMultiplyColors[e].Color.B=i,this._userMultiplyColors[e].Color.A=r}setScreenColorByTextureColor(e,t){this.setScreenColorByRGBA(e,t.R,t.G,t.B,t.A)}setScreenColorByRGBA(e,t,s,i,r=1){this._userScreenColors[e].Color.R=t,this._userScreenColors[e].Color.G=s,this._userScreenColors[e].Color.B=i,this._userScreenColors[e].Color.A=r}getPartMultiplyColor(e){return this._userPartMultiplyColors[e].Color}getPartScreenColor(e){return this._userPartScreenColors[e].Color}setPartColor(e,t,s,i,r,n,o){if(n[e].Color.R=t,n[e].Color.G=s,n[e].Color.B=i,n[e].Color.A=r,n[e].isOverwritten)for(let n=0;n<this._partChildDrawables[e].length;++n){const a=this._partChildDrawables[e][n];o[a].Color.R=t,o[a].Color.G=s,o[a].Color.B=i,o[a].Color.A=r}}setPartMultiplyColorByTextureColor(e,t){this.setPartMultiplyColorByRGBA(e,t.R,t.G,t.B,t.A)}setPartMultiplyColorByRGBA(e,t,s,i,r){this.setPartColor(e,t,s,i,r,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(e,t){this.setPartScreenColorByRGBA(e,t.R,t.G,t.B,t.A)}setPartScreenColorByRGBA(e,t,s,i,r){this.setPartColor(e,t,s,i,r,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(e){this._isOverwrittenModelMultiplyColors=e}setOverwriteFlagForModelScreenColors(e){this._isOverwrittenModelScreenColors=e}getOverwriteFlagForDrawableMultiplyColors(e){return this._userMultiplyColors[e].isOverwritten}getOverwriteFlagForDrawableScreenColors(e){return this._userScreenColors[e].isOverwritten}setOverwriteFlagForDrawableMultiplyColors(e,t){this._userMultiplyColors[e].isOverwritten=t}setOverwriteFlagForDrawableScreenColors(e,t){this._userScreenColors[e].isOverwritten=t}getOverwriteColorForPartMultiplyColors(e){return this._userPartMultiplyColors[e].isOverwritten}getOverwriteColorForPartScreenColors(e){return this._userPartScreenColors[e].isOverwritten}setOverwriteColorForPartColors(e,t,s,i){s[e].isOverwritten=t;for(let r=0;r<this._partChildDrawables[e].length;++r){const n=this._partChildDrawables[e][r];i[n].isOverwritten=t,t&&(i[n].Color.R=s[e].Color.R,i[n].Color.G=s[e].Color.G,i[n].Color.B=s[e].Color.B,i[n].Color.A=s[e].Color.A)}}setOverwriteColorForPartMultiplyColors(e,t){this._userPartMultiplyColors[e].isOverwritten=t,this.setOverwriteColorForPartColors(e,t,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(e,t){this._userPartScreenColors[e].isOverwritten=t,this.setOverwriteColorForPartColors(e,t,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(e){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(e))return this._userCullings[e].isCulling;const t=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(t[e])}setDrawableCulling(e,t){this._userCullings[e].isCulling=t}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(e){this._isOverwrittenCullings=e}getOverwriteFlagForDrawableCullings(e){return this._userCullings[e].isOverwritten}setOverwriteFlagForDrawableCullings(e,t){this._userCullings[e].isOverwritten=t}getModelOapcity(){return this._modelOpacity}setModelOapcity(e){this._modelOpacity=e}getModel(){return this._model}getPartIndex(e){let t;const s=this._model.parts.count;for(t=0;t<s;++t)if(e==this._partIds[t])return t;return e in this._notExistPartId?this._notExistPartId[e]:(t=s+this._notExistPartId.length,this._notExistPartId[e]=t,this._notExistPartOpacities[t]=0,t)}getPartId(e){return this._model.parts.ids[e]}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(e,t){e in this._notExistPartOpacities?this._notExistPartOpacities[e]=t:(Ge(0<=e&&e<this.getPartCount()),this._partOpacities[e]=t)}setPartOpacityById(e,t){const s=this.getPartIndex(e);s<0||this.setPartOpacityByIndex(s,t)}getPartOpacityByIndex(e){return e in this._notExistPartOpacities?this._notExistPartOpacities[e]:(Ge(0<=e&&e<this.getPartCount()),this._partOpacities[e])}getPartOpacityById(e){const t=this.getPartIndex(e);return t<0?0:this.getPartOpacityByIndex(t)}getParameterIndex(e){let t;const s=this._model.parameters.count;for(t=0;t<s;++t)if(e==this._parameterIds[t])return t;return e in this._notExistParameterId?this._notExistParameterId[e]:(t=this._model.parameters.count+Object.keys(this._notExistParameterId).length,this._notExistParameterId[e]=t,this._notExistParameterValues[t]=0,t)}getParameterCount(){return this._model.parameters.count}getParameterType(e){return this._model.parameters.types[e]}getParameterMaximumValue(e){return this._model.parameters.maximumValues[e]}getParameterMinimumValue(e){return this._model.parameters.minimumValues[e]}getParameterDefaultValue(e){return this._model.parameters.defaultValues[e]}getParameterValueByIndex(e){return e in this._notExistParameterValues?this._notExistParameterValues[e]:(Ge(0<=e&&e<this.getParameterCount()),this._parameterValues[e])}getParameterValueById(e){const t=this.getParameterIndex(e);return this.getParameterValueByIndex(t)}setParameterValueByIndex(e,t,s=1){e in this._notExistParameterValues?this._notExistParameterValues[e]=1==s?t:this._notExistParameterValues[e]*(1-s)+t*s:(Ge(0<=e&&e<this.getParameterCount()),this._model.parameters.maximumValues[e]<t&&(t=this._model.parameters.maximumValues[e]),this._model.parameters.minimumValues[e]>t&&(t=this._model.parameters.minimumValues[e]),this._parameterValues[e]=1==s?t:this._parameterValues[e]=this._parameterValues[e]*(1-s)+t*s)}setParameterValueById(e,t,s=1){const i=this.getParameterIndex(e);this.setParameterValueByIndex(i,t,s)}addParameterValueByIndex(e,t,s=1){this.setParameterValueByIndex(e,this.getParameterValueByIndex(e)+t*s)}addParameterValueById(e,t,s=1){const i=this.getParameterIndex(e);this.addParameterValueByIndex(i,t,s)}multiplyParameterValueById(e,t,s=1){const i=this.getParameterIndex(e);this.multiplyParameterValueByIndex(i,t,s)}multiplyParameterValueByIndex(e,t,s=1){this.setParameterValueByIndex(e,this.getParameterValueByIndex(e)*(1+(t-1)*s))}getDrawableIds(){return this._drawableIds.slice()}getDrawableIndex(e){const t=this._model.drawables.count;for(let s=0;s<t;++s)if(this._drawableIds[s]==e)return s;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(e){return this._model.drawables.ids[e]}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(e){return this.getDrawableTextureIndex(e)}getDrawableTextureIndex(e){return this._model.drawables.textureIndices[e]}getDrawableDynamicFlagVertexPositionsDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(t[e])}getDrawableVertexIndexCount(e){return this._model.drawables.indexCounts[e]}getDrawableVertexCount(e){return this._model.drawables.vertexCounts[e]}getDrawableVertices(e){return this.getDrawableVertexPositions(e)}getDrawableVertexIndices(e){return this._model.drawables.indices[e]}getDrawableVertexPositions(e){return this._model.drawables.vertexPositions[e]}getDrawableVertexUvs(e){return this._model.drawables.vertexUvs[e]}getDrawableOpacity(e){return this._model.drawables.opacities[e]}getDrawableMultiplyColor(e){const t=this._model.drawables.multiplyColors,s=4*e,i=new Le;return i.R=t[s],i.G=t[s+1],i.B=t[s+2],i.A=t[s+3],i}getDrawableScreenColor(e){const t=this._model.drawables.screenColors,s=4*e,i=new Le;return i.R=t[s],i.G=t[s+1],i.B=t[s+2],i.A=t[s+3],i}getDrawableParentPartIndex(e){return this._model.drawables.parentPartIndices[e]}getDrawableBlendMode(e){const t=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(t[e])?Re.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(t[e])?Re.CubismBlendMode_Multiplicative:Re.CubismBlendMode_Normal}getDrawableInvertedMaskBit(e){const t=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(t[e])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let e=0;e<this._model.drawables.count;++e)if(!(this._model.drawables.maskCounts[e]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(t[e])}getDrawableDynamicFlagVisibilityDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(t[e])}getDrawableDynamicFlagOpacityDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(t[e])}getDrawableDynamicFlagRenderOrderDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(t[e])}getDrawableDynamicFlagBlendColorDidChange(e){const t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(t[e])}loadParameters(){let e=this._model.parameters.count;const t=this._savedParameters.length;e>t&&(e=t);for(let t=0;t<e;++t)this._parameterValues[t]=this._savedParameters[t]}initialize(){this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const e=this._model.parameters.ids,t=this._model.parameters.count;for(let s=0;s<t;++s)this._parameterIds.push(e[s])}const e=this._model.parts.count;{const t=this._model.parts.ids;for(let s=0;s<e;++s)this._partIds.push(t[s])}{const t=this._model.drawables.ids,s=this._model.drawables.count,i=new qt(!1,!1);for(let t=0;t<e;++t){const e=new Le(1,1,1,1),t=new Le(0,0,0,1),s=new Yt(!1,e),i=new Yt(!1,t);this._userPartMultiplyColors.push(s),this._userPartScreenColors.push(i),this._partChildDrawables.push([])}for(let e=0;e<s;++e){const s=new Le(1,1,1,1),r=new Le(0,0,0,1),n=new zt(!1,s),o=new zt(!1,r);this._drawableIds.push(t[e]),this._userMultiplyColors.push(n),this._userScreenColors.push(o),this._userCullings.push(i);const a=this.getDrawableParentPartIndex(e);a>=0&&this._partChildDrawables[a].push(e)}}}constructor(e){this._model=e,this._savedParameters=[],this._parameterIds=[],this._drawableIds=[],this._partIds=[],this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=[],this._userScreenColors=[],this._userCullings=[],this._userPartMultiplyColors=[],this._userPartScreenColors=[],this._partChildDrawables=[],this._notExistPartId={},this._notExistParameterId={},this._notExistParameterValues={},this._notExistPartOpacities={},this.initialize()}release(){this._model.release(),this._model=void 0}}class Kt{static create(e,t){if(t){if(!this.hasMocConsistency(e))throw new Error('Inconsistent MOC3.')}const s=Live2DCubismCore.Moc.fromArrayBuffer(e);if(s){const t=new Kt(s);return t._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(s,e),t}throw new Error('Failed to CubismMoc.create().')}createModel(){let e;const t=Live2DCubismCore.Model.fromMoc(this._moc);if(t)return e=new Qt(t),++this._modelCount,e;throw new Error('Unknown error')}deleteModel(e){null!=e&&--this._modelCount}constructor(e){this._moc=e,this._modelCount=0,this._mocVersion=0}release(){this._moc._release(),this._moc=void 0}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(e){return 1===Live2DCubismCore.Moc.prototype.hasMocConsistency(e)}}var Zt=(e=>(e[e.CubismPhysicsTargetType_Parameter=0]='CubismPhysicsTargetType_Parameter',e))(Zt||{}),Jt=(e=>(e[e.CubismPhysicsSource_X=0]='CubismPhysicsSource_X',e[e.CubismPhysicsSource_Y=1]='CubismPhysicsSource_Y',e[e.CubismPhysicsSource_Angle=2]='CubismPhysicsSource_Angle',e))(Jt||{});class es{constructor(){this.initialPosition=new Se(0,0),this.position=new Se(0,0),this.lastPosition=new Se(0,0),this.lastGravity=new Se(0,0),this.force=new Se(0,0),this.velocity=new Se(0,0)}}class ts{constructor(){this.normalizationPosition={},this.normalizationAngle={}}}class ss{constructor(){this.source={}}}class is{constructor(){this.destination={},this.translationScale=new Se(0,0)}}class rs{constructor(){this.settings=[],this.inputs=[],this.outputs=[],this.particles=[],this.gravity=new Se(0,0),this.wind=new Se(0,0),this.fps=0}}class ns{constructor(e){this._json=e}release(){this._json=void 0}getGravity(){const e=new Se(0,0);return e.x=this._json.Meta.EffectiveForces.Gravity.X,e.y=this._json.Meta.EffectiveForces.Gravity.Y,e}getWind(){const e=new Se(0,0);return e.x=this._json.Meta.EffectiveForces.Wind.X,e.y=this._json.Meta.EffectiveForces.Wind.Y,e}getFps(){return this._json.Meta.Fps||0}getSubRigCount(){return this._json.Meta.PhysicsSettingCount}getTotalInputCount(){return this._json.Meta.TotalInputCount}getTotalOutputCount(){return this._json.Meta.TotalOutputCount}getVertexCount(){return this._json.Meta.VertexCount}getNormalizationPositionMinimumValue(e){return this._json.PhysicsSettings[e].Normalization.Position.Minimum}getNormalizationPositionMaximumValue(e){return this._json.PhysicsSettings[e].Normalization.Position.Maximum}getNormalizationPositionDefaultValue(e){return this._json.PhysicsSettings[e].Normalization.Position.Default}getNormalizationAngleMinimumValue(e){return this._json.PhysicsSettings[e].Normalization.Angle.Minimum}getNormalizationAngleMaximumValue(e){return this._json.PhysicsSettings[e].Normalization.Angle.Maximum}getNormalizationAngleDefaultValue(e){return this._json.PhysicsSettings[e].Normalization.Angle.Default}getInputCount(e){return this._json.PhysicsSettings[e].Input.length}getInputWeight(e,t){return this._json.PhysicsSettings[e].Input[t].Weight}getInputReflect(e,t){return this._json.PhysicsSettings[e].Input[t].Reflect}getInputType(e,t){return this._json.PhysicsSettings[e].Input[t].Type}getInputSourceId(e,t){return this._json.PhysicsSettings[e].Input[t].Source.Id}getOutputCount(e){return this._json.PhysicsSettings[e].Output.length}getOutputVertexIndex(e,t){return this._json.PhysicsSettings[e].Output[t].VertexIndex}getOutputAngleScale(e,t){return this._json.PhysicsSettings[e].Output[t].Scale}getOutputWeight(e,t){return this._json.PhysicsSettings[e].Output[t].Weight}getOutputDestinationId(e,t){return this._json.PhysicsSettings[e].Output[t].Destination.Id}getOutputType(e,t){return this._json.PhysicsSettings[e].Output[t].Type}getOutputReflect(e,t){return this._json.PhysicsSettings[e].Output[t].Reflect}getParticleCount(e){return this._json.PhysicsSettings[e].Vertices.length}getParticleMobility(e,t){return this._json.PhysicsSettings[e].Vertices[t].Mobility}getParticleDelay(e,t){return this._json.PhysicsSettings[e].Vertices[t].Delay}getParticleAcceleration(e,t){return this._json.PhysicsSettings[e].Vertices[t].Acceleration}getParticleRadius(e,t){return this._json.PhysicsSettings[e].Vertices[t].Radius}getParticlePosition(e,t){const s=new Se(0,0);return s.x=this._json.PhysicsSettings[e].Vertices[t].Position.X,s.y=this._json.PhysicsSettings[e].Vertices[t].Position.Y,s}}const os='Angle';class as{static create(e){const t=new as;return t.parse(e),t._physicsRig.gravity.y=0,t}static delete(e){null!=e&&e.release()}parse(e){this._physicsRig=new rs;const t=new ns(e);this._physicsRig.gravity=t.getGravity(),this._physicsRig.wind=t.getWind(),this._physicsRig.subRigCount=t.getSubRigCount(),this._physicsRig.fps=t.getFps(),this._currentRigOutputs=[],this._previousRigOutputs=[];let s=0,i=0,r=0;for(let e=0;e<this._physicsRig.subRigCount;++e){const n=new ts;n.normalizationPosition.minimum=t.getNormalizationPositionMinimumValue(e),n.normalizationPosition.maximum=t.getNormalizationPositionMaximumValue(e),n.normalizationPosition.defalut=t.getNormalizationPositionDefaultValue(e),n.normalizationAngle.minimum=t.getNormalizationAngleMinimumValue(e),n.normalizationAngle.maximum=t.getNormalizationAngleMaximumValue(e),n.normalizationAngle.defalut=t.getNormalizationAngleDefaultValue(e),n.inputCount=t.getInputCount(e),n.baseInputIndex=s,s+=n.inputCount;for(let s=0;s<n.inputCount;++s){const i=new ss;switch(i.sourceParameterIndex=-1,i.weight=t.getInputWeight(e,s),i.reflect=t.getInputReflect(e,s),t.getInputType(e,s)){case'X':i.type=Jt.CubismPhysicsSource_X,i.getNormalizedParameterValue=us;break;case'Y':i.type=Jt.CubismPhysicsSource_Y,i.getNormalizedParameterValue=cs;break;case os:i.type=Jt.CubismPhysicsSource_Angle,i.getNormalizedParameterValue=ds}i.source.targetType=Zt.CubismPhysicsTargetType_Parameter,i.source.id=t.getInputSourceId(e,s),this._physicsRig.inputs.push(i)}n.outputCount=t.getOutputCount(e),n.baseOutputIndex=i;const o=new hs,a=new hs;for(let s=0;s<n.outputCount;++s){o.outputs[s]=0,a.outputs[s]=0;let r=this._physicsRig.outputs[i+s];switch(r||(r=new is,this._physicsRig.outputs[i+s]=r),r.destinationParameterIndex=-1,r.vertexIndex=t.getOutputVertexIndex(e,s),r.angleScale=t.getOutputAngleScale(e,s),r.weight=t.getOutputWeight(e,s),r.destination.targetType=Zt.CubismPhysicsTargetType_Parameter,r.destination.id=t.getOutputDestinationId(e,s),t.getOutputType(e,s)){case'X':r.type=Jt.CubismPhysicsSource_X,r.getValue=ps,r.getScale=_s;break;case'Y':r.type=Jt.CubismPhysicsSource_Y,r.getValue=fs,r.getScale=vs;break;case os:r.type=Jt.CubismPhysicsSource_Angle,r.getValue=gs,r.getScale=ys}r.reflect=t.getOutputReflect(e,s)}this._currentRigOutputs.push(o),this._previousRigOutputs.push(a),i+=n.outputCount,n.particleCount=t.getParticleCount(e),n.baseParticleIndex=r,r+=n.particleCount;for(let s=0;s<n.particleCount;++s){const i=new es;i.mobility=t.getParticleMobility(e,s),i.delay=t.getParticleDelay(e,s),i.acceleration=t.getParticleAcceleration(e,s),i.radius=t.getParticleRadius(e,s),i.position=t.getParticlePosition(e,s),this._physicsRig.particles.push(i)}this._physicsRig.settings.push(n)}this.initialize(),t.release()}stabilization(e){var t,s,i,r;let n,o,a,l;const h=new Se;let u,c,d,p,f,g,m,v;f=e.getModel().parameters.values,g=e.getModel().parameters.maximumValues,m=e.getModel().parameters.minimumValues,v=e.getModel().parameters.defaultValues,(null!=(s=null==(t=this._parameterCaches)?void 0:t.length)?s:0)<e.getParameterCount()&&(this._parameterCaches=new Float32Array(e.getParameterCount())),(null!=(r=null==(i=this._parameterInputCaches)?void 0:i.length)?r:0)<e.getParameterCount()&&(this._parameterInputCaches=new Float32Array(e.getParameterCount()));for(let t=0;t<e.getParameterCount();++t)this._parameterCaches[t]=f[t],this._parameterInputCaches[t]=f[t];for(let t=0;t<this._physicsRig.subRigCount;++t){n={angle:0},h.x=0,h.y=0,u=this._physicsRig.settings[t],c=this._physicsRig.inputs.slice(u.baseInputIndex),d=this._physicsRig.outputs.slice(u.baseOutputIndex),p=this._physicsRig.particles.slice(u.baseParticleIndex);for(let t=0;t<u.inputCount;++t)o=c[t].weight/100,-1==c[t].sourceParameterIndex&&(c[t].sourceParameterIndex=e.getParameterIndex(c[t].source.id)),c[t].getNormalizedParameterValue(h,n,f[c[t].sourceParameterIndex],m[c[t].sourceParameterIndex],g[c[t].sourceParameterIndex],v[c[t].sourceParameterIndex],u.normalizationPosition,u.normalizationAngle,c[t].reflect,o),this._parameterCaches[c[t].sourceParameterIndex]=f[c[t].sourceParameterIndex];a=Me.degreesToRadian(-n.angle),h.x=h.x*Me.cos(a)-h.y*Me.sin(a),h.y=h.x*Me.sin(a)+h.y*Me.cos(a),bs(p,u.particleCount,h,n.angle,this._options.wind,.001*u.normalizationPosition.maximum);for(let s=0;s<u.outputCount;++s){const i=d[s].vertexIndex;if(-1==d[s].destinationParameterIndex&&(d[s].destinationParameterIndex=e.getParameterIndex(d[s].destination.id)),i<1||i>=u.particleCount)continue;let r=new Se;r=p[i].position.substract(p[i-1].position),l=d[s].getValue(r,p,i,d[s].reflect,this._options.gravity),this._currentRigOutputs[t].outputs[s]=l,this._previousRigOutputs[t].outputs[s]=l;const n=d[s].destinationParameterIndex,o=!Float32Array.prototype.slice&&'subarray'in Float32Array.prototype?JSON.parse(JSON.stringify(f.subarray(n))):f.slice(n);Ts(o,m[n],g[n],l,d[s]);for(let e=n,t=0;e<this._parameterCaches.length;e++,t++)f[e]=this._parameterCaches[e]=o[t]}}}evaluate(e,t){var s,i,r,n;let o,a,l,h;const u=new Se;let c,d,p,f,g,m,v,y,x;if(0>=t)return;if(this._currentRemainTime+=t,this._currentRemainTime>5&&(this._currentRemainTime=0),g=e.getModel().parameters.values,m=e.getModel().parameters.maximumValues,v=e.getModel().parameters.minimumValues,y=e.getModel().parameters.defaultValues,(null!=(i=null==(s=this._parameterCaches)?void 0:s.length)?i:0)<e.getParameterCount()&&(this._parameterCaches=new Float32Array(e.getParameterCount())),(null!=(n=null==(r=this._parameterInputCaches)?void 0:r.length)?n:0)<e.getParameterCount()){this._parameterInputCaches=new Float32Array(e.getParameterCount());for(let t=0;t<e.getParameterCount();++t)this._parameterInputCaches[t]=g[t]}for(x=this._physicsRig.fps>0?1/this._physicsRig.fps:t;this._currentRemainTime>=x;){for(let e=0;e<this._physicsRig.subRigCount;++e){c=this._physicsRig.settings[e],p=this._physicsRig.outputs.slice(c.baseOutputIndex);for(let t=0;t<c.outputCount;++t)this._previousRigOutputs[e].outputs[t]=this._currentRigOutputs[e].outputs[t]}const t=x/this._currentRemainTime;for(let s=0;s<e.getParameterCount();++s)this._parameterCaches[s]=this._parameterInputCaches[s]*(1-t)+g[s]*t,this._parameterInputCaches[s]=this._parameterCaches[s];for(let t=0;t<this._physicsRig.subRigCount;++t){o={angle:0},u.x=0,u.y=0,c=this._physicsRig.settings[t],d=this._physicsRig.inputs.slice(c.baseInputIndex),p=this._physicsRig.outputs.slice(c.baseOutputIndex),f=this._physicsRig.particles.slice(c.baseParticleIndex);for(let t=0;t<c.inputCount;++t)a=d[t].weight/100,-1==d[t].sourceParameterIndex&&(d[t].sourceParameterIndex=e.getParameterIndex(d[t].source.id)),d[t].getNormalizedParameterValue(u,o,this._parameterCaches[d[t].sourceParameterIndex],v[d[t].sourceParameterIndex],m[d[t].sourceParameterIndex],y[d[t].sourceParameterIndex],c.normalizationPosition,c.normalizationAngle,d[t].reflect,a);l=Me.degreesToRadian(-o.angle),u.x=u.x*Me.cos(l)-u.y*Me.sin(l),u.y=u.x*Me.sin(l)+u.y*Me.cos(l),xs(f,c.particleCount,u,o.angle,this._options.wind,.001*c.normalizationPosition.maximum,x,5);for(let s=0;s<c.outputCount;++s){const i=p[s].vertexIndex;if(-1==p[s].destinationParameterIndex&&(p[s].destinationParameterIndex=e.getParameterIndex(p[s].destination.id)),i<1||i>=c.particleCount)continue;const r=new Se;r.x=f[i].position.x-f[i-1].position.x,r.y=f[i].position.y-f[i-1].position.y,h=p[s].getValue(r,f,i,p[s].reflect,this._options.gravity),this._currentRigOutputs[t].outputs[s]=h;const n=p[s].destinationParameterIndex,o=!Float32Array.prototype.slice&&'subarray'in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(n))):this._parameterCaches.slice(n);Ts(o,v[n],m[n],h,p[s]);for(let e=n,t=0;e<this._parameterCaches.length;e++,t++)this._parameterCaches[e]=o[t]}}this._currentRemainTime-=x}const b=this._currentRemainTime/x;this.interpolate(e,b)}interpolate(e,t){let s,i,r,n,o;r=e.getModel().parameters.values,n=e.getModel().parameters.maximumValues,o=e.getModel().parameters.minimumValues;for(let e=0;e<this._physicsRig.subRigCount;++e){i=this._physicsRig.settings[e],s=this._physicsRig.outputs.slice(i.baseOutputIndex);for(let a=0;a<i.outputCount;++a){if(-1==s[a].destinationParameterIndex)continue;const i=s[a].destinationParameterIndex,l=!Float32Array.prototype.slice&&'subarray'in Float32Array.prototype?JSON.parse(JSON.stringify(r.subarray(i))):r.slice(i);Ts(l,o[i],n[i],this._previousRigOutputs[e].outputs[a]*(1-t)+this._currentRigOutputs[e].outputs[a]*t,s[a]);for(let e=i,t=0;e<r.length;e++,t++)r[e]=l[t]}}}setOptions(e){this._options=e}getOption(){return this._options}constructor(){this._options=new ls,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=[],this._previousRigOutputs=[],this._currentRemainTime=0}release(){this._physicsRig=void 0}initialize(){let e,t,s;for(let i=0;i<this._physicsRig.subRigCount;++i){t=this._physicsRig.settings[i],e=this._physicsRig.particles.slice(t.baseParticleIndex),e[0].initialPosition=new Se(0,0),e[0].lastPosition=new Se(e[0].initialPosition.x,e[0].initialPosition.y),e[0].lastGravity=new Se(0,-1),e[0].lastGravity.y*=-1,e[0].velocity=new Se(0,0),e[0].force=new Se(0,0);for(let i=1;i<t.particleCount;++i)s=new Se(0,0),s.y=e[i].radius,e[i].initialPosition=new Se(e[i-1].initialPosition.x+s.x,e[i-1].initialPosition.y+s.y),e[i].position=new Se(e[i].initialPosition.x,e[i].initialPosition.y),e[i].lastPosition=new Se(e[i].initialPosition.x,e[i].initialPosition.y),e[i].lastGravity=new Se(0,-1),e[i].lastGravity.y*=-1,e[i].velocity=new Se(0,0),e[i].force=new Se(0,0)}}}class ls{constructor(){this.gravity=new Se(0,0),this.wind=new Se(0,0)}}class hs{constructor(){this.outputs=[]}}function us(e,t,s,i,r,n,o,a,l,h){e.x+=ws(s,i,r,n,o.minimum,o.maximum,o.defalut,l)*h}function cs(e,t,s,i,r,n,o,a,l,h){e.y+=ws(s,i,r,n,o.minimum,o.maximum,o.defalut,l)*h}function ds(e,t,s,i,r,n,o,a,l,h){t.angle+=ws(s,i,r,n,a.minimum,a.maximum,a.defalut,l)*h}function ps(e,t,s,i,r){let n=e.x;return i&&(n*=-1),n}function fs(e,t,s,i,r){let n=e.y;return i&&(n*=-1),n}function gs(e,t,s,i,r){let n;return r=s>=2?t[s-1].position.substract(t[s-2].position):r.multiplyByScaler(-1),n=Me.directionToRadian(r,e),i&&(n*=-1),n}function ms(e,t){return Math.min(e,t)+function(e,t){return Math.abs(Math.max(e,t)-Math.min(e,t))}(e,t)/2}function _s(e,t){return e.x}function vs(e,t){return e.y}function ys(e,t){return t}function xs(e,t,s,i,r,n,o,a){let l,h,u,c,d=new Se(0,0),p=new Se(0,0),f=new Se(0,0),g=new Se(0,0);e[0].position=new Se(s.x,s.y),l=Me.degreesToRadian(i),c=Me.radianToDirection(l),c.normalize();for(let s=1;s<t;++s)e[s].force=c.multiplyByScaler(e[s].acceleration).add(r),e[s].lastPosition=new Se(e[s].position.x,e[s].position.y),h=e[s].delay*o*30,d=e[s].position.substract(e[s-1].position),u=Me.directionToRadian(e[s].lastGravity,c)/a,d.x=Me.cos(u)*d.x-d.y*Me.sin(u),d.y=Me.sin(u)*d.x+d.y*Me.cos(u),e[s].position=e[s-1].position.add(d),p=e[s].velocity.multiplyByScaler(h),f=e[s].force.multiplyByScaler(h).multiplyByScaler(h),e[s].position=e[s].position.add(p).add(f),g=e[s].position.substract(e[s-1].position),g.normalize(),e[s].position=e[s-1].position.add(g.multiplyByScaler(e[s].radius)),Me.abs(e[s].position.x)<n&&(e[s].position.x=0),0!=h&&(e[s].velocity=e[s].position.substract(e[s].lastPosition),e[s].velocity=e[s].velocity.divisionByScalar(h),e[s].velocity=e[s].velocity.multiplyByScaler(e[s].mobility)),e[s].force=new Se(0,0),e[s].lastGravity=new Se(c.x,c.y)}function bs(e,t,s,i,r,n){let o,a,l=new Se(0,0);e[0].position=new Se(s.x,s.y),o=Me.degreesToRadian(i),a=Me.radianToDirection(o),a.normalize();for(let s=1;s<t;++s)e[s].force=a.multiplyByScaler(e[s].acceleration).add(r),e[s].lastPosition=new Se(e[s].position.x,e[s].position.y),e[s].velocity=new Se(0,0),l=e[s].force,l.normalize(),l=l.multiplyByScaler(e[s].radius),e[s].position=e[s-1].position.add(l),Me.abs(e[s].position.x)<n&&(e[s].position.x=0),e[s].force=new Se(0,0),e[s].lastGravity=new Se(a.x,a.y)}function Ts(e,t,s,i,r){let n,o,a;n=r.getScale(r.translationScale,r.angleScale),o=i*n,o<t?(o<r.valueBelowMinimum&&(r.valueBelowMinimum=o),o=t):o>s&&(o>r.valueExceededMaximum&&(r.valueExceededMaximum=o),o=s),a=r.weight/100,a>=1||(o=e[0]*(1-a)+o*a),e[0]=o}function ws(e,t,s,i,r,n,o,a){let l=0;const h=Me.max(s,t);h<e&&(e=h);const u=Me.min(s,t);u>e&&(e=u);const c=Me.min(r,n),d=Me.max(r,n),p=o,f=ms(u,h),g=e-f;switch(Math.sign(g)){case 1:{const e=h-f;0!=e&&(l=g*((d-p)/e),l+=p);break}case-1:{const e=u-f;0!=e&&(l=g*((c-p)/e),l+=p);break}case 0:l=p}return a?l:-1*l}function Es(){var e;null==(e=this.__moc)||e.release()}ie.registerRuntime({version:4,ready:function(){return Ne.isStarted()?Promise.resolve():(null!=Wt||(Wt=new Promise((e,t)=>{!function s(){try{i=Object.assign({logFunction:console.log,loggingLevel:Ue.LogLevel_Verbose},i),Ne.startUp(i),Ne.initialize(),e()}catch(e){if($t--,$t<0){const s=new Error('Failed to start up Cubism 4 framework.');return s.cause=e,void t(s)}T.log('Cubism4','Startup failed, retrying 10ms later...'),setTimeout(s,10)}var i}()})),Wt)},test:e=>e instanceof Vt||Vt.isValidJSON(e),isValidMoc(e){if(e.byteLength<4)return!1;const t=new Int8Array(e,0,4);return'MOC3'===String.fromCharCode(...t)},createModelSettings:e=>new Vt(e),createCoreModel(e,t){const s=Kt.create(e,!!(null==t?void 0:t.checkMocConsistency));try{const e=s.createModel();return e.__moc=s,e}catch(e){try{s.release()}catch(e){}throw e}},createInternalModel(e,t,s){const i=new Ut(e,t,s),r=e;return r.__moc&&(i.__moc=r.__moc,delete r.__moc,i.once('destroy',Es)),i},createPhysics:(e,t)=>as.create(t),createPose:(e,t)=>Xt.create(t)});class Cs{static instance=null;modelCache=new Map;loadingPromises=new Map;maxCacheSize=5;constructor(){console.info('[Live2D] ')}static getInstance(){return Cs.instance||(Cs.instance=new Cs),Cs.instance}async preloadModel(e){const t=e.id;if(this.modelCache.has(t)){return this.modelCache.get(t).lastUsed=Date.now(),void console.info(`[Live2D]  "${e.name}" `)}if(this.loadingPromises.has(t))return console.info(`[Live2D]  "${e.name}" ...`),void await this.loadingPromises.get(t);console.info(`[Live2D] : "${e.name}"`);const s=this.loadModelInternal(e);this.loadingPromises.set(t,s);try{const i=await s;this.cleanupCache(),this.modelCache.set(t,{model:i,config:e,lastUsed:Date.now()}),console.info(`[Live2D]  "${e.name}" `)}catch(t){throw console.error(`[Live2D]  "${e.name}" :`,t),t}finally{this.loadingPromises.delete(t)}}async preloadModels(e){console.info(`[Live2D]  ${e.length} `);const t=e.map(e=>this.preloadModel(e).catch(t=>{console.warn(`[Live2D]  "${e.name}" :`,t)}));Promise.all(t).then(()=>{console.info('[Live2D] ')})}getCachedModel(e){const t=this.modelCache.get(e);return t?(t.lastUsed=Date.now(),console.info(`[Live2D] : ${t.config.name}`),t.model):null}async getOrLoadModel(e){const t=e.id,s=this.getCachedModel(t);return s||(this.loadingPromises.has(t)?(console.info(`[Live2D]  "${e.name}" ...`),await this.loadingPromises.get(t)):(console.info(`[Live2D]  "${e.name}" ...`),await this.preloadModel(e),this.getCachedModel(t)))}async loadModelInternal(e){try{let t=e.modelPath;t.startsWith('http://')||t.startsWith('https://')||(t=e.basePath?`${e.basePath}${t}`:t),console.info(`[Live2D] : ${t}`);const s=await de.from(t,{autoInteract:!1,autoUpdate:!0});return console.info(`[Live2D]  "${e.name}" `),s}catch(t){throw console.error(`[Live2D]  "${e.name}" :`,t),t}}cleanupCache(){if(this.modelCache.size<this.maxCacheSize)return;console.info(`[Live2D]  (${this.modelCache.size}/${this.maxCacheSize})...`);let e=null,t=1/0;for(const[s,i]of this.modelCache.entries())i.lastUsed<t&&(t=i.lastUsed,e=s);if(e){const t=this.modelCache.get(e);console.info(`[Live2D] : "${t.config.name}"`);try{t.model.destroy()}catch(e){console.warn('[Live2D] :',e)}this.modelCache.delete(e)}}clearCache(){console.info(`[Live2D]  (${this.modelCache.size} )`);for(const e of this.modelCache.values())try{e.model.destroy()}catch(t){console.warn(`[Live2D]  "${e.config.name}" :`,t)}this.modelCache.clear(),this.loadingPromises.clear()}getCacheStats(){return{cached:this.modelCache.size,loading:this.loadingPromises.size,maxSize:this.maxCacheSize,models:Array.from(this.modelCache.entries()).map(([e,t])=>({id:e,name:t.config.name,lastUsed:t.lastUsed}))}}setMaxCacheSize(e){this.maxCacheSize=Math.max(1,e),console.info(`[Live2D] : ${this.maxCacheSize}`),this.cleanupCache()}}const Ss=Cs.getInstance()},990(e,t,s){s.d(t,{$u:()=>ge,$y:()=>xe,CE:()=>wt,Df:()=>te,EW:()=>as,FK:()=>dt,Fv:()=>Dt,Gy:()=>q,K9:()=>tt,Lk:()=>Pt,MZ:()=>ee,OW:()=>J,Q3:()=>Bt,QP:()=>K,Wv:()=>Et,bF:()=>It,bo:()=>O,dY:()=>g,eW:()=>kt,h:()=>ls,hi:()=>_e,nI:()=>$t,pI:()=>we,pM:()=>se,qL:()=>o,sV:()=>fe,uX:()=>vt,wB:()=>V});var i=s(926),r=s(395);function n(e,t,s,i){try{return i?e(...i):e()}catch(e){a(e,t,s)}}function o(e,t,s,i){if((0,r.Tn)(e)){const o=n(e,t,s,i);return o&&(0,r.yL)(o)&&o.catch(e=>{a(e,t,s)}),o}if((0,r.cy)(e)){const r=[];for(let n=0;n<e.length;n++)r.push(o(e[n],t,s,i));return r}}function a(e,t,s,o=!0){t&&t.vnode;const{errorHandler:a,throwUnhandledErrorInProduction:l}=t&&t.appContext.config||r.MZ;if(t){let r=t.parent;const o=t.proxy,l=`https://vuejs.org/error-reference/#runtime-${s}`;for(;r;){const t=r.ec;if(t)for(let s=0;s<t.length;s++)if(!1===t[s](e,o,l))return;r=r.parent}if(a)return(0,i.C4)(),n(a,null,10,[e,o,l]),void(0,i.bl)()}!function(e,t,s,i=!0,r=!1){if(r)throw e;console.error(e)}(e,0,0,o,l)}const l=[];let h=-1;const u=[];let c=null,d=0;const p=Promise.resolve();let f=null;function g(e){const t=f||p;return e?t.then(this?e.bind(this):e):t}function m(e){if(!(1&e.flags)){const t=T(e),s=l[l.length-1];!s||!(2&e.flags)&&t>=T(s)?l.push(e):l.splice(function(e){let t=h+1,s=l.length;for(;t<s;){const i=t+s>>>1,r=l[i],n=T(r);n<e||n===e&&2&r.flags?t=i+1:s=i}return t}(t),0,e),e.flags|=1,v()}}function v(){f||(f=p.then(w))}function y(e){(0,r.cy)(e)?u.push(...e):c&&-1===e.id?c.splice(d+1,0,e):1&e.flags||(u.push(e),e.flags|=1),v()}function x(e,t,s=h+1){for(0;s<l.length;s++){const t=l[s];if(t&&2&t.flags){if(e&&t.id!==e.uid)continue;0,l.splice(s,1),s--,4&t.flags&&(t.flags&=-2),t(),4&t.flags||(t.flags&=-2)}}}function b(e){if(u.length){const e=[...new Set(u)].sort((e,t)=>T(e)-T(t));if(u.length=0,c)return void c.push(...e);for(c=e,d=0;d<c.length;d++){const e=c[d];0,4&e.flags&&(e.flags&=-2),8&e.flags||e(),e.flags&=-2}c=null,d=0}}const T=e=>null==e.id?2&e.flags?-1:1/0:e.id;function w(e){r.tE;try{for(h=0;h<l.length;h++){const e=l[h];!e||8&e.flags||(4&e.flags&&(e.flags&=-2),n(e,e.i,e.i?15:14),4&e.flags||(e.flags&=-2))}}finally{for(;h<l.length;h++){const e=l[h];e&&(e.flags&=-2)}h=-1,l.length=0,b(),f=null,(l.length||u.length)&&w(e)}}let E,C=[],S=!1;function A(e,...t){E?E.emit(e,...t):S||C.push({event:e,args:t})}function M(e,t){var s,i;if(E=e,E)E.enabled=!0,C.forEach(({event:e,args:t})=>E.emit(e,...t)),C=[];else if('undefined'!=typeof window&&window.HTMLElement&&!(null==(i=null==(s=window.navigator)?void 0:s.userAgent)?void 0:i.includes('jsdom'))){(t.__VUE_DEVTOOLS_HOOK_REPLAY__=t.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(e=>{M(e,t)}),setTimeout(()=>{E||(t.__VUE_DEVTOOLS_HOOK_REPLAY__=null,S=!0,C=[])},3e3)}else S=!0,C=[]}const P=L('component:added'),I=L('component:updated'),R=L('component:removed');function L(e){return t=>{A(e,t.appContext.app,t.uid,t.parent?t.parent.uid:void 0,t)}}let k=null,D=null;function B(e){const t=k;return k=e,D=e&&e.type.__scopeId||null,t}function F(e,t=k,s){if(!t)return e;if(e._n)return e;const i=(...s)=>{i._d&&bt(-1);const r=B(t);let n;try{n=e(...s)}finally{B(r),i._d&&bt(1)}return I(t),n};return i._n=!0,i._c=!0,i._d=!0,i}function O(e,t){if(null===k)return e;const s=rs(k),n=e.dirs||(e.dirs=[]);for(let e=0;e<t.length;e++){let[o,a,l,h=r.MZ]=t[e];o&&((0,r.Tn)(o)&&(o={mounted:o,updated:o}),o.deep&&(0,i.hV)(a),n.push({dir:o,instance:s,value:a,oldValue:void 0,arg:l,modifiers:h}))}return e}function N(e,t,s,r){const n=e.dirs,a=t&&t.dirs;for(let l=0;l<n.length;l++){const h=n[l];a&&(h.oldValue=a[l].value);let u=h.dir[r];u&&((0,i.C4)(),o(u,s,8,[e.el,h,e,t]),(0,i.bl)())}}function U(e,t,s=!1){const i=$t();if(i||Re){let n=Re?Re._context.provides:i?null==i.parent||i.ce?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:void 0;if(n&&e in n)return n[e];if(arguments.length>1)return s&&(0,r.Tn)(t)?t.call(i&&i.proxy):t}else 0}const G=Symbol.for('v-scx');function V(e,t,s){return H(e,t,s)}function H(e,t,s=r.MZ){const{immediate:n,deep:a,flush:l,once:h}=s;const u=(0,r.X$)({},s);const c=t&&n||!t&&'post'!==l;let d;if(Zt)if('sync'===l){const e=U(G);d=e.__watcherHandles||(e.__watcherHandles=[])}else if(!c){const e=()=>{};return e.stop=r.tE,e.resume=r.tE,e.pause=r.tE,e}const p=Wt;u.call=(e,t,s)=>o(e,p,t,s);let f=!1;'post'===l?u.scheduler=e=>{et(e,p&&p.suspense)}:'sync'!==l&&(f=!0,u.scheduler=(e,t)=>{t?e():m(e)}),u.augmentJob=e=>{t&&(e.flags|=4),f&&(e.flags|=2,p&&(e.id=p.uid,e.i=p))};const g=(0,i.wB)(e,t,u);return Zt&&(d?d.push(g):c&&g()),g}const W=Symbol('_vte'),X=e=>e.__isTeleport;const j=Symbol('_leaveCb'),Y=Symbol('_enterCb');function q(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return fe(()=>{e.isMounted=!0}),me(()=>{e.isUnmounting=!0}),e}const Q=[Function,Array],K={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Q,onEnter:Q,onAfterEnter:Q,onEnterCancelled:Q,onBeforeLeave:Q,onLeave:Q,onAfterLeave:Q,onLeaveCancelled:Q,onBeforeAppear:Q,onAppear:Q,onAfterAppear:Q,onAppearCancelled:Q};function Z(e,t){const{leavingVNodes:s}=e;let i=s.get(t.type);return i||(i=Object.create(null),s.set(t.type,i)),i}function J(e,t,s,i,n){const{appear:a,mode:l,persisted:h=!1,onBeforeEnter:u,onEnter:c,onAfterEnter:d,onEnterCancelled:p,onBeforeLeave:f,onLeave:g,onAfterLeave:m,onLeaveCancelled:v,onBeforeAppear:y,onAppear:x,onAfterAppear:b,onAppearCancelled:T}=t,w=String(e.key),E=Z(s,e),C=(e,t)=>{e&&o(e,i,9,t)},S=(e,t)=>{const s=t[1];C(e,t),(0,r.cy)(e)?e.every(e=>e.length<=1)&&s():e.length<=1&&s()},A={mode:l,persisted:h,beforeEnter(t){let i=u;if(!s.isMounted){if(!a)return;i=y||u}t[j]&&t[j](!0);const r=E[w];r&&St(e,r)&&r.el[j]&&r.el[j](),C(i,[t])},enter(e){let t=c,i=d,r=p;if(!s.isMounted){if(!a)return;t=x||c,i=b||d,r=T||p}let n=!1;const o=e[Y]=t=>{n||(n=!0,C(t?r:i,[e]),A.delayedLeave&&A.delayedLeave(),e[Y]=void 0)};t?S(t,[e,o]):o()},leave(t,i){const r=String(e.key);if(t[Y]&&t[Y](!0),s.isUnmounting)return i();C(f,[t]);let n=!1;const o=t[j]=s=>{n||(n=!0,i(),C(s?v:m,[t]),t[j]=void 0,E[r]===e&&delete E[r])};E[r]=e,g?S(g,[t,o]):o()},clone(e){const r=J(e,t,s,i,n);return n&&n(r),r}};return A}function ee(e,t){6&e.shapeFlag&&e.component?(e.transition=t,ee(e.component.subTree,t)):128&e.shapeFlag?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function te(e,t=!1,s){let i=[],r=0;for(let n=0;n<e.length;n++){let o=e[n];const a=null==s?o.key:String(s)+String(null!=o.key?o.key:n);o.type===dt?(128&o.patchFlag&&r++,i=i.concat(te(o.children,t,a))):(t||o.type!==ft)&&i.push(null!=a?Lt(o,{key:a}):o)}if(r>1)for(let e=0;e<i.length;e++)i[e].patchFlag=-2;return i}function se(e,t){return(0,r.Tn)(e)?(()=>(0,r.X$)({name:e.name},t,{setup:e}))():e}function ie(e){e.ids=[e.ids[0]+e.ids[2]+++'-',0,0]}const re=new WeakMap;function ne(e,t,s,o,a=!1){if((0,r.cy)(e))return void e.forEach((e,i)=>ne(e,t&&((0,r.cy)(t)?t[i]:t),s,o,a));if(ae(o)&&!a)return void(512&o.shapeFlag&&o.type.__asyncResolved&&o.component.subTree.component&&ne(e,t,s,o.component.subTree));const l=4&o.shapeFlag?rs(o.component):o.el,h=a?null:l,{i:u,r:c}=e;const d=t&&t.r,p=u.refs===r.MZ?u.refs={}:u.refs,f=u.setupState,g=(0,i.ux)(f),m=f===r.MZ?r.NO:e=>(0,r.$3)(g,e);if(null!=d&&d!==c)if(oe(t),(0,r.Kg)(d))p[d]=null,m(d)&&(f[d]=null);else if((0,i.i9)(d)){d.value=null;const e=t;e.k&&(p[e.k]=null)}if((0,r.Tn)(c))n(c,u,12,[h,p]);else{const t=(0,r.Kg)(c),n=(0,i.i9)(c);if(t||n){const i=()=>{if(e.f){const s=t?m(c)?f[c]:p[c]:c.value;if(a)(0,r.cy)(s)&&(0,r.TF)(s,l);else if((0,r.cy)(s))s.includes(l)||s.push(l);else if(t)p[c]=[l],m(c)&&(f[c]=p[c]);else{const t=[l];c.value=t,e.k&&(p[e.k]=t)}}else t?(p[c]=h,m(c)&&(f[c]=h)):n&&(c.value=h,e.k&&(p[e.k]=h))};if(h){const t=()=>{i(),re.delete(e)};t.id=-1,re.set(e,t),et(t,s)}else oe(e),i()}else 0}}function oe(e){const t=re.get(e);t&&(t.flags|=8,re.delete(e))}(0,r.We)().requestIdleCallback,(0,r.We)().cancelIdleCallback;const ae=e=>!!e.type.__asyncLoader;const le=e=>e.type.__isKeepAlive;RegExp,RegExp;function he(e,t){return(0,r.cy)(e)?e.some(e=>he(e,t)):(0,r.Kg)(e)?e.split(',').includes(t):!!(0,r.gd)(e)&&(e.lastIndex=0,e.test(t))}function ue(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function ce(e){return 128&e.shapeFlag?e.ssContent:e}function de(e,t,s=Wt,r=!1){if(s){const n=s[e]||(s[e]=[]),a=t.__weh||(t.__weh=(...r)=>{(0,i.C4)();const n=zt(s),a=o(t,s,e,r);return n(),(0,i.bl)(),a});return r?n.unshift(a):n.push(a),a}}const pe=e=>(t,s=Wt)=>{Zt&&'sp'!==e||de(e,(...e)=>t(...e),s)},fe=(pe('bm'),pe('m')),ge=(pe('bu'),pe('u')),me=pe('bum'),_e=pe('um');pe('sp'),pe('rtg'),pe('rtc');const ve='components';const ye=Symbol.for('v-ndc');function xe(e){return(0,r.Kg)(e)?be(ve,e,!1)||e:e||ye}function be(e,t,s=!0,i=!1){const n=k||Wt;if(n){const s=n.type;if(e===ve){const e=ns(s,!1);if(e&&(e===t||e===(0,r.PT)(t)||e===(0,r.ZH)((0,r.PT)(t))))return s}const o=Te(n[e]||s[e],t)||Te(n.appContext[e],t);return!o&&i?s:o}}function Te(e,t){return e&&(e[t]||e[(0,r.PT)(t)]||e[(0,r.ZH)((0,r.PT)(t))])}function we(e,t,s,n){let o;const a=s&&s[n],l=(0,r.cy)(e);if(l||(0,r.Kg)(e)){let s=!1,r=!1;l&&(0,i.g8)(e)&&(s=!(0,i.fE)(e),r=(0,i.Tm)(e),e=(0,i.qA)(e)),o=new Array(e.length);for(let n=0,l=e.length;n<l;n++)o[n]=t(s?r?(0,i.a1)((0,i.lJ)(e[n])):(0,i.lJ)(e[n]):e[n],n,void 0,a&&a[n])}else if('number'==typeof e){0,o=new Array(e);for(let s=0;s<e;s++)o[s]=t(s+1,s,void 0,a&&a[s])}else if((0,r.Gv)(e))if(e[Symbol.iterator])o=Array.from(e,(e,s)=>t(e,s,void 0,a&&a[s]));else{const s=Object.keys(e);o=new Array(s.length);for(let i=0,r=s.length;i<r;i++){const r=s[i];o[i]=t(e[r],r,i,a&&a[i])}}else o=[];return s&&(s[n]=o),o}const Ee=e=>e?qt(e)?rs(e):Ee(e.parent):null,Ce=(0,r.X$)(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Ee(e.parent),$root:e=>Ee(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>e.type,$forceUpdate:e=>e.f||(e.f=()=>{m(e.update)}),$nextTick:e=>e.n||(e.n=g.bind(e.proxy)),$watch:e=>r.tE}),Se=(e,t)=>e!==r.MZ&&!e.__isScriptSetup&&(0,r.$3)(e,t),Ae={get({_:e},t){if('__v_skip'===t)return!0;const{ctx:s,setupState:n,data:o,props:a,accessCache:l,type:h,appContext:u}=e;if('$'!==t[0]){const e=l[t];if(void 0!==e)switch(e){case 1:return n[t];case 2:return o[t];case 4:return s[t];case 3:return a[t]}else{if(Se(n,t))return l[t]=1,n[t];if((0,r.$3)(a,t))return l[t]=3,a[t];if(s!==r.MZ&&(0,r.$3)(s,t))return l[t]=4,s[t];l[t]=0}}const c=Ce[t];let d,p;return c?('$attrs'===t&&(0,i.u4)(e.attrs,'get',''),c(e)):(d=h.__cssModules)&&(d=d[t])?d:s!==r.MZ&&(0,r.$3)(s,t)?(l[t]=4,s[t]):(p=u.config.globalProperties,(0,r.$3)(p,t)?p[t]:void 0)},set({_:e},t,s){const{data:i,setupState:n,ctx:o}=e;return Se(n,t)?(n[t]=s,!0):!(0,r.$3)(e.props,t)&&(('$'!==t[0]||!(t.slice(1)in e))&&(o[t]=s,!0))},has({_:{data:e,setupState:t,accessCache:s,ctx:i,appContext:n,props:o,type:a}},l){let h;return!!(s[l]||Se(t,l)||(0,r.$3)(o,l)||(0,r.$3)(i,l)||(0,r.$3)(Ce,l)||(0,r.$3)(n.config.globalProperties,l)||(h=a.__cssModules)&&h[l])},defineProperty(e,t,s){return null!=s.get?e._.accessCache[t]=0:(0,r.$3)(s,'value')&&this.set(e,t,s.value,null),Reflect.defineProperty(e,t,s)}};function Me(){return{app:null,config:{isNativeTag:r.NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Pe=0;function Ie(e,t){return function(s,i=null){(0,r.Tn)(s)||(s=(0,r.X$)({},s)),null==i||(0,r.Gv)(i)||(i=null);const n=Me(),a=new WeakSet,l=[];let h=!1;const u=n.app={_uid:Pe++,_component:s,_props:i,_container:null,_context:n,_instance:null,version:hs,get config(){return n.config},set config(e){0},use:(e,...t)=>(a.has(e)||(e&&(0,r.Tn)(e.install)?(a.add(e),e.install(u,...t)):(0,r.Tn)(e)&&(a.add(e),e(u,...t))),u),mixin:e=>u,component:(e,t)=>t?(n.components[e]=t,u):n.components[e],directive:(e,t)=>t?(n.directives[e]=t,u):n.directives[e],mount(r,o,a){if(!h){0;const l=u._ceVNode||It(s,i);return l.appContext=n,!0===a?a='svg':!1===a&&(a=void 0),o&&t?t(l,r):e(l,r,a),h=!0,u._container=r,r.__vue_app__=u,u._instance=l.component,function(e,t){A('app:init',e,t,{Fragment:dt,Text:pt,Comment:ft,Static:gt})}(u,hs),rs(l.component)}},onUnmount(e){l.push(e)},unmount(){h&&(o(l,u._instance,16),e(null,u._container),u._instance=null,function(e){A('app:unmount',e)}(u),delete u._container.__vue_app__)},provide:(e,t)=>(n.provides[e]=t,u),runWithContext(e){const t=Re;Re=u;try{return e()}finally{Re=t}}};return u}}let Re=null;const Le=(e,t)=>'modelValue'===t||'model-value'===t?e.modelModifiers:e[`${t}Modifiers`]||e[`${(0,r.PT)(t)}Modifiers`]||e[`${(0,r.Tg)(t)}Modifiers`];function ke(e,t,...s){if(e.isUnmounted)return;const i=e.vnode.props||r.MZ;let n=s;const a=t.startsWith('update:'),l=a&&Le(i,t.slice(7));let h;l&&(l.trim&&(n=s.map(e=>(0,r.Kg)(e)?e.trim():e)),l.number&&(n=s.map(r.bB))),function(e,t,s){A('component:emit',e.appContext.app,e,t,s)}(e,t,n);let u=i[h=(0,r.rU)(t)]||i[h=(0,r.rU)((0,r.PT)(t))];!u&&a&&(u=i[h=(0,r.rU)((0,r.Tg)(t))]),u&&o(u,e,6,n);const c=i[h+'Once'];if(c){if(e.emitted){if(e.emitted[h])return}else e.emitted={};e.emitted[h]=!0,o(c,e,6,n)}}function De(e,t,s=!1){const i=t.emitsCache,n=i.get(e);if(void 0!==n)return n;const o=e.emits;let a={};return o?((0,r.cy)(o)?o.forEach(e=>a[e]=null):(0,r.X$)(a,o),(0,r.Gv)(e)&&i.set(e,a),a):((0,r.Gv)(e)&&i.set(e,null),null)}function Be(e,t){return!(!e||!(0,r.Mp)(t))&&(t=t.slice(2).replace(/Once$/,''),(0,r.$3)(e,t[0].toLowerCase()+t.slice(1))||(0,r.$3)(e,(0,r.Tg)(t))||(0,r.$3)(e,t))}function Fe(e){const{type:t,vnode:s,proxy:i,withProxy:n,propsOptions:[o],slots:l,attrs:h,emit:u,render:c,renderCache:d,props:p,data:f,setupState:g,ctx:m,inheritAttrs:v}=e,y=B(e);let x,b;try{if(4&s.shapeFlag){const e=n||i,t=e;x=Ft(c.call(t,e,d,p,g,f,m)),b=h}else{const e=t;0,x=Ft(e.length>1?e(p,{attrs:h,slots:l,emit:u}):e(p,null)),b=t.props?h:Oe(h)}}catch(t){mt.length=0,a(t,e,1),x=It(ft)}let T=x;if(b&&!1!==v){const e=Object.keys(b),{shapeFlag:t}=T;e.length&&7&t&&(o&&e.some(r.CP)&&(b=Ne(b,o)),T=Lt(T,b,!1,!0))}return s.dirs&&(T=Lt(T,null,!1,!0),T.dirs=T.dirs?T.dirs.concat(s.dirs):s.dirs),s.transition&&ee(T,s.transition),x=T,B(y),x}const Oe=e=>{let t;for(const s in e)('class'===s||'style'===s||(0,r.Mp)(s))&&((t||(t={}))[s]=e[s]);return t},Ne=(e,t)=>{const s={};for(const i in e)(0,r.CP)(i)&&i.slice(9)in t||(s[i]=e[i]);return s};function Ue(e,t,s){const i=Object.keys(t);if(i.length!==Object.keys(e).length)return!0;for(let r=0;r<i.length;r++){const n=i[r];if(t[n]!==e[n]&&!Be(s,n))return!0}return!1}function Ge({vnode:e,parent:t},s){for(;t;){const i=t.subTree;if(i.suspense&&i.suspense.activeBranch===e&&(i.el=e.el),i!==e)break;(e=t.vnode).el=s,t=t.parent}}const Ve={},He=()=>Object.create(Ve),We=e=>Object.getPrototypeOf(e)===Ve;function $e(e,t,s,n){const[o,a]=e.propsOptions;let l,h=!1;if(t)for(let i in t){if((0,r.SU)(i))continue;const u=t[i];let c;o&&(0,r.$3)(o,c=(0,r.PT)(i))?a&&a.includes(c)?(l||(l={}))[c]=u:s[c]=u:Be(e.emitsOptions,i)||i in n&&u===n[i]||(n[i]=u,h=!0)}if(a){const t=(0,i.ux)(s),n=l||r.MZ;for(let i=0;i<a.length;i++){const l=a[i];s[l]=Xe(o,t,l,n[l],e,!(0,r.$3)(n,l))}}return h}function Xe(e,t,s,i,n,o){const a=e[s];if(null!=a){const e=(0,r.$3)(a,'default');if(e&&void 0===i){const e=a.default;if(a.type!==Function&&!a.skipFactory&&(0,r.Tn)(e)){const{propsDefaults:r}=n;if(s in r)i=r[s];else{const o=zt(n);i=r[s]=e.call(null,t),o()}}else i=e;n.ce&&n.ce._setProp(s,i)}a[0]&&(o&&!e?i=!1:!a[1]||''!==i&&i!==(0,r.Tg)(s)||(i=!0))}return i}function je(e,t,s=!1){const i=t.propsCache,n=i.get(e);if(n)return n;const o=e.props,a={},l=[];if(!o)return(0,r.Gv)(e)&&i.set(e,r.Oj),r.Oj;if((0,r.cy)(o))for(let e=0;e<o.length;e++){0;const t=(0,r.PT)(o[e]);ze(t)&&(a[t]=r.MZ)}else if(o){0;for(const e in o){const t=(0,r.PT)(e);if(ze(t)){const s=o[e],i=a[t]=(0,r.cy)(s)||(0,r.Tn)(s)?{type:s}:(0,r.X$)({},s),n=i.type;let h=!1,u=!0;if((0,r.cy)(n))for(let e=0;e<n.length;++e){const t=n[e],s=(0,r.Tn)(t)&&t.name;if('Boolean'===s){h=!0;break}'String'===s&&(u=!1)}else h=(0,r.Tn)(n)&&'Boolean'===n.name;i[0]=h,i[1]=u,(h||(0,r.$3)(i,'default'))&&l.push(t)}}}const h=[a,l];return(0,r.Gv)(e)&&i.set(e,h),h}function ze(e){return'$'!==e[0]&&!(0,r.SU)(e)}const Ye=e=>'_'===e||'_ctx'===e||'$stable'===e,qe=e=>(0,r.cy)(e)?e.map(Ft):[Ft(e)],Qe=(e,t,s)=>{if(t._n)return t;const i=F((...e)=>qe(t(...e)),s);return i._c=!1,i},Ke=(e,t,s)=>{const i=e._ctx;for(const s in e){if(Ye(s))continue;const n=e[s];if((0,r.Tn)(n))t[s]=Qe(0,n,i);else if(null!=n){0;const e=qe(n);t[s]=()=>e}}},Ze=(e,t)=>{const s=qe(t);e.slots.default=()=>s},Je=(e,t,s)=>{for(const i in t)!s&&Ye(i)||(e[i]=t[i])};const et=ct;function tt(e){return st(e)}function st(e,t){const s=(0,r.We)();s.__VUE__=!0,M(s.__VUE_DEVTOOLS_GLOBAL_HOOK__,s);const{insert:n,remove:o,patchProp:a,createElement:l,createText:h,createComment:u,setText:c,setElementText:d,parentNode:p,nextSibling:f,setScopeId:g=r.tE,insertStaticContent:v}=e,y=(e,t,s,i=null,r=null,n=null,o=void 0,a=null,l=!!t.dynamicChildren)=>{if(e===t)return;e&&!St(e,t)&&(i=re(e),J(e,r,n,!0),e=null),-2===t.patchFlag&&(l=!1,t.dynamicChildren=null);const{type:h,ref:u,shapeFlag:c}=t;switch(h){case pt:T(e,t,s,i);break;case ft:w(e,t,s,i);break;case gt:null==e&&C(t,s,i,o);break;case dt:U(e,t,s,i,r,n,o,a,l);break;default:1&c?A(e,t,s,i,r,n,o,a,l):6&c?G(e,t,s,i,r,n,o,a,l):(64&c||128&c)&&h.process(e,t,s,i,r,n,o,a,l,ue)}null!=u&&r?ne(u,e&&e.ref,n,t||e,!t):null==u&&e&&null!=e.ref&&ne(e.ref,null,n,e,!0)},T=(e,t,s,i)=>{if(null==e)n(t.el=h(t.children),s,i);else{const s=t.el=e.el;t.children!==e.children&&c(s,t.children)}},w=(e,t,s,i)=>{null==e?n(t.el=u(t.children||''),s,i):t.el=e.el},C=(e,t,s,i)=>{[e.el,e.anchor]=v(e.children,t,s,i,e.el,e.anchor)},S=({el:e,anchor:t})=>{let s;for(;e&&e!==t;)s=f(e),o(e),e=s;o(t)},A=(e,t,s,i,r,n,o,a,l)=>{if('svg'===t.type?o='svg':'math'===t.type&&(o='mathml'),null==e)L(t,s,i,r,n,o,a,l);else{const s=e.el&&e.el._isVueCE?e.el:null;try{s&&s._beginPatch(),B(e,t,r,n,o,a,l)}finally{s&&s._endPatch()}}},L=(e,t,s,i,o,h,u,c)=>{let p,f;const{props:g,shapeFlag:m,transition:v,dirs:y}=e;if(p=e.el=l(e.type,h,g&&g.is,g),8&m?d(p,e.children):16&m&&D(e.children,p,null,i,o,it(e,h),u,c),y&&N(e,null,i,'created'),k(p,e,e.scopeId,u,i),g){for(const e in g)'value'===e||(0,r.SU)(e)||a(p,e,null,g[e],h,i);'value'in g&&a(p,'value',null,g.value,h),(f=g.onVnodeBeforeMount)&&Ut(f,i,e)}(0,r.yQ)(p,'__vnode',e,!0),(0,r.yQ)(p,'__vueParentComponent',i,!0),y&&N(e,null,i,'beforeMount');const x=nt(o,v);x&&v.beforeEnter(p),n(p,t,s),((f=g&&g.onVnodeMounted)||x||y)&&et(()=>{f&&Ut(f,i,e),x&&v.enter(p),y&&N(e,null,i,'mounted')},o)},k=(e,t,s,i,r)=>{if(s&&g(e,s),i)for(let t=0;t<i.length;t++)g(e,i[t]);if(r){let s=r.subTree;if(t===s||ut(s.type)&&(s.ssContent===t||s.ssFallback===t)){const t=r.vnode;k(e,t,t.scopeId,t.slotScopeIds,r.parent)}}},D=(e,t,s,i,r,n,o,a,l=0)=>{for(let h=l;h<e.length;h++){const l=e[h]=a?Ot(e[h]):Ft(e[h]);y(null,l,t,s,i,r,n,o,a)}},B=(e,t,s,i,n,o,l)=>{const h=t.el=e.el;h.__vnode=t;let{patchFlag:u,dynamicChildren:c,dirs:p}=t;u|=16&e.patchFlag;const f=e.props||r.MZ,g=t.props||r.MZ;let m;if(s&&rt(s,!1),(m=g.onVnodeBeforeUpdate)&&Ut(m,s,t,e),p&&N(t,e,s,'beforeUpdate'),s&&rt(s,!0),(f.innerHTML&&null==g.innerHTML||f.textContent&&null==g.textContent)&&d(h,''),c?F(e.dynamicChildren,c,h,s,i,it(t,n),o):l||q(e,t,h,null,s,i,it(t,n),o,!1),u>0){if(16&u)O(h,f,g,s,n);else if(2&u&&f.class!==g.class&&a(h,'class',null,g.class,n),4&u&&a(h,'style',f.style,g.style,n),8&u){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const i=e[t],r=f[i],o=g[i];o===r&&'value'!==i||a(h,i,r,o,n,s)}}1&u&&e.children!==t.children&&d(h,t.children)}else l||null!=c||O(h,f,g,s,n);((m=g.onVnodeUpdated)||p)&&et(()=>{m&&Ut(m,s,t,e),p&&N(t,e,s,'updated')},i)},F=(e,t,s,i,r,n,o)=>{for(let a=0;a<t.length;a++){const l=e[a],h=t[a],u=l.el&&(l.type===dt||!St(l,h)||198&l.shapeFlag)?p(l.el):s;y(l,h,u,null,i,r,n,o,!0)}},O=(e,t,s,i,n)=>{if(t!==s){if(t!==r.MZ)for(const o in t)(0,r.SU)(o)||o in s||a(e,o,t[o],null,n,i);for(const o in s){if((0,r.SU)(o))continue;const l=s[o],h=t[o];l!==h&&'value'!==o&&a(e,o,h,l,n,i)}'value'in s&&a(e,'value',t.value,s.value,n)}},U=(e,t,s,i,r,o,a,l,u)=>{const c=t.el=e?e.el:h(''),d=t.anchor=e?e.anchor:h('');let{patchFlag:p,dynamicChildren:f,slotScopeIds:g}=t;g&&(l=l?l.concat(g):g),null==e?(n(c,s,i),n(d,s,i),D(t.children||[],s,d,r,o,a,l,u)):p>0&&64&p&&f&&e.dynamicChildren&&e.dynamicChildren.length===f.length?(F(e.dynamicChildren,f,s,r,o,a,l),(null!=t.key||r&&t===r.subTree)&&ot(e,t,!0)):q(e,t,s,d,r,o,a,l,u)},G=(e,t,s,i,r,n,o,a,l)=>{t.slotScopeIds=a,null==e?512&t.shapeFlag?r.ctx.activate(t,s,i,o,l):V(t,s,i,r,n,o,l):H(e,t,l)},V=(e,t,s,i,r,n,o)=>{const a=e.component=Ht(e,i,r);if(le(e)&&(a.ctx.renderer=ue),Jt(a,!1,o),a.asyncDep){if(r&&r.registerDep(a,X,o),!e.el){const i=a.subTree=It(ft);w(null,i,t,s),e.placeholder=i.el}}else X(a,e,t,s,r,n,o)},H=(e,t,s)=>{const i=t.component=e.component;if(function(e,t,s){const{props:i,children:r,component:n}=e,{props:o,children:a,patchFlag:l}=t,h=n.emitsOptions;if(t.dirs||t.transition)return!0;if(!(s&&l>=0))return!(!r&&!a||a&&a.$stable)||i!==o&&(i?!o||Ue(i,o,h):!!o);if(1024&l)return!0;if(16&l)return i?Ue(i,o,h):!!o;if(8&l){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const s=e[t];if(o[s]!==i[s]&&!Be(h,s))return!0}}return!1}(e,t,s)){if(i.asyncDep&&!i.asyncResolved)return void Y(i,t,s);i.next=t,i.update()}else t.el=e.el,i.vnode=t},X=(e,t,s,n,o,a,l)=>{const h=()=>{if(e.isMounted){let{next:t,bu:s,u:i,parent:n,vnode:u}=e;{const s=at(e);if(s)return t&&(t.el=u.el,Y(e,t,l)),void s.asyncDep.then(()=>{e.isUnmounted||h()})}let c,d=t;0,rt(e,!1),t?(t.el=u.el,Y(e,t,l)):t=u,s&&(0,r.DY)(s),(c=t.props&&t.props.onVnodeBeforeUpdate)&&Ut(c,n,t,u),rt(e,!0);const f=Fe(e);0;const g=e.subTree;e.subTree=f,y(g,f,p(g.el),re(g),e,o,a),t.el=f.el,null===d&&Ge(e,f.el),i&&et(i,o),(c=t.props&&t.props.onVnodeUpdated)&&et(()=>Ut(c,n,t,u),o),I(e)}else{let i;const{el:l,props:h}=t,{bm:u,m:c,parent:d,root:p,type:f}=e,g=ae(t);if(rt(e,!1),u&&(0,r.DY)(u),!g&&(i=h&&h.onVnodeBeforeMount)&&Ut(i,d,t),rt(e,!0),l&&de){const t=()=>{e.subTree=Fe(e),de(l,e.subTree,e,o,null)};g&&f.__asyncHydrate?f.__asyncHydrate(l,e,t):t()}else{p.ce&&!1!==p.ce._def.shadowRoot&&p.ce._injectChildStyle(f);const i=e.subTree=Fe(e);0,y(null,i,s,n,e,o,a),t.el=i.el}if(c&&et(c,o),!g&&(i=h&&h.onVnodeMounted)){const e=t;et(()=>Ut(i,d,e),o)}(256&t.shapeFlag||d&&ae(d.vnode)&&256&d.vnode.shapeFlag)&&e.a&&et(e.a,o),e.isMounted=!0,P(e),t=s=n=null}};e.scope.on();const u=e.effect=new i.X2(h);e.scope.off();const c=e.update=u.run.bind(u),d=e.job=u.runIfDirty.bind(u);d.i=e,d.id=e.uid,u.scheduler=()=>m(d),rt(e,!0),c()},Y=(e,t,s)=>{t.component=e;const n=e.vnode.props;e.vnode=t,e.next=null,function(e,t,s,n){const{props:o,attrs:a,vnode:{patchFlag:l}}=e,h=(0,i.ux)(o),[u]=e.propsOptions;let c=!1;if(!(n||l>0)||16&l){let i;$e(e,t,o,a)&&(c=!0);for(const n in h)t&&((0,r.$3)(t,n)||(i=(0,r.Tg)(n))!==n&&(0,r.$3)(t,i))||(u?!s||void 0===s[n]&&void 0===s[i]||(o[n]=Xe(u,h,n,void 0,e,!0)):delete o[n]);if(a!==h)for(const e in a)t&&(0,r.$3)(t,e)||(delete a[e],c=!0)}else if(8&l){const s=e.vnode.dynamicProps;for(let i=0;i<s.length;i++){let n=s[i];if(Be(e.emitsOptions,n))continue;const l=t[n];if(u)if((0,r.$3)(a,n))l!==a[n]&&(a[n]=l,c=!0);else{const t=(0,r.PT)(n);o[t]=Xe(u,h,t,l,e,!1)}else l!==a[n]&&(a[n]=l,c=!0)}}c&&(0,i.hZ)(e.attrs,'set','')}(e,t.props,n,s),((e,t,s)=>{const{vnode:i,slots:n}=e;let o=!0,a=r.MZ;if(32&i.shapeFlag){const e=t._;e?s&&1===e?o=!1:Je(n,t,s):(o=!t.$stable,Ke(t,n)),a=t}else t&&(Ze(e,t),a={default:1});if(o)for(const e in n)Ye(e)||null!=a[e]||delete n[e]})(e,t.children,s),(0,i.C4)(),x(e),(0,i.bl)()},q=(e,t,s,i,r,n,o,a,l=!1)=>{const h=e&&e.children,u=e?e.shapeFlag:0,c=t.children,{patchFlag:p,shapeFlag:f}=t;if(p>0){if(128&p)return void K(h,c,s,i,r,n,o,a,l);if(256&p)return void Q(h,c,s,i,r,n,o,a,l)}8&f?(16&u&&ie(h,r,n),c!==h&&d(s,c)):16&u?16&f?K(h,c,s,i,r,n,o,a,l):ie(h,r,n,!0):(8&u&&d(s,''),16&f&&D(c,s,i,r,n,o,a,l))},Q=(e,t,s,i,n,o,a,l,h)=>{e=e||r.Oj,t=t||r.Oj;const u=e.length,c=t.length,d=Math.min(u,c);let p;for(p=0;p<d;p++){const i=t[p]=h?Ot(t[p]):Ft(t[p]);y(e[p],i,s,null,n,o,a,l,h)}u>c?ie(e,n,o,!0,!1,d):D(t,s,i,n,o,a,l,h,d)},K=(e,t,s,i,n,o,a,l,h)=>{let u=0;const c=t.length;let d=e.length-1,p=c-1;for(;u<=d&&u<=p;){const i=e[u],r=t[u]=h?Ot(t[u]):Ft(t[u]);if(!St(i,r))break;y(i,r,s,null,n,o,a,l,h),u++}for(;u<=d&&u<=p;){const i=e[d],r=t[p]=h?Ot(t[p]):Ft(t[p]);if(!St(i,r))break;y(i,r,s,null,n,o,a,l,h),d--,p--}if(u>d){if(u<=p){const e=p+1,r=e<c?t[e].el:i;for(;u<=p;)y(null,t[u]=h?Ot(t[u]):Ft(t[u]),s,r,n,o,a,l,h),u++}}else if(u>p)for(;u<=d;)J(e[u],n,o,!0),u++;else{const f=u,g=u,m=new Map;for(u=g;u<=p;u++){const e=t[u]=h?Ot(t[u]):Ft(t[u]);null!=e.key&&m.set(e.key,u)}let v,x=0;const b=p-g+1;let T=!1,w=0;const E=new Array(b);for(u=0;u<b;u++)E[u]=0;for(u=f;u<=d;u++){const i=e[u];if(x>=b){J(i,n,o,!0);continue}let r;if(null!=i.key)r=m.get(i.key);else for(v=g;v<=p;v++)if(0===E[v-g]&&St(i,t[v])){r=v;break}void 0===r?J(i,n,o,!0):(E[r-g]=u+1,r>=w?w=r:T=!0,y(i,t[r],s,null,n,o,a,l,h),x++)}const C=T?function(e){const t=e.slice(),s=[0];let i,r,n,o,a;const l=e.length;for(i=0;i<l;i++){const l=e[i];if(0!==l){if(r=s[s.length-1],e[r]<l){t[i]=r,s.push(i);continue}for(n=0,o=s.length-1;n<o;)a=n+o>>1,e[s[a]]<l?n=a+1:o=a;l<e[s[n]]&&(n>0&&(t[i]=s[n-1]),s[n]=i)}}n=s.length,o=s[n-1];for(;n-- >0;)s[n]=o,o=t[o];return s}(E):r.Oj;for(v=C.length-1,u=b-1;u>=0;u--){const e=g+u,r=t[e],d=t[e+1],p=e+1<c?d.el||ht(d):i;0===E[u]?y(null,r,s,p,n,o,a,l,h):T&&(v<0||u!==C[v]?Z(r,s,p,2):v--)}}},Z=(e,t,s,i,r=null)=>{const{el:a,type:l,transition:h,children:u,shapeFlag:c}=e;if(6&c)return void Z(e.component.subTree,t,s,i);if(128&c)return void e.suspense.move(t,s,i);if(64&c)return void l.move(e,t,s,ue);if(l===dt){n(a,t,s);for(let e=0;e<u.length;e++)Z(u[e],t,s,i);return void n(e.anchor,t,s)}if(l===gt)return void(({el:e,anchor:t},s,i)=>{let r;for(;e&&e!==t;)r=f(e),n(e,s,i),e=r;n(t,s,i)})(e,t,s);if(2!==i&&1&c&&h)if(0===i)h.beforeEnter(a),n(a,t,s),et(()=>h.enter(a),r);else{const{leave:i,delayLeave:r,afterLeave:l}=h,u=()=>{e.ctx.isUnmounted?o(a):n(a,t,s)},c=()=>{a._isLeaving&&a[j](!0),i(a,()=>{u(),l&&l()})};r?r(a,u,c):c()}else n(a,t,s)},J=(e,t,s,r=!1,n=!1)=>{const{type:o,props:a,ref:l,children:h,dynamicChildren:u,shapeFlag:c,patchFlag:d,dirs:p,cacheIndex:f}=e;if(-2===d&&(n=!1),null!=l&&((0,i.C4)(),ne(l,null,s,e,!0),(0,i.bl)()),null!=f&&(t.renderCache[f]=void 0),256&c)return void t.ctx.deactivate(e);const g=1&c&&p,m=!ae(e);let v;if(m&&(v=a&&a.onVnodeBeforeUnmount)&&Ut(v,t,e),6&c)se(e.component,s,r);else{if(128&c)return void e.suspense.unmount(s,r);g&&N(e,null,t,'beforeUnmount'),64&c?e.type.remove(e,t,s,ue,r):u&&!u.hasOnce&&(o!==dt||d>0&&64&d)?ie(u,t,s,!1,!0):(o===dt&&384&d||!n&&16&c)&&ie(h,t,s),r&&ee(e)}(m&&(v=a&&a.onVnodeUnmounted)||g)&&et(()=>{v&&Ut(v,t,e),g&&N(e,null,t,'unmounted')},s)},ee=e=>{const{type:t,el:s,anchor:i,transition:r}=e;if(t===dt)return void te(s,i);if(t===gt)return void S(e);const n=()=>{o(s),r&&!r.persisted&&r.afterLeave&&r.afterLeave()};if(1&e.shapeFlag&&r&&!r.persisted){const{leave:t,delayLeave:i}=r,o=()=>t(s,n);i?i(e.el,n,o):o()}else n()},te=(e,t)=>{let s;for(;e!==t;)s=f(e),o(e),e=s;o(t)},se=(e,t,s)=>{const{bum:i,scope:n,job:o,subTree:a,um:l,m:h,a:u}=e;var c;lt(h),lt(u),i&&(0,r.DY)(i),n.stop(),o&&(o.flags|=8,J(a,e,t,s)),l&&et(l,t),et(()=>{e.isUnmounted=!0},t),c=e,E&&'function'==typeof E.cleanupBuffer&&!E.cleanupBuffer(c)&&R(c)},ie=(e,t,s,i=!1,r=!1,n=0)=>{for(let o=n;o<e.length;o++)J(e[o],t,s,i,r)},re=e=>{if(6&e.shapeFlag)return re(e.component.subTree);if(128&e.shapeFlag)return e.suspense.next();const t=f(e.anchor||e.el),s=t&&t[W];return s?f(s):t};let oe=!1;const he=(e,t,s)=>{let i;null==e?t._vnode&&(J(t._vnode,null,null,!0),i=t._vnode.component):y(t._vnode||null,e,t,null,null,null,s),t._vnode=e,oe||(oe=!0,x(i),b(),oe=!1)},ue={p:y,um:J,m:Z,r:ee,mt:V,mc:D,pc:q,pbc:F,n:re,o:e};let ce,de;return t&&([ce,de]=t(ue)),{render:he,hydrate:ce,createApp:Ie(he,ce)}}function it({type:e,props:t},s){return'svg'===s&&'foreignObject'===e||'mathml'===s&&'annotation-xml'===e&&t&&t.encoding&&t.encoding.includes('html')?void 0:s}function rt({effect:e,job:t},s){s?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function nt(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function ot(e,t,s=!1){const i=e.children,n=t.children;if((0,r.cy)(i)&&(0,r.cy)(n))for(let t=0;t<i.length;t++){const r=i[t];let o=n[t];1&o.shapeFlag&&!o.dynamicChildren&&((o.patchFlag<=0||32===o.patchFlag)&&(o=n[t]=Ot(n[t]),o.el=r.el),s||-2===o.patchFlag||ot(r,o)),o.type===pt&&(-1!==o.patchFlag?o.el=r.el:o.__elIndex=t+(e.type===dt?1:0)),o.type!==ft||o.el||(o.el=r.el)}}function at(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:at(t)}function lt(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}function ht(e){if(e.placeholder)return e.placeholder;const t=e.component;return t?ht(t.subTree):null}const ut=e=>e.__isSuspense;function ct(e,t){t&&t.pendingBranch?(0,r.cy)(e)?t.effects.push(...e):t.effects.push(e):y(e)}const dt=Symbol.for('v-fgt'),pt=Symbol.for('v-txt'),ft=Symbol.for('v-cmt'),gt=Symbol.for('v-stc'),mt=[];let _t=null;function vt(e=!1){mt.push(_t=e?null:[])}function yt(){mt.pop(),_t=mt[mt.length-1]||null}let xt=1;function bt(e,t=!1){xt+=e,e<0&&_t&&t&&(_t.hasOnce=!0)}function Tt(e){return e.dynamicChildren=xt>0?_t||r.Oj:null,yt(),xt>0&&_t&&_t.push(e),e}function wt(e,t,s,i,r,n){return Tt(Pt(e,t,s,i,r,n,!0))}function Et(e,t,s,i,r){return Tt(It(e,t,s,i,r,!0))}function Ct(e){return!!e&&!0===e.__v_isVNode}function St(e,t){return e.type===t.type&&e.key===t.key}const At=({key:e})=>null!=e?e:null,Mt=({ref:e,ref_key:t,ref_for:s})=>('number'==typeof e&&(e=''+e),null!=e?(0,r.Kg)(e)||(0,i.i9)(e)||(0,r.Tn)(e)?{i:k,r:e,k:t,f:!!s}:e:null);function Pt(e,t=null,s=null,i=0,n=null,o=(e===dt?0:1),a=!1,l=!1){const h={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&At(t),ref:t&&Mt(t),scopeId:D,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:i,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:k};return l?(Nt(h,s),128&o&&e.normalize(h)):s&&(h.shapeFlag|=(0,r.Kg)(s)?8:16),xt>0&&!a&&_t&&(h.patchFlag>0||6&o)&&32!==h.patchFlag&&_t.push(h),h}const It=Rt;function Rt(e,t=null,s=null,n=0,o=null,a=!1){if(e&&e!==ye||(e=ft),Ct(e)){const i=Lt(e,t,!0);return s&&Nt(i,s),xt>0&&!a&&_t&&(6&i.shapeFlag?_t[_t.indexOf(e)]=i:_t.push(i)),i.patchFlag=-2,i}if(os(e)&&(e=e.__vccOpts),t){t=function(e){return e?(0,i.ju)(e)||We(e)?(0,r.X$)({},e):e:null}(t);let{class:e,style:s}=t;e&&!(0,r.Kg)(e)&&(t.class=(0,r.C4)(e)),(0,r.Gv)(s)&&((0,i.ju)(s)&&!(0,r.cy)(s)&&(s=(0,r.X$)({},s)),t.style=(0,r.Tr)(s))}return Pt(e,t,s,n,o,(0,r.Kg)(e)?1:ut(e)?128:X(e)?64:(0,r.Gv)(e)?4:(0,r.Tn)(e)?2:0,a,!0)}function Lt(e,t,s=!1,i=!1){const{props:n,ref:o,patchFlag:a,children:l,transition:h}=e,u=t?function(...e){const t={};for(let s=0;s<e.length;s++){const i=e[s];for(const e in i)if('class'===e)t.class!==i.class&&(t.class=(0,r.C4)([t.class,i.class]));else if('style'===e)t.style=(0,r.Tr)([t.style,i.style]);else if((0,r.Mp)(e)){const s=t[e],n=i[e];!n||s===n||(0,r.cy)(s)&&s.includes(n)||(t[e]=s?[].concat(s,n):n)}else''!==e&&(t[e]=i[e])}return t}(n||{},t):n,c={__v_isVNode:!0,__v_skip:!0,type:e.type,props:u,key:u&&At(u),ref:t&&t.ref?s&&o?(0,r.cy)(o)?o.concat(Mt(t)):[o,Mt(t)]:Mt(t):o,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:l,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==dt?-1===a?16:16|a:a,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:h,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Lt(e.ssContent),ssFallback:e.ssFallback&&Lt(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return h&&i&&ee(c,h.clone(c)),c}function kt(e=' ',t=0){return It(pt,null,e,t)}function Dt(e,t){const s=It(gt,null,e);return s.staticCount=t,s}function Bt(e='',t=!1){return t?(vt(),Et(ft,null,e)):It(ft,null,e)}function Ft(e){return null==e||'boolean'==typeof e?It(ft):(0,r.cy)(e)?It(dt,null,e.slice()):Ct(e)?Ot(e):It(pt,null,String(e))}function Ot(e){return null===e.el&&-1!==e.patchFlag||e.memo?e:Lt(e)}function Nt(e,t){let s=0;const{shapeFlag:i}=e;if(null==t)t=null;else if((0,r.cy)(t))s=16;else if('object'==typeof t){if(65&i){const s=t.default;return void(s&&(s._c&&(s._d=!1),Nt(e,s()),s._c&&(s._d=!0)))}{s=32;const i=t._;i||We(t)?3===i&&k&&(1===k.slots._?t._=1:(t._=2,e.patchFlag|=1024)):t._ctx=k}}else(0,r.Tn)(t)?(t={default:t,_ctx:k},s=32):(t=String(t),64&i?(s=16,t=[kt(t)]):s=8);e.children=t,e.shapeFlag|=s}function Ut(e,t,s,i=null){o(e,t,7,[s,i])}const Gt=Me();let Vt=0;function Ht(e,t,s){const n=e.type,o=(t?t.appContext:e.appContext)||Gt,a={uid:Vt++,vnode:e,type:n,parent:t,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new i.yC(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(o.provides),ids:t?t.ids:['',0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:je(n,o),emitsOptions:De(n,o),emit:null,emitted:null,propsDefaults:r.MZ,inheritAttrs:n.inheritAttrs,ctx:r.MZ,data:r.MZ,props:r.MZ,attrs:r.MZ,slots:r.MZ,refs:r.MZ,setupState:r.MZ,setupContext:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=t?t.root:a,a.emit=ke.bind(null,a),e.ce&&e.ce(a),a}let Wt=null;const $t=()=>Wt||k;let Xt,jt;{const e=(0,r.We)(),t=(t,s)=>{let i;return(i=e[t])||(i=e[t]=[]),i.push(s),e=>{i.length>1?i.forEach(t=>t(e)):i[0](e)}};Xt=t('__VUE_INSTANCE_SETTERS__',e=>Wt=e),jt=t('__VUE_SSR_SETTERS__',e=>Zt=e)}const zt=e=>{const t=Wt;return Xt(e),e.scope.on(),()=>{e.scope.off(),Xt(t)}},Yt=()=>{Wt&&Wt.scope.off(),Xt(null)};function qt(e){return 4&e.vnode.shapeFlag}let Qt,Kt,Zt=!1;function Jt(e,t=!1,s=!1){t&&jt(t);const{props:o,children:l}=e.vnode,h=qt(e);!function(e,t,s,r=!1){const n={},o=He();e.propsDefaults=Object.create(null),$e(e,t,n,o);for(const t in e.propsOptions[0])t in n||(n[t]=void 0);s?e.props=r?n:(0,i.Gc)(n):e.type.props?e.props=n:e.props=o,e.attrs=o}(e,o,h,t),((e,t,s)=>{const i=e.slots=He();if(32&e.vnode.shapeFlag){const e=t._;e?(Je(i,t,s),s&&(0,r.yQ)(i,'_',e,!0)):Ke(t,i)}else t&&Ze(e,t)})(e,l,s||t);const u=h?function(e,t){const s=e.type;0;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,Ae),!1;const{setup:o}=s;if(o){(0,i.C4)();const s=e.setupContext=o.length>1?is(e):null,l=zt(e),h=n(o,e,0,[e.props,s]),u=(0,r.yL)(h);if((0,i.bl)(),l(),!u&&!e.sp||ae(e)||ie(e),u){if(h.then(Yt,Yt),t)return h.then(s=>{es(e,s,t)}).catch(t=>{a(t,e,0)});e.asyncDep=h}else es(e,h,t)}else ts(e,t)}(e,t):void 0;return t&&jt(!1),u}function es(e,t,s){(0,r.Tn)(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:(0,r.Gv)(t)&&(e.devtoolsRawSetupState=t,e.setupState=(0,i.Pr)(t)),ts(e,s)}function ts(e,t,s){const i=e.type;if(!e.render){if(!t&&Qt&&!i.render){const t=i.template||!1;if(t){0;const{isCustomElement:s,compilerOptions:n}=e.appContext.config,{delimiters:o,compilerOptions:a}=i,l=(0,r.X$)((0,r.X$)({isCustomElement:s,delimiters:o},n),a);i.render=Qt(t,l)}}e.render=i.render||r.tE,Kt&&Kt(e)}}const ss={get:(e,t)=>((0,i.u4)(e,'get',''),e[t])};function is(e){const t=t=>{e.exposed=t||{}};return{attrs:new Proxy(e.attrs,ss),slots:e.slots,emit:e.emit,expose:t}}function rs(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy((0,i.Pr)((0,i.IG)(e.exposed)),{get:(t,s)=>s in t?t[s]:s in Ce?Ce[s](e):void 0,has:(e,t)=>t in e||t in Ce})):e.proxy}function ns(e,t=!0){return(0,r.Tn)(e)?e.displayName||e.name:e.name||t&&e.__name}function os(e){return(0,r.Tn)(e)&&'__vccOpts'in e}const as=(e,t)=>(0,i.EW)(e,t,Zt);function ls(e,t,s){try{bt(-1);const i=arguments.length;return 2===i?(0,r.Gv)(t)&&!(0,r.cy)(t)?Ct(t)?It(e,null,[t]):It(e,t):It(e,null,t):(i>3?s=Array.prototype.slice.call(arguments,2):3===i&&Ct(s)&&(s=[s]),It(e,t,s))}finally{bt(1)}}const hs='3.5.26'}},l={};function h(e){var t=l[e];if(void 0!==t)return t.exports;var s=l[e]={exports:{}};return a[e](s,s.exports,h),s.exports}h.d=(e,t)=>{for(var s in t)h.o(t,s)&&!h.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},h.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),h.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};var u=h(165),c=h(677),d=h(35);function p(e,t){return new Promise((s,i)=>{if(t&&window[t])return void s();const r=document.createElement('script');r.src=e,r.async=!1,r.onload=()=>s(),r.onerror=()=>i(new Error(`Failed to load script: ${e}`)),document.head.appendChild(r)})}window.PIXI=u,$(()=>{(async function(){try{void 0===window.Live2D?(console.info('[Live2D]  Cubism 2.1 ...'),await p('https://cdn.jsdelivr.net/gh/dylanNew/live2d/webgl/Live2D/lib/live2d.min.js','Live2D'),console.info('[Live2D] Cubism 2.1 ')):console.info('[Live2D] Cubism 2.1  HTML '),void 0===window.Live2DCubismCore?(console.info('[Live2D]  Cubism 4 ...'),await p('https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js','Live2DCubismCore'),console.info('[Live2D] Cubism 4 ')):console.info('[Live2D] Cubism 4  HTML '),console.info('[Live2D]  Cubism 2/3/4 ')}catch(e){throw console.error('[Live2D] :',e),e}})().then(async()=>{const{default:e}=await Promise.resolve().then(h.bind(h,371));(0,c.Ef)(e).use((0,d.createPinia)()).mount('#app'),console.info('[] Vue ')}).catch(e=>{console.error('[] :',e),toastr.error('Live2D ')})});
//# sourceMappingURL=index.js.map</script><style>@import url(https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;500;700&family=Zen+Maru+Gothic:wght@400;700&display=swap);
/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */@layer properties;@layer theme,base,components,utilities;@layer theme{:root,:host{--font-sans:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--color-red-500:oklch(63.7% 0.237 25.331);--color-gray-200:oklch(92.8% 0.006 264.531);--color-black:#000;--color-white:#fff;--spacing:0.25rem;--container-md:28rem;--container-lg:32rem;--container-2xl:42rem;--container-3xl:48rem;--container-4xl:56rem;--text-xs:0.75rem;--text-xs--line-height:calc(1 / 0.75);--text-sm:0.875rem;--text-sm--line-height:calc(1.25 / 0.875);--text-base:1rem;--text-base--line-height:calc(1.5 / 1);--text-lg:1.125rem;--text-lg--line-height:calc(1.75 / 1.125);--text-xl:1.25rem;--text-xl--line-height:calc(1.75 / 1.25);--text-2xl:1.5rem;--text-2xl--line-height:calc(2 / 1.5);--font-weight-medium:500;--font-weight-semibold:600;--font-weight-bold:700;--leading-relaxed:1.625;--radius-2xl:1rem;--drop-shadow-2xl:0 25px 25px rgb(0 0 0/0.15);--ease-in-out:cubic-bezier(0.4,0,0.2,1);--animate-pulse:pulse 2s cubic-bezier(0.4,0,0.6,1) infinite;--blur-sm:8px;--blur-md:12px;--default-transition-duration:150ms;--default-transition-timing-function:cubic-bezier(0.4,0,0.2,1);--default-font-family:var(--font-sans);--default-mono-font-family:var(--font-mono);--color-background:oklch(0.97 0.02 145);--color-foreground:oklch(0.25 0.05 145);--color-card:oklch(0.99 0.01 145);--color-card-foreground:oklch(0.25 0.05 145);--color-popover:oklch(0.99 0.01 145);--color-popover-foreground:oklch(0.25 0.05 145);--color-primary:oklch(0.55 0.15 145);--color-primary-foreground:oklch(0.99 0.01 145);--color-secondary:oklch(0.92 0.03 145);--color-secondary-foreground:oklch(0.35 0.08 145);--color-muted:oklch(0.94 0.02 145);--color-muted-foreground:oklch(0.5 0.05 145);--color-accent:oklch(0.75 0.12 90);--color-accent-foreground:oklch(0.25 0.05 145);--color-destructive:oklch(0.577 0.245 27.325);--color-destructive-foreground:oklch(0.577 0.245 27.325);--color-border:oklch(0.85 0.04 145);--color-input:oklch(0.9 0.03 145);--color-ring:oklch(0.55 0.15 145)}}@layer base{*,::after,::before,::backdrop,::file-selector-button{box-sizing:border-box;margin:0;padding:0;border:0 solid}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:var(--default-font-family,ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji");font-feature-settings:var(--default-font-feature-settings,normal);font-variation-settings:var(--default-font-variation-settings,normal);-webkit-tap-highlight-color:transparent}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:var(--default-mono-font-family,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace);font-feature-settings:var(--default-mono-font-feature-settings,normal);font-variation-settings:var(--default-mono-font-variation-settings,normal);font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}:-moz-focusring{outline:auto}progress{vertical-align:baseline}summary{display:list-item}ol,ul,menu{list-style:none}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}button,input,select,optgroup,textarea,::file-selector-button{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;border-radius:0;background-color:transparent;opacity:1}:where(select:is([multiple],[size])) optgroup{font-weight:bolder}:where(select:is([multiple],[size])) optgroup option{padding-inline-start:20px}::file-selector-button{margin-inline-end:4px}::placeholder{opacity:1}@supports (not (-webkit-appearance:-apple-pay-button)) or (contain-intrinsic-size:1px){::placeholder{color:currentcolor;@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,currentcolor 50%,transparent)}}}textarea{resize:vertical}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-date-and-time-value{min-height:1lh;text-align:inherit}::-webkit-datetime-edit{display:inline-flex}::-webkit-datetime-edit-fields-wrapper{padding:0}::-webkit-datetime-edit,::-webkit-datetime-edit-year-field,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute-field,::-webkit-datetime-edit-second-field,::-webkit-datetime-edit-millisecond-field,::-webkit-datetime-edit-meridiem-field{padding-block:0}::-webkit-calendar-picker-indicator{line-height:1}:-moz-ui-invalid{box-shadow:none}button,input:where([type="button"],[type="reset"],[type="submit"]),::file-selector-button{-webkit-appearance:button;appearance:button}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[hidden]:where(:not([hidden="until-found"])){display:none !important}}@layer utilities{.pointer-events-none{pointer-events:none}.visible{visibility:visible}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip-path:inset(50%);white-space:nowrap;border-width:0}.absolute{position:absolute}.fixed{position:fixed}.relative{position:relative}.static{position:static}.sticky{position:sticky}.inset-0{inset:calc(var(--spacing) * 0)}.inset-y-2{inset-block:calc(var(--spacing) * 2)}.top-0{top:calc(var(--spacing) * 0)}.top-1\/2{top:calc(1/2 * 100%)}.top-2{top:calc(var(--spacing) * 2)}.top-4{top:calc(var(--spacing) * 4)}.right-0{right:calc(var(--spacing) * 0)}.right-1{right:calc(var(--spacing) * 1)}.right-2{right:calc(var(--spacing) * 2)}.right-3{right:calc(var(--spacing) * 3)}.right-4{right:calc(var(--spacing) * 4)}.right-6{right:calc(var(--spacing) * 6)}.bottom-0{bottom:calc(var(--spacing) * 0)}.bottom-1\.5{bottom:calc(var(--spacing) * 1.5)}.bottom-3{bottom:calc(var(--spacing) * 3)}.left-0{left:calc(var(--spacing) * 0)}.left-1{left:calc(var(--spacing) * 1)}.left-2{left:calc(var(--spacing) * 2)}.left-3{left:calc(var(--spacing) * 3)}.left-4{left:calc(var(--spacing) * 4)}.left-6{left:calc(var(--spacing) * 6)}.z-5{z-index:5}.z-10{z-index:10}.z-20{z-index:20}.z-25{z-index:25}.z-30{z-index:30}.z-40{z-index:40}.z-50{z-index:50}.container{width:100%;@media (width >= 40rem){max-width:40rem}@media (width >= 48rem){max-width:48rem}@media (width >= 64rem){max-width:64rem}@media (width >= 80rem){max-width:80rem}@media (width >= 96rem){max-width:96rem}}.mx-4{margin-inline:calc(var(--spacing) * 4)}.mx-auto{margin-inline:auto}.my-4{margin-block:calc(var(--spacing) * 4)}.mt-4{margin-top:calc(var(--spacing) * 4)}.mb-1{margin-bottom:calc(var(--spacing) * 1)}.mb-2{margin-bottom:calc(var(--spacing) * 2)}.mb-3{margin-bottom:calc(var(--spacing) * 3)}.mb-4{margin-bottom:calc(var(--spacing) * 4)}.ml-6{margin-left:calc(var(--spacing) * 6)}.ml-auto{margin-left:auto}.block{display:block}.contents{display:contents}.flex{display:flex}.grid{display:grid}.hidden{display:none}.inline{display:inline}.inline-block{display:inline-block}.inline-flex{display:inline-flex}.h-1{height:calc(var(--spacing) * 1)}.h-1\.5{height:calc(var(--spacing) * 1.5)}.h-2{height:calc(var(--spacing) * 2)}.h-3{height:calc(var(--spacing) * 3)}.h-4{height:calc(var(--spacing) * 4)}.h-5{height:calc(var(--spacing) * 5)}.h-6{height:calc(var(--spacing) * 6)}.h-7{height:calc(var(--spacing) * 7)}.h-8{height:calc(var(--spacing) * 8)}.h-9{height:calc(var(--spacing) * 9)}.h-\[1\.15rem\]{height:1.15rem}.h-\[70vh\]{height:70vh}.h-\[calc\(100\%-1px\)\]{height:calc(100% - 1px)}.h-px{height:1px}.max-h-\[85vh\]{max-height:85vh}.max-h-\[calc\(85vh-100px\)\]{max-height:calc(85vh - 100px)}.max-h-\[calc\(85vh-120px\)\]{max-height:calc(85vh - 120px)}.min-h-\[60px\]{min-height:60px}.min-h-\[120px\]{min-height:120px}.w-1{width:calc(var(--spacing) * 1)}.w-1\.5{width:calc(var(--spacing) * 1.5)}.w-2{width:calc(var(--spacing) * 2)}.w-2\/3{width:calc(2/3 * 100%)}.w-3{width:calc(var(--spacing) * 3)}.w-4{width:calc(var(--spacing) * 4)}.w-5{width:calc(var(--spacing) * 5)}.w-6{width:calc(var(--spacing) * 6)}.w-8{width:calc(var(--spacing) * 8)}.w-9{width:calc(var(--spacing) * 9)}.w-20{width:calc(var(--spacing) * 20)}.w-\[90\%\]{width:90%}.w-auto{width:auto}.w-full{width:100%}.max-w-2xl{max-width:var(--container-2xl)}.max-w-3xl{max-width:var(--container-3xl)}.max-w-4xl{max-width:var(--container-4xl)}.max-w-lg{max-width:var(--container-lg)}.max-w-md{max-width:var(--container-md)}.flex-1{flex:1}.flex-shrink{flex-shrink:1}.flex-shrink-0{flex-shrink:0}.-translate-y-1\/2{--tw-translate-y:calc(calc(1/2 * 100%) * -1);translate:var(--tw-translate-x) var(--tw-translate-y)}.transform{transform:var(--tw-rotate-x,) var(--tw-rotate-y,) var(--tw-rotate-z,) var(--tw-skew-x,) var(--tw-skew-y,)}.animate-pulse{animation:var(--animate-pulse)}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.touch-none{touch-action:none}.resize{resize:both}.resize-none{resize:none}.grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.items-end{align-items:flex-end}.items-start{align-items:flex-start}.justify-between{justify-content:space-between}.justify-center{justify-content:center}.justify-end{justify-content:flex-end}.justify-start{justify-content:flex-start}.gap-0\.5{gap:calc(var(--spacing) * 0.5)}.gap-1{gap:calc(var(--spacing) * 1)}.gap-1\.5{gap:calc(var(--spacing) * 1.5)}.gap-2{gap:calc(var(--spacing) * 2)}.gap-3{gap:calc(var(--spacing) * 3)}.space-y-1\.5{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 1.5) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 1.5) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-2{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 2) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 2) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-3{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 3) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 3) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-4{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 4) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 4) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-6{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 6) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 6) * calc(1 - var(--tw-space-y-reverse)))}}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.rounded{border-radius:0.25rem}.rounded-2xl{border-radius:var(--radius-2xl)}.rounded-full{border-radius:calc(infinity * 1px)}.rounded-lg{border-radius:var(--radius)}.rounded-md{border-radius:calc(var(--radius) - 2px)}.rounded-xl{border-radius:calc(var(--radius) + 4px)}.border{border-style:var(--tw-border-style);border-width:1px}.border-2{border-style:var(--tw-border-style);border-width:2px}.border-b{border-bottom-style:var(--tw-border-style);border-bottom-width:1px}.border-border{border-color:oklch(0.85 0.04 145)}.border-border\/30{border-color:color-mix(in oklab,oklch(0.85 0.04 145) 30%,transparent)}.border-gray-200{border-color:var(--color-gray-200)}.border-input{border-color:oklch(0.9 0.03 145)}.border-primary{border-color:oklch(0.55 0.15 145)}.border-transparent{border-color:transparent}.border-white{border-color:var(--color-white)}.bg-background{background-color:oklch(0.97 0.02 145)}.bg-black{background-color:var(--color-black)}.bg-black\/30{background-color:color-mix(in srgb,#000 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 30%,transparent)}}.bg-black\/40{background-color:color-mix(in srgb,#000 40%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 40%,transparent)}}.bg-black\/50{background-color:color-mix(in srgb,#000 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 50%,transparent)}}.bg-border{background-color:oklch(0.85 0.04 145)}.bg-border\/30{background-color:color-mix(in oklab,oklch(0.85 0.04 145) 30%,transparent)}.bg-card{background-color:oklch(0.99 0.01 145)}.bg-card\/80{background-color:color-mix(in oklab,oklch(0.99 0.01 145) 80%,transparent)}.bg-card\/95{background-color:color-mix(in oklab,oklch(0.99 0.01 145) 95%,transparent)}.bg-input{background-color:oklch(0.9 0.03 145)}.bg-muted{background-color:oklch(0.94 0.02 145)}.bg-muted\/30{background-color:color-mix(in oklab,oklch(0.94 0.02 145) 30%,transparent)}.bg-primary{background-color:oklch(0.55 0.15 145)}.bg-primary\/5{background-color:color-mix(in oklab,oklch(0.55 0.15 145) 5%,transparent)}.bg-primary\/10{background-color:color-mix(in oklab,oklch(0.55 0.15 145) 10%,transparent)}.bg-transparent{background-color:transparent}.bg-cover{background-size:cover}.bg-center{background-position:center}.bg-no-repeat{background-repeat:no-repeat}.object-contain{object-fit:contain}.p-1{padding:calc(var(--spacing) * 1)}.p-2{padding:calc(var(--spacing) * 2)}.p-3{padding:calc(var(--spacing) * 3)}.p-4{padding:calc(var(--spacing) * 4)}.p-6{padding:calc(var(--spacing) * 6)}.p-\[3px\]{padding:3px}.px-2{padding-inline:calc(var(--spacing) * 2)}.px-3{padding-inline:calc(var(--spacing) * 3)}.px-4{padding-inline:calc(var(--spacing) * 4)}.px-6{padding-inline:calc(var(--spacing) * 6)}.px-8{padding-inline:calc(var(--spacing) * 8)}.py-0\.5{padding-block:calc(var(--spacing) * 0.5)}.py-1{padding-block:calc(var(--spacing) * 1)}.py-2{padding-block:calc(var(--spacing) * 2)}.py-3{padding-block:calc(var(--spacing) * 3)}.py-4{padding-block:calc(var(--spacing) * 4)}.py-12{padding-block:calc(var(--spacing) * 12)}.pr-4{padding-right:calc(var(--spacing) * 4)}.pb-4{padding-bottom:calc(var(--spacing) * 4)}.text-center{text-align:center}.text-left{text-align:left}.text-right{text-align:right}.font-mono{font-family:var(--font-mono)}.text-base{font-size:var(--text-base);line-height:var(--tw-leading,var(--text-base--line-height))}.text-lg{font-size:var(--text-lg);line-height:var(--tw-leading,var(--text-lg--line-height))}.text-sm{font-size:var(--text-sm);line-height:var(--tw-leading,var(--text-sm--line-height))}.text-xl{font-size:var(--text-xl);line-height:var(--tw-leading,var(--text-xl--line-height))}.text-xs{font-size:var(--text-xs);line-height:var(--tw-leading,var(--text-xs--line-height))}.text-\[10px\]{font-size:10px}.leading-relaxed{--tw-leading:var(--leading-relaxed);line-height:var(--leading-relaxed)}.font-bold{--tw-font-weight:var(--font-weight-bold);font-weight:var(--font-weight-bold)}.font-medium{--tw-font-weight:var(--font-weight-medium);font-weight:var(--font-weight-medium)}.font-semibold{--tw-font-weight:var(--font-weight-semibold);font-weight:var(--font-weight-semibold)}.whitespace-nowrap{white-space:nowrap}.text-foreground{color:oklch(0.25 0.05 145)}.text-muted-foreground{color:oklch(0.5 0.05 145)}.text-primary{color:oklch(0.55 0.15 145)}.text-primary-foreground{color:oklch(0.99 0.01 145)}.text-red-500{color:var(--color-red-500)}.text-white{color:var(--color-white)}.text-white\/40{color:color-mix(in srgb,#fff 40%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-white) 40%,transparent)}}.capitalize{text-transform:capitalize}.lowercase{text-transform:lowercase}.uppercase{text-transform:uppercase}.italic{font-style:italic}.underline{text-decoration-line:underline}.opacity-0{opacity:0%}.opacity-40{opacity:40%}.opacity-50{opacity:50%}.opacity-70{opacity:70%}.opacity-100{opacity:100%}.shadow{--tw-shadow:0 1px 3px 0 var(--tw-shadow-color,rgb(0 0 0/0.1)),0 1px 2px -1px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-2xl{--tw-shadow:0 25px 50px -12px var(--tw-shadow-color,rgb(0 0 0/0.25));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 4px 6px -4px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 2px 4px -2px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 3px 0 var(--tw-shadow-color,rgb(0 0 0/0.1)),0 1px 2px -1px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 8px 10px -6px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring-2{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring-primary{--tw-ring-color:oklch(0.55 0.15 145)}.outline{outline-style:var(--tw-outline-style);outline-width:1px}.blur{--tw-blur:blur(8px);filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.drop-shadow-2xl{--tw-drop-shadow-size:drop-shadow(0 25px 25px var(--tw-drop-shadow-color,rgb(0 0 0/0.15)));--tw-drop-shadow:drop-shadow(var(--drop-shadow-2xl));filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.invert{--tw-invert:invert(100%);filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.filter{filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.backdrop-blur-md{--tw-backdrop-blur:blur(var(--blur-md));backdrop-filter:var(--tw-backdrop-blur,) var(--tw-backdrop-brightness,) var(--tw-backdrop-contrast,) var(--tw-backdrop-grayscale,) var(--tw-backdrop-hue-rotate,) var(--tw-backdrop-invert,) var(--tw-backdrop-opacity,) var(--tw-backdrop-saturate,) var(--tw-backdrop-sepia,)}.backdrop-blur-sm{--tw-backdrop-blur:blur(var(--blur-sm));backdrop-filter:var(--tw-backdrop-blur,) var(--tw-backdrop-brightness,) var(--tw-backdrop-contrast,) var(--tw-backdrop-grayscale,) var(--tw-backdrop-hue-rotate,) var(--tw-backdrop-invert,) var(--tw-backdrop-opacity,) var(--tw-backdrop-saturate,) var(--tw-backdrop-sepia,)}.backdrop-filter{backdrop-filter:var(--tw-backdrop-blur,) var(--tw-backdrop-brightness,) var(--tw-backdrop-contrast,) var(--tw-backdrop-grayscale,) var(--tw-backdrop-hue-rotate,) var(--tw-backdrop-invert,) var(--tw-backdrop-opacity,) var(--tw-backdrop-saturate,) var(--tw-backdrop-sepia,)}.transition{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to,opacity,box-shadow,transform,translate,scale,rotate,filter,backdrop-filter,display,content-visibility,overlay,pointer-events;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-all{transition-property:all;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-colors{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-opacity{transition-property:opacity;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-transform{transition-property:transform,translate,scale,rotate;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.duration-200{--tw-duration:200ms;transition-duration:200ms}.duration-300{--tw-duration:300ms;transition-duration:300ms}.duration-500{--tw-duration:500ms;transition-duration:500ms}.duration-1000{--tw-duration:1000ms;transition-duration:1000ms}.ease-in-out{--tw-ease:var(--ease-in-out);transition-timing-function:var(--ease-in-out)}.outline-none{--tw-outline-style:none;outline-style:none}.select-none{-webkit-user-select:none;user-select:none}.group-hover\:opacity-100{&:is(:where(.group):hover *){@media (hover:hover){opacity:100%}}}.peer-checked\:translate-x-\[calc\(100\%-2px\)\]{&:is(:where(.peer):checked~*){--tw-translate-x:calc(100% - 2px);translate:var(--tw-translate-x) var(--tw-translate-y)}}.peer-checked\:bg-primary{&:is(:where(.peer):checked~*){background-color:oklch(0.55 0.15 145)}}.placeholder\:text-muted-foreground{&::placeholder{color:oklch(0.5 0.05 145)}}.hover\:scale-105{&:hover{@media (hover:hover){--tw-scale-x:105%;--tw-scale-y:105%;--tw-scale-z:105%;scale:var(--tw-scale-x) var(--tw-scale-y)}}}.hover\:scale-110{&:hover{@media (hover:hover){--tw-scale-x:110%;--tw-scale-y:110%;--tw-scale-z:110%;scale:var(--tw-scale-x) var(--tw-scale-y)}}}.hover\:scale-\[1\.02\]{&:hover{@media (hover:hover){scale:1.02}}}.hover\:border-primary\/50{&:hover{@media (hover:hover){border-color:color-mix(in oklab,oklch(0.55 0.15 145) 50%,transparent)}}}.hover\:bg-black\/5{&:hover{@media (hover:hover){background-color:color-mix(in srgb,#000 5%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 5%,transparent)}}}}.hover\:bg-black\/10{&:hover{@media (hover:hover){background-color:color-mix(in srgb,#000 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 10%,transparent)}}}}.hover\:bg-card{&:hover{@media (hover:hover){background-color:oklch(0.99 0.01 145)}}}.hover\:bg-muted{&:hover{@media (hover:hover){background-color:oklch(0.94 0.02 145)}}}.hover\:bg-primary\/90{&:hover{@media (hover:hover){background-color:color-mix(in oklab,oklch(0.55 0.15 145) 90%,transparent)}}}.hover\:bg-red-500\/20{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(63.7% 0.237 25.331) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-500) 20%,transparent)}}}}.hover\:text-foreground{&:hover{@media (hover:hover){color:oklch(0.25 0.05 145)}}}.hover\:text-white\/60{&:hover{@media (hover:hover){color:color-mix(in srgb,#fff 60%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-white) 60%,transparent)}}}}.hover\:opacity-80{&:hover{@media (hover:hover){opacity:80%}}}.focus\:border-primary{&:focus{border-color:oklch(0.55 0.15 145)}}.focus\:ring-1{&:focus{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.focus\:ring-2{&:focus{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.focus\:ring-primary{&:focus{--tw-ring-color:oklch(0.55 0.15 145)}}.focus\:outline-none{&:focus{--tw-outline-style:none;outline-style:none}}.active\:scale-\[0\.98\]{&:active{scale:0.98}}.md\:gap-4{@media (width >= 48rem){gap:calc(var(--spacing) * 4)}}.md\:p-5{@media (width >= 48rem){padding:calc(var(--spacing) * 5)}}.md\:px-8{@media (width >= 48rem){padding-inline:calc(var(--spacing) * 8)}}.md\:pb-6{@media (width >= 48rem){padding-bottom:calc(var(--spacing) * 6)}}.md\:text-2xl{@media (width >= 48rem){font-size:var(--text-2xl);line-height:var(--tw-leading,var(--text-2xl--line-height))}}}html,body{width:100%;margin:0;padding:0;overflow:hidden;background:transparent}#app{width:100%;aspect-ratio:16/9;margin:0 auto;position:relative;background:transparent;overflow:hidden}@layer base{*{border-color:oklch(0.85 0.04 145);outline-color:color-mix(in oklab,oklch(0.55 0.15 145) 50%,transparent)}body{background-color:oklch(0.97 0.02 145);color:oklch(0.25 0.05 145)}}:root{--background:oklch(0.97 0.02 145);--foreground:oklch(0.25 0.05 145);--card:oklch(0.99 0.01 145);--card-foreground:oklch(0.25 0.05 145);--popover:oklch(0.99 0.01 145);--popover-foreground:oklch(0.25 0.05 145);--primary:oklch(0.55 0.15 145);--primary-foreground:oklch(0.99 0.01 145);--secondary:oklch(0.92 0.03 145);--secondary-foreground:oklch(0.35 0.08 145);--muted:oklch(0.94 0.02 145);--muted-foreground:oklch(0.5 0.05 145);--accent:oklch(0.75 0.12 90);--accent-foreground:oklch(0.25 0.05 145);--destructive:oklch(0.577 0.245 27.325);--destructive-foreground:oklch(0.577 0.245 27.325);--border:oklch(0.85 0.04 145);--input:oklch(0.9 0.03 145);--ring:oklch(0.55 0.15 145)}.dark{--background:oklch(0.145 0 0);--foreground:oklch(0.985 0 0);--card:oklch(0.145 0 0);--card-foreground:oklch(0.985 0 0);--popover:oklch(0.145 0 0);--popover-foreground:oklch(0.985 0 0);--primary:oklch(0.985 0 0);--primary-foreground:oklch(0.205 0 0);--secondary:oklch(0.269 0 0);--secondary-foreground:oklch(0.985 0 0);--muted:oklch(0.269 0 0);--muted-foreground:oklch(0.708 0 0);--accent:oklch(0.269 0 0);--accent-foreground:oklch(0.985 0 0);--destructive:oklch(0.396 0.141 25.723);--destructive-foreground:oklch(0.637 0.237 25.331);--border:oklch(0.269 0 0);--input:oklch(0.269 0 0);--ring:oklch(0.439 0 0)}*{border-color:var(--border)}body{background-color:var(--background);color:var(--foreground)}@keyframes fade-in{from{opacity:0}to{opacity:1}}@keyframes slide-in-from-left-2{from{transform:translateX(-8px);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes slide-in-from-top-2{from{transform:translateY(-8px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes slide-in-from-bottom-2{from{transform:translateY(8px);opacity:0}to{transform:translateY(0);opacity:1}}.animate-in{animation-duration:0.3s;animation-timing-function:ease-out;animation-fill-mode:both}.fade-in{animation-name:fade-in}.slide-in-from-left-2{animation-name:slide-in-from-left-2}.slide-in-from-top-2{animation-name:slide-in-from-top-2}.slide-in-from-bottom-2{animation-name:slide-in-from-bottom-2}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}@property --tw-rotate-x{syntax:"*";inherits:false}@property --tw-rotate-y{syntax:"*";inherits:false}@property --tw-rotate-z{syntax:"*";inherits:false}@property --tw-skew-x{syntax:"*";inherits:false}@property --tw-skew-y{syntax:"*";inherits:false}@property --tw-space-y-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-leading{syntax:"*";inherits:false}@property --tw-font-weight{syntax:"*";inherits:false}@property --tw-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-shadow-color{syntax:"*";inherits:false}@property --tw-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-inset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-shadow-color{syntax:"*";inherits:false}@property --tw-inset-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-ring-color{syntax:"*";inherits:false}@property --tw-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-ring-color{syntax:"*";inherits:false}@property --tw-inset-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-ring-inset{syntax:"*";inherits:false}@property --tw-ring-offset-width{syntax:"<length>";inherits:false;initial-value:0px}@property --tw-ring-offset-color{syntax:"*";inherits:false;initial-value:#fff}@property --tw-ring-offset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-outline-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-blur{syntax:"*";inherits:false}@property --tw-brightness{syntax:"*";inherits:false}@property --tw-contrast{syntax:"*";inherits:false}@property --tw-grayscale{syntax:"*";inherits:false}@property --tw-hue-rotate{syntax:"*";inherits:false}@property --tw-invert{syntax:"*";inherits:false}@property --tw-opacity{syntax:"*";inherits:false}@property --tw-saturate{syntax:"*";inherits:false}@property --tw-sepia{syntax:"*";inherits:false}@property --tw-drop-shadow{syntax:"*";inherits:false}@property --tw-drop-shadow-color{syntax:"*";inherits:false}@property --tw-drop-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-drop-shadow-size{syntax:"*";inherits:false}@property --tw-backdrop-blur{syntax:"*";inherits:false}@property --tw-backdrop-brightness{syntax:"*";inherits:false}@property --tw-backdrop-contrast{syntax:"*";inherits:false}@property --tw-backdrop-grayscale{syntax:"*";inherits:false}@property --tw-backdrop-hue-rotate{syntax:"*";inherits:false}@property --tw-backdrop-invert{syntax:"*";inherits:false}@property --tw-backdrop-opacity{syntax:"*";inherits:false}@property --tw-backdrop-saturate{syntax:"*";inherits:false}@property --tw-backdrop-sepia{syntax:"*";inherits:false}@property --tw-duration{syntax:"*";inherits:false}@property --tw-ease{syntax:"*";inherits:false}@property --tw-scale-x{syntax:"*";inherits:false;initial-value:1}@property --tw-scale-y{syntax:"*";inherits:false;initial-value:1}@property --tw-scale-z{syntax:"*";inherits:false;initial-value:1}@keyframes pulse{50%{opacity:0.5}}@layer properties{@supports ((-webkit-hyphens:none) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,::before,::after,::backdrop{--tw-translate-x:0;--tw-translate-y:0;--tw-translate-z:0;--tw-rotate-x:initial;--tw-rotate-y:initial;--tw-rotate-z:initial;--tw-skew-x:initial;--tw-skew-y:initial;--tw-space-y-reverse:0;--tw-border-style:solid;--tw-leading:initial;--tw-font-weight:initial;--tw-shadow:0 0 #0000;--tw-shadow-color:initial;--tw-shadow-alpha:100%;--tw-inset-shadow:0 0 #0000;--tw-inset-shadow-color:initial;--tw-inset-shadow-alpha:100%;--tw-ring-color:initial;--tw-ring-shadow:0 0 #0000;--tw-inset-ring-color:initial;--tw-inset-ring-shadow:0 0 #0000;--tw-ring-inset:initial;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-offset-shadow:0 0 #0000;--tw-outline-style:solid;--tw-blur:initial;--tw-brightness:initial;--tw-contrast:initial;--tw-grayscale:initial;--tw-hue-rotate:initial;--tw-invert:initial;--tw-opacity:initial;--tw-saturate:initial;--tw-sepia:initial;--tw-drop-shadow:initial;--tw-drop-shadow-color:initial;--tw-drop-shadow-alpha:100%;--tw-drop-shadow-size:initial;--tw-backdrop-blur:initial;--tw-backdrop-brightness:initial;--tw-backdrop-contrast:initial;--tw-backdrop-grayscale:initial;--tw-backdrop-hue-rotate:initial;--tw-backdrop-invert:initial;--tw-backdrop-opacity:initial;--tw-backdrop-saturate:initial;--tw-backdrop-sepia:initial;--tw-duration:initial;--tw-ease:initial;--tw-scale-x:1;--tw-scale-y:1;--tw-scale-z:1}}}

.live2d-canvas[data-v-110796a2]{width:100%;height:70vh;min-height:400px;display:block}

.status-container-wrapper[data-v-92b411dc]{width:90%;max-width:32rem;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;font-size:14px}.status-container[data-v-92b411dc]{background:linear-gradient(rgba(255,255,255,0.3),rgba(255,255,255,0.3)),url('https://pic.imgdd.cc/item/691e765bc828c4c6def97018.jpg') center center /cover no-repeat;background-color:#f4f8f2;border:1px solid #d1e5d9;border-radius:16px;overflow:hidden;box-shadow:0 4px 12px rgba(168,216,195,0.2);transition:all 0.3s ease-in-out;max-height:85vh;overflow-y:auto;scrollbar-width:none;-ms-overflow-style:none}.status-container[data-v-92b411dc]::-webkit-scrollbar{display:none}.status-header[data-v-92b411dc]{display:flex;align-items:center;padding:12px 20px;color:#5a6e65;font-weight:600;background-color:rgba(231,244,238,0.87);border-bottom:1px solid #d1e5d9;position:relative}.summary-icon[data-v-92b411dc]{margin-right:10px;font-size:1.2em;color:#a8d8c3}.status-title[data-v-92b411dc]{flex:1}.status-close[data-v-92b411dc]{background:transparent;border:none;color:#5a6e65;cursor:pointer;padding:4px;display:flex;align-items:center;justify-content:center;transition:opacity 0.2s;opacity:0.7}.status-close[data-v-92b411dc]:hover{opacity:1}.status-main-content[data-v-92b411dc]{padding:20px;display:flex;flex-direction:column;gap:16px}.status-info-bar[data-v-92b411dc]{display:flex;justify-content:space-between;background:rgba(224,242,233,0.8);padding:10px 15px;border-radius:10px;color:#5a6e65}.info-item[data-v-92b411dc]{display:flex;align-items:center;gap:8px}.status-values-grid[data-v-92b411dc]{display:grid;grid-template-columns:1fr 1fr;gap:12px}.value-card[data-v-92b411dc]{background:rgba(255,255,255,0.85);padding:12px;border-radius:8px;border:1px solid #d1e5d9;text-align:center}.value-name[data-v-92b411dc]{font-weight:600;color:#5a6e65}.value-number[data-v-92b411dc]{font-size:1.5em;color:#a8d8c3;font-weight:bold}.status-text-card[data-v-92b411dc]{background:rgba(255,255,255,0.85);padding:15px;border-radius:10px;border:1px solid #d1e5d9}.text-card-row[data-v-92b411dc]{margin-bottom:8px}.text-card-row[data-v-92b411dc]:last-child{margin-bottom:0}.text-card-label[data-v-92b411dc]{font-weight:600;color:#5a6e65;margin-right:8px;display:inline-block;background-color:rgba(224,242,233,0.9);padding:2px 8px;border-radius:12px}.text-card-content[data-v-92b411dc]{color:#788a82;white-space:pre-wrap}@media (max-width:600px){.status-info-bar[data-v-92b411dc]{flex-direction:column;gap:8px;align-items:flex-start}}

@keyframes pulse-7ebdc071{0%,100%{opacity:1}50%{opacity:0.5}}@keyframes diamondPulse-7ebdc071{0%,100%{opacity:1;transform:rotate(45deg) scale(1)}50%{opacity:0.6;transform:rotate(45deg) scale(0.8)}}@keyframes ping-7ebdc071{75%,100%{transform:scale(2);opacity:0}}@keyframes arrowBounce-7ebdc071{0%,100%{transform:translateX(0)}50%{transform:translateX(3px)}}

.note-card[data-v-68f5f8e2]{position:relative;width:100%;max-width:280px;aspect-ratio:1;background:white;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);overflow:hidden;-webkit-user-select:none;user-select:none;transition:box-shadow 0.2s}.note-card[data-v-68f5f8e2]:hover{box-shadow:0 6px 16px rgba(0,0,0,0.15)}.note-close-btn[data-v-68f5f8e2]{position:absolute;top:8px;right:8px;z-index:20;width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.9);border:1px solid rgba(16,185,129,0.2);border-radius:50%;color:#10b981;cursor:pointer;transition:all 0.2s;opacity:0.7}.note-close-btn[data-v-68f5f8e2]:hover{opacity:1;background:rgba(255,255,255,1);border-color:rgba(16,185,129,0.4);transform:scale(1.1)}.note-border[data-v-68f5f8e2]{position:absolute;inset:0;border:2px solid rgba(16,185,129,0.15);border-radius:12px;pointer-events:none}.note-dots[data-v-68f5f8e2]{position:absolute;top:12px;left:0;right:0;display:flex;justify-content:center;gap:8px;pointer-events:none;z-index:10}.note-dot[data-v-68f5f8e2]{width:6px;height:6px;border-radius:50%;background:rgba(16,185,129,0.3)}.note-lines[data-v-68f5f8e2]{position:absolute;inset:0;pointer-events:none;margin-top:48px;z-index:1}.note-line[data-v-68f5f8e2]{height:32px;border-bottom:1px solid rgba(16,185,129,0.08)}.note-binding[data-v-68f5f8e2]{position:absolute;left:16px;top:0;bottom:0;width:1px;background:linear-gradient(to bottom,transparent,rgba(16,185,129,0.2) 20%,rgba(16,185,129,0.2) 80%,transparent);pointer-events:none;z-index:2}.note-content[data-v-68f5f8e2]{position:relative;z-index:10;height:100%;padding:48px 24px 24px;overflow-y:auto}.note-content[data-v-68f5f8e2]::-webkit-scrollbar{width:4px}.note-content[data-v-68f5f8e2]::-webkit-scrollbar-thumb{background:rgba(16,185,129,0.2);border-radius:2px}.note-text[data-v-68f5f8e2]{font-size:14px;line-height:1.6;color:#374151;white-space:pre-wrap;word-break:break-word}.note-flower[data-v-68f5f8e2]{position:absolute;bottom:12px;right:12px;pointer-events:none;z-index:5;color:rgba(16,185,129,0.25)}

.theater-window[data-v-6e6d14fc]{width:90%;max-width:28rem;max-height:85vh;background:linear-gradient(to bottom,#fafffe 0%,#f0fdf4 100%);border:2px solid rgba(129,199,132,0.3);border-radius:16px;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(76,175,80,0.15);overflow:hidden}.theater-window-fullscreen[data-v-6e6d14fc]{width:90%;max-width:32rem;max-height:none;aspect-ratio:32/23}.title-bar[data-v-6e6d14fc]{height:32px;background:linear-gradient(to right,#81c784 0%,#a5d6a7 100%);display:flex;align-items:center;justify-content:space-between;padding:0 12px;color:#ffffff;font-weight:500;font-size:13px;letter-spacing:2px;-webkit-user-select:none;user-select:none;flex-shrink:0;font-family:'Zen Maru Gothic',sans-serif;box-shadow:0 2px 8px rgba(76,175,80,0.15)}.title-group[data-v-6e6d14fc]{display:flex;align-items:center;gap:8px}.icon-charm[data-v-6e6d14fc]{width:12px;height:12px;background:#ffffff;border-radius:50%;box-shadow:0 0 0 2px #66bb6a inset}.win-controls[data-v-6e6d14fc]{display:flex;gap:6px}.win-btn[data-v-6e6d14fc]{width:20px;height:20px;border-radius:50%;cursor:pointer;border:1px solid rgba(255,255,255,0.4);transition:all 0.2s;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.8);color:#4caf50;padding:0}.win-btn[data-v-6e6d14fc]:hover{transform:scale(1.1);filter:brightness(1.1);box-shadow:0 2px 4px rgba(76,175,80,0.2)}.win-btn .icon[data-v-6e6d14fc]{width:12px;height:12px}.menu-bar[data-v-6e6d14fc]{height:32px;background:rgba(232,245,233,0.5);backdrop-filter:blur(10px);border-bottom:1px solid rgba(129,199,132,0.2);display:flex;align-items:center;padding:0 16px;gap:20px;font-size:14px;color:#4caf50;flex-shrink:0;font-family:'SimSun',serif}.menu-item[data-v-6e6d14fc]{position:relative;transition:color 0.2s;cursor:pointer}.menu-item[data-v-6e6d14fc]:hover{color:#2e7d32}.menu-item[data-v-6e6d14fc]::after{content:'';position:absolute;bottom:-2px;left:0;width:0;height:2px;background:#66bb6a;transition:width 0.3s}.menu-item[data-v-6e6d14fc]:hover::after{width:100%}.menu-item-badge[data-v-6e6d14fc]{position:absolute;top:4px;right:4px;width:8px;height:8px;background:#f44336;border-radius:50%;border:1px solid rgba(255,255,255,0.8)}.contacts-sidebar[data-v-6e6d14fc]{width:200px;background:rgba(255,255,255,0.5);backdrop-filter:blur(20px);border-right:1px solid rgba(129,199,132,0.3);display:flex;flex-direction:column;overflow:hidden}.contacts-header[data-v-6e6d14fc]{padding:12px;border-bottom:1px solid rgba(129,199,132,0.2);font-size:13px;color:#4caf50;font-weight:500}.contacts-list[data-v-6e6d14fc]{flex:1;overflow-y:auto;padding:8px}.contacts-list[data-v-6e6d14fc]::-webkit-scrollbar{width:4px;background:transparent}.contacts-list[data-v-6e6d14fc]::-webkit-scrollbar-thumb{background:rgba(129,199,132,0.3);border-radius:2px}.contact-item[data-v-6e6d14fc]{display:flex;align-items:center;gap:10px;padding:10px;cursor:pointer;border-radius:8px;transition:all 0.2s;position:relative;margin-bottom:4px}.contact-item[data-v-6e6d14fc]:hover{background:rgba(129,199,132,0.15)}.contact-item.active[data-v-6e6d14fc]{background:rgba(129,199,132,0.25)}.contact-avatar[data-v-6e6d14fc]{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#81c784,#66bb6a);display:flex;align-items:center;justify-content:center;color:white;font-size:14px;font-weight:500;flex-shrink:0;position:relative}.contact-info[data-v-6e6d14fc]{flex:1;min-width:0}.contact-name[data-v-6e6d14fc]{font-size:13px;color:#2e7d32;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.contact-badge[data-v-6e6d14fc]{position:absolute;top:8px;right:8px;width:8px;height:8px;background:#f44336;border-radius:50%;display:none}.contact-item.has-unread .contact-badge[data-v-6e6d14fc]{display:block}.avatar-unread-dot[data-v-6e6d14fc]{position:absolute;top:0;right:0;width:10px;height:10px;background:#f44336;border-radius:50%;border:2px solid rgba(255,255,255,0.9);z-index:1}.chat-area[data-v-6e6d14fc]{flex:1;display:flex;flex-direction:column;min-width:0;min-height:0}.panel-body[data-v-6e6d14fc]{flex:1;display:flex;flex-direction:row;min-height:0;overflow:hidden}.display-wrapper[data-v-6e6d14fc]{flex:1;min-height:0;border:1px solid rgba(165,214,167,0.3);margin:8px 8px 0 8px;position:relative;background:rgba(255,255,255,0.4);backdrop-filter:blur(20px);overflow:hidden;box-shadow:inset 0 0 30px rgba(76,175,80,0.05);border-radius:8px;display:flex;flex-direction:column}.bg-image[data-v-6e6d14fc]{position:absolute;top:0;left:0;width:100%;height:100%;background-image:url('https://files.catbox.moe/2td8l0.jpg');background-position:center center;background-repeat:no-repeat;background-size:cover;opacity:0.15;filter:sepia(0.4) contrast(0.9);z-index:0;mix-blend-mode:multiply}.watermark-xi[data-v-6e6d14fc]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:160px;color:#81c784;font-weight:normal;-webkit-user-select:none;user-select:none;pointer-events:none;opacity:0.04;z-index:1;font-family:'Songti SC',serif;writing-mode:vertical-rl;text-shadow:none;border:4px double #a5d6a7;padding:20px}.scroll-container[data-v-6e6d14fc]{position:absolute;top:0;left:0;width:100%;height:100%;overflow-y:scroll;overflow-x:hidden;z-index:5;scroll-behavior:smooth}.scroll-container[data-v-6e6d14fc]::-webkit-scrollbar{width:6px;background:transparent}.scroll-container[data-v-6e6d14fc]::-webkit-scrollbar-thumb{background:rgba(129,199,132,0.3);border-radius:3px}.scroll-container[data-v-6e6d14fc]::-webkit-scrollbar-thumb:hover{background:rgba(129,199,132,0.6)}.chat-log[data-v-6e6d14fc]{display:flex;flex-direction:column;gap:24px;padding:30px 24px}.message-container[data-v-6e6d14fc]{display:flex;flex-direction:column;margin-bottom:16px}.message-container.message-left[data-v-6e6d14fc]{align-items:flex-start}.message-container.message-right[data-v-6e6d14fc]{align-items:flex-end}.speaker-label[data-v-6e6d14fc]{font-size:0.75em;color:#788a82;margin-bottom:4px;padding:0 8px}.timestamp[data-v-6e6d14fc]{font-size:0.75em;color:#aaa;margin-top:4px;padding:0 8px}.bubble[data-v-6e6d14fc]{max-width:80%;padding:10px 15px;border-radius:18px;position:relative;line-height:1.5;white-space:pre-wrap;word-break:break-all}.bubble-left[data-v-6e6d14fc]{background-color:rgba(224,242,233,0.9);color:#5a6e65;border-bottom-left-radius:4px;align-self:flex-start}.bubble-right[data-v-6e6d14fc]{background-color:rgba(255,255,255,0.85);color:#788a82;border:1px solid #d1e5d9;border-bottom-right-radius:4px;align-self:flex-end}.sub-text[data-v-6e6d14fc]{font-family:'KaiTi','',serif;font-size:0.9em;color:#66bb6a;margin:0 2px}.text-muted-foreground[data-v-6e6d14fc]{color:#aaa}.bg-border[data-v-6e6d14fc]{background-color:#ddd}.flex[data-v-6e6d14fc]{display:flex}.items-center[data-v-6e6d14fc]{align-items:center}.gap-3[data-v-6e6d14fc]{gap:12px}.my-4[data-v-6e6d14fc]{margin-top:16px;margin-bottom:16px}.px-4[data-v-6e6d14fc]{padding-left:16px;padding-right:16px}.text-xs[data-v-6e6d14fc]{font-size:0.75rem}.select-none[data-v-6e6d14fc]{-webkit-user-select:none;user-select:none}.flex-1[data-v-6e6d14fc]{flex:1}.h-px[data-v-6e6d14fc]{height:1px}.whitespace-nowrap[data-v-6e6d14fc]{white-space:nowrap}.cursor[data-v-6e6d14fc]{display:inline-block;width:6px;height:6px;background:#4caf50;border-radius:50%;animation:blink-6e6d14fc 1s infinite;margin-left:4px;vertical-align:middle}.cmd-bar[data-v-6e6d14fc]{height:48px;min-height:48px;background:rgba(232,245,233,0.5);backdrop-filter:blur(10px);padding:8px 16px;display:flex;align-items:center;gap:10px;flex-shrink:0;border-top:1px solid rgba(165,214,167,0.3)}.cmd-input-wrapper[data-v-6e6d14fc]{flex:1;position:relative;display:flex;align-items:center}.cmd-input[data-v-6e6d14fc]{flex:1;width:100%;height:32px;background:rgba(255,255,255,0.7);border:1px solid rgba(129,199,132,0.3);border-radius:16px;font-family:'Noto Serif SC',sans-serif;font-size:14px;color:#2e7d32;padding:0 40px 0 12px;outline:none;transition:all 0.3s}.cmd-input[data-v-6e6d14fc]:focus{border-color:#66bb6a;background:rgba(255,255,255,0.9)}.cmd-input[data-v-6e6d14fc]:disabled{opacity:0.6;cursor:not-allowed}.cmd-newline-btn-inline[data-v-6e6d14fc]{position:absolute;right:8px;top:50%;transform:translateY(-50%);padding:4px;width:24px;height:24px;background:transparent;border:none;color:#81c784;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;border-radius:50%}.cmd-newline-btn-inline[data-v-6e6d14fc]:hover:not(:disabled){background:rgba(129,199,132,0.15);color:#4caf50}.cmd-newline-btn-inline[data-v-6e6d14fc]:disabled{opacity:0.3;cursor:not-allowed}.cmd-newline-btn-inline .icon[data-v-6e6d14fc]{width:16px;height:16px}.cmd-send-btn[data-v-6e6d14fc]{padding:6px 16px;height:32px;background:rgba(129,199,132,0.8);border:1px solid rgba(129,199,132,0.5);border-radius:16px;color:white;font-size:13px;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;min-width:40px}.cmd-send-btn[data-v-6e6d14fc]:hover:not(:disabled){background:rgba(129,199,132,1);transform:translateY(-1px);box-shadow:0 2px 8px rgba(76,175,80,0.3)}.cmd-send-btn[data-v-6e6d14fc]:disabled{opacity:0.5;cursor:not-allowed}.cmd-send-btn .icon[data-v-6e6d14fc]{width:16px;height:16px}.status-bar[data-v-6e6d14fc]{height:48px;min-height:48px;background:rgba(240,253,244,0.8);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;gap:24px;padding:0 10px;flex-shrink:0;z-index:20}.jade-btn[data-v-6e6d14fc]{padding:6px 18px;background:rgba(255,255,255,0.6);backdrop-filter:blur(10px);border:1.5px solid rgba(129,199,132,0.4);border-radius:20px;font-family:'Zen Maru Gothic',sans-serif;font-size:11px;color:#4caf50;cursor:pointer;outline:none;transition:all 0.3s;display:flex;align-items:center;gap:4px}.jade-btn[data-v-6e6d14fc]:hover{background:rgba(129,199,132,0.2);color:#2e7d32;border-color:#66bb6a;transform:translateY(-2px);box-shadow:0 4px 12px rgba(76,175,80,0.15)}.jade-btn-red[data-v-6e6d14fc]:hover{border-color:#81c784;color:#43a047;background:rgba(165,214,167,0.2)}.refresh-indicator[data-v-6e6d14fc]{position:absolute;top:10px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.9);backdrop-filter:blur(10px);padding:8px 16px;border-radius:20px;border:1px solid rgba(129,199,132,0.3);box-shadow:0 2px 8px rgba(76,175,80,0.2);z-index:10;font-size:12px;color:#2e7d32}.refresh-spinner[data-v-6e6d14fc]{width:16px;height:16px;border:2px solid rgba(129,199,132,0.3);border-top-color:#4caf50;border-radius:50%;animation:spin-6e6d14fc 1s linear infinite}@keyframes spin-6e6d14fc{to{transform:rotate(360deg)}}.settings-overlay[data-v-6e6d14fc]{position:absolute;inset:0;z-index:100;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);backdrop-filter:blur(4px)}.settings-panel[data-v-6e6d14fc]{background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border-radius:12px;border:2px solid rgba(129,199,132,0.3);box-shadow:0 10px 40px rgba(76,175,80,0.2);width:90%;max-width:400px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column}.settings-header[data-v-6e6d14fc]{background:linear-gradient(to right,#66bb6a 0%,#81c784 100%);color:white;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(129,199,132,0.3)}.settings-header h3[data-v-6e6d14fc]{margin:0;font-size:16px;font-weight:500}.settings-close[data-v-6e6d14fc]{background:transparent;border:none;color:white;font-size:24px;line-height:1;cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;transition:opacity 0.2s}.settings-close[data-v-6e6d14fc]:hover{opacity:0.8}.settings-body[data-v-6e6d14fc]{padding:20px;overflow-y:auto}.settings-item[data-v-6e6d14fc]{margin-bottom:20px}.settings-item label[data-v-6e6d14fc]{display:block;margin-bottom:8px;font-size:14px;color:#2e7d32;font-weight:500}.settings-input[data-v-6e6d14fc]{width:100%;padding:8px 12px;border:1px solid rgba(129,199,132,0.3);border-radius:8px;font-size:14px;color:#2e7d32;background:rgba(255,255,255,0.8);outline:none;transition:all 0.3s;box-sizing:border-box}.settings-input[data-v-6e6d14fc]:focus{border-color:#66bb6a;background:rgba(255,255,255,1)}.settings-btn[data-v-6e6d14fc]{margin-top:8px;padding:6px 16px;background:rgba(129,199,132,0.8);border:1px solid rgba(129,199,132,0.5);border-radius:8px;color:white;font-size:12px;cursor:pointer;transition:all 0.2s}.settings-btn[data-v-6e6d14fc]:hover{background:rgba(129,199,132,1);transform:translateY(-1px);box-shadow:0 2px 8px rgba(76,175,80,0.3)}@keyframes blink-6e6d14fc{0%{opacity:0.2;transform:scale(0.8)}50%{opacity:1;transform:scale(1.2)}100%{opacity:0.2;transform:scale(0.8)}}@media (max-width:800px){.theater-window[data-v-6e6d14fc]:not(.theater-window-fullscreen){width:95%;max-width:28rem}.theater-window[data-v-6e6d14fc]{max-height:90vh}.theater-window-fullscreen[data-v-6e6d14fc]{width:90%;max-width:28rem;border-radius:12px;max-height:90vh}}

input[type='text'][data-v-6137eb39]{font-family:monospace}

.settings-scroll-container[data-v-783ad584]{scrollbar-width:none;-ms-overflow-style:none}.settings-scroll-container[data-v-783ad584]::-webkit-scrollbar{display:none}input[type='range'][data-v-783ad584]{-webkit-appearance:none;appearance:none;height:6px;background:var(--muted);border-radius:9999px;outline:none}input[type='range'][data-v-783ad584]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:var(--primary);border-radius:9999px;cursor:pointer}input[type='range'][data-v-783ad584]::-moz-range-thumb{width:16px;height:16px;background:var(--primary);border-radius:9999px;cursor:pointer;border:none}

.history-scroll-container[data-v-466895fe]{scrollbar-width:none;-ms-overflow-style:none}.history-scroll-container[data-v-466895fe]::-webkit-scrollbar{display:none}.history-message-item[data-v-466895fe]{position:relative;margin-bottom:0}.history-message-item[data-v-466895fe]:hover{background-color:rgba(0,0,0,0.04)}


/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div></body>