<head><script src="https://cdn.jsdelivr.net/gh/dylanNew/live2d/webgl/Live2D/lib/live2d.min.js"></script><script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script><script type="module">import{Live2DModel as e}from'https://testingcf.jsdelivr.net/npm/pixi-live2d-display/+esm';var t={61(e){e.exports=Vue},315(e){e.exports=PIXI},407(e,t,o){o.d(t,{default:()=>Xo});var n=o(61);const a=[{id:'none',name:'æ— ',pattern:''},{id:'grid',name:'æ–¹æ ¼',pattern:'linear-gradient(to right, VAR_BORDER_COLOR 1px, transparent 1px), linear-gradient(to bottom, VAR_BORDER_COLOR 1px, transparent 1px)'},{id:'dots',name:'åœ†ç‚¹',pattern:'radial-gradient(circle, VAR_BORDER_COLOR 1px, transparent 1px)'},{id:'diamonds',name:'è±å½¢',pattern:'linear-gradient(45deg, VAR_BORDER_COLOR 25%, transparent 25%), linear-gradient(-45deg, VAR_BORDER_COLOR 25%, transparent 25%), linear-gradient(45deg, transparent 75%, VAR_BORDER_COLOR 75%), linear-gradient(-45deg, transparent 75%, VAR_BORDER_COLOR 75%)'},{id:'stripes',name:'æ¡çº¹',pattern:'repeating-linear-gradient(45deg, transparent, transparent 10px, VAR_BORDER_COLOR 10px, VAR_BORDER_COLOR 20px)'},{id:'gradient-soft',name:'æŸ”å…‰æ¸å˜',pattern:'linear-gradient(135deg, rgba(255,255,255,0.15) 0%, transparent 50%, VAR_BORDER_COLOR 100%)'}],l=[{id:'rounded',name:'åœ†è§’',borderRadius:'12px',borderWidth:'1px',shadow:'0 4px 20px rgba(0,0,0,0.08)'},{id:'pill',name:'æ¯›ç»ç’ƒ',borderRadius:'24px',borderWidth:'1px',shadow:'0 4px 24px rgba(0,0,0,0.1)'},{id:'sharp',name:'ç›´è§’',borderRadius:'0px',borderWidth:'2px',shadow:'4px 4px 0 rgba(0,0,0,0.1)'},{id:'soft',name:'æŸ”å’Œ',borderRadius:'16px',borderWidth:'0px',shadow:'0 8px 32px rgba(0,0,0,0.12)'},{id:'frame',name:'ç”»æ¡†',borderRadius:'4px',borderWidth:'3px',shadow:'inset 0 0 0 1px rgba(0,0,0,0.05)'}],r=[{id:'none',name:'æ— ',width:'0px'},{id:'thin',name:'ç»†',width:'1px'},{id:'medium',name:'ä¸­',width:'2px'},{id:'thick',name:'ç²—',width:'3px'},{id:'bold',name:'åŠ ç²—',width:'4px'}],s=[{id:'tag',name:'æ ‡ç­¾',borderRadius:'6px 6px 0 0',style:'tag'},{id:'pill',name:'èƒ¶å›Š',borderRadius:'999px',style:'pill'},{id:'square',name:'æ–¹å½¢',borderRadius:'0px',style:'square'},{id:'underline',name:'ä¸‹åˆ’çº¿',borderRadius:'0px',style:'underline'},{id:'floating',name:'æ‚¬æµ®',borderRadius:'8px',style:'floating'}],i=[{id:'circle',name:'åœ†å½¢',type:'circle',isInner:!1},{id:'square',name:'æ–¹å½¢',type:'square',isInner:!1},{id:'pill',name:'èƒ¶å›Š',type:'pill',isInner:!1},{id:'minimal',name:'æç®€',type:'minimal',isInner:!1},{id:'inner-round',name:'å†…åµŒåœ†',type:'inner-round',isInner:!0},{id:'inner-square',name:'å†…åµŒæ–¹',type:'inner-square',isInner:!0}],c=[{id:'dots',name:'å‘¼å¸ç‚¹',type:'dots'},{id:'diamonds',name:'è±å½¢',type:'diamonds'},{id:'pulse',name:'è„‰å†²',type:'pulse'},{id:'arrow',name:'ç®­å¤´',type:'arrow'},{id:'none',name:'æ— ',type:'none'}],d={boxShape:'rounded',nameShape:'tag',arrowShape:'circle',indicatorShape:'dots',backgroundPattern:'none',borderWidth:'thin',colors:{boxBackground:'rgba(255, 255, 255, 0.9)',boxBorder:'rgba(16, 185, 129, 0.3)',nameBackground:'rgba(236, 253, 245, 0.9)',nameText:'#059669',nameBorder:'rgba(16, 185, 129, 0.3)',dialogText:'#374151',narrationText:'#6b7280',arrowBackground:'rgba(255, 255, 255, 0.85)',arrowIcon:'#10b981',indicatorColor:'#10b981'},fontSize:16};function u(e){const t=e.match(/```json\s*([\s\S]*?)\s*```/);if(t)try{return JSON.parse(t[1])}catch(e){console.warn('è§£æä¸–ç•Œä¹¦ JSON æ•°æ®å¤±è´¥:',e)}try{return JSON.parse(e.trim())}catch(e){return console.warn('è§£æä¸–ç•Œä¹¦ JSON æ•°æ®å¤±è´¥:',e),null}}let m=null,p=0,v='';async function h(){const e=Date.now();let t='';try{t=new RawCharacter(RawCharacter.find({name:'current'})).getCardData().name||''}catch(e){console.warn('è·å–å½“å‰è§’è‰²å¡åç§°å¤±è´¥:',e)}if(m&&e-p<5e3&&v===t)return m;const o={models:new Map,sprites:null,backgrounds:null,cgs:null},n=[];try{const e=getCharWorldbookNames('current');e.primary&&n.push(e.primary),n.push(...e.additional)}catch(e){console.warn('è·å–è§’è‰²å¡ä¸–ç•Œä¹¦å¤±è´¥:',e)}0===n.length&&n.push('å¼€åœºç•Œé¢-æ¨¡å‹æ•°æ®'),console.info('[ä¸–ç•Œä¹¦åŠ è½½] å‡†å¤‡åŠ è½½ä¸–ç•Œä¹¦:',n);for(const e of n)try{if('function'!=typeof getWorldbook){console.warn('[ä¸–ç•Œä¹¦åŠ è½½] getWorldbook å‡½æ•°ä¸å­˜åœ¨ï¼Œå¯èƒ½ä¸åœ¨é…’é¦†ç¯å¢ƒä¸­');continue}const t=await getWorldbook(e);console.info(`[ä¸–ç•Œä¹¦åŠ è½½] ä» ${e} è·å–åˆ° ${t.length} ä¸ªæ¡ç›®`);for(const e of t){if(!e.enabled)continue;const t=u(e.content);if(t){if(console.info(`[ä¸–ç•Œä¹¦åŠ è½½] è§£ææ¡ç›®: ${e.name}, type=${t.type}`),'live2d_model'===t.type){const e=t;o.models.has(e.modelName)||o.models.set(e.modelName,e)}else if('sprite'===t.type){const e=t;if(console.info(`[ç«‹ç»˜åŠ è½½] å‘ç°ç«‹ç»˜èµ„æºæ¡ç›®ï¼ŒåŒ…å« ${e.sprites?.length||0} ä¸ªç«‹ç»˜`),e.sprites&&e.sprites.length>0)for(const t of e.sprites)console.info(`[ç«‹ç»˜åŠ è½½] ç«‹ç»˜: ${t.name}, textMappings: ${t.textMappings?.join(', ')}`);if(o.sprites){const t=o.sprites,n=e;t.sprites.push(...n.sprites)}else o.sprites=e;console.info('[ç«‹ç»˜åŠ è½½] åˆå¹¶ç«‹ç»˜èµ„æºï¼Œå½“å‰æ€»æ•°:',o.sprites.sprites.length)}else if('background'===t.type)if(o.backgrounds){const e=o.backgrounds,n=t;e.backgrounds.push(...n.backgrounds)}else o.backgrounds=t;else if('cg'===t.type)if(o.cgs){const e=o.cgs,n=t;e.cgs.push(...n.cgs)}else o.cgs=t}else console.warn(`[ä¸–ç•Œä¹¦åŠ è½½] æ— æ³•è§£ææ¡ç›®: ${e.name}`)}}catch(t){console.warn(`åŠ è½½ä¸–ç•Œä¹¦ ${e} å¤±è´¥:`,t)}return m=o,p=e,v=t,console.info('[ä¸–ç•Œä¹¦åŠ è½½] åŠ è½½å®Œæˆï¼Œç¼“å­˜çŠ¶æ€:',{æ¨¡å‹æ•°é‡:o.models.size,ç«‹ç»˜æ•°é‡:o.sprites?.sprites?.length||0,èƒŒæ™¯æ•°é‡:o.backgrounds?.backgrounds?.length||0,CGæ•°é‡:o.cgs?.cgs?.length||0}),o}function f(e){return e.replace(/[-/\\_.\s]/g,'').toLowerCase()}function g(e,t){const o=f(e),n=f(t);return o===n||o.includes(n)||n.includes(o)}function y(e){const t={},o=e.split('||').map(e=>e.trim()).filter(e=>e);for(const e of o){const o=e.match(/^([^ï¼š:]+)[ï¼š:]\s*(.+)$/);if(o){const e=o[1].trim(),n=o[2].trim();e&&n&&(t[e]=n)}}return t}async function x(e,t,o,n,a){const l={};try{const r=await h();if(t&&r.backgrounds)for(const e of r.backgrounds.backgrounds){const o=t;if(g(e.name,o)||e.textMappings?.some(e=>g(e,o))){l.sceneImageUrl=e.file;break}}if(a&&r.cgs)for(const e of r.cgs.cgs){const t=a;if(g(e.name,t)||e.textMappings?.some(e=>g(e,t))){l.cgImageUrl=e.file;break}}if(e&&r.sprites){const t=e;console.info('[ç«‹ç»˜åŒ¹é…] å¼€å§‹åŒ¹é…ç«‹ç»˜ï¼Œè§’è‰²å:',e,'å¯ç”¨ç«‹ç»˜æ•°é‡:',r.sprites.sprites.length,'ç«‹ç»˜åˆ—è¡¨:',r.sprites.sprites.map(e=>({name:e.name,textMappings:e.textMappings})));for(const e of r.sprites.sprites){const o=e.textMappings?.some(e=>{const o=g(e,t);return console.info('[ç«‹ç»˜åŒ¹é…] æ£€æŸ¥ textMapping:',{mapping:e,matchText:t,result:o}),o}),n=g(e.name,t);if(console.info('[ç«‹ç»˜åŒ¹é…] æ£€æŸ¥ç«‹ç»˜:',{spriteName:e.name,textMappingMatch:o,nameMatch:n}),o||n){l.spriteImageUrl=e.file,console.info('[ç«‹ç»˜åŒ¹é…] åŒ¹é…æˆåŠŸ! sprite:',e.name,'textMappingsåŒ¹é…:',o,'nameåŒ¹é…:',n,'URL:',e.file);break}}l.spriteImageUrl||console.warn('[ç«‹ç»˜åŒ¹é…] æœªæ‰¾åˆ°åŒ¹é…çš„ç«‹ç»˜ï¼Œè§’è‰²å:',e)}else e&&!r.sprites&&console.warn('[ç«‹ç»˜åŒ¹é…] ä¸–ç•Œä¹¦ä¸­æ²¡æœ‰ç«‹ç»˜èµ„æºæ•°æ®ï¼Œè§’è‰²å:',e);const s=[];e&&s.push(e),t&&s.push(t),o&&s.push(o),n&&s.push(n);let i=null;for(const[e,t]of r.models.entries())if(s.some(t=>g(e,t))){i=t;break}if(i){if(o){let e=!1;if(i.motions&&i.motions.length>0)for(const t of i.motions)if('motion'===t.motionType&&t.textMappings&&t.textMappings.length>0){if(t.textMappings.some(e=>g(e,o))){l.motionFile=t.file,e=!0,console.info('[ä¸–ç•Œä¹¦åŒ¹é…] é€šè¿‡æ–°æ ¼å¼ textMappings åŒ¹é…åˆ°åŠ¨ä½œ:',{motionName:t.name,motionFile:t.file,matchedText:o});break}}if(!e&&i.textMappings?.motion)for(const[t,n]of Object.entries(i.textMappings.motion))if(g(n,o)){const o=(i.motions||[]).find(e=>e.file===t||e.name===t);if(o){l.motionFile=o.file,e=!0;break}}if(!e)for(const e of i.motions||[])if('motion'===e.motionType&&(g(e.name,o)||g(e.file,o))){l.motionFile=e.file;break}}if(n){let e=!1;if(i.motions&&i.motions.length>0)for(const t of i.motions)if('expression'===t.motionType&&t.textMappings&&t.textMappings.length>0){if(t.textMappings.some(e=>g(e,n))){l.expressionFile=t.file,e=!0,console.info('[ä¸–ç•Œä¹¦åŒ¹é…] é€šè¿‡æ–°æ ¼å¼ textMappings åŒ¹é…åˆ°è¡¨æƒ…:',{motionName:t.name,motionFile:t.file,matchedText:n});break}}if(!e&&i.textMappings?.expression)for(const[t,o]of Object.entries(i.textMappings.expression))if(g(o,n)){const o=(i.expressions||[]).find(e=>e.file===t||e.name===t);if(o){l.expressionFile=o.file,e=!0;break}}if(!e){for(const t of i.motions||[])if('expression'===t.motionType&&(g(t.name,n)||g(t.file,n))){l.expressionFile=t.file,e=!0;break}if(!e&&i.expressions)for(const e of i.expressions){const t='string'==typeof e?e:e.name||e.file,o='string'==typeof e?e:e.file;if(g(t,n)||g(o,n)){l.expressionFile=o;break}}}}}}catch(e){console.warn('åŒ¹é…ä¸–ç•Œä¹¦èµ„æºå¤±è´¥:',e)}return l}function b(e){const t=e.match(/<StatusBlock>([\s\S]*?)<\/StatusBlock>/i);if(!t)return null;const o={},n=t[1].trim().replace(/<skit>[\s\S]*?<\/skit>/gi,'').split('\n');let a=null,l=[];for(const e of n){const t=e.trim(),n=t.match(/^([^ï¼š:]+)[ï¼š:]\s*(.*)$/);if(n){if(a){const e=l.join('\n').trim();e&&(o[a]=e)}a=n[1].trim();const e=n[2].trim();l=e?[e]:[]}else a&&t&&l.push(t)}return a&&(o[a]=l.join('\n').trim()),Object.keys(o).length>0?o:null}function k(e){if(!e)return!1;const t=e.trim().toLowerCase();return'<user>'===t||'{{user}}'===t||'user'===t||'ç”¨æˆ·'===t||'ä½ '===t}async function w(e,t){const o=[];let n=t;const a=e.match(/<content>([\s\S]*?)<\/content>/i),l=a?a[1]:e,r=[],s=/\[\[(\w+)\|\|([^\]]*)\]\]/g;let i;for(;null!==(i=s.exec(l));)r.push({type:'format',start:i.index,end:i.index+i[0].length,match:i});const c=l.split('\n');let d=0,u=[],m=-1;for(let e=0;e<c.length;e++){const t=c[e],o=t.trim(),n=d,a=d+t.length;if(o.startsWith('> ')){0===u.length&&(m=n);const e=o.substring(2);u.push(e)}else if(u.length>0&&''===o)u.push('');else if(u.length>0&&!o.startsWith('> ')){const e=u.join('\n').trim();e&&r.push({type:'note',start:m,end:n,noteContent:e}),u=[],m=-1}d=a+1}if(u.length>0){const e=u.join('\n').trim();e&&r.push({type:'note',start:m,end:d,noteContent:e})}r.sort((e,t)=>e.start-t.start);for(const e of r){if('note'===e.type){o.push({type:'note',noteContent:e.noteContent});continue}i=e.match;const t=i[1],a=i[2];if('character'===t){const e=y(a),t=e['è§’è‰²å']||e.character||'';if(k(t)){const t=e['åœºæ™¯']||e.scene||n;let l=e['å°è¯']||e['å°è¯å†…å®¹']||e.text||a;const r=/ã€([^ã€‘]+)ã€‘/g,s=[];let i;for(;null!==(i=r.exec(l));)s.push(i[1]);l=l.replace(r,'').trim(),t&&(n=t);for(const e of s){const n={type:'narration',scene:t,message:e};if(t){const e=await x(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(n.sceneImageUrl=e.sceneImageUrl)}o.push(n)}const c={type:'user',scene:t,message:l};if(t){const e=await x(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(c.sceneImageUrl=e.sceneImageUrl)}o.push(c);continue}const l={type:'character'};l.character=t;const r=e['CGåœºæ™¯']||e['cgåœºæ™¯']||e.CG||e.cg;r?(l.scene=r,l.text=e['å°è¯']||e.text||'',l.isCG=!0):(l.scene=e['åœºæ™¯']||e.scene||n,l.motion=e['åŠ¨ä½œ']||e.motion||'',l.expression=e['è¡¨æƒ…']||e.expression||'',l.text=e['å°è¯']||e.text||'',l.isCG=!1),!l.scene&&n&&(l.scene=n),l.scene&&(n=l.scene),console.info('[æ¶ˆæ¯è§£æ] å¼€å§‹åŒ¹é…ä¸–ç•Œä¹¦èµ„æº:',{character:l.character,scene:l.isCG?void 0:l.scene,motion:l.motion,expression:l.expression,cgScene:l.isCG?l.scene:void 0,isCGMode:l.isCG});const s=await x(l.character,l.isCG?void 0:l.scene,l.motion,l.expression,l.isCG?l.scene:void 0);console.info('[æ¶ˆæ¯è§£æ] åŒ¹é…åˆ°çš„èµ„æº:',s),Object.assign(l,s),o.push(l)}else if('narration'===t){const e=y(a),t=e['åœºæ™¯']||e.scene||n;t&&(n=t);const l={type:'narration',scene:t,message:e['æ—ç™½']||e['æ—ç™½å†…å®¹']||e.text||e['å†…å®¹']||a};if(t){const e=await x(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(l.sceneImageUrl=e.sceneImageUrl)}o.push(l)}else if('blacktext'===t){const e=y(a),t=e['é»‘å±æ–‡å­—']||e.text||e['æ–‡å­—']||a;o.push({type:'blacktext',message:t})}else if('user'===t){const e=y(a),t=e['åœºæ™¯']||e.scene||n;let l=e['å°è¯']||e['ç”¨æˆ·æ¶ˆæ¯']||e['æ¶ˆæ¯']||e.text||a;const r=/ã€([^ã€‘]+)ã€‘/g,s=[];let i;for(;null!==(i=r.exec(l));)s.push(i[1]);l=l.replace(r,'').trim(),t&&(n=t);for(const e of s){const n={type:'narration',scene:t,message:e};if(t){const e=await x(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(n.sceneImageUrl=e.sceneImageUrl)}o.push(n)}const c={type:'user',scene:t,message:l};if(t){const e=await x(void 0,t,void 0,void 0,void 0);e.sceneImageUrl&&(c.sceneImageUrl=e.sceneImageUrl)}o.push(c)}else if('choice'===t){const e=y(a),t=e['è§’è‰²å']||e.character||e['å°è¯']||e.response||e.text||e['æ—ç™½']||e.narration,n=[];for(const t in e)if(t.match(/^é€‰é¡¹\d+ï¼š?$/)){const e=t.replace(/^é€‰é¡¹(\d+)ï¼š?$/,'$1');n.push(e)}if(n.sort((e,t)=>parseInt(e)-parseInt(t)),1===n.length&&t){const t=`é€‰é¡¹${n[0]}`,a=e[t]||e[`${t}ï¼š`];a&&o.push({type:'choice',choiceFormat:'format1',options:[{id:'choice_0',text:a,character:e['è§’è‰²å']||e.character,response:e['å°è¯']||e.response||e.text||e['æ—ç™½']||e.narration}]})}else if(n.length>1){const t=[];for(const o of n){const n=`é€‰é¡¹${o}`,a=e[n]||e[`${n}ï¼š`];a&&t.push(a)}t.length>0&&o.push({type:'choice',choiceFormat:'format2',choices:t})}}}return o}function C(e,t,o,n){if(!e||!n||0===n.length)return!1;const a=n.find(t=>t.name===e);if(!a)return!1;if(t){let e=!1;if(e=a.motions?.some(e=>{const o='string'==typeof e?e:e.name||e.file;return o===t||o===`${t}.motion3.json`}),!e&&a.textMappings?.motion)for(const[o,n]of Object.entries(a.textMappings.motion)){const l=f(t),r=f(String(n));if((l===r||l.includes(r)||r.includes(l))&&(e=a.motions?.some(e=>{const t='string'==typeof e?e:e.file;return t===o||t===`${o}.motion3.json`}),e))break}if(!e)return!1}if(o){let e=!1;if(e=a.expressions?.some(e=>{const t='string'==typeof e?e:e.name||e.file;return t===o||t===`${o}.exp3.json`}),!e&&a.textMappings?.expression)for(const[t,n]of Object.entries(a.textMappings.expression)){const l=f(o),r=f(String(n));if((l===r||l.includes(r)||r.includes(l))&&(e=a.expressions?.some(e=>{const o='string'==typeof e?e:e.file;return o===t||o===`${t}.exp3.json`}),e))break}if(!e)return!1}return!0}var N=o(315),V=o(521);class E{canvas=null;app=null;model=null;isInitialized=!1;config=null;getDisplaySize(){const e=this.app?.renderer?.screen?.width,t=this.app?.renderer?.screen?.height;if(e&&t)return{width:e,height:t};return{width:this.canvas?.clientWidth||this.canvas?.offsetWidth||this.canvas?.width||800,height:this.canvas?.clientHeight||this.canvas?.offsetHeight||this.canvas?.height||600}}async init(e){if(!this.isInitialized)try{const t=e.clientWidth||e.offsetWidth||800,o=e.clientHeight||e.offsetHeight||600;console.info('[PixiLive2DRenderer] å¼€å§‹åˆå§‹åŒ–ï¼Œcanvas:',{exists:!!e,clientWidth:e.clientWidth,clientHeight:e.clientHeight,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,finalWidth:t,finalHeight:o}),0!==e.clientWidth&&0!==e.clientHeight||console.warn('[PixiLive2DRenderer] Canvas å°ºå¯¸ä¸º 0ï¼Œä½¿ç”¨åå¤‡å€¼:',{width:t,height:o}),this.canvas=e,this.app=new N.Application({view:e,autoStart:!0,width:t,height:o,backgroundColor:0,backgroundAlpha:0,antialias:!0,resolution:window.devicePixelRatio||1,autoDensity:!0}),console.info('[PixiLive2DRenderer] Pixi åº”ç”¨åˆ›å»ºæˆåŠŸ',{screenWidth:this.app.renderer?.screen?.width,screenHeight:this.app.renderer?.screen?.height}),this.app.renderer?.screen||console.warn('[PixiLive2DRenderer] renderer.screen ä¸å¯ç”¨ï¼Œåç»­å°†ä½¿ç”¨ canvas å°ºå¯¸ä½œä¸ºåå¤‡');new ResizeObserver(()=>{this.resize()}).observe(e),this.isInitialized=!0,console.info('[PixiLive2DRenderer] æ¸²æŸ“å™¨åˆå§‹åŒ–æˆåŠŸ')}catch(e){const t=e instanceof Error?e.message:String(e),o=e instanceof Error?e.stack:void 0;throw console.error('[PixiLive2DRenderer] æ¸²æŸ“å™¨åˆå§‹åŒ–å¤±è´¥:',t),o&&console.error('[PixiLive2DRenderer] åˆå§‹åŒ–é”™è¯¯å †æ ˆ:',o),console.error('[PixiLive2DRenderer] åˆå§‹åŒ–é”™è¯¯è¯¦æƒ…:',JSON.stringify({message:t,stack:o},null,2)),e}}async loadModel(e){if(!this.isInitialized||!this.app)throw new Error('æ¸²æŸ“å™¨æœªåˆå§‹åŒ–');try{console.info(`[PixiLive2DRenderer] å¼€å§‹åŠ è½½æ¨¡å‹: "${e.name}"`);const t=await V.live2dModelManager.getOrLoadModel(e);this.model&&this.app.stage.removeChild(this.model),this.model=t,this.config=e,this.app.stage.addChild(t),t.anchor.set(.5,1);const{width:o,height:n}=this.getDisplaySize(),a=.3*Math.min(o/t.width,n/t.height);if(t.scale.set(a),t.x=o/2,t.y=n,t.alpha=1,t.visible=!0,console.info(`[PixiLive2DRenderer] æ¨¡å‹ "${e.name}" å·²åŠ è½½å¹¶æ·»åŠ åˆ°èˆå°`),e.defaultAnimation){if(e.defaultAnimation.motion){const t=e.motions?.find(t=>(t.name===e.defaultAnimation?.motion||t.file===e.defaultAnimation?.motion)&&'expression'!==t.motionType);if(t&&void 0!==t.index){const e=t.group??'default';this.playMotion(e,t.index,1)}else if(t){const t=e.motions?.findIndex(t=>t.name===e.defaultAnimation?.motion||t.file===e.defaultAnimation?.motion);if(void 0!==t&&t>=0&&e.motions){const o=e.motions[t].group??'default';this.playMotion(o,t,1)}}}if(e.defaultAnimation.expression){const t=e.motions?.find(t=>(t.name===e.defaultAnimation?.expression||t.file===e.defaultAnimation?.expression)&&'expression'===t.motionType);if(t&&void 0!==t.index){const e=t.group??'default';this.playMotion(e,t.index,2)}else{const t=e.expressions?.findIndex(t=>t===e.defaultAnimation?.expression||t.includes(e.defaultAnimation?.expression||''));void 0!==t&&t>=0&&this.playExpression(t)}}}}catch(e){throw console.error('[PixiLive2DRenderer] åŠ è½½æ¨¡å‹å¤±è´¥:',e),new Error(`åŠ è½½æ¨¡å‹å¤±è´¥: ${e instanceof Error?e.message:String(e)}`)}}playMotion(e,t,o=2){if(this.model)try{console.info(`[PixiLive2DRenderer] æ’­æ”¾åŠ¨ä½œ: ç»„="${e}", ç´¢å¼•=${t}, ä¼˜å…ˆçº§=${o}`),this.model.motion(e,t,o)}catch(e){console.error('[PixiLive2DRenderer] æ’­æ”¾åŠ¨ä½œå¤±è´¥:',e)}else console.warn('[PixiLive2DRenderer] æ¨¡å‹æœªåŠ è½½ï¼Œæ— æ³•æ’­æ”¾åŠ¨ä½œ')}playExpression(e){if(this.model)try{console.info(`[PixiLive2DRenderer] æ’­æ”¾è¡¨æƒ…: ç´¢å¼•=${e}`),this.model.expression(e)}catch(e){console.error('[PixiLive2DRenderer] æ’­æ”¾è¡¨æƒ…å¤±è´¥:',e)}else console.warn('[PixiLive2DRenderer] æ¨¡å‹æœªåŠ è½½ï¼Œæ— æ³•æ’­æ”¾è¡¨æƒ…')}setPosition(e,t){if(!this.model||!this.app)return;const{width:o,height:n}=this.getDisplaySize();this.model.x=e/100*o,this.model.y=t/100*n}setScale(e){this.model&&this.model.scale.set(e)}getModel(){return this.model}isReady(){return this.isInitialized}setVisible(e){this.model&&(e?(this.model.alpha=1,this.model.visible=!0,console.info('[PixiLive2DRenderer] æ¨¡å‹å·²è®¾ç½®ä¸ºå¯è§')):(this.model.alpha=0,this.model.visible=!1,console.info('[PixiLive2DRenderer] æ¨¡å‹å·²è®¾ç½®ä¸ºä¸å¯è§')))}playMotionByText(e,t){if(!this.model||!this.config?.motions)return!1;const o=e=>e.replace(/[-/\\_.\s]/g,'').toLowerCase(),n=o(e);for(const a of this.config.motions)if(a.textMappings&&a.textMappings.length>0){if(a.textMappings.some(e=>{const t=o(e);return n===t||n.includes(t)||t.includes(n)})){let o=t;if(void 0===o&&(o=2),void 0!==a.index)return console.info(`[PixiLive2DRenderer] æ–‡æœ¬åŒ¹é…æ’­æ”¾: "${a.name}" (group="${a.group}", index=${a.index}, type=${a.motionType}, text="${e}")`),this.playMotion(a.group,a.index,o),!0}}return!1}unloadModel(){this.model&&this.app&&(this.app.stage.removeChild(this.model),this.model.destroy(),this.model=null),this.config=null}destroy(){this.unloadModel(),this.app&&(this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0}),this.app=null),this.canvas=null,this.isInitialized=!1}resize(e,t){if(!this.canvas||!this.app)return;const o=this.getDisplaySize(),n=e||this.canvas.clientWidth||o.width,a=t||this.canvas.clientHeight||o.height;this.app.renderer.resize(n,a),console.info('[PixiLive2DRenderer] ç”»å¸ƒå¤§å°å·²è°ƒæ•´:',{displayWidth:n,displayHeight:a})}}const S=['src'],M=(0,n.defineComponent)({__name:'CharacterSprite',props:{spriteScale:{},spritePositionX:{},spritePositionY:{},live2dScale:{},live2dPositionX:{},live2dPositionY:{},spriteType:{},imageUrl:{},live2dModelId:{},live2dModels:{},motion:{},expression:{}},setup(e){const t=e,o=(0,n.ref)(null);let a,l,r,s=null;const i=(0,n.computed)(()=>({left:`${t.spritePositionX}%`,bottom:100-t.spritePositionY+'%',transform:`translateX(-50%) scale(${t.spriteScale})`,transformOrigin:'bottom center'}));function c(e,t){if(!s)return;if(s.playMotionByText(t))return;let o=t;if(e.textMappings?.motions)for(const[n,a]of Object.entries(e.textMappings.motions))if(a===t||String(a).toLowerCase()===t.toLowerCase()){o=n,console.info(`[CharacterSprite] é€šè¿‡ textMappings åŒ¹é…åˆ°åŠ¨ä½œ: ${t} -> ${n}`);break}const n=e.motions?.find(e=>{const t='string'==typeof e?e:e.name||e.file;return t===o||t===`${o}.motion3.json`||e.file===o});if(n){const t='string'==typeof n?'idle':n.group??'idle';if('string'!=typeof n&&void 0!==n.index)return console.info(`[CharacterSprite] æ’­æ”¾åŠ¨ä½œ: group="${t}", index=${n.index}, motion=${o}`),void s.playMotion(t,n.index,2);const a=(e.motions?.filter(e=>('string'==typeof e?'idle':e.group??'idle')===t)||[]).findIndex(e=>{const t='string'==typeof e?e:e.name||e.file;return t===o||t===`${o}.motion3.json`||e.file===o});a>=0&&(console.info(`[CharacterSprite] æ’­æ”¾åŠ¨ä½œ: group="${t}", index=${a}, motion=${o}`),s.playMotion(t,a,2))}else console.warn(`[CharacterSprite] æœªæ‰¾åˆ°åŠ¨ä½œé…ç½®: ${o}`)}function d(e,t){if(!s)return;if(s.playMotionByText(t,3))return;let o=t;if(e.textMappings?.expressions)for(const[n,a]of Object.entries(e.textMappings.expressions))if(a===t||String(a).toLowerCase()===t.toLowerCase()){o=n,console.info(`[CharacterSprite] é€šè¿‡ textMappings åŒ¹é…åˆ°è¡¨æƒ…: ${t} -> ${n}`);break}const n=e.expressions?.findIndex(e=>{const t='string'==typeof e?e:e.name||e.file;return t===o||t===`${o}.exp3.json`||'object'==typeof e&&e.file===o});void 0!==n&&n>=0?(console.info(`[CharacterSprite] æ’­æ”¾è¡¨æƒ…: index=${n}, expression=${o}`),s.playExpression(n)):console.warn(`[CharacterSprite] æœªæ‰¾åˆ°è¡¨æƒ…é…ç½®: ${o}`)}async function u(){if(console.info('[CharacterSprite] loadLive2dModel è¢«è°ƒç”¨',{spriteType:t.spriteType,live2dModelId:t.live2dModelId,hasModels:!!t.live2dModels,modelsLength:t.live2dModels?.length||0,hasCanvas:!!o.value}),!t.live2dModelId||!t.live2dModels||!o.value)return void console.warn('[CharacterSprite] åŠ è½½æ¡ä»¶ä¸æ»¡è¶³ï¼Œè·³è¿‡åŠ è½½',{live2dModelId:t.live2dModelId,hasModels:!!t.live2dModels,hasCanvas:!!o.value});const e=t.live2dModels.map(e=>({id:e.id,name:e.name}));console.info('[CharacterSprite] å¯ç”¨çš„æ¨¡å‹åˆ—è¡¨:',e),console.info('[CharacterSprite] è¯·æ±‚çš„æ¨¡å‹ID:',t.live2dModelId,'ç±»å‹:',typeof t.live2dModelId);let n=t.live2dModels.find(e=>e.id===t.live2dModelId);if(n||(n=t.live2dModels.find(e=>e.name===t.live2dModelId),n&&console.info(`[CharacterSprite] é€šè¿‡ name åŒ¹é…åˆ°æ¨¡å‹: ${t.live2dModelId} -> ${n.id}`)),n){console.info('[CharacterSprite] æ‰¾åˆ°æ¨¡å‹é…ç½®:',{id:n.id,name:n.name,modelPath:n.modelPath,basePath:n.basePath,motionsCount:n.motions?.length||0,expressionsCount:n.expressions?.length||0});try{if(!s||!s.isReady())return void console.error('[CharacterSprite] æ¸²æŸ“å™¨æœªåˆå§‹åŒ–ï¼Œæ— æ³•åŠ è½½æ¨¡å‹');const e=r!==t.live2dModelId;e&&(console.info('[CharacterSprite] æ¨¡å‹IDå˜åŒ–ï¼Œé‡æ–°åŠ è½½æ¨¡å‹:',{oldModelId:r,newModelId:t.live2dModelId}),await s.loadModel(n),console.info('[CharacterSprite] Live2D æ¨¡å‹åŠ è½½å®Œæˆ'),r=t.live2dModelId,s.setScale(t.live2dScale),s.setPosition(t.live2dPositionX,t.live2dPositionY),console.info('[CharacterSprite] åº”ç”¨ç”¨æˆ·è®¾ç½®:',{scale:t.live2dScale,positionX:t.live2dPositionX,positionY:t.live2dPositionY}));const o=a!==t.motion,i=l!==t.expression;(o||i||e)&&(!async function(e){t.expression&&t.motion?(d(e,t.expression),await new Promise(e=>setTimeout(e,3e3)),c(e,t.motion)):(t.expression&&d(e,t.expression),t.motion&&c(e,t.motion))}(n),a=t.motion,l=t.expression)}catch(e){console.error('[CharacterSprite] åŠ è½½ Live2D æ¨¡å‹å¤±è´¥:',e);const a=e instanceof Error?e.message:String(e),l=e instanceof Error?e.stack:void 0,r={message:a,stack:l,modelId:t.live2dModelId,modelConfig:n?{id:n.id,name:n.name}:null,canvasInfo:o.value?{width:o.value.clientWidth,height:o.value.clientHeight,offsetWidth:o.value.offsetWidth,offsetHeight:o.value.offsetHeight}:null,rendererReady:s?.isReady()||!1};console.error('[CharacterSprite] é”™è¯¯è¯¦æƒ…:',JSON.stringify(r,null,2)),console.error('[CharacterSprite] é”™è¯¯æ¶ˆæ¯:',a),l&&console.error('[CharacterSprite] é”™è¯¯å †æ ˆ:',l),console.error('[CharacterSprite] æ¨¡å‹ID:',t.live2dModelId),console.error('[CharacterSprite] Canvas ä¿¡æ¯:',r.canvasInfo),console.error('[CharacterSprite] æ¸²æŸ“å™¨å°±ç»ª:',r.rendererReady)}}else console.warn(`[CharacterSprite] æœªæ‰¾åˆ° Live2D æ¨¡å‹é…ç½®: ${t.live2dModelId}`,{requestedId:t.live2dModelId,requestedIdType:typeof t.live2dModelId,availableIds:t.live2dModels.map(e=>({id:e.id,idType:typeof e.id,name:e.name})),availableIdsString:JSON.stringify(t.live2dModels.map(e=>e.id)),requestedIdString:JSON.stringify(t.live2dModelId)})}return(0,n.watch)(()=>[t.live2dModelId,t.live2dModels],async(e,r)=>{const s=r?.[1],i=s!==t.live2dModelId;console.info('[CharacterSprite] watch æ¨¡å‹IDå˜åŒ–:',{live2dModelId:t.live2dModelId,modelsCount:t.live2dModels?.length,oldModelId:s,modelIdChanged:i}),i&&t.live2dModelId&&(a=void 0,l=void 0,await(0,n.nextTick)(),o.value||(console.error('[CharacterSprite] Canvas å…ƒç´ ä¸å­˜åœ¨ï¼Œå»¶è¿Ÿé‡è¯•'),await new Promise(e=>requestAnimationFrame(()=>e(void 0))),await(0,n.nextTick)()),o.value?await u():console.error('[CharacterSprite] Canvas å…ƒç´ ä»ç„¶ä¸å­˜åœ¨ï¼Œæ— æ³•åŠ è½½æ¨¡å‹'))},{immediate:!0}),(0,n.watch)(()=>t.spriteType,(e,t)=>{console.info('[CharacterSprite] spriteType å˜åŒ–:',{oldType:t,newType:e,hasRenderer:!!s}),s&&('live2d'===e?(console.info('[CharacterSprite] æ˜¾ç¤º Live2D æ¨¡å‹'),s.setVisible(!0)):(console.info('[CharacterSprite] éšè— Live2D æ¨¡å‹'),s.setVisible(!1)))},{immediate:!0}),(0,n.watch)(()=>[t.motion,t.expression],()=>{if('live2d'===t.spriteType&&s&&t.live2dModelId&&t.live2dModels){const e=a!==t.motion,o=l!==t.expression;if(e||o){const n=t.live2dModels.find(e=>e.id===t.live2dModelId);n&&(t.expression&&t.motion&&(o||e)?(o&&t.expression&&d(n,t.expression),e&&t.motion&&setTimeout(()=>{c(n,t.motion)},3e3)):(e&&t.motion&&c(n,t.motion),o&&t.expression&&d(n,t.expression)),a=t.motion,l=t.expression)}}}),(0,n.watch)(()=>[t.live2dScale,t.live2dPositionX,t.live2dPositionY],()=>{'live2d'===t.spriteType&&s&&(s.setScale(t.live2dScale),s.setPosition(t.live2dPositionX,t.live2dPositionY))}),(0,n.onMounted)(async()=>{if(await(0,n.nextTick)(),o.value){if(!s)try{const e=o.value;if(!e)return void console.error('[CharacterSprite] Canvas å…ƒç´ ä¸å­˜åœ¨');const t=e.clientWidth||e.offsetWidth||800,a=e.clientHeight||e.offsetHeight||600;if(console.info('[CharacterSprite] åˆå§‹åŒ– Pixi Live2D æ¸²æŸ“å™¨',{canvasWidth:t,canvasHeight:a,clientWidth:e.clientWidth,clientHeight:e.clientHeight,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight}),0===t||0===a){console.warn('[CharacterSprite] Canvas å°ºå¯¸ä¸º 0ï¼Œç­‰å¾…ä¸€å¸§åé‡è¯•'),await new Promise(e=>requestAnimationFrame(()=>e(void 0))),await(0,n.nextTick)();const t=e.clientWidth||e.offsetWidth||800,o=e.clientHeight||e.offsetHeight||600;if(console.info('[CharacterSprite] é‡è¯•æ—¶ Canvas å°ºå¯¸:',{width:t,height:o}),0===t||0===o)return void console.error('[CharacterSprite] Canvas å°ºå¯¸ä»ç„¶ä¸º 0ï¼Œæ— æ³•åˆå§‹åŒ–æ¸²æŸ“å™¨')}s=new E,await s.init(e),console.info('[CharacterSprite] Pixi Live2D æ¸²æŸ“å™¨åˆå§‹åŒ–å®Œæˆ')}catch(e){const t=e instanceof Error?e.message:String(e),o=e instanceof Error?e.stack:void 0;return console.error('[CharacterSprite] æ¸²æŸ“å™¨åˆå§‹åŒ–å¤±è´¥:',t),o&&console.error('[CharacterSprite] åˆå§‹åŒ–é”™è¯¯å †æ ˆ:',o),void console.error('[CharacterSprite] åˆå§‹åŒ–é”™è¯¯è¯¦æƒ…:',JSON.stringify({message:t,stack:o},null,2))}t.live2dModelId&&t.live2dModels&&(await u(),'live2d'===t.spriteType?s.setVisible(!0):s.setVisible(!1))}else console.error('[CharacterSprite] Canvas å…ƒç´ ä¸å­˜åœ¨')}),(0,n.onUnmounted)(()=>{s&&(s.destroy(),s=null)}),(t,a)=>((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createCommentVNode)(' é™æ€å›¾ç‰‡ç«‹ç»˜ - ä½¿ç”¨å®¹å™¨ç¼©æ”¾ '),'image'===e.spriteType?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,class:'pointer-events-none absolute z-5 transition-all duration-300',style:(0,n.normalizeStyle)(i.value)},[(0,n.createElementVNode)('img',{src:e.imageUrl,alt:'è§’è‰²ç«‹ç»˜',class:'h-[70vh] w-auto object-contain drop-shadow-2xl',draggable:'false'},null,8,S)],4)):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' Live2D æ¨¡å‹æ¸²æŸ“ - ç”»å¸ƒå§‹ç»ˆå­˜åœ¨ï¼Œé€šè¿‡å¯è§åº¦æ§åˆ¶æ˜¾ç¤º/éšè— '),(0,n.createElementVNode)('canvas',{ref_key:'live2dCanvasRef',ref:o,class:'live2d-canvas pointer-events-none absolute inset-0 z-5',style:(0,n.normalizeStyle)({width:'100%',height:'100%',display:o.value?'block':'none'})},null,4)],64))}});var B=o(455);const I=(0,B.A)(M,[['__scopeId','data-v-00af568a']]),L={class:'status-container'},D={class:'status-header'},P={class:'status-main-content'},R={class:'status-info-bar'},T={class:'info-item'},U={class:'status-text-card'},j={class:'text-card-row'},F={class:'text-card-content'},W={class:'text-card-row'},O={class:'text-card-content'},A={class:'text-card-row'},H={class:'text-card-content'},G={class:'text-card-row'},q={class:'text-card-content'},X=(0,n.defineComponent)({__name:'CharacterStatusPanel',props:{show:{type:Boolean},messageId:{},statusBlock:{},onClose:{type:Function}},setup(e){const t=e,o=(0,n.computed)(()=>{const e={åœ°ç‚¹:'',å…³ç³»:'',å¿ƒæƒ…:'',åæ§½:'',å¾…åŠ:''};return t.statusBlock&&(t.statusBlock.åœ°ç‚¹&&(e.åœ°ç‚¹=t.statusBlock.åœ°ç‚¹),t.statusBlock.å…³ç³»&&(e.å…³ç³»=t.statusBlock.å…³ç³»),t.statusBlock.å¿ƒæƒ…&&(e.å¿ƒæƒ…=t.statusBlock.å¿ƒæƒ…),t.statusBlock.åæ§½&&(e.åæ§½=t.statusBlock.åæ§½),t.statusBlock.å¾…åŠ&&(e.å¾…åŠ=t.statusBlock.å¾…åŠ)),e});return(t,a)=>e.show?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,class:'animate-in fade-in absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm duration-200',onClick:a[2]||(a[2]=(...t)=>e.onClose&&e.onClose(...t))},[(0,n.createElementVNode)('div',{class:'status-container-wrapper',onClick:a[1]||(a[1]=(0,n.withModifiers)(()=>{},['stop']))},[(0,n.createElementVNode)('div',L,[(0,n.createCommentVNode)(' å¤´éƒ¨ '),(0,n.createElementVNode)('div',D,[a[4]||(a[4]=(0,n.createElementVNode)('span',{class:'summary-icon'},'â˜˜ï¸',-1)),a[5]||(a[5]=(0,n.createElementVNode)('span',{class:'status-title'},'çŠ¶æ€æ ',-1)),(0,n.createElementVNode)('button',{class:'status-close','aria-label':'å…³é—­çŠ¶æ€æ ',onClick:a[0]||(a[0]=(...t)=>e.onClose&&e.onClose(...t))},[...a[3]||(a[3]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),(0,n.createCommentVNode)(' å†…å®¹ '),(0,n.createElementVNode)('div',P,[(0,n.createCommentVNode)(' ä¿¡æ¯æ  '),(0,n.createElementVNode)('div',R,[a[7]||(a[7]=(0,n.createElementVNode)('div',{class:'info-item'},[(0,n.createElementVNode)('span',null,'ğŸ•’'),(0,n.createElementVNode)('span',{textContent:'{{get_message_variable::stat_data.æ—¶é—´}}'})],-1)),(0,n.createElementVNode)('div',T,[a[6]||(a[6]=(0,n.createElementVNode)('span',null,'ğŸ“',-1)),(0,n.createElementVNode)('span',null,(0,n.toDisplayString)(o.value.åœ°ç‚¹||'æœªçŸ¥'),1)])]),(0,n.createCommentVNode)(' æ•°å€¼ç½‘æ ¼ '),a[12]||(a[12]=(0,n.createStaticVNode)('<div class="status-values-grid" data-v-330f15ce><div class="value-card" data-v-330f15ce><div class="value-name" data-v-330f15ce>äº²æƒ…</div><div class="value-number" data-v-330f15ce>{{get_message_variable::stat_data.ç¨‹åŒ—æ.äº²æƒ…}}</div></div><div class="value-card" data-v-330f15ce><div class="value-name" data-v-330f15ce>çˆ±æ¬²</div><div class="value-number" data-v-330f15ce>{{get_message_variable::stat_data.ç¨‹åŒ—æ.çˆ±æ¬²}}</div></div><div class="value-card" data-v-330f15ce><div class="value-name" data-v-330f15ce>åŒæ¶</div><div class="value-number" data-v-330f15ce>{{get_message_variable::stat_data.ç¨‹åŒ—æ.åŒæ¶}}</div></div><div class="value-card" data-v-330f15ce><div class="value-name" data-v-330f15ce>è‡ªæˆ‘</div><div class="value-number" data-v-330f15ce>{{get_message_variable::stat_data.ç¨‹åŒ—æ.è‡ªæˆ‘}}</div></div></div>',1)),(0,n.createCommentVNode)(' æ–‡æœ¬å¡ç‰‡ '),(0,n.createElementVNode)('div',U,[(0,n.createElementVNode)('div',j,[a[8]||(a[8]=(0,n.createElementVNode)('span',{class:'text-card-label'},'å…³ç³»',-1)),(0,n.createElementVNode)('span',F,(0,n.toDisplayString)(o.value.å…³ç³»||'æš‚æ— '),1)]),(0,n.createElementVNode)('div',W,[a[9]||(a[9]=(0,n.createElementVNode)('span',{class:'text-card-label'},'å¿ƒæƒ…',-1)),(0,n.createElementVNode)('span',O,(0,n.toDisplayString)(o.value.å¿ƒæƒ…||'æš‚æ— '),1)]),(0,n.createElementVNode)('div',A,[a[10]||(a[10]=(0,n.createElementVNode)('span',{class:'text-card-label'},'åæ§½',-1)),(0,n.createElementVNode)('span',H,(0,n.toDisplayString)(o.value.åæ§½||'æš‚æ— '),1)]),(0,n.createElementVNode)('div',G,[a[11]||(a[11]=(0,n.createElementVNode)('span',{class:'text-card-label'},'å¾…åŠ',-1)),(0,n.createElementVNode)('span',q,(0,n.toDisplayString)(o.value.å¾…åŠ||'æš‚æ— '),1)])])])])])])):(0,n.createCommentVNode)('v-if',!0)}}),Y=(0,B.A)(X,[['__scopeId','data-v-330f15ce']]),J=['onClick'],K={key:1,class:'flex items-center gap-2'},Q=(0,n.defineComponent)({__name:'ChoiceBox',props:{options:{},customStyle:{},onSelect:{type:Function},onPrev:{type:Function},onNext:{type:Function},onSave:{type:Function}},setup(e){const t=e,o=(0,n.ref)(!1),a=(0,n.ref)(''),s=(0,n.ref)(!1),i=(0,n.ref)(null);function c(){o.value?a.value.trim()&&!s.value?s.value=!0:s.value&&t.onSelect('custom',a.value):(o.value=!0,(0,n.nextTick)(()=>{i.value?.focus()}))}function u(){a.value.trim()&&(s.value?t.onSelect('custom',a.value):s.value=!0)}function m(){a.value.trim()&&t.onSave&&(t.onSave(a.value.trim()),a.value='',o.value=!1,s.value=!1)}(0,n.watch)(()=>t.options,()=>{o.value=!1,a.value='',s.value=!1});const p=(0,n.computed)(()=>t.customStyle||d),v=(0,n.computed)(()=>l.find(e=>e.id===p.value.boxShape)||l[0]),h=(0,n.computed)(()=>r.find(e=>e.id===p.value.borderWidth)||r[1]),f=(0,n.computed)(()=>'pill'===p.value.boxShape);function g(e){const o=e.currentTarget.getBoundingClientRect();e.clientX-o.left<o.width/2&&t.onPrev?.()}return(l,r)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{class:'absolute inset-0 z-25 flex items-center justify-center bg-black/30 backdrop-blur-sm',onClick:g},[(0,n.createElementVNode)('div',{class:'flex w-full max-w-md flex-col gap-3 px-6',onClick:r[2]||(r[2]=(0,n.withModifiers)(()=>{},['stop']))},[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.options,(e,o)=>((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:e.id,class:'w-full p-4 text-left transition-all hover:scale-[1.02] active:scale-[0.98]',style:(0,n.normalizeStyle)({backgroundColor:f.value?'rgba(255, 255, 255, 0.7)':p.value.colors.boxBackground,borderRadius:v.value.borderRadius,borderTopWidth:h.value.width,borderLeftWidth:h.value.width,borderRightWidth:h.value.width,borderBottomWidth:h.value.width,borderStyle:'solid',borderColor:p.value.colors.boxBorder,boxShadow:v.value.shadow,color:p.value.colors.dialogText,fontSize:`${p.value.fontSize}px`,backdropFilter:f.value?'blur(12px)':void 0,WebkitBackdropFilter:f.value?'blur(12px)':void 0}),onClick:()=>{return o=e.id,s.value&&(s.value=!1),void t.onSelect(o);var o}},(0,n.toDisplayString)(e.text),13,J))),128)),(0,n.createCommentVNode)(' è‡ªç”±è¾“å…¥é€‰é¡¹ '),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['w-full p-4 transition-all cursor-pointer',s.value?'ring-2 ring-primary':'']),style:(0,n.normalizeStyle)({backgroundColor:f.value?'rgba(255, 255, 255, 0.7)':p.value.colors.boxBackground,borderRadius:v.value.borderRadius,borderTopWidth:h.value.width,borderLeftWidth:h.value.width,borderRightWidth:h.value.width,borderBottomWidth:h.value.width,borderStyle:'solid',borderColor:p.value.colors.boxBorder,boxShadow:v.value.shadow,fontSize:`${p.value.fontSize}px`,backdropFilter:f.value?'blur(12px)':void 0,WebkitBackdropFilter:f.value?'blur(12px)':void 0}),onClick:c},[o.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',K,[(0,n.withDirectives)((0,n.createElementVNode)('input',{ref_key:'inputRef',ref:i,'onUpdate:modelValue':r[0]||(r[0]=e=>a.value=e),type:'text',placeholder:'è¾“å…¥ä½ æƒ³è¯´çš„è¯...',class:'flex-1 bg-transparent outline-none',style:(0,n.normalizeStyle)({color:p.value.colors.dialogText}),onClick:r[1]||(r[1]=(0,n.withModifiers)(()=>{},['stop'])),onKeydown:(0,n.withKeys)(u,['enter']),autofocus:''},null,36),[[n.vModelText,a.value]]),(0,n.createCommentVNode)(' å›è½¦å›¾æ ‡ï¼ˆä¿å­˜è¾“å…¥/ç¡®è®¤é€‰é¡¹ï¼‰ '),a.value.trim()?((0,n.openBlock)(),(0,n.createElementBlock)('svg',{key:0,class:'h-5 w-5 transition-colors cursor-pointer',style:(0,n.normalizeStyle)({color:s.value?p.value.colors.nameText:p.value.colors.narrationText}),fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',onClick:(0,n.withModifiers)(u,['stop'])},[...r[4]||(r[4]=[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'},null,-1)])],4)):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' ä¿å­˜æŒ‰é’® '),a.value.trim()?((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:1,class:'p-1 transition-colors hover:opacity-80',style:(0,n.normalizeStyle)({color:p.value.colors.nameText}),'aria-label':'ä¿å­˜åˆ°æ­£æ–‡',title:'ä¿å­˜åˆ°æ­£æ–‡ï¼ˆä¸å‘é€ï¼‰',onClick:(0,n.withModifiers)(m,['stop'])},[...r[5]||(r[5]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12'})],-1)])],4)):(0,n.createCommentVNode)('v-if',!0)])):((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,class:'flex items-center gap-2',style:(0,n.normalizeStyle)({color:p.value.colors.narrationText})},[...r[3]||(r[3]=[(0,n.createElementVNode)('svg',{class:'h-4 w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z'})],-1),(0,n.createElementVNode)('span',null,'è‡ªç”±è¾“å…¥...',-1)])],4))],6)])]))}}),Z={class:'absolute bottom-0 left-0 right-0 z-20 px-4 md:px-8 pb-4 md:pb-6'},ee={class:'flex items-center gap-2 md:gap-4 max-w-4xl mx-auto'},te=['disabled'],oe={key:0,class:'absolute left-2 top-1/2 -translate-y-1/2 z-10'},ne=['disabled'],ae={key:0,class:'ml-auto flex gap-2'},le=['innerHTML'],re={class:'absolute bottom-3 right-4'},se={key:2,class:'absolute right-2 top-1/2 -translate-y-1/2 z-10'},ie=['disabled'],ce=['disabled'],de={class:'flex gap-3 mt-4 justify-end'},ue=(0,n.defineComponent)({__name:'DialogBox',props:{character:{},text:{},isLastDialogue:{type:Boolean},isFirstDialogue:{type:Boolean},onPrev:{type:Function},onNext:{type:Function},dialogKey:{},customStyle:{},isLoading:{type:Boolean},streamingText:{},isThrough:{type:Boolean},isEditable:{type:Boolean},messageId:{},onEdit:{type:Function},onDelete:{type:Function}},setup(e){const t=e,o=(0,n.ref)(''),u=(0,n.ref)(!0);let m=null;const p=(0,n.ref)(null),v=(0,n.ref)(!1),h=(0,n.computed)(()=>v.value?'justify-start':'justify-center'),f=(0,n.computed)(()=>t.customStyle||d),g=(0,n.computed)(()=>l.find(e=>e.id===f.value.boxShape)||l[0]),y=(0,n.computed)(()=>s.find(e=>e.id===f.value.nameShape)||s[0]),x=(0,n.computed)(()=>i.find(e=>e.id===f.value.arrowShape)||i[0]),b=(0,n.computed)(()=>c.find(e=>e.id===f.value.indicatorShape)||c[0]),k=(0,n.computed)(()=>r.find(e=>e.id===f.value.borderWidth)||r[1]),w=(0,n.computed)(()=>a.find(e=>e.id===f.value.backgroundPattern)),C=(0,n.computed)(()=>!t.character||''===t.character.trim()),N=(0,n.computed)(()=>x.value.isInner),V=(0,n.computed)(()=>'minimal'===x.value.type),E=(0,n.computed)(()=>'pill'===f.value.boxShape),S=(0,n.computed)(()=>{if(!w.value?.pattern)return{};const e=f.value.colors.boxBorder.replace(/[\d.]+\)$/,'0.08)'),t=w.value.pattern.replace(/VAR_BORDER_COLOR/g,e);let o='20px 20px';return'dots'===w.value.id&&(o='16px 16px'),'diamonds'===w.value.id&&(o='16px 16px'),'stripes'===w.value.id&&(o='28px 28px'),{backgroundImage:t,backgroundSize:o}}),M=(0,n.computed)(()=>({backgroundColor:E.value?'rgba(255, 255, 255, 0.7)':f.value.colors.boxBackground,borderRadius:g.value.borderRadius,borderTopWidth:k.value.width,borderLeftWidth:k.value.width,borderRightWidth:k.value.width,borderBottomWidth:k.value.width,borderStyle:'solid',borderColor:f.value.colors.boxBorder,boxShadow:g.value.shadow,...E.value?{backdropFilter:'blur(12px)',WebkitBackdropFilter:'blur(12px)'}:{},...S.value})),B=(0,n.computed)(()=>{const e=t.isFirstDialogue||t.isLastDialogue?`${f.value.colors.arrowIcon}66`:f.value.colors.arrowIcon;if(V.value)return{color:e};const o=f.value.colors.arrowBackground;let n='9999px';return'square'!==x.value.type&&'inner-square'!==x.value.type||(n='6px'),'pill'===x.value.type&&(n='16px'),{backgroundColor:o,borderRadius:n,color:e}}),I=(0,n.computed)(()=>{const e=t.isFirstDialogue?`${f.value.colors.arrowIcon}66`:f.value.colors.arrowIcon;return{background:'inner-round'===x.value.type?f.value.colors.arrowBackground:'transparent',color:e}}),L=(0,n.computed)(()=>{const e=t.isLastDialogue?`${f.value.colors.arrowIcon}66`:f.value.colors.arrowIcon;return{background:'inner-round'===x.value.type?f.value.colors.arrowBackground:'transparent',color:e}}),D=(0,n.computed)(()=>{const{type:e}=b.value,{indicatorColor:o}=f.value.colors;if('none'===e)return null;const a=t.isLoading||!1;return'dots'===e?(0,n.h)('div',{class:'flex gap-1 items-center'},[0,1,2].map(e=>(0,n.h)('span',{key:e,class:'w-1.5 h-1.5 rounded-full transition-opacity duration-500',style:{backgroundColor:o,opacity:a?2===e?1:.4:.6,animation:a&&2===e?'pulse 1s ease-in-out infinite':void 0}}))):'diamonds'===e?(0,n.h)('div',{class:'flex gap-1 items-center'},[0,1,2].map(e=>(0,n.h)('span',{key:e,class:'transition-all duration-300',style:{width:'8px',height:'8px',backgroundColor:o,opacity:a?2===e?1:.3+.15*e:.5,transform:`rotate(45deg) scale(${a&&2===e?1.1:.9})`,animation:a&&2===e?'diamondPulse 1.2s ease-in-out infinite':void 0,display:'inline-block'}}))):'pulse'===e?(0,n.h)('div',{class:'relative w-3 h-3'},[(0,n.h)('span',{class:'absolute inset-0 rounded-full',style:{backgroundColor:o,opacity:.4,animation:a?'ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite':void 0}}),(0,n.h)('span',{class:'absolute inset-0 rounded-full',style:{backgroundColor:o,animation:a?'pulse 2s ease-in-out infinite':void 0}})]):'arrow'===e?(0,n.h)('svg',{class:'w-4 h-4 transition-transform duration-300',style:{color:o,animation:a?'arrowBounce 0.8s ease-in-out infinite':void 0},fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.h)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})]):null});function P(){t.isFirstDialogue||t.onPrev()}function R(){t.isLastDialogue||t.onNext()}function T(e,t){const o=function(e){return e?e.replace(/\*([^*]+)\*/g,(e,t)=>'through'===t.trim()?e:` <span style="color: #9ca3af; font-style: italic;">${t}</span> `):''}(e);return t?o+'<span class="animate-pulse" style="display: inline; margin-left: 2px;">|</span>':o}function U(){m&&(clearInterval(m),m=null)}function j(){if(U(),t.isLoading)return o.value=t.text,void(u.value=!0);if(!t.text)return o.value='',void(u.value=!1);o.value='',u.value=!0;let e=0;m=setInterval(()=>{e<t.text.length?(o.value=t.text.slice(0,e+1),e++):(u.value=!1,U())},50)}function F(){C.value&&p.value?(0,n.nextTick)(()=>{if(!p.value)return;const e=p.value,t=e.querySelector('span');if(!t||!o.value)return void(v.value=!1);const n=e.offsetWidth-(parseInt(getComputedStyle(e).paddingLeft)||0)-(parseInt(getComputedStyle(e).paddingRight)||0);if(n<=0)return void(v.value=!1);const a=document.createElement('div');a.style.visibility='hidden',a.style.position='absolute',a.style.top='-9999px',a.style.left='-9999px',a.style.width=`${n}px`,a.style.fontSize=`${f.value.fontSize}px`,a.style.fontStyle='italic',a.style.fontFamily=getComputedStyle(e).fontFamily,a.style.lineHeight=getComputedStyle(e).lineHeight,a.style.textAlign='center',a.style.whiteSpace='normal',a.style.wordWrap='break-word',a.style.overflowWrap='break-word';const l=(t.innerHTML||'').replace(/<span[^>]*class="[^"]*animate-pulse[^"]*"[^>]*>.*?<\/span>/gi,'');a.innerHTML=l||'M',document.body.appendChild(a);const r=document.createElement('div');r.style.visibility='hidden',r.style.position='absolute',r.style.top='-9999px',r.style.left='-9999px',r.style.width=`${n}px`,r.style.fontSize=`${f.value.fontSize}px`,r.style.fontStyle='italic',r.style.fontFamily=getComputedStyle(e).fontFamily,r.style.lineHeight=getComputedStyle(e).lineHeight,r.style.textAlign='center',r.style.whiteSpace='nowrap',r.textContent='M',document.body.appendChild(r);const s=r.offsetHeight,i=a.offsetHeight;document.body.removeChild(a),document.body.removeChild(r),v.value=i>1.3*s}):v.value=!1}(0,n.watch)(()=>[t.text,t.dialogKey,t.isLoading],()=>{j()},{immediate:!0}),(0,n.watch)(()=>o.value,()=>{C.value&&setTimeout(()=>{F()},10)}),(0,n.onMounted)(()=>{j(),C.value&&F()}),(0,n.onUnmounted)(()=>{U()});const W=(0,n.ref)(!1),O=(0,n.ref)('');function A(){void 0!==t.messageId&&(O.value=t.text,W.value=!0)}function H(){void 0!==t.messageId&&t.onDelete&&confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æ¶ˆæ¯å—ï¼Ÿ')&&t.onDelete(t.messageId)}function G(){void 0!==t.messageId&&t.onEdit&&O.value.trim()&&(t.onEdit(t.messageId,O.value.trim()),W.value=!1)}function q(){W.value=!1,O.value=''}return(a,l)=>((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createElementVNode)('div',Z,[(0,n.createElementVNode)('div',ee,[(0,n.createCommentVNode)(' å¤–ç½®å·¦ç®­å¤´ '),N.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,disabled:e.isFirstDialogue,class:(0,n.normalizeClass)(['flex flex-shrink-0 items-center justify-center transition-all duration-200',e.isFirstDialogue?'cursor-not-allowed opacity-40':'hover:scale-105']),style:(0,n.normalizeStyle)(B.value),'aria-label':'ä¸Šä¸€æ¡å¯¹è¯',onClick:(0,n.withModifiers)(P,['stop'])},[...l[2]||(l[2]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 19l-7-7 7-7'})],-1)])],14,te)),(0,n.createCommentVNode)(' å¯¹è¯æ¡†ä¸»ä½“ '),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['flex-1 relative p-4 md:p-5 min-h-[120px]',[C.value?'flex flex-col':'']]),style:(0,n.normalizeStyle)(M.value)},[(0,n.createCommentVNode)(' å†…ç½®å·¦ç®­å¤´ '),N.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',oe,[(0,n.createElementVNode)('button',{disabled:e.isFirstDialogue,class:(0,n.normalizeClass)(['flex items-center justify-center transition-all duration-200',e.isFirstDialogue?'cursor-not-allowed opacity-40':'hover:bg-opacity-100']),style:(0,n.normalizeStyle)(I.value),'aria-label':'ä¸Šä¸€æ¡å¯¹è¯',onClick:(0,n.withModifiers)(P,['stop'])},[...l[3]||(l[3]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 19l-7-7 7-7'})],-1)])],14,ne)])):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' è§’è‰²ååŒºåŸŸ '),C.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:1,class:'h-6 mb-2 flex items-start',style:(0,n.normalizeStyle)({paddingLeft:N.value?'48px':0,paddingRight:N.value?'48px':0})},[(0,n.createElementVNode)('div',{class:'px-3 py-1 text-sm font-medium',style:(0,n.normalizeStyle)({backgroundColor:f.value.colors.nameBackground,color:f.value.colors.nameText,borderRadius:y.value.borderRadius,borderBottom:'underline'===y.value.style?`2px solid ${f.value.colors.nameText}`:void 0,boxShadow:'floating'===y.value.style?'0 2px 8px rgba(0,0,0,0.1)':void 0})},(0,n.toDisplayString)(e.character),5),(0,n.createCommentVNode)(' ç¼–è¾‘/åˆ é™¤æŒ‰é’®ï¼ˆä»…useræ¶ˆæ¯æ˜¾ç¤ºï¼‰ '),t.isEditable&&void 0!==t.messageId?((0,n.openBlock)(),(0,n.createElementBlock)('div',ae,[(0,n.createElementVNode)('button',{onClick:(0,n.withModifiers)(A,['stop']),class:'p-1 rounded transition-colors hover:bg-black/10','aria-label':'ç¼–è¾‘',title:'ç¼–è¾‘æ¶ˆæ¯'},[...l[4]||(l[4]=[(0,n.createElementVNode)('svg',{class:'h-4 w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z'})],-1)])]),(0,n.createElementVNode)('button',{onClick:(0,n.withModifiers)(H,['stop']),class:'p-1 rounded transition-colors hover:bg-red-500/20','aria-label':'åˆ é™¤',title:'åˆ é™¤æ¶ˆæ¯'},[...l[5]||(l[5]=[(0,n.createElementVNode)('svg',{class:'h-4 w-4 text-red-500',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16'})],-1)])])])):(0,n.createCommentVNode)('v-if',!0)],4)),(0,n.createCommentVNode)(' æ–‡å­—å†…å®¹ '),(0,n.createElementVNode)('div',{ref_key:'textContentRef',ref:p,class:(0,n.normalizeClass)(['leading-relaxed',C.value?`italic text-center flex-1 flex flex-col ${h.value}`:'']),style:(0,n.normalizeStyle)({color:C.value?f.value.colors.narrationText:f.value.colors.dialogText,fontSize:`${f.value.fontSize}px`,paddingLeft:N.value?'48px':0,paddingRight:N.value?'48px':0})},[(0,n.createElementVNode)('span',{innerHTML:T(o.value,u.value)},null,8,le)],6),(0,n.createCommentVNode)(' å‘¼å¸æŒ‡ç¤ºå™¨ '),(0,n.createElementVNode)('div',re,[((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)(D.value)))]),(0,n.createCommentVNode)(' å†…ç½®å³ç®­å¤´ '),N.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',se,[(0,n.createElementVNode)('button',{disabled:e.isLastDialogue,class:(0,n.normalizeClass)(['flex items-center justify-center transition-all duration-200',e.isLastDialogue?'cursor-not-allowed opacity-40':'hover:bg-opacity-100']),style:(0,n.normalizeStyle)(L.value),'aria-label':'ä¸‹ä¸€æ¡å¯¹è¯',onClick:(0,n.withModifiers)(R,['stop'])},[...l[6]||(l[6]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})],-1)])],14,ie)])):(0,n.createCommentVNode)('v-if',!0)],6),(0,n.createCommentVNode)(' å¤–ç½®å³ç®­å¤´ '),N.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:1,disabled:e.isLastDialogue,class:(0,n.normalizeClass)(['flex flex-shrink-0 items-center justify-center transition-all duration-200',e.isLastDialogue?'cursor-not-allowed opacity-40':'hover:scale-105']),style:(0,n.normalizeStyle)(B.value),'aria-label':'ä¸‹ä¸€æ¡å¯¹è¯',onClick:(0,n.withModifiers)(R,['stop'])},[...l[7]||(l[7]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})],-1)])],14,ce))])]),(0,n.createCommentVNode)(' ç¼–è¾‘å¯¹è¯æ¡† '),W.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,class:'fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm',onClick:q},[(0,n.createElementVNode)('div',{class:'bg-card rounded-lg p-6 shadow-xl max-w-md w-full mx-4',onClick:l[1]||(l[1]=(0,n.withModifiers)(()=>{},['stop'])),style:(0,n.normalizeStyle)({backgroundColor:f.value.colors.boxBackground,borderColor:f.value.colors.boxBorder,borderWidth:'1px',borderStyle:'solid'})},[(0,n.createElementVNode)('h3',{class:'text-lg font-semibold mb-4',style:(0,n.normalizeStyle)({color:f.value.colors.dialogText})},'ç¼–è¾‘æ¶ˆæ¯',4),(0,n.withDirectives)((0,n.createElementVNode)('textarea',{'onUpdate:modelValue':l[0]||(l[0]=e=>O.value=e),class:'w-full p-3 rounded border resize-none focus:outline-none focus:ring-2',style:(0,n.normalizeStyle)({backgroundColor:f.value.colors.boxBackground,borderColor:f.value.colors.boxBorder,color:f.value.colors.dialogText}),rows:'4',placeholder:'è¾“å…¥æ¶ˆæ¯å†…å®¹...'},null,4),[[n.vModelText,O.value]]),(0,n.createElementVNode)('div',de,[(0,n.createElementVNode)('button',{onClick:q,class:'px-4 py-2 rounded transition-colors',style:(0,n.normalizeStyle)({backgroundColor:f.value.colors.boxBorder+'40',color:f.value.colors.dialogText})},' å–æ¶ˆ ',4),(0,n.createElementVNode)('button',{onClick:G,class:'px-4 py-2 rounded transition-colors',style:(0,n.normalizeStyle)({backgroundColor:f.value.colors.nameBackground,color:f.value.colors.nameText})},' ç¡®è®¤ ',4)])],4)])):(0,n.createCommentVNode)('v-if',!0)],64))}}),me=(0,B.A)(ue,[['__scopeId','data-v-7ebdc071']]),pe={class:'note-lines'},ve={class:'note-content'},he={class:'note-text'},fe=(0,n.defineComponent)({__name:'NoteCard',props:{content:{},noteUnitId:{},initialPosition:{}},emits:['close','positionChange'],setup(e,{emit:t}){const o=e,a=t,l=(0,n.ref)(null),r=(0,n.ref)(!1),s=(0,n.ref)({x:0,y:0}),i=(0,n.ref)({x:0,y:0});(0,n.onMounted)(()=>{if(o.noteUnitId){const e=`note_position_${o.noteUnitId}`,t=localStorage.getItem(e);if(t)try{i.value=JSON.parse(t)}catch(e){console.warn('Failed to parse saved note position:',e)}else o.initialPosition&&(i.value=o.initialPosition)}else o.initialPosition&&(i.value=o.initialPosition)}),(0,n.watch)(()=>o.initialPosition,e=>{e&&!r.value&&(i.value=e)});const c=(0,n.computed)(()=>({transform:`translate(${i.value.x}px, ${i.value.y}px)`,cursor:r.value?'grabbing':'grab'}));function d(e){e.target.closest('.note-close-btn')||(m(e.clientX,e.clientY),e.preventDefault())}function u(e){if(!e.target.closest('.note-close-btn')&&e.touches.length>0){const t=e.touches[0];m(t.clientX,t.clientY),e.preventDefault()}}function m(e,t){r.value=!0;const o=l.value?.getBoundingClientRect();o&&(s.value={x:e-o.left,y:t-o.top}),document.addEventListener('mousemove',p),document.addEventListener('mouseup',f),document.addEventListener('touchmove',v,{passive:!1}),document.addEventListener('touchend',g)}function p(e){r.value&&l.value&&h(e.clientX,e.clientY)}function v(e){if(r.value&&l.value&&e.touches.length>0){const t=e.touches[0];h(t.clientX,t.clientY),e.preventDefault()}}function h(e,t){if(!l.value)return;const o=(l.value.closest('.relative')||document.body).getBoundingClientRect(),n=l.value.getBoundingClientRect(),a=e-o.left-s.value.x,r=t-o.top-s.value.y,c=Math.max(0,o.width-n.width),d=Math.max(0,o.height-n.height);i.value={x:Math.max(.5*-n.width,Math.min(a,c+.5*n.width)),y:Math.max(.5*-n.height,Math.min(r,d+.5*n.height))}}function f(){y()}function g(){y()}function y(){r.value=!1,document.removeEventListener('mousemove',p),document.removeEventListener('mouseup',f),document.removeEventListener('touchmove',v),document.removeEventListener('touchend',g),o.noteUnitId&&a('positionChange',o.noteUnitId,i.value)}function x(){a('close')}return(0,n.onUnmounted)(()=>{document.removeEventListener('mousemove',p),document.removeEventListener('mouseup',f),document.removeEventListener('touchmove',v),document.removeEventListener('touchend',g)}),(t,o)=>e.content?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,ref_key:'noteCardRef',ref:l,class:'note-card',style:(0,n.normalizeStyle)(c.value),onMousedown:d,onTouchstart:u},[(0,n.createCommentVNode)(' å…³é—­æŒ‰é’® '),(0,n.createElementVNode)('button',{class:'note-close-btn','aria-label':'å…³é—­',onClick:(0,n.withModifiers)(x,['stop']),onTouchend:(0,n.withModifiers)(x,['stop'])},[...o[0]||(o[0]=[(0,n.createElementVNode)('svg',{width:'12',height:'12',viewBox:'0 0 12 12',fill:'none',xmlns:'http://www.w3.org/2000/svg'},[(0,n.createElementVNode)('path',{d:'M9 3L3 9M3 3L9 9',stroke:'currentColor','stroke-width':'1.5','stroke-linecap':'round','stroke-linejoin':'round'})],-1)])],32),(0,n.createCommentVNode)(' çº¸å¼ è¾¹ç¼˜çš„æµ…ç»¿è£…é¥°è¾¹ '),o[1]||(o[1]=(0,n.createElementVNode)('div',{class:'note-border'},null,-1)),(0,n.createCommentVNode)(' é¡¶éƒ¨è£…é¥° - å°‘å¥³é£æ ¼çš„åœ†ç‚¹ '),o[2]||(o[2]=(0,n.createElementVNode)('div',{class:'note-dots'},[(0,n.createElementVNode)('div',{class:'note-dot'}),(0,n.createElementVNode)('div',{class:'note-dot'}),(0,n.createElementVNode)('div',{class:'note-dot'})],-1)),(0,n.createCommentVNode)(' æ¨ªçº¿èƒŒæ™¯ - æ—¥è®°æœ¬æ•ˆæœ '),(0,n.createElementVNode)('div',pe,[((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(8,e=>(0,n.createElementVNode)('div',{key:e,class:'note-line'})),64))]),(0,n.createCommentVNode)(' å·¦ä¾§è£…è®¢çº¿æ•ˆæœ '),o[3]||(o[3]=(0,n.createElementVNode)('div',{class:'note-binding'},null,-1)),(0,n.createCommentVNode)(' å†…å®¹åŒºåŸŸ '),(0,n.createElementVNode)('div',ve,[(0,n.createElementVNode)('div',he,(0,n.toDisplayString)(e.content),1)]),(0,n.createCommentVNode)(' å³ä¸‹è§’å°è£…é¥° - å¯çˆ±çš„å°èŠ± '),o[4]||(o[4]=(0,n.createStaticVNode)('<div class="note-flower" data-v-68f5f8e2><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-68f5f8e2><circle cx="10" cy="10" r="2" fill="currentColor" data-v-68f5f8e2></circle><circle cx="10" cy="5" r="2.5" fill="currentColor" data-v-68f5f8e2></circle><circle cx="15" cy="10" r="2.5" fill="currentColor" data-v-68f5f8e2></circle><circle cx="10" cy="15" r="2.5" fill="currentColor" data-v-68f5f8e2></circle><circle cx="5" cy="10" r="2.5" fill="currentColor" data-v-68f5f8e2></circle></svg></div>',1))],36)):(0,n.createCommentVNode)('v-if',!0)}}),ge=(0,B.A)(fe,[['__scopeId','data-v-68f5f8e2']]),ye={class:'title-bar'},xe={class:'title-group'},be={class:'menu-bar'},ke={key:0,class:'menu-item-badge'},we={class:'panel-body relative flex'},Ce={key:0,class:'contacts-sidebar'},Ne={class:'contacts-list'},Ve=['onClick'],Ee={class:'contact-avatar'},Se={key:0,class:'avatar-unread-dot'},Me={class:'contact-info'},Be={class:'contact-name'},Ie={key:0,class:'contact-badge'},$e={class:'display-wrapper'},Le={key:0,class:'refresh-indicator'},_e=['data-owner','innerHTML'],De={key:0,class:'typing-cursor'},Pe={class:'cmd-bar'},ze=['disabled'],Re=['disabled'],Te={class:'settings-header'},Ue={class:'settings-body'},je={class:'settings-item'},Fe=(0,n.defineComponent)({__name:'PhonePanel',props:{show:{type:Boolean},messageId:{},statusBlock:{},onClose:{type:Function}},setup(e,{expose:t}){const o=e,a=(0,n.ref)(null),l=(0,n.ref)(!1),r=(0,n.ref)(!1),s=(0,n.ref)(!1),i=(0,n.ref)(''),c=(0,n.ref)(''),d=(0,n.ref)([]),u=(0,n.ref)(new Map),m=(0,n.ref)(new Map),p=(0,n.ref)([]),v=(0,n.ref)(new Set),h=(0,n.ref)('æ‰‹æœº Â· Phone'),f=(0,n.ref)([]),g=(0,n.ref)(0),y=(0,n.ref)(!1),x=(0,n.ref)(!1),b=(0,n.ref)(null),k=(0,n.ref)(''),w=(0,n.ref)(!1),C=(0,n.ref)(!1),N=(0,n.ref)(new Set),V=(0,n.ref)(null),E=(0,n.ref)(null);function S(){i.value=c.value,localStorage.setItem('phone-panel-bg-url',c.value),r.value=!1,console.info('[PhonePanel] èƒŒæ™¯å›¾ç‰‡å·²ä¿å­˜:',c.value)}function M(){c.value='',i.value='';try{localStorage.removeItem('phone-panel-bg-url')}catch(e){console.warn('æ¸…é™¤èƒŒæ™¯å›¾ç‰‡URLå¤±è´¥:',e)}r.value=!1}function B(){b.value&&(clearTimeout(b.value),b.value=null),x.value=!1,o.onClose()}function I(e){const t=e.match(/<StatusBlock>([\s\S]*?)<\/StatusBlock>/i);if(!t)return null;const o=t[1].match(/<skit>\s*([\s\S]*?)<\/skit>/i);if(!o)return null;const n=o[1].trim();if(!n)return null;const a=n.match(/^([^ï¼š:\n]+?)[ï¼š:]\s*(.+)$/s);if(a){return{title:a[1].trim(),content:a[2].trim()}}return{title:'',content:n}}function L(e){const t=/<phone>([\s\S]*?)<\/phone>/gi.exec(e);if(!t)return null;const o=t[1].trim().match(/(?:ä¸)?([^ï¼š:çš„èŠå¤©]+)(?:çš„èŠå¤©)?[ï¼š:](.*?)(?:\|(.+))?$/);if(!o)return null;const n=o[1].trim(),a=o[2].trim(),l=o[3]?.trim();let r='user';try{const e=new RawCharacter(RawCharacter.find({name:'current'})).getCardData();e.data?.user_name&&(r=e.data.user_name)}catch(e){console.warn('[PhonePanel] è·å–ç”¨æˆ·åç§°å¤±è´¥')}const s=n===r||/user|ç©å®¶|ä½ /i.test(n);return{contact:s?'':n,messages:[{speaker:n,content:a,timestamp:l,isUser:s,hideLabel:!1}]}}function D(e){a.value=e;const t=m.value.get(e)||[];d.value=[...t],v.value.delete(e),(0,n.nextTick)(()=>{T()}),N.value.has(e)||j(e)}function P(){if(!k.value.trim()||!a.value)return;const e={speaker:'ä½ ',content:k.value.trim(),isUser:!0,hideLabel:!1,timestamp:R()},t=u.value.get(a.value)||[];t.push(e),u.value.set(a.value,t);const o=m.value.get(a.value)||[];o.push(e),m.value.set(a.value,o),d.value.push(e),k.value='',(0,n.nextTick)(()=>{T()}),console.info('[PhonePanel] æ¶ˆæ¯å·²é¢„å­˜:',e)}function R(){try{if('undefined'!=typeof Mvu&&Mvu.get){const e=Mvu.get('æ—¶é—´');if(e){const t=e.match(/(\d{4})\/(\d{1,2})\/(\d{1,2}).*?(\d{1,2}):(\d{2})/);if(t)return`${t[1]}-${t[2].padStart(2,'0')}-${t[3].padStart(2,'0')} ${t[4].padStart(2,'0')}:${t[5]}`}}}catch(e){console.warn('[PhonePanel] è·å– MVU æ—¶é—´å¤±è´¥:',e)}const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,'0')}-${String(e.getDate()).padStart(2,'0')} ${String(e.getHours()).padStart(2,'0')}:${String(e.getMinutes()).padStart(2,'0')}`}function T(){V.value&&(V.value.scrollTop=V.value.scrollHeight)}function U(){V.value&&a.value&&(0!==V.value.scrollTop||C.value||N.value.has(a.value)||(C.value=!0,j(a.value)))}async function j(e){try{console.info('[PhonePanel] å¼€å§‹åŠ è½½å†å²è®°å½•:',e);const t=`[ä¸${e}çš„èŠå¤©è®°å½•]`,o=[];try{const e=getCharWorldbookNames('current');e.primary&&o.push(e.primary),o.push(...e.additional)}catch(e){console.warn('[PhonePanel] è·å–è§’è‰²å¡ä¸–ç•Œä¹¦å¤±è´¥:',e)}if(0===o.length)return console.warn('[PhonePanel] æ²¡æœ‰å¯ç”¨çš„ä¸–ç•Œä¹¦'),void(C.value=!1);let l='';for(const e of o)try{const o=(await getWorldbook(e)).find(e=>e.enabled&&e.name===t);if(o){l=o.content,console.info('[PhonePanel] æ‰¾åˆ°å†å²è®°å½•æ¡ç›®:',t,'å†…å®¹é•¿åº¦:',l.length);break}}catch(t){console.warn('[PhonePanel] è¯»å–ä¸–ç•Œä¹¦å¤±è´¥:',e,t)}if(!l)return console.info('[PhonePanel] æ²¡æœ‰æ‰¾åˆ°å†å²è®°å½•æ¡ç›®:',t),N.value.add(e),void(C.value=!1);const r=[],s=l.split('\n').filter(e=>e.trim());let i='user';try{const e=new RawCharacter(RawCharacter.find({name:'current'})).getCardData();e.data?.user_name&&(i=e.data.user_name)}catch(e){console.warn('[PhonePanel] è·å–ç”¨æˆ·åç§°å¤±è´¥')}for(const e of s){const t=e.match(/^([^ï¼š:]+)[ï¼š:](.*?)(?:\|(.+))?$/);if(t){const e=t[1].trim(),o=t[2].trim(),n=t[3]?.trim(),a=e===i||'user'===e||/user|ç©å®¶|ä½ /i.test(e);r.push({speaker:e,content:o,timestamp:n,isUser:a,hideLabel:!1})}}for(let e=1;e<r.length;e++)r[e].speaker===r[e-1].speaker&&(r[e].hideLabel=!0);const c=m.value.get(e)||[];if(m.value.set(e,[...r,...c]),a.value===e){const e=V.value?.scrollHeight||0;d.value=[...r,...d.value],(0,n.nextTick)(()=>{if(V.value){const t=V.value.scrollHeight;V.value.scrollTop=t-e}})}N.value.add(e),console.info('[PhonePanel] å†å²è®°å½•åŠ è½½å®Œæˆï¼Œæ¶ˆæ¯æ•°:',r.length)}catch(e){console.error('[PhonePanel] åŠ è½½å†å²è®°å½•å¤±è´¥:',e)}finally{C.value=!1}}async function F(e,t){try{const o=`[ä¸${e}çš„èŠå¤©è®°å½•]`,n=[];try{const e=getCharWorldbookNames('current');e.primary&&n.push(e.primary),n.push(...e.additional)}catch(e){console.warn('[PhonePanel] è·å–è§’è‰²å¡ä¸–ç•Œä¹¦å¤±è´¥:',e)}if(0===n.length)return void console.warn('[PhonePanel] æ²¡æœ‰å¯ç”¨çš„ä¸–ç•Œä¹¦');const a=n[0],l=(await getWorldbook(a)).find(e=>e.name===o),r=t.map(e=>`${e.speaker}ï¼š${e.content}${e.timestamp?`|${e.timestamp}`:''}`).join('\n');if(l)l.content+='\n'+r,await replaceWorldbook(a,[l]),console.info('[PhonePanel] æ¶ˆæ¯å·²ä¿å­˜åˆ°ä¸–ç•Œä¹¦:',o);else{const t={name:o,content:r,enabled:!0,keys:[e],priority:100};await replaceWorldbook(a,[t]),console.info('[PhonePanel] æ–°å»ºä¸–ç•Œä¹¦æ¡ç›®å¹¶ä¿å­˜æ¶ˆæ¯:',o)}}catch(e){console.error('[PhonePanel] ä¿å­˜æ¶ˆæ¯åˆ°ä¸–ç•Œä¹¦å¤±è´¥:',e)}}function W(){0!==f.value.length&&(g.value>=f.value.length?console.info('[PhonePanel] å°å‰§åœºæ’­æ”¾å®Œæ¯•'):(x.value=!0,H(!0)))}function O(){0!==f.value.length&&(g.value>=f.value.length?console.info('[PhonePanel] å°å‰§åœºæ’­æ”¾å®Œæ¯•'):(x.value=!1,b.value&&(clearTimeout(b.value),b.value=null),H(!1)))}function A(){x.value=!1,b.value&&(clearTimeout(b.value),b.value=null),g.value=0,d.value=[],console.info('[PhonePanel] å°å‰§åœºå·²é‡ç½®')}function H(e){if(g.value>=f.value.length)return void(x.value=!1);const t=f.value[g.value];g.value++,y.value=!0;const o=t.content.length>50?30:50;d.value.push({...t,content:''});const n=d.value.length-1;let a=0;const l=setInterval(()=>{a<t.content.length?(d.value[n].content+=t.content[a],a++,T()):(clearInterval(l),y.value=!1,e&&x.value&&(b.value=window.setTimeout(()=>{H(!0)},800)))},o)}async function G(){try{const e=await async function(){return new Promise((e,t)=>{if(void 0!==window.html2canvas)return void e(window.html2canvas);const o=document.createElement('script');o.src='https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js',o.onload=()=>{void 0!==window.html2canvas?e(window.html2canvas):t(new Error('html2canvas åŠ è½½å¤±è´¥'))},o.onerror=()=>t(new Error('html2canvas è„šæœ¬åŠ è½½å¤±è´¥')),document.head.appendChild(o)})}();if(y.value=!1,await(0,n.nextTick)(),!E.value)return;const t=await e(E.value,{backgroundColor:'#fdfdfb',scale:2}),o=document.createElement('a');o.download=`å°å‰§åœº_${Date.now()}.png`,o.href=t.toDataURL(),o.click(),console.info('[PhonePanel] æˆªå±å®Œæˆ')}catch(e){console.error('[PhonePanel] æˆªå±å¤±è´¥:',e)}}async function q(){h.value='æ‰‹æœº Â· Phone',f.value=[],p.value=[],g.value=0,X();try{let e=null;if(void 0!==o.messageId){const t=getChatMessages(o.messageId);if(t.length>0){e=I(t[0].message||'')}}if(!e)try{const t=void 0!==o.messageId?o.messageId:'function'==typeof getLastMessageId?getLastMessageId():null;if(null!==t)for(let o=t;o>=Math.max(0,t-10);o--){const t=getChatMessages(o);if(t.length>0){if(e=I(t[0].message||''),e)break}}}catch(e){console.warn('æŸ¥æ‰¾å°å‰§åœºå¤±è´¥:',e)}if(!e&&o.statusBlock?.å°å‰§åœº){const t=o.statusBlock.å°å‰§åœº,n=t.match(/^([^ï¼š:\n]+?)[ï¼š:]\s*(.+)$/s);e=n?{title:n[1].trim(),content:n[2].trim()}:{title:'',content:t}}e&&e.content?(h.value=e.title||'æ‰‹æœº Â· Phone',f.value=function(e){const t=[],o=/ã€([^ï¼š:]+)[ï¼š:](.*?)ã€‘/g;let n,a='user';try{const e=new RawCharacter(RawCharacter.find({name:'current'})).getCardData();e.data?.user_name&&(a=e.data.user_name)}catch(e){console.warn('[PhonePanel] è·å–ç”¨æˆ·åç§°å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼ "user"')}for(;null!==(n=o.exec(e));){const e=n[1]?.trim()||'',o=n[2]?.trim()||'',l=e.split('ï¼ˆ')[0].split('(')[0].trim(),r=/<user>/i.test(e)||l===a||/user|ç©å®¶|ä½ /i.test(l);t.push({speaker:e,content:o,isUser:r,hideLabel:!1}),r||p.value.includes(l)||(p.value.push(l),console.info('[PhonePanel] æ–°å¢è”ç³»äºº:',l))}for(let e=1;e<t.length;e++)t[e].speaker===t[e-1].speaker&&(t[e].hideLabel=!0);return t}(e.content),console.info('[PhonePanel] å°å‰§åœºæ¶ˆæ¯è§£æå®Œæˆï¼Œæ¶ˆæ¯æ•°:',f.value.length),p.value.length>0&&!a.value&&D(p.value[0]),v.value.size>0&&(l.value=!0)):h.value='æ‰‹æœº Â· Phone'}catch(e){console.error('[PhonePanel] åŠ è½½å°å‰§åœºå¤±è´¥:',e)}}function X(){b.value&&(clearTimeout(b.value),b.value=null),x.value=!1,y.value=!1}return(0,n.onMounted)(()=>{const e=localStorage.getItem('phone-panel-bg-url');e&&(i.value=e,c.value=e);const t=()=>{s.value=!!document.fullscreenElement};document.addEventListener('fullscreenchange',t);const o=setInterval(()=>{!async function(){try{const e='function'==typeof getLastMessageId?getLastMessageId():-1;if(e<0)return;const t=[];try{const o=Math.max(0,e-4);for(let n=e;n>=o;n--){const e=getChatMessages(n);e.length>0&&t.unshift(...e)}}catch(e){return void console.warn('[PhonePanel] è·å–æ¶ˆæ¯å¤±è´¥:',e)}const o=t.slice(-5);for(const e of o){const t=/<phone>([\s\S]*?)<\/phone>/gi;let o;for(;null!==(o=t.exec(e.message||''));){const e=L(o[0]);if(e&&e.contact&&e.contact!==a.value){v.value.add(e.contact),p.value.includes(e.contact)||p.value.push(e.contact);const t=m.value.get(e.contact)||[];t.push(...e.messages),m.value.set(e.contact,t),F(e.contact,e.messages)}}}}catch(e){console.error('[PhonePanel] æ£€æŸ¥æœªè¯»æ¶ˆæ¯å¤±è´¥:',e)}}()},2e3);(0,n.onUnmounted)(()=>{document.removeEventListener('fullscreenchange',t),clearInterval(o),b.value&&clearTimeout(b.value)})}),(0,n.watch)(()=>[o.show,o.messageId,o.statusBlock],async()=>{o.show?await q():X()},{immediate:!0}),(0,n.watch)(()=>o.show,e=>{e||(g.value=0,x.value=!1,y.value=!1,b.value&&(clearTimeout(b.value),b.value=null))}),t({getPendingMessages:function(){const e=[];for(const[t,o]of u.value.entries())if(o.length>0){const n=o.map(e=>`${e.content}${e.timestamp?`|${e.timestamp}`:''}`).join('\n');e.push(`<phone>\nä¸${t}çš„èŠå¤©ï¼š${n}\n</phone>`)}return u.value.clear(),e.join('\n')}}),(t,o)=>e.show?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,class:'fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm',onClick:(0,n.withModifiers)(B,['self'])},[(0,n.createCommentVNode)(' æµ…ç»¿è‰²ç³»çª—å£ '),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['theater-window relative max-h-[85vh] w-[90%] max-w-md overflow-hidden rounded-xl shadow-2xl',{'theater-window-fullscreen':s.value}])},[(0,n.createCommentVNode)(' æ ‡é¢˜æ  - æµ…ç»¿è‰²æ¸å˜ '),(0,n.createElementVNode)('div',ye,[(0,n.createElementVNode)('div',xe,[o[7]||(o[7]=(0,n.createElementVNode)('div',{class:'icon-charm'},null,-1)),(0,n.createElementVNode)('span',null,(0,n.toDisplayString)(a.value?`ä¸${a.value}çš„èŠå¤©`:h.value),1)]),(0,n.createElementVNode)('div',{class:'win-controls'},[(0,n.createElementVNode)('button',{class:'win-btn btn-close','aria-label':'å…³é—­',onClick:B},[...o[8]||(o[8]=[(0,n.createElementVNode)('svg',{t:'1766144599366',class:'icon',viewBox:'0 0 1024 1024',version:'1.1',xmlns:'http://www.w3.org/2000/svg','p-id':'4447',width:'12',height:'12'},[(0,n.createElementVNode)('path',{d:'M886.784 746.496q29.696 30.72 43.52 56.32t-4.608 58.368q-4.096 6.144-11.264 14.848t-14.848 16.896-15.36 14.848-12.8 9.728q-25.6 15.36-60.416 8.192t-62.464-34.816l-43.008-43.008-57.344-57.344-67.584-67.584-73.728-73.728-131.072 131.072q-60.416 60.416-98.304 99.328-38.912 38.912-77.312 48.128t-68.096-17.408l-7.168-7.168-11.264-11.264-11.264-11.264q-6.144-6.144-7.168-8.192-11.264-14.336-13.312-29.184t2.56-29.184 13.824-27.648 20.48-24.576q9.216-8.192 32.768-30.72l55.296-57.344q33.792-32.768 75.264-73.728t86.528-86.016q-49.152-49.152-93.696-93.184t-79.872-78.848-57.856-56.832-27.648-27.136q-26.624-26.624-27.136-52.736t17.92-52.736q8.192-10.24 23.552-24.064t21.504-17.92q30.72-20.48 55.296-17.92t49.152 28.16l31.744 31.744q23.552 23.552 58.368 57.344t78.336 76.288 90.624 88.576q38.912-38.912 76.288-75.776t69.632-69.12 58.368-57.856 43.52-43.008q24.576-23.552 53.248-31.232t55.296 12.8q1.024 1.024 6.656 5.12t11.264 9.216 10.752 9.728 7.168 5.632q27.648 26.624 27.136 57.856t-27.136 57.856q-18.432 18.432-45.568 46.08t-60.416 60.416-70.144 69.632l-77.824 77.824q37.888 36.864 74.24 72.192t67.584 66.048 56.32 56.32 41.472 41.984z','p-id':'4448',fill:'currentColor'})],-1)])])])]),(0,n.createCommentVNode)(' èœå•æ  '),(0,n.createElementVNode)('div',be,[(0,n.createElementVNode)('span',{class:'menu-item',onClick:o[0]||(o[0]=e=>l.value=!l.value)},[(0,n.createTextVNode)((0,n.toDisplayString)(l.value?'éšè—è”ç³»äºº':'æŸ¥çœ‹è”ç³»äºº')+' ',1),v.value.size>0?((0,n.openBlock)(),(0,n.createElementBlock)('span',ke)):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('span',{class:'menu-item',onClick:G},'è®°å½•'),(0,n.createElementVNode)('span',{class:'menu-item',onClick:o[1]||(o[1]=e=>r.value=!r.value)},'è®¾ç½®')]),(0,n.createCommentVNode)(' ä¸»ä½“å†…å®¹åŒºåŸŸ '),(0,n.createElementVNode)('div',we,[(0,n.createCommentVNode)(' è”ç³»äººåˆ—è¡¨ï¼ˆå·¦ä¾§ï¼‰ '),l.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ce,[o[9]||(o[9]=(0,n.createElementVNode)('div',{class:'contacts-header'},'è”ç³»äºº',-1)),(0,n.createElementVNode)('div',Ne,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(p.value,e=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e,class:(0,n.normalizeClass)(['contact-item',{active:a.value===e,'has-unread':v.value.has(e)}]),onClick:t=>D(e)},[(0,n.createElementVNode)('div',Ee,[(0,n.createTextVNode)((0,n.toDisplayString)(e.charAt(0))+' ',1),v.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',Se)):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createElementVNode)('div',Me,[(0,n.createElementVNode)('div',Be,(0,n.toDisplayString)(e),1)]),v.value.has(e)?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ie)):(0,n.createCommentVNode)('v-if',!0)],10,Ve))),128))])])):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' èŠå¤©åŒºåŸŸï¼ˆå³ä¾§/å…¨å±ï¼‰ '),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['chat-area',{'w-full':!l.value,'w-2/3':l.value}])},[(0,n.createElementVNode)('div',$e,[(0,n.createCommentVNode)(' èƒŒæ™¯å›¾ç‰‡ '),(0,n.createElementVNode)('div',{class:'bg-image',style:(0,n.normalizeStyle)({backgroundImage:i.value?`url('${i.value}')`:'url(\'https://files.catbox.moe/2td8l0.jpg\')'})},null,4),o[12]||(o[12]=(0,n.createElementVNode)('div',{class:'watermark-xi'},'å°',-1)),(0,n.createElementVNode)('div',{ref_key:'scrollContainer',ref:V,class:'scroll-container',onScroll:U},[(0,n.createCommentVNode)(' åˆ·æ–°æŒ‡ç¤ºå™¨ '),C.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Le,[...o[10]||(o[10]=[(0,n.createElementVNode)('div',{class:'refresh-spinner'},null,-1),(0,n.createElementVNode)('span',null,'åŠ è½½å†å²è®°å½•...',-1)])])):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' æ¶ˆæ¯æ°”æ³¡ '),(0,n.createElementVNode)('div',{ref_key:'chatLog',ref:E,class:'chat-log'},[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(d.value,(e,t)=>{return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:t},[(0,n.createCommentVNode)(' æ¶ˆæ¯å®¹å™¨ï¼ˆåŒ…å«åå­—å’Œæ°”æ³¡ï¼Œä½†ä¸å…±äº«èƒŒæ™¯ï¼‰ '),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['message-container',e.isUser?'message-right':'message-left'])},[(0,n.createCommentVNode)(' å‘è¨€è€…æ ‡ç­¾ï¼ˆç‹¬ç«‹äºæ°”æ³¡ï¼Œå•ç‹¬ä¸€è¡Œï¼‰ '),e.hideLabel?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,class:(0,n.normalizeClass)(['speaker-label',e.isUser?'text-right':'text-left'])},(0,n.toDisplayString)(e.speaker),3)),(0,n.createCommentVNode)(' æ°”æ³¡å†…å®¹ï¼ˆç‹¬ç«‹å®¹å™¨ï¼Œåªæœ‰æ°”æ³¡æœ‰èƒŒæ™¯ï¼‰ '),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['bubble',e.isUser?'bubble-right':'bubble-left']),'data-owner':e.speaker,innerHTML:(o=e.content,o.replace(/[ï¼ˆ(]([^ï¼‰)]+)[ï¼‰)]/g,'<span style="font-family: \'KaiTi\', \'æ¥·ä½“\', serif; font-size: 0.9em; color: #888; margin: 0 2px;">ï¼ˆ$1ï¼‰</span>'))},null,10,_e),(0,n.createCommentVNode)(' æ—¶é—´æˆ³ '),e.timestamp?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:1,class:(0,n.normalizeClass)(['timestamp',e.isUser?'text-right':'text-left'])},(0,n.toDisplayString)(e.timestamp),3)):(0,n.createCommentVNode)('v-if',!0)],2)],64);var o}),128)),(0,n.createCommentVNode)(' æ‰“å­—å…‰æ ‡ï¼ˆä»…åœ¨æ‰“å­—æ—¶æ˜¾ç¤ºï¼‰ '),y.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',De,[...o[11]||(o[11]=[(0,n.createElementVNode)('span',{class:'cursor'},null,-1)])])):(0,n.createCommentVNode)('v-if',!0)],512)],544)]),(0,n.createCommentVNode)(' è¾“å…¥æ  '),(0,n.createElementVNode)('div',Pe,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':o[2]||(o[2]=e=>k.value=e),type:'text',class:'cmd-input',disabled:y.value||w.value,placeholder:'è¾“å…¥æ¶ˆæ¯...',onKeydown:(0,n.withKeys)(P,['enter'])},null,40,ze),[[n.vModelText,k.value]]),(0,n.createElementVNode)('button',{class:'cmd-send-btn',disabled:y.value||w.value||!k.value.trim()||!a.value,onClick:P},[...o[13]||(o[13]=[(0,n.createElementVNode)('svg',{t:'1766144631220',class:'icon',viewBox:'0 0 1024 1024',version:'1.1',xmlns:'http://www.w3.org/2000/svg','p-id':'5495',width:'16',height:'16'},[(0,n.createElementVNode)('path',{d:'M1023.200312 43.682936L877.057399 920.640375c-1.899258 10.995705-8.096837 19.592347-18.292854 25.689965-5.29793 2.898868-11.295588 4.598204-17.693089 4.598204-4.19836 0-8.796564-0.99961-13.69465-2.898868l-236.707536-96.762202c-12.994924-5.29793-27.889106-1.499414-36.785631 9.296368l-123.251855 150.341273c-6.897306 8.796564-16.293635 13.094885-27.989066 13.094885-4.898087 0-9.096447-0.799688-12.695041-2.299102-7.197189-2.698946-12.994924-6.997267-17.393206-13.394768-4.398282-6.29754-6.697384-13.194846-6.697384-20.891839V811.083171c0-14.794221 5.098009-28.988676 14.394377-40.484186l478.912925-587.070676-602.864506 521.796174c-4.598204 3.898477-10.995705 4.998048-16.493557 2.698945L23.390863 619.358063C9.296369 614.060133 1.599375 603.664194 0.599766 587.870363c-0.799688-15.194065 5.29793-26.489652 18.292854-33.786802L968.921515 5.997657c5.797735-3.498633 11.795392-5.098009 18.292854-5.098008 7.696993 0 14.594299 2.199141 20.691918 6.397501 12.695041 8.996486 17.593128 21.291683 15.294025 36.385786z','p-id':'5496',fill:'currentColor'})],-1)])],8,Re)]),(0,n.createCommentVNode)(' çŠ¶æ€æ  '),(0,n.createElementVNode)('div',{class:'status-bar'},[(0,n.createElementVNode)('button',{class:'jade-btn',onClick:W},'â–¶ è‡ªåŠ¨æ’­æ”¾'),(0,n.createElementVNode)('button',{class:'jade-btn',onClick:O},'â¯ ç»§ç»­'),(0,n.createElementVNode)('button',{class:'jade-btn jade-btn-red',onClick:A},'â†º é‡ç½®')])],2)]),(0,n.createCommentVNode)(' è®¾ç½®é¢æ¿ï¼ˆå¼¹å‡ºï¼‰ '),r.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,class:'settings-overlay',onClick:o[6]||(o[6]=e=>r.value=!1)},[(0,n.createElementVNode)('div',{class:'settings-panel',onClick:o[5]||(o[5]=(0,n.withModifiers)(()=>{},['stop']))},[(0,n.createElementVNode)('div',Te,[o[14]||(o[14]=(0,n.createElementVNode)('h3',null,'è®¾ç½®',-1)),(0,n.createElementVNode)('button',{class:'settings-close',onClick:o[3]||(o[3]=e=>r.value=!1)},'Ã—')]),(0,n.createElementVNode)('div',Ue,[(0,n.createElementVNode)('div',je,[o[15]||(o[15]=(0,n.createElementVNode)('label',null,'èŠå¤©èƒŒæ™¯å›¾ç‰‡URL',-1)),(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':o[4]||(o[4]=e=>c.value=e),type:'text',class:'settings-input',placeholder:'è¾“å…¥å›¾ç‰‡URLæˆ–ç•™ç©ºä½¿ç”¨é»˜è®¤',onBlur:S},null,544),[[n.vModelText,c.value]]),(0,n.createElementVNode)('button',{class:'settings-btn',onClick:M},'æ¸…é™¤')])])])])):(0,n.createCommentVNode)('v-if',!0)],2)])):(0,n.createCommentVNode)('v-if',!0)}}),We=(0,B.A)(Fe,[['__scopeId','data-v-eef7e62c']]),Oe={class:'space-y-1.5'},Ae={class:'flex items-center justify-between'},He={class:'text-muted-foreground text-xs'},Ge={class:'flex items-center gap-2'},qe={class:'text-muted-foreground w-5 text-[10px]'},Xe=['onPointerdown','onPointermove','onPointerup'],Ye={class:'text-muted-foreground w-9 text-right text-[10px]'},Je=(0,n.defineComponent)({__name:'ColorSlider',props:{label:{},value:{},showAlpha:{type:Boolean,default:!0}},emits:['update:value'],setup(e,{emit:t}){const o=e,a=t;function l(e){let t=0,o=0,n=0,a=1;if(e.startsWith('rgba')){const l=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);l&&(t=Number.parseInt(l[1])/255,o=Number.parseInt(l[2])/255,n=Number.parseInt(l[3])/255,a=l[4]?Number.parseFloat(l[4]):1)}else if(e.startsWith('rgb')){const a=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);a&&(t=Number.parseInt(a[1])/255,o=Number.parseInt(a[2])/255,n=Number.parseInt(a[3])/255)}else if(e.startsWith('#')){const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);l&&(t=Number.parseInt(l[1],16)/255,o=Number.parseInt(l[2],16)/255,n=Number.parseInt(l[3],16)/255,a=l[4]?Number.parseInt(l[4],16)/255:1)}const l=Math.max(t,o,n),r=Math.min(t,o,n);let s=0,i=0;const c=(l+r)/2;if(l!==r){const e=l-r;switch(i=c>.5?e/(2-l-r):e/(l+r),l){case t:s=((o-n)/e+(o<n?6:0))/6;break;case o:s=((n-t)/e+2)/6;break;case n:s=((t-o)/e+4)/6}}return{h:Math.round(360*s),s:Math.round(100*i),l:Math.round(100*c),a}}function r(e,t,o,n){t/=100,o/=100;const a=t=>(t+e/30)%12,l=e=>o-t*Math.min(o,1-o)*Math.max(-1,Math.min(a(e)-3,Math.min(9-a(e),1))),r=Math.round(255*l(0)),s=Math.round(255*l(8)),i=Math.round(255*l(4));return n<1?`rgba(${r}, ${s}, ${i}, ${n.toFixed(2)})`:`#${r.toString(16).padStart(2,'0')}${s.toString(16).padStart(2,'0')}${i.toString(16).padStart(2,'0')}`}function s(e){if(e.startsWith('#'))return e.slice(0,7).toUpperCase();const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(t){return`#${Number.parseInt(t[1]).toString(16).padStart(2,'0')}${Number.parseInt(t[2]).toString(16).padStart(2,'0')}${Number.parseInt(t[3]).toString(16).padStart(2,'0')}`.toUpperCase()}return'#000000'}const i=(0,n.computed)(()=>l(o.value)),c=(0,n.computed)(()=>s(o.value)),d=(0,n.ref)(c.value),u=(0,n.ref)(i.value),m=(0,n.ref)(!1),p={},v=(0,n.ref)(null),h=(0,n.ref)(null),f=(0,n.ref)(null);(0,n.watch)(()=>o.value,()=>{if(!m.value){const e=l(o.value);u.value=e,d.value=c.value}});const g=(0,n.computed)(()=>{const e=[{key:'h',label:'H',min:0,max:360,currentValue:u.value.h,gradient:'linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000)',step:1,thumbColor:`hsl(${u.value.h}, 100%, 50%)`,displayValue:`${Math.round(u.value.h)}Â°`},{key:'s',label:'S',min:0,max:100,currentValue:u.value.s,gradient:`linear-gradient(to right, hsl(${u.value.h}, 0%, ${u.value.l}%), hsl(${u.value.h}, 100%, ${u.value.l}%))`,step:1,thumbColor:r(u.value.h,u.value.s,u.value.l,1),displayValue:`${Math.round(u.value.s)}%`},{key:'l',label:'L',min:0,max:100,currentValue:u.value.l,gradient:`linear-gradient(to right, #000, hsl(${u.value.h}, ${u.value.s}%, 50%), #fff)`,step:1,thumbColor:r(u.value.h,u.value.s,u.value.l,1),displayValue:`${Math.round(u.value.l)}%`}];return o.showAlpha&&e.push({key:'a',label:'A',min:0,max:1,currentValue:u.value.a,gradient:`linear-gradient(to right, transparent, ${r(u.value.h,u.value.s,u.value.l,1)})`,step:.01,thumbColor:r(u.value.h,u.value.s,u.value.l,u.value.a),displayValue:`${Math.round(100*u.value.a)}%`}),e});function y(e,t){const o=p[t.key];if(!o)return;const n=o.getBoundingClientRect(),l=Math.max(0,Math.min(e.clientX-n.left,n.width))/n.width,s=t.min+l*(t.max-t.min),i=t.step<1?Math.round(100*s)/100:Math.round(s);u.value={...u.value,[t.key]:i};const c=r(u.value.h,u.value.s,u.value.l,u.value.a);a('update:value',c)}function x(){if(m.value){const e=r(u.value.h,u.value.s,u.value.l,u.value.a);a('update:value',e),m.value=!1}}function b(e){const t=e.target.value.toUpperCase();if(d.value=t,/^#[0-9A-F]{6}$/.test(t)){const e=l(t);e.a=u.value.a,u.value=e,a('update:value',r(e.h,e.s,e.l,e.a))}}function k(){d.value=s(o.value)}return(t,o)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',Oe,[(0,n.createElementVNode)('div',Ae,[(0,n.createElementVNode)('label',He,(0,n.toDisplayString)(e.label),1),(0,n.createElementVNode)('div',Ge,[(0,n.withDirectives)((0,n.createElementVNode)('input',{'onUpdate:modelValue':o[0]||(o[0]=e=>d.value=e),type:'text',class:'bg-background text-foreground w-20 rounded border px-2 py-0.5 font-mono text-xs',placeholder:'#000000',onInput:b,onBlur:k},null,544),[[n.vModelText,d.value]]),(0,n.createElementVNode)('div',{class:'border-border h-6 w-6 rounded border shadow-sm',style:(0,n.normalizeStyle)({backgroundColor:e.value})},null,4)])]),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(g.value,e=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:e.key,class:'flex items-center gap-2'},[(0,n.createElementVNode)('span',qe,(0,n.toDisplayString)(e.label),1),(0,n.createElementVNode)('div',{ref_for:!0,ref:t=>p[e.key]=t,class:'relative flex h-6 flex-1 cursor-pointer touch-none items-center',onPointerdown:t=>function(e,t){m.value=!0,v.value=t.key,e.currentTarget.setPointerCapture(e.pointerId),y(e,t);const o=e=>{v.value===t.key&&m.value&&y(e,t)},n=()=>{v.value===t.key&&(x(),v.value=null,h.value&&document.removeEventListener('pointermove',h.value),f.value&&document.removeEventListener('pointerup',f.value),e.currentTarget instanceof HTMLElement&&e.currentTarget.releasePointerCapture(e.pointerId))};h.value=o,f.value=n,document.addEventListener('pointermove',o),document.addEventListener('pointerup',n)}(t,e),onPointermove:t=>function(e,t){v.value===t.key&&m.value&&y(e,t)}(t,e),onPointerup:t=>function(e,t){v.value===t.key&&(x(),v.value=null,e.currentTarget instanceof HTMLElement&&e.currentTarget.releasePointerCapture(e.pointerId))}(t,e)},[(0,n.createElementVNode)('div',{class:'absolute inset-y-2 right-0 left-0 rounded-full',style:(0,n.normalizeStyle)({background:e.gradient})},null,4),(0,n.createElementVNode)('div',{class:'pointer-events-none absolute top-1/2 h-4 w-4 -translate-y-1/2 rounded-full border-2 border-white shadow-md',style:(0,n.normalizeStyle)({left:`calc(${(e.currentValue-e.min)/(e.max-e.min)*100}% - 8px)`,background:e.thumbColor})},null,4)],40,Xe),(0,n.createElementVNode)('span',Ye,(0,n.toDisplayString)(e.displayValue),1)]))),128))]))}}),Ke=(0,B.A)(Je,[['__scopeId','data-v-6137eb39']]),Qe={class:'flex items-center gap-1'},Ze={key:0,class:'p-1'},et={key:0,class:'absolute left-1 top-1/2 -translate-y-1/2'},tt={class:'absolute bottom-1.5 right-2'},ot={key:1,class:'absolute right-1 top-1/2 -translate-y-1/2'},nt={key:1,class:'p-1'},at=(0,n.defineComponent)({__name:'DialogPreview',props:{style:{}},setup(e){const t=e,o=(0,n.computed)(()=>t.style),d=(0,n.computed)(()=>l.find(e=>e.id===o.value.boxShape)||l[0]),u=(0,n.computed)(()=>s.find(e=>e.id===o.value.nameShape)||s[0]),m=(0,n.computed)(()=>i.find(e=>e.id===o.value.arrowShape)||i[0]),p=(0,n.computed)(()=>c.find(e=>e.id===o.value.indicatorShape)||c[0]),v=(0,n.computed)(()=>r.find(e=>e.id===o.value.borderWidth)||r[1]),h=(0,n.computed)(()=>a.find(e=>e.id===o.value.backgroundPattern)),f=(0,n.computed)(()=>m.value.isInner),g=((0,n.computed)(()=>'minimal'===m.value.type),(0,n.computed)(()=>'pill'===o.value.boxShape)),y=(0,n.computed)(()=>'square'===m.value.type||'inner-square'===m.value.type?'4px':'pill'===m.value.type?'12px':'9999px'),x=(0,n.computed)(()=>{if(!h.value?.pattern)return{};const e=o.value.colors.boxBorder.replace(/[\d.]+\)$/,'0.08)'),t=h.value.pattern.replace(/VAR_BORDER_COLOR/g,e);let n='20px 20px';return'dots'===h.value.id&&(n='16px 16px'),'diamonds'===h.value.id&&(n='16px 16px'),'stripes'===h.value.id&&(n='28px 28px'),{backgroundImage:t,backgroundSize:n}}),b=(0,n.computed)(()=>({backgroundColor:g.value?'rgba(255,255,255,0.7)':o.value.colors.boxBackground,borderRadius:d.value.borderRadius,borderTopWidth:v.value.width,borderLeftWidth:v.value.width,borderRightWidth:v.value.width,borderBottomWidth:v.value.width,borderStyle:'solid',borderColor:o.value.colors.boxBorder,boxShadow:d.value.shadow,...g.value?{backdropFilter:'blur(12px)',WebkitBackdropFilter:'blur(12px)'}:{},...x.value})),k=(0,n.computed)(()=>{const{type:e}=p.value,t=o.value.colors.indicatorColor;return'none'===e?null:'dots'===e?(0,n.h)('div',{class:'flex gap-0.5 items-center'},[0,1,2].map(e=>(0,n.h)('span',{key:e,class:'w-1 h-1 rounded-full',style:{backgroundColor:t,opacity:2===e?1:.4}}))):'diamonds'===e?(0,n.h)('div',{class:'flex gap-0.5 items-center'},[0,1,2].map(e=>(0,n.h)('span',{key:e,style:{width:'8px',height:'8px',backgroundColor:t,opacity:2===e?1:.3+.15*e,transform:'rotate(45deg)',display:'inline-block'}}))):'pulse'===e?(0,n.h)('div',{class:'relative w-2 h-2'},[(0,n.h)('span',{class:'absolute inset-0 rounded-full',style:{backgroundColor:t}})]):'arrow'===e?(0,n.h)('svg',{class:'w-3 h-3',style:{color:t},fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.h)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'})]):null});return(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',Qe,[f.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',Ze,[(0,n.createElementVNode)('div',{class:'p-1 backdrop-blur-sm shadow',style:(0,n.normalizeStyle)({backgroundColor:o.value.colors.arrowBackground,borderRadius:y.value.value})},[((0,n.openBlock)(),(0,n.createElementBlock)('svg',{class:'w-3 h-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',style:(0,n.normalizeStyle)({color:o.value.colors.arrowIcon})},[...t[0]||(t[0]=[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 19l-7-7 7-7'},null,-1)])],4))],4)])),(0,n.createElementVNode)('div',{class:'flex-1 p-2 min-h-[60px] relative',style:(0,n.normalizeStyle)(b.value)},[f.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',et,[(0,n.createElementVNode)('div',{class:'p-1 backdrop-blur-sm shadow',style:(0,n.normalizeStyle)({backgroundColor:o.value.colors.arrowBackground,borderRadius:y.value})},[((0,n.openBlock)(),(0,n.createElementBlock)('svg',{class:'w-3 h-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',style:(0,n.normalizeStyle)({color:o.value.colors.arrowIcon})},[...t[1]||(t[1]=[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 19l-7-7 7-7'},null,-1)])],4))],4)])):(0,n.createCommentVNode)('v-if',!0),(0,n.createElementVNode)('div',{class:'h-4 mb-1 flex items-start',style:(0,n.normalizeStyle)({paddingLeft:f.value?'24px':0,paddingRight:f.value?'24px':0})},[(0,n.createElementVNode)('div',{class:'px-2 py-0.5 text-[10px] font-medium',style:(0,n.normalizeStyle)({backgroundColor:o.value.colors.nameBackground,color:o.value.colors.nameText,borderRadius:u.value.borderRadius,borderBottom:'underline'===u.value.style?`2px solid ${o.value.colors.nameText}`:void 0,boxShadow:'floating'===u.value.style?'0 2px 8px rgba(0,0,0,0.1)':void 0})},' è§’è‰²å ',4)],4),(0,n.createElementVNode)('p',{class:'text-[10px] leading-relaxed',style:(0,n.normalizeStyle)({color:o.value.colors.dialogText,fontSize:`${o.value.fontSize}px`,paddingLeft:f.value?'24px':0,paddingRight:f.value?'24px':0})},' è¿™æ˜¯é¢„è§ˆæ–‡æœ¬ç¤ºä¾‹... ',4),(0,n.createElementVNode)('div',tt,[((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)(k.value)))]),f.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',ot,[(0,n.createElementVNode)('div',{class:'p-1 backdrop-blur-sm shadow',style:(0,n.normalizeStyle)({backgroundColor:o.value.colors.arrowBackground,borderRadius:y.value})},[((0,n.openBlock)(),(0,n.createElementBlock)('svg',{class:'w-3 h-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',style:(0,n.normalizeStyle)({color:o.value.colors.arrowIcon})},[...t[2]||(t[2]=[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'},null,-1)])],4))],4)])):(0,n.createCommentVNode)('v-if',!0)],4),f.value?(0,n.createCommentVNode)('v-if',!0):((0,n.openBlock)(),(0,n.createElementBlock)('div',nt,[(0,n.createElementVNode)('div',{class:'p-1 backdrop-blur-sm shadow',style:(0,n.normalizeStyle)({backgroundColor:o.value.colors.arrowBackground,borderRadius:y.value.value})},[((0,n.openBlock)(),(0,n.createElementBlock)('svg',{class:'w-3 h-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24',style:(0,n.normalizeStyle)({color:o.value.colors.arrowIcon})},[...t[3]||(t[3]=[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 5l7 7-7 7'},null,-1)])],4))],4)]))]))}}),lt={class:'animate-in fade-in absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm duration-200'},rt={class:'bg-card relative max-h-[85vh] w-[90%] max-w-lg overflow-hidden rounded-2xl shadow-2xl'},st={class:'border-border flex items-center justify-between border-b p-4'},it={class:'settings-scroll-container max-h-[calc(85vh-120px)] overflow-y-auto p-4'},ct={class:'space-y-6'},dt={class:'space-y-4'},ut={class:'space-y-3'},mt={class:'space-y-2'},pt=['value'],vt={class:'space-y-4'},ht={class:'space-y-3'},ft={class:'space-y-2'},gt={class:'text-muted-foreground text-xs'},yt=['value'],xt={class:'space-y-2'},bt={class:'text-muted-foreground text-xs'},kt=['value'],wt={class:'space-y-2'},Ct={class:'text-muted-foreground text-xs'},Nt=['value'],Vt={class:'space-y-4'},Et={class:'space-y-3'},St={class:'space-y-2'},Mt={class:'text-muted-foreground text-xs'},Bt=['value'],It={class:'space-y-2'},$t={class:'text-muted-foreground text-xs'},Lt=['value'],_t={class:'space-y-2'},Dt={class:'text-muted-foreground text-xs'},Pt=['value'],zt={class:'space-y-4'},Rt={class:'flex items-center justify-between'},Tt={class:'relative inline-flex cursor-pointer items-center'},Ut=['checked'],jt={key:0,class:'animate-in fade-in space-y-2 duration-200'},Ft={class:'text-muted-foreground text-xs'},Wt=['value'],Ot={class:'space-y-4'},At={class:'flex items-center justify-between'},Ht={class:'relative inline-flex cursor-pointer items-center'},Gt=['checked'],qt={key:0,class:'animate-in fade-in space-y-4 duration-200'},Xt={class:'bg-muted/30 rounded-lg p-3'},Yt={class:'mb-2 flex items-center justify-between'},Jt=['disabled'],Kt={key:0,class:'h-3 w-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},Qt={key:1,class:'h-3 w-3',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},Zt={class:'px-6'},eo={class:'space-y-4'},to={class:'bg-muted text-muted-foreground inline-flex h-9 w-full items-center justify-center rounded-lg p-[3px]'},oo={key:0,class:'space-y-4'},no={class:'space-y-2'},ao={class:'grid grid-cols-5 gap-2'},lo=['onClick'],ro={class:'space-y-2'},so={class:'grid grid-cols-6 gap-2'},io=['onClick'],co={class:'space-y-2'},uo={class:'grid grid-cols-5 gap-2'},mo=['onClick'],po={class:'space-y-2'},vo={class:'grid grid-cols-5 gap-2'},ho=['onClick'],fo={class:'space-y-2'},go={class:'grid grid-cols-6 gap-2'},yo=['onClick'],xo={class:'space-y-2'},bo={class:'grid grid-cols-5 gap-2'},ko=['onClick'],wo={class:'space-y-2'},Co={class:'text-muted-foreground text-xs'},No=['value'],Vo={key:1,class:'space-y-4'},Eo=(0,n.defineComponent)({__name:'SettingsPanel',props:{onClose:{type:Function},userDisplayName:{},onUserDisplayNameChange:{type:Function},spriteSettings:{},onSpriteSettingsChange:{type:Function},live2dSettings:{},onLive2dSettingsChange:{type:Function},autoPlay:{type:Boolean},onAutoPlayChange:{type:Function},autoPlaySpeed:{},onAutoPlaySpeedChange:{type:Function},dialogStyle:{},onDialogStyleChange:{type:Function},onSaveStyle:{type:Function},currentAppliedStyle:{},customModeEnabled:{type:Boolean},onCustomModeChange:{type:Function}},setup(e){const t=e,o=(0,n.ref)('shapes'),d=(0,n.computed)(()=>JSON.stringify(t.dialogStyle)!==JSON.stringify(t.currentAppliedStyle));function u(e){t.onSpriteSettingsChange(e)}function m(e){t.onLive2dSettingsChange(e)}function p(e,o){t.onDialogStyleChange({...t.dialogStyle,[e]:o})}function v(e,o){t.onDialogStyleChange({...t.dialogStyle,colors:{...t.dialogStyle.colors,[e]:o}})}return(h,f)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',lt,[(0,n.createElementVNode)('div',rt,[(0,n.createCommentVNode)(' å¤´éƒ¨ '),(0,n.createElementVNode)('div',st,[f[25]||(f[25]=(0,n.createElementVNode)('h2',{class:'text-foreground text-lg font-semibold'},'è®¾ç½®',-1)),(0,n.createElementVNode)('button',{class:'hover:bg-muted rounded-full p-1 transition-colors','aria-label':'å…³é—­è®¾ç½®',onClick:f[0]||(f[0]=(...t)=>e.onClose&&e.onClose(...t))},[...f[24]||(f[24]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),(0,n.createCommentVNode)(' å†…å®¹ '),(0,n.createElementVNode)('div',it,[(0,n.createElementVNode)('div',ct,[(0,n.createCommentVNode)(' ç”¨æˆ·ç§°å‘¼è®¾ç½® '),(0,n.createElementVNode)('div',dt,[f[27]||(f[27]=(0,n.createElementVNode)('h3',{class:'text-foreground text-sm font-medium'},'ç”¨æˆ·ç§°å‘¼',-1)),(0,n.createElementVNode)('div',ut,[(0,n.createElementVNode)('div',mt,[f[26]||(f[26]=(0,n.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'ä½ æƒ³è®©æˆ‘ç§°å‘¼ä½ ä¸ºâ€¦â€¦ï¼Ÿ',-1)),(0,n.createElementVNode)('input',{type:'text',value:e.userDisplayName,placeholder:'è¯·è¾“å…¥ä½ çš„ç§°å‘¼',class:'border-border bg-background text-foreground w-full rounded-lg border px-3 py-2 text-sm placeholder:text-muted-foreground focus:border-primary focus:ring-primary focus:ring-1 focus:outline-none',onInput:f[1]||(f[1]=e=>{return o=e.target.value,void t.onUserDisplayNameChange(o);var o})},null,40,pt)])])]),(0,n.createCommentVNode)(' ç«‹ç»˜è®¾ç½®ï¼ˆé™æ€å›¾ç‰‡ï¼‰ '),(0,n.createElementVNode)('div',vt,[f[28]||(f[28]=(0,n.createElementVNode)('h3',{class:'text-foreground text-sm font-medium'},'ç«‹ç»˜è®¾ç½®',-1)),f[29]||(f[29]=(0,n.createElementVNode)('p',{class:'text-muted-foreground text-xs'},'è°ƒæ•´é™æ€ç«‹ç»˜å›¾ç‰‡çš„æ˜¾ç¤ºæ•ˆæœ',-1)),(0,n.createElementVNode)('div',ht,[(0,n.createElementVNode)('div',ft,[(0,n.createElementVNode)('label',gt,'å¤§å° ('+(0,n.toDisplayString)(Math.round(100*e.spriteSettings.scale))+'%)',1),(0,n.createElementVNode)('input',{type:'range',value:e.spriteSettings.scale,min:'0.5',max:'1.5',step:'0.05',class:'w-full',onInput:f[2]||(f[2]=t=>u({...e.spriteSettings,scale:parseFloat(t.target.value)}))},null,40,yt)]),(0,n.createElementVNode)('div',xt,[(0,n.createElementVNode)('label',bt,'æ°´å¹³ä½ç½® ('+(0,n.toDisplayString)(e.spriteSettings.positionX)+'%)',1),(0,n.createElementVNode)('input',{type:'range',value:e.spriteSettings.positionX,min:'0',max:'100',step:'1',class:'w-full',onInput:f[3]||(f[3]=t=>u({...e.spriteSettings,positionX:parseInt(t.target.value)}))},null,40,kt)]),(0,n.createElementVNode)('div',wt,[(0,n.createElementVNode)('label',Ct,'å‚ç›´ä½ç½® ('+(0,n.toDisplayString)(e.spriteSettings.positionY)+'%)',1),(0,n.createElementVNode)('input',{type:'range',value:e.spriteSettings.positionY,min:'0',max:'200',step:'1',class:'w-full',onInput:f[4]||(f[4]=t=>u({...e.spriteSettings,positionY:parseInt(t.target.value)}))},null,40,Nt)])])]),(0,n.createCommentVNode)(' Live2D æ¨¡å‹è®¾ç½® '),(0,n.createElementVNode)('div',Vt,[f[30]||(f[30]=(0,n.createElementVNode)('h3',{class:'text-foreground text-sm font-medium'},'Live2D æ¨¡å‹è®¾ç½®',-1)),f[31]||(f[31]=(0,n.createElementVNode)('p',{class:'text-muted-foreground text-xs'},'è°ƒæ•´ Live2D åŠ¨æ€æ¨¡å‹çš„æ˜¾ç¤ºæ•ˆæœ',-1)),(0,n.createElementVNode)('div',Et,[(0,n.createElementVNode)('div',St,[(0,n.createElementVNode)('label',Mt,'å¤§å° ('+(0,n.toDisplayString)(Math.round(100*e.live2dSettings.scale))+'%)',1),(0,n.createElementVNode)('input',{type:'range',value:e.live2dSettings.scale,min:'0',max:'2',step:'0.05',class:'w-full',onInput:f[5]||(f[5]=t=>m({...e.live2dSettings,scale:parseFloat(t.target.value)}))},null,40,Bt)]),(0,n.createElementVNode)('div',It,[(0,n.createElementVNode)('label',$t,'æ°´å¹³ä½ç½® ('+(0,n.toDisplayString)(e.live2dSettings.positionX)+'%)',1),(0,n.createElementVNode)('input',{type:'range',value:e.live2dSettings.positionX,min:'0',max:'100',step:'1',class:'w-full',onInput:f[6]||(f[6]=t=>m({...e.live2dSettings,positionX:parseInt(t.target.value)}))},null,40,Lt)]),(0,n.createElementVNode)('div',_t,[(0,n.createElementVNode)('label',Dt,'å‚ç›´ä½ç½® ('+(0,n.toDisplayString)(e.live2dSettings.positionY)+'%)',1),(0,n.createElementVNode)('input',{type:'range',value:e.live2dSettings.positionY,min:'0',max:'150',step:'1',class:'w-full',onInput:f[7]||(f[7]=t=>m({...e.live2dSettings,positionY:parseInt(t.target.value)}))},null,40,Pt)])])]),(0,n.createCommentVNode)(' æ’­æ”¾è®¾ç½® '),(0,n.createElementVNode)('div',zt,[f[34]||(f[34]=(0,n.createElementVNode)('h3',{class:'text-foreground text-sm font-medium'},'æ’­æ”¾è®¾ç½®',-1)),(0,n.createElementVNode)('div',Rt,[f[33]||(f[33]=(0,n.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'è‡ªåŠ¨æ’­æ”¾',-1)),(0,n.createElementVNode)('label',Tt,[(0,n.createElementVNode)('input',{type:'checkbox',checked:e.autoPlay,class:'peer sr-only',onChange:f[8]||(f[8]=t=>e.onAutoPlayChange(t.target.checked))},null,40,Ut),f[32]||(f[32]=(0,n.createElementVNode)('div',{class:'bg-input peer relative h-[1.15rem] w-8 rounded-full transition-colors peer-checked:bg-primary'},[(0,n.createElementVNode)('div',{class:'bg-background absolute top-0 left-0 h-4 w-4 rounded-full transition-transform peer-checked:translate-x-[calc(100%-2px)]'})],-1))])]),e.autoPlay?((0,n.openBlock)(),(0,n.createElementBlock)('div',jt,[(0,n.createElementVNode)('label',Ft,'æ’­æ”¾é€Ÿåº¦ ('+(0,n.toDisplayString)(e.autoPlaySpeed/1e3)+'ç§’)',1),(0,n.createElementVNode)('input',{type:'range',value:e.autoPlaySpeed,min:'1000',max:'8000',step:'500',class:'w-full',onInput:f[9]||(f[9]=t=>e.onAutoPlaySpeedChange(parseInt(t.target.value)))},null,40,Wt)])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createCommentVNode)(' è‡ªå®šä¹‰å¯¹è¯æ¡† '),(0,n.createElementVNode)('div',Ot,[(0,n.createElementVNode)('div',At,[f[36]||(f[36]=(0,n.createElementVNode)('h3',{class:'text-foreground text-sm font-medium'},'è‡ªå®šä¹‰å¯¹è¯æ¡†',-1)),(0,n.createElementVNode)('label',Ht,[(0,n.createElementVNode)('input',{type:'checkbox',checked:e.customModeEnabled,class:'peer sr-only',onChange:f[10]||(f[10]=e=>{return o=e.target.checked,t.onCustomModeChange(o),void(o&&t.onDialogStyleChange(t.currentAppliedStyle));var o})},null,40,Gt),f[35]||(f[35]=(0,n.createElementVNode)('div',{class:'bg-input peer relative h-[1.15rem] w-8 rounded-full transition-colors peer-checked:bg-primary'},[(0,n.createElementVNode)('div',{class:'bg-background absolute top-0 left-0 h-4 w-4 rounded-full transition-transform peer-checked:translate-x-[calc(100%-2px)]'})],-1))])]),e.customModeEnabled?((0,n.openBlock)(),(0,n.createElementBlock)('div',qt,[(0,n.createCommentVNode)(' å®æ—¶é¢„è§ˆä¸ä¿å­˜æŒ‰é’® '),(0,n.createElementVNode)('div',Xt,[(0,n.createElementVNode)('div',Yt,[f[39]||(f[39]=(0,n.createElementVNode)('span',{class:'text-muted-foreground text-xs'},'å®æ—¶é¢„è§ˆ',-1)),(0,n.createElementVNode)('button',{disabled:!d.value,class:(0,n.normalizeClass)(['flex h-7 items-center gap-1 rounded-md border px-3 text-xs transition-colors',d.value?'bg-primary text-primary-foreground border-primary hover:bg-primary/90':'bg-background cursor-not-allowed border-gray-200 opacity-50']),onClick:f[11]||(f[11]=(...t)=>e.onSaveStyle&&e.onSaveStyle(...t))},[d.value?((0,n.openBlock)(),(0,n.createElementBlock)('svg',Kt,[...f[37]||(f[37]=[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12'},null,-1)])])):((0,n.openBlock)(),(0,n.createElementBlock)('svg',Qt,[...f[38]||(f[38]=[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M5 13l4 4L19 7'},null,-1)])])),(0,n.createTextVNode)(' '+(0,n.toDisplayString)(d.value?'ä¿å­˜åº”ç”¨':'å·²ä¿å­˜'),1)],10,Jt)]),(0,n.createElementVNode)('div',Zt,[(0,n.createVNode)(at,{style:(0,n.normalizeStyle)(e.dialogStyle)},null,8,['style'])])]),(0,n.createCommentVNode)(' æ ‡ç­¾é¡µ '),(0,n.createElementVNode)('div',eo,[(0,n.createElementVNode)('div',to,[(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all','shapes'===o.value?'bg-background text-foreground border-input shadow-sm':'text-muted-foreground hover:text-foreground']),onClick:f[12]||(f[12]=e=>o.value='shapes')},' å½¢çŠ¶é¢„è®¾ ',2),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all','colors'===o.value?'bg-background text-foreground border-input shadow-sm':'text-muted-foreground hover:text-foreground']),onClick:f[13]||(f[13]=e=>o.value='colors')},' é¢œè‰²è°ƒæ•´ ',2)]),(0,n.createCommentVNode)(' å½¢çŠ¶é¢„è®¾æ ‡ç­¾é¡µ '),'shapes'===o.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',oo,[(0,n.createCommentVNode)(' æ–‡æœ¬æ¡†å½¢çŠ¶ '),(0,n.createElementVNode)('div',no,[f[40]||(f[40]=(0,n.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'æ–‡æœ¬æ¡†å½¢çŠ¶',-1)),(0,n.createElementVNode)('div',ao,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)((0,n.unref)(l),t=>((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:t.id,class:(0,n.normalizeClass)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.boxShape===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>p('boxShape',t.id)},(0,n.toDisplayString)(t.name),11,lo))),128))])]),(0,n.createCommentVNode)(' èƒŒæ™¯å›¾æ¡ˆ '),(0,n.createElementVNode)('div',ro,[f[41]||(f[41]=(0,n.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'èƒŒæ™¯å›¾æ¡ˆ',-1)),(0,n.createElementVNode)('div',so,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)((0,n.unref)(a),t=>((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:t.id,class:(0,n.normalizeClass)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.backgroundPattern===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>p('backgroundPattern',t.id)},(0,n.toDisplayString)(t.name),11,io))),128))])]),(0,n.createCommentVNode)(' è¾¹æ¡†ç²—ç»† '),(0,n.createElementVNode)('div',co,[f[42]||(f[42]=(0,n.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'è¾¹æ¡†ç²—ç»†',-1)),(0,n.createElementVNode)('div',uo,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)((0,n.unref)(r),t=>((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:t.id,class:(0,n.normalizeClass)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.borderWidth===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>p('borderWidth',t.id)},(0,n.toDisplayString)(t.name),11,mo))),128))])]),(0,n.createCommentVNode)(' è§’è‰²åå½¢çŠ¶ '),(0,n.createElementVNode)('div',po,[f[43]||(f[43]=(0,n.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'è§’è‰²åå½¢çŠ¶',-1)),(0,n.createElementVNode)('div',vo,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)((0,n.unref)(s),t=>((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:t.id,class:(0,n.normalizeClass)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.nameShape===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>p('nameShape',t.id)},(0,n.toDisplayString)(t.name),11,ho))),128))])]),(0,n.createCommentVNode)(' ç®­å¤´æŒ‰é’®å½¢çŠ¶ '),(0,n.createElementVNode)('div',fo,[f[44]||(f[44]=(0,n.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'ç®­å¤´æŒ‰é’®å½¢çŠ¶',-1)),(0,n.createElementVNode)('div',go,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)((0,n.unref)(i),t=>((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:t.id,class:(0,n.normalizeClass)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.arrowShape===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>p('arrowShape',t.id)},(0,n.toDisplayString)(t.name),11,yo))),128))])]),(0,n.createCommentVNode)(' å‘¼å¸æŒ‡ç¤ºå™¨å½¢çŠ¶ '),(0,n.createElementVNode)('div',xo,[f[45]||(f[45]=(0,n.createElementVNode)('label',{class:'text-muted-foreground text-xs'},'å‘¼å¸æŒ‡ç¤ºå™¨',-1)),(0,n.createElementVNode)('div',bo,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)((0,n.unref)(c),t=>((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:t.id,class:(0,n.normalizeClass)(['rounded-lg border p-2 text-[10px] transition-all',e.dialogStyle.indicatorShape===t.id?'border-primary bg-primary/10 text-primary':'border-border hover:border-primary/50']),onClick:e=>p('indicatorShape',t.id)},(0,n.toDisplayString)(t.name),11,ko))),128))])]),(0,n.createCommentVNode)(' å­—ä½“å¤§å° '),(0,n.createElementVNode)('div',wo,[(0,n.createElementVNode)('label',Co,'å­—ä½“å¤§å° ('+(0,n.toDisplayString)(e.dialogStyle.fontSize)+'px)',1),(0,n.createElementVNode)('input',{type:'range',value:e.dialogStyle.fontSize,min:'12',max:'24',step:'1',class:'w-full',onInput:f[14]||(f[14]=t=>e.onDialogStyleChange({...e.dialogStyle,fontSize:parseInt(t.target.value)}))},null,40,No)])])):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' é¢œè‰²è°ƒæ•´æ ‡ç­¾é¡µ '),'colors'===o.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',Vo,[(0,n.createVNode)(Ke,{label:'æ–‡æœ¬æ¡†èƒŒæ™¯',value:e.dialogStyle.colors.boxBackground,'onUpdate:value':f[15]||(f[15]=e=>v('boxBackground',e))},null,8,['value']),(0,n.createVNode)(Ke,{label:'æ–‡æœ¬æ¡†è¾¹æ¡†',value:e.dialogStyle.colors.boxBorder,'onUpdate:value':f[16]||(f[16]=e=>v('boxBorder',e))},null,8,['value']),(0,n.createVNode)(Ke,{label:'è§’è‰²åèƒŒæ™¯',value:e.dialogStyle.colors.nameBackground,'onUpdate:value':f[17]||(f[17]=e=>v('nameBackground',e))},null,8,['value']),(0,n.createVNode)(Ke,{label:'è§’è‰²åæ–‡å­—',value:e.dialogStyle.colors.nameText,'show-alpha':!1,'onUpdate:value':f[18]||(f[18]=e=>v('nameText',e))},null,8,['value']),(0,n.createVNode)(Ke,{label:'å¯¹è¯æ–‡å­—',value:e.dialogStyle.colors.dialogText,'show-alpha':!1,'onUpdate:value':f[19]||(f[19]=e=>v('dialogText',e))},null,8,['value']),(0,n.createVNode)(Ke,{label:'æ—ç™½æ–‡å­—',value:e.dialogStyle.colors.narrationText,'show-alpha':!1,'onUpdate:value':f[20]||(f[20]=e=>v('narrationText',e))},null,8,['value']),(0,n.createVNode)(Ke,{label:'ç®­å¤´èƒŒæ™¯',value:e.dialogStyle.colors.arrowBackground,'onUpdate:value':f[21]||(f[21]=e=>v('arrowBackground',e))},null,8,['value']),(0,n.createVNode)(Ke,{label:'ç®­å¤´å›¾æ ‡',value:e.dialogStyle.colors.arrowIcon,'show-alpha':!1,'onUpdate:value':f[22]||(f[22]=e=>v('arrowIcon',e))},null,8,['value']),(0,n.createVNode)(Ke,{label:'æŒ‡ç¤ºå™¨é¢œè‰²',value:e.dialogStyle.colors.indicatorColor,'onUpdate:value':f[23]||(f[23]=e=>v('indicatorColor',e))},null,8,['value'])])):(0,n.createCommentVNode)('v-if',!0)])])):(0,n.createCommentVNode)('v-if',!0)])])])])]))}}),So=(0,B.A)(Eo,[['__scopeId','data-v-783ad584']]),Mo={class:'absolute top-4 left-4 z-50 flex flex-col items-start gap-2'},Bo={key:0,class:'animate-in fade-in slide-in-from-left-2 text-sm duration-200'},Io={class:'absolute top-4 right-4 z-50 flex flex-col items-end gap-2'},$o={key:0,class:'animate-in fade-in slide-in-from-left-2 text-sm duration-200'},Lo=['aria-label'],_o={key:0,class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},Do={key:1,class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},Po={class:'text-sm'},zo={class:'animate-in fade-in px-8 text-center text-xl leading-relaxed text-white duration-1000 md:text-2xl'},Ro={key:3,class:'absolute z-40',style:{right:'20%',top:'20%',maxWidth:'280px'}},To={class:'bg-card/95 text-foreground relative max-h-[85vh] w-[90%] max-w-3xl rounded-2xl shadow-2xl backdrop-blur-md'},Uo={class:'border-border/30 flex items-center justify-between border-b px-6 py-3'},jo={class:'history-scroll-container max-h-[calc(85vh-100px)] overflow-y-auto px-6 py-2'},Fo={key:0,class:'text-muted-foreground py-12 text-center text-sm'},Wo=['onClick'],Oo={class:'font-medium'},Ao=['innerHTML'],Ho={key:4,class:'bg-border/30 absolute right-3 bottom-0 left-3 h-px opacity-0 transition-opacity group-hover:opacity-100'},Go={class:'flex items-center gap-3'},qo=(0,n.defineComponent)({__name:'GalgamePlayer',setup(e){const t='galgame_dialog_style',a='galgame_sprite_settings',l='galgame_live2d_settings',r=(0,n.ref)(null),s=(0,n.ref)(null),i=(0,n.shallowRef)([]),c=(0,n.ref)(0),u=(0,n.computed)(()=>i.value[c.value]||null),m=(0,n.ref)(!1),p=(0,n.computed)(()=>{if(!u.value)return;const e=i.value.find(e=>e.noteUnitId===u.value?.unitId&&e.noteContent);return e?.noteContent}),v=(0,n.computed)(()=>{if(!u.value)return;const e=i.value.find(e=>e.noteUnitId===u.value?.unitId&&e.noteContent);return e?.noteUnitId}),f=(0,n.computed)(()=>{if(!u.value)return;const e=i.value.find(e=>e.noteUnitId===u.value?.unitId&&e.noteContent);return e?.notePosition});function g(e,t){const o=i.value.find(t=>t.noteUnitId===e&&t.noteContent);if(o){o.notePosition=t;const n=`note_position_${e}`;localStorage.setItem(n,JSON.stringify(t))}}const y=(0,n.ref)(!1),x=(0,n.ref)(!1),k=(0,n.ref)(!1),N=(0,n.ref)(3e3),V=(0,n.ref)(!1),E=(0,n.ref)(!1),S=(0,n.ref)(!1),M=(0,n.ref)(!1),B=(0,n.ref)(!1),L=(0,n.ref)(''),D=(0,n.ref)(!1),P=(0,n.ref)(!1),R=(0,n.ref)(!1),T=(0,n.ref)(''),U=(0,n.ref)(null),j=(0,n.ref)(null),F=(0,n.ref)(!1),W=(0,n.ref)(''),O=(0,n.ref)(null),A=(0,n.ref)(K(a,{scale:1.15,positionX:24,positionY:120})),H=(0,n.ref)(K(l,{scale:1.15,positionX:24,positionY:120})),G=(0,n.ref)(K(t,d)),q=(0,n.ref)({...G.value}),X=(0,n.shallowRef)([]),J=(0,n.shallowRef)(new Map);function K(e,t){try{const t=localStorage.getItem(e);if(t)return JSON.parse(t)}catch(t){console.warn(`ä» localStorage åŠ è½½ ${e} å¤±è´¥:`,t)}return t}function Z(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(t){console.warn(`ä¿å­˜åˆ° localStorage ${e} å¤±è´¥:`,t)}}(0,n.watch)(G,e=>{Z(t,e)},{deep:!0}),(0,n.watch)(A,e=>{Z(a,e)},{deep:!0}),(0,n.watch)(H,e=>{Z(l,e)},{deep:!0});const ee=(0,n.computed)(()=>{const e=window.innerHeight>window.innerWidth,t=!!document.fullscreenElement,o=16/9;if(e&&t){const e=window.innerHeight;return{width:`${e}px`,aspectRatio:'16 / 9',transform:'rotate(90deg)',transformOrigin:'center center',position:'absolute',left:'50%',top:'50%',marginLeft:`-${e/2}px`,marginTop:`-${e/o/2}px`,background:'transparent'}}return{width:'100%',aspectRatio:'16 / 9',margin:'0 auto',background:'transparent'}}),te=(0,n.computed)(()=>{const e=u.value;return e?.sceneImageUrl?e.sceneImageUrl:e?.scene&&(e.scene.match(/^https?:\/\//)||e.scene.match(/^\//))?e.scene:null}),oe=(0,n.computed)(()=>{const e=u.value;if(e?.sprite?.type)return console.info('[GalgamePlayer] currentSpriteType: ä» dialogue.sprite.type è·å–',e.sprite.type),e.sprite.type;if(e?.isCG||'cg'===e?.type)return console.info('[GalgamePlayer] currentSpriteType: CGæ¨¡å¼ï¼Œè¿”å› none'),'none';if(e?.character){const t=X.value.some(t=>t.name===e.character),o=!!e.sprite?.imageUrl;return console.info('[GalgamePlayer] currentSpriteType: è‡ªåŠ¨åˆ¤æ–­',{character:e.character,hasLive2d:t,hasImage:o,availableModels:X.value.map(e=>({id:e.id,name:e.name}))}),t?'live2d':o?'image':'none'}return console.info('[GalgamePlayer] currentSpriteType: æ— è§’è‰²åï¼Œè¿”å› none'),'none'}),ne=(0,n.computed)(()=>{const e=u.value;return e?.sprite?.imageUrl||'/placeholder-user.jpg'}),ae=(0,n.computed)(()=>{const e=u.value;if(e?.sprite?.live2dModelId)return console.info('[GalgamePlayer] currentLive2dModelId: ä» dialogue.sprite.live2dModelId è·å–',e.sprite.live2dModelId),e.sprite.live2dModelId;if(e?.character){const t=X.value.find(t=>t.name===e.character);return console.info('[GalgamePlayer] currentLive2dModelId: è‡ªåŠ¨åŒ¹é…è§’è‰²å',{character:e.character,foundModel:t?{id:t.id,name:t.name}:null,availableModels:X.value.map(e=>({id:e.id,name:e.name}))}),t?.id}console.info('[GalgamePlayer] currentLive2dModelId: æœªæ‰¾åˆ°æ¨¡å‹ID')}),le=(0,n.ref)(new Map);async function re(){try{const e=getChatMessages('0-{{lastMessageId}}'),t=[];let n,a,l,r,s,d,u;if(X.value.length>0){console.info(`[å¯¹è¯åŠ è½½] å¼€å§‹é¢„åŠ è½½ ${X.value.length} ä¸ª Live2D æ¨¡å‹`);const{live2dModelManager:e}=await Promise.resolve().then(o.bind(o,521));e.preloadModels(X.value).catch(e=>{console.warn('[å¯¹è¯åŠ è½½] Live2D æ¨¡å‹é¢„åŠ è½½å¤±è´¥:',e)})}const p=e=>{!e.scene&&n&&(e.scene=n),!e.sceneImageUrl&&a&&(!e.scene||n&&e.scene===n)&&(e.sceneImageUrl=a)},v=e=>{'blackscreen'!==e.type&&void 0===e.isCG&&d&&(e.isCG=d,u&&(e.cgImageUrl=u))},h=e=>{'blackscreen'!==e.type&&(l&&(e.sprite={...l}),!e.motion&&r&&(e.motion=r),!e.expression&&s&&(e.expression=s))},f=e=>{'blackscreen'!==e.type&&(e.scene&&(n=e.scene),e.sceneImageUrl&&(a=e.sceneImageUrl))},g=e=>{!1===e.isCG?(l=e.sprite?{...e.sprite}:void 0,r=e.motion,s=e.expression,d=!1,u=void 0):!0===e.isCG?(l=void 0,r=void 0,s=void 0,d=!0,u=e.cgImageUrl):(l=e.sprite?{...e.sprite}:void 0,r=e.motion,s=e.expression,void 0!==e.isCG&&(d=e.isCG,u=e.cgImageUrl))};for(const o of e){const e=o.message||'',a=await w(e,n);if(0===a.length)continue;const l=b(e);let r=0,s=0;for(;s<a.length;){const e=a[s];if('choice'===e.type){const n=[e];let i=s+1;for(;i<a.length&&'choice'===a[i].type;)n.push(a[i]),i++;const c=n.some(e=>'format1'===e.choiceFormat),d=n.some(e=>'format2'===e.choiceFormat);if(c){const e=[];for(const t of n)t.options&&e.push(...t.options);if(e.length>0){const n={unitId:`msg_${o.message_id}_unit_${r}`,unitIndex:r++,character:'',text:'',type:'choice',message_id:o.message_id,role:'system',choiceFormat:'format1',options:e,statusBlock:l};p(n),h(n),v(n),t.push(n),f(n)}}else if(d){const e=[];for(const t of n)t.choices&&e.push(...t.choices);if(e.length>0){const n={unitId:`msg_${o.message_id}_unit_${r}`,unitIndex:r++,character:'',text:'',type:'choice',message_id:o.message_id,role:'system',choiceFormat:'format2',options:e.map((e,t)=>({id:`choice_${t}`,text:e})),statusBlock:l};p(n),h(n),v(n),t.push(n),f(n)}}s=i;continue}if('character'===e.type){const n=e.motion||e.motionFile,a=e.expression||e.expressionFile,s=C(e.character||'',n,a,X.value),i=X.value.find(t=>t.name===e.character),c=!!e.spriteImageUrl||!!o.extra?.sprite_image;console.info('[å¯¹è¯åˆ›å»º] èµ„æºæ£€æŸ¥:',{character:e.character,hasLive2dModel:!!i,hasMotionExpr:s,hasSpriteImage:c,spriteImageUrl:e.spriteImageUrl,blockIsCG:e.isCG});const d=!0===e.isCG;console.info('[å¯¹è¯åˆ›å»º] CGæ¨¡å¼åˆ¤æ–­:',{isCGMode:d,reason:!0===e.isCG?'æ˜ç¡®æŒ‡å®šCGåœºæ™¯æ ¼å¼ï¼Œè¿›å…¥CGæ¨¡å¼':!1===e.isCG?'æ™®é€šæ¨¡å¼ï¼Œä½¿ç”¨ç«‹ç»˜æˆ–æ¨¡å‹':'æœªè®¾ç½®isCGï¼Œä½¿ç”¨é»˜è®¤é€»è¾‘'});const u={unitId:`msg_${o.message_id}_unit_${r}`,unitIndex:r++,character:e.character,text:e.text||'',message_id:o.message_id,role:'assistant',type:d?'cg':void 0,scene:e.scene,sceneImageUrl:e.sceneImageUrl,motion:n,expression:a,isCG:d,cgImageUrl:d?e.cgImageUrl||e.scene:void 0,statusBlock:l,sprite:d?{type:'none'}:(()=>{const t=e.spriteImageUrl||o.extra?.sprite_image||void 0;return i?(console.info('[å¯¹è¯åˆ›å»º] ä½¿ç”¨ Live2D æ¨¡å‹:',e.character,'modelId:',i.id),{type:'live2d',live2dModelId:i.id,imageUrl:void 0}):t?(console.info('[å¯¹è¯åˆ›å»º] ä½¿ç”¨ç«‹ç»˜å›¾ç‰‡:',e.character,'imageUrl:',t),{type:'image',live2dModelId:void 0,imageUrl:t}):(console.info('[å¯¹è¯åˆ›å»º] æ— ç«‹ç»˜èµ„æº:',e.character,'ä¸æ˜¾ç¤ºç«‹ç»˜'),{type:'none',live2dModelId:void 0,imageUrl:void 0})})()};p(u),t.push(u),f(u),g(u)}else if('narration'===e.type){const n={unitId:`msg_${o.message_id}_unit_${r}`,unitIndex:r++,character:'',text:e.message||'',type:'narration',message_id:o.message_id,role:'system',scene:e.scene,sceneImageUrl:e.sceneImageUrl,statusBlock:l};p(n),h(n),v(n),t.push(n),f(n)}else if('blacktext'===e.type){const n={unitId:`msg_${o.message_id}_unit_${r}`,unitIndex:r++,character:'',text:e.message||'',type:'blackscreen',message_id:o.message_id,role:'system',statusBlock:l};d=void 0,u=void 0,t.push(n)}else if('user'===e.type){const n={unitId:`msg_${o.message_id}_unit_${r}`,unitIndex:r++,character:'ä½ ',text:e.message||'',type:'user',message_id:o.message_id,role:'user',scene:e.scene,sceneImageUrl:e.sceneImageUrl,isEditable:!0,statusBlock:l};p(n),h(n),v(n);const a=le.value.get(o.message_id);a&&(a.deleted?n.isDeleted=!0:void 0!==a.text&&(n.editedText=a.text,n.text=a.text)),t.push(n),f(n)}else if('note'===e.type){let n;for(let e=t.length-1;e>=0;e--){const o=t[e];if('choice'!==o.type&&!o.noteContent){n=o.unitId;break}}if(n){const o=t.find(e=>e.unitId===n);o&&(o.noteContent=e.noteContent,o.noteUnitId=n,e.noteUnitId&&(o.noteUnitId=e.noteUnitId))}else{const n={unitId:`msg_${o.message_id}_unit_${r}`,unitIndex:r++,character:'',text:'',type:'narration',message_id:o.message_id,role:'system',noteContent:e.noteContent,noteUnitId:e.noteUnitId,statusBlock:l};p(n),t.push(n)}}s++}}const y=t.filter(e=>!e.isDeleted),x=i.value.length;i.value=y,m.value?m.value=!1:0===x&&y.length>0?c.value=0:c.value>=y.length&&(c.value=Math.max(0,y.length-1)),console.info(`åŠ è½½äº† ${i.value.length} æ¡å¯¹è¯`),0===i.value.length&&se()}catch(e){console.error('åŠ è½½å¯¹è¯æ•°æ®å¤±è´¥:',e),se()}}function se(){console.info('ä½¿ç”¨æµ‹è¯•å¯¹è¯æ•°æ®');let e=0;const t=t=>({unitId:`test_unit_${e}`,unitIndex:e++,message_id:0,role:'assistant',character:'',text:'',...t});i.value=[t({character:'å°é›ª',text:'ä½ å¥½å•Šï¼Œæ¬¢è¿æ¥åˆ°è¿™ä¸ª Galgame é£æ ¼çš„å¯¹è¯ç•Œé¢ï¼',type:void 0,scene:'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=1920&h=1080&fit=crop',sprite:{type:'image',imageUrl:'/placeholder-user.jpg'}}),t({character:'å°é›ª',text:'è¿™æ˜¯ä¸€ä¸ªæ”¯æŒå¤šç§æ¼”å‡ºæ•ˆæœçš„ç•Œé¢ï¼ŒåŒ…æ‹¬è§’è‰²å¯¹è¯ã€æ—ç™½ã€é»‘å±è½¬åœºå’Œé€‰é¡¹é€‰æ‹©ã€‚',isThrough:!1}),t({character:'',text:'è¿™æ˜¯ä¸€æ®µæ—ç™½æ–‡å­—ï¼Œç”¨äºæè¿°åœºæ™¯æˆ–è¡¥å……è¯´æ˜ã€‚æ—ç™½ä¼šä»¥æ–œä½“å±…ä¸­æ˜¾ç¤ºã€‚',type:'narration'}),t({character:'å°é›ª',text:'*through* è¿™æ˜¯ä¸€æ®µå†…å¿ƒç‹¬ç™½ï¼Œä½¿ç”¨äº† through æ ¼å¼ï¼Œä¼šä»¥æµ…ç°è‰²æ–œä½“æ˜¾ç¤ºã€‚',isThrough:!0}),t({character:'',text:'æ—¶é—´æ‚„ç„¶æµé€...',type:'blackscreen'}),t({character:'å°é›ª',text:'ä½ å¯ä»¥é€šè¿‡ç‚¹å‡»å³ä¸Šè§’çš„é½¿è½®å›¾æ ‡æ‰“å¼€è®¾ç½®é¢æ¿ï¼Œè‡ªå®šä¹‰å¯¹è¯æ¡†çš„æ ·å¼å’Œé¢œè‰²ã€‚'}),t({character:'å°é›ª',text:'ç°åœ¨ï¼Œè¯·é€‰æ‹©ä½ æƒ³è¦åšçš„äº‹æƒ…ï¼š'}),t({character:'',text:'',type:'choice',options:[{id:'opt1',text:'æŸ¥çœ‹è®¾ç½®é€‰é¡¹'},{id:'opt2',text:'ç»§ç»­å¯¹è¯'},{id:'opt3',text:'äº†è§£æ›´å¤šåŠŸèƒ½'}]}),t({character:'å°é›ª',text:'æ„Ÿè°¢ä½ çš„é€‰æ‹©ï¼è¿™ä¸ªç•Œé¢è¿˜æ”¯æŒ Live2D æ¨¡å‹æ˜¾ç¤ºï¼Œä¸è¿‡éœ€è¦å…ˆåœ¨è§’è‰²å¡å˜é‡ä¸­é…ç½®æ¨¡å‹ã€‚'}),t({character:'å°é›ª',text:'ä½ è¿˜å¯ä»¥ç‚¹å‡»å·¦ä¸Šè§’çš„è§’è‰²æŒ‰é’®ï¼ŒæŸ¥çœ‹è§’è‰²çŠ¶æ€æ å’Œå°å‰§åœºã€‚'}),t({character:'',text:'--- ä»¥ä¸‹æ˜¯ Live2D æ¨¡å‹å’Œç«‹ç»˜æµ‹è¯• ---',type:'narration'}),t({character:'',text:'æµ‹è¯• 1ï¼šç¨‹åŒ—æ Live2D æ¨¡å‹ - æ­£å¸¸åŠ¨ä½œ + å¾®ç¬‘è¡¨æƒ…',type:'narration',scene:'ç¨‹åŒ—ææˆ¿é—´ç™½å¤©'}),t({character:'ç¨‹åŒ—æ',text:'ä½ å¥½ï¼Œæˆ‘æ˜¯ç¨‹åŒ—æã€‚è¿™æ˜¯ Live2D æ¨¡å‹çš„æµ‹è¯•ï¼Œä½¿ç”¨äº†"æ­£å¸¸åŠ¨ä½œ"å’Œ"å¾®ç¬‘"è¡¨æƒ…ã€‚',type:void 0,scene:'ç¨‹åŒ—ææˆ¿é—´ç™½å¤©',motion:'æ­£å¸¸åŠ¨ä½œ',expression:'å¾®ç¬‘',sprite:{type:'live2d',live2dModelId:'ç¨‹åŒ—æ'}}),t({character:'',text:'æµ‹è¯• 2ï¼šç¨‹åŒ—æ Live2D æ¨¡å‹ - æŠ±è‡‚åŠ¨ä½œ + ä¸¥è‚ƒè¡¨æƒ…',type:'narration',scene:'æ“åœº'}),t({character:'ç¨‹åŒ—æ',text:'è¿™æ˜¯å¦ä¸€ä¸ªæµ‹è¯•ï¼Œä½¿ç”¨äº†"æŠ±è‡‚"åŠ¨ä½œå’Œ"ä¸¥è‚ƒ"è¡¨æƒ…ã€‚',type:void 0,scene:'æ“åœº',motion:'æŠ±è‡‚',expression:'ä¸¥è‚ƒ',sprite:{type:'live2d',live2dModelId:'ç¨‹åŒ—æ'}}),t({character:'',text:'æµ‹è¯• 3ï¼šç¨‹åŒ—æ Live2D æ¨¡å‹ - å¹æ°”åŠ¨ä½œ + å›°æƒ‘è¡¨æƒ…',type:'narration',scene:'æˆ¿é—´ç™½å¤©'}),t({character:'ç¨‹åŒ—æ',text:'è¿™æ˜¯"å¹æ°”"åŠ¨ä½œå’Œ"å›°æƒ‘"è¡¨æƒ…çš„æµ‹è¯•ã€‚',type:void 0,scene:'æˆ¿é—´ç™½å¤©',motion:'å¹æ°”',expression:'å›°æƒ‘',sprite:{type:'live2d',live2dModelId:'ç¨‹åŒ—æ'}}),t({character:'',text:'æµ‹è¯• 4ï¼šå¥³åŒå­¦ç«‹ç»˜ï¼ˆæ²¡æœ‰ Live2D æ¨¡å‹ï¼Œä½¿ç”¨ç«‹ç»˜èµ„æºï¼‰',type:'narration',scene:'æ“åœº'}),t({character:'å¥³åŒå­¦',text:'å‘€ï¼Ÿç¨‹åŒ—æä½ åœ¨ç­‰äººå—ï¼Ÿè¿™æ˜¯ç«‹ç»˜èµ„æºçš„æµ‹è¯•ï¼Œæˆ‘æ²¡æœ‰ Live2D æ¨¡å‹ï¼Œæ‰€ä»¥ä¼šæ˜¾ç¤ºç«‹ç»˜å›¾ç‰‡ã€‚',type:void 0,scene:'æ“åœº',sprite:{type:'image',imageUrl:'https://iili.io/f01ajiN.png'}}),t({character:'',text:'æµ‹è¯• 5ï¼šç¨‹åŒ—æå›å¤ - æ­£å¸¸åŠ¨ä½œ + æ­£å¸¸è¡¨æƒ…',type:'narration'}),t({character:'ç¨‹åŒ—æ',text:'å—¯ï¼Œåœ¨ç­‰äººã€‚è¿™æ˜¯å›å¤æµ‹è¯•ï¼Œä½¿ç”¨äº†"æ­£å¸¸åŠ¨ä½œ"å’Œ"æ­£å¸¸è¡¨æƒ…"ã€‚',type:void 0,motion:'æ­£å¸¸åŠ¨ä½œ',expression:'æ­£å¸¸è¡¨æƒ…',sprite:{type:'live2d',live2dModelId:'ç¨‹åŒ—æ'}}),t({character:'',text:'æµ‹è¯• 6ï¼šç¨‹åŒ—æ Live2D æ¨¡å‹ - å‘å³çœ‹åŠ¨ä½œ + å®³ç¾è¡¨æƒ…',type:'narration',scene:'å·´å£«ç«™ç™½å¤©'}),t({character:'ç¨‹åŒ—æ',text:'è¿™æ˜¯"å‘å³çœ‹"åŠ¨ä½œå’Œ"å®³ç¾"è¡¨æƒ…çš„æµ‹è¯•ã€‚',type:void 0,scene:'å·´å£«ç«™ç™½å¤©',motion:'å‘å³çœ‹',expression:'å®³ç¾',sprite:{type:'live2d',live2dModelId:'ç¨‹åŒ—æ'}}),t({character:'',text:'æµ‹è¯• 7ï¼šç¨‹åŒ—æ Live2D æ¨¡å‹ - æ‘‡å¤´åŠ¨ä½œ + æ— è¯­è¡¨æƒ…',type:'narration',scene:'ç¨‹åŒ—ææˆ¿é—´å¤œæ™š'}),t({character:'ç¨‹åŒ—æ',text:'è¿™æ˜¯"æ‘‡å¤´"åŠ¨ä½œå’Œ"æ— è¯­"è¡¨æƒ…çš„æµ‹è¯•ã€‚',type:void 0,scene:'ç¨‹åŒ—ææˆ¿é—´å¤œæ™š',motion:'æ‘‡å¤´',expression:'æ— è¯­',sprite:{type:'live2d',live2dModelId:'ç¨‹åŒ—æ'}}),t({character:'',text:'--- Live2D æ¨¡å‹å’Œç«‹ç»˜æµ‹è¯•ç»“æŸ ---',type:'narration'}),t({character:'',text:'æµ‹è¯•å¯¹è¯åˆ°æ­¤ç»“æŸã€‚åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œå¯¹è¯æ•°æ®ä¼šä»é…’é¦†æ¶ˆæ¯ä¸­è‡ªåŠ¨è¯»å–ã€‚',type:'narration'})]}function ie(e=!1){if(c.value<i.value.length-1){const t=c.value+1;c.value=t,e&&(B.value=!1),D.value=!1}}function ce(){c.value>0&&(c.value--,D.value=!1)}async function de(){try{if(!document.fullscreenElement&&r.value){if(window.innerHeight>window.innerWidth&&screen.orientation&&'lock'in screen.orientation)try{await screen.orientation.lock('landscape')}catch(e){console.warn('æ— æ³•é”å®šå±å¹•æ–¹å‘:',e)}await r.value.requestFullscreen(),x.value=!0}else if(await document.exitFullscreen(),x.value=!1,screen.orientation&&'unlock'in screen.orientation)try{screen.orientation.unlock()}catch(e){}V.value=!1}catch(e){console.error('å…¨å±åˆ‡æ¢å¤±è´¥:',e)}}(0,n.watch)(()=>[c.value,u.value],()=>{const e=u.value;e&&(null!==O.value&&e.message_id!==O.value&&(F.value=!1,W.value='',O.value=null),'blackscreen'===e.type?(L.value=e.text,B.value=!0,D.value=!1):'choice'===e.type?(D.value=!0,B.value=!1):(B.value=!1,D.value=!1))},{immediate:!0}),(0,n.watch)(()=>[k.value,N.value,c.value,D.value,u.value],()=>{if(s.value&&(clearTimeout(s.value),s.value=null),k.value&&c.value<i.value.length-1&&!D.value){const e=u.value,t='blackscreen'===e?.type?N.value+2e3:N.value;s.value=setTimeout(()=>{ie()},t)}},{immediate:!0});const ue=()=>{x.value=!!document.fullscreenElement,(0,n.nextTick)(()=>{})},pe=()=>{(0,n.nextTick)(()=>{})},ve=[];function he(e){const t=e.currentTarget.getBoundingClientRect();e.clientX-t.left<t.width/2?c.value>0&&(c.value--,B.value=!1):ie(!0)}function fe(){y.value||V.value||D.value||B.value||ie()}(0,n.onMounted)(()=>{if(document.addEventListener('fullscreenchange',ue),window.addEventListener('resize',pe),window.addEventListener('orientationchange',pe),(0,n.nextTick)(()=>{pe()}),async function(){try{const e=new Map;try{const t=await h();console.info(`[GalgamePlayer] ä»ä¸–ç•Œä¹¦åŠ è½½åˆ° ${t.models.size} ä¸ª Live2D æ¨¡å‹`);for(const[o,n]of t.models.entries()){const t=n.files?.model3||'',a=t.startsWith('http://')||t.startsWith('https://'),l=t.substring(0,t.lastIndexOf('/')+1),r=a?t:t?t.split('/').pop():'',s={name:o,id:o,basePath:l,modelPath:r,version:3,textures:n.files?.textures||[],motions:n.motions?.map(e=>({group:e.group??'default',name:e.name,file:e.file,index:e.index,motionType:e.motionType,textMappings:e.textMappings}))||[],expressions:n.expressions?.map(e=>e.name||e.file)||[],defaultAnimation:n.defaultAnimation,textMappings:n.textMappings};console.info(`[GalgamePlayer] ä»ä¸–ç•Œä¹¦åŠ è½½æ¨¡å‹é…ç½®: ${o}`,{modelPath:r,basePath:l,isFullUrl:a,motionsCount:s.motions.length,expressionsCount:s.expressions.length,hasTextMappings:!!s.textMappings}),e.set(o,s)}J.value=t.models}catch(e){console.warn('[GalgamePlayer] ä»ä¸–ç•Œä¹¦åŠ è½½æ¨¡å‹èµ„æºå¤±è´¥:',e)}X.value=Array.from(e.values()),console.info(`[GalgamePlayer] åŠ è½½äº† ${X.value.length} ä¸ª Live2D æ¨¡å‹é…ç½®`),console.info('[GalgamePlayer] æ¨¡å‹åˆ—è¡¨è¯¦æƒ…:',X.value.map(e=>({id:e.id,name:e.name,modelPath:e.modelPath,basePath:e.basePath,motionsCount:e.motions?.length||0,expressionsCount:e.expressions?.length||0,hasTextMappings:!!e.textMappings})))}catch(e){console.error('[GalgamePlayer] åŠ è½½ Live2D æ¨¡å‹é…ç½®å¤±è´¥:',e)}}(),re(),'function'==typeof eventOn&&'undefined'!=typeof tavern_events){const e=eventOn(tavern_events.MESSAGE_RECEIVED,async e=>{const t=Number(e);try{const e=getChatMessages(t);if(e.length>0){const t=e[0].message||'';await async function(e){const t=/<phone>([\s\S]*?)<\/phone>/gi,o=Array.from(e.matchAll(t));if(0===o.length)return;const n=new Set;try{let e=null;try{const t=getCharWorldbookNames('current');e=t.primary||t.additional[0]||null}catch(e){console.warn('è·å–è§’è‰²å¡ä¸–ç•Œä¹¦å¤±è´¥:',e)}e||(e='å¼€åœºç•Œé¢-æ¨¡å‹æ•°æ®');let t=[];try{t=await getWorldbook(e)}catch{await createOrReplaceWorldbook(e,[]),t=[]}for(const e of o){const o=e[1].trim();if(!o)continue;const a=o.split('\n').filter(e=>e.trim()),l=new Map;for(const e of a){let t=e.match(/^(.+?)[ï¼š:](.+?)\|(.+)$/),o=null,a=null,r=null,s=null;if(t){const e=t[1].trim(),l=t[2].trim(),i=t[3].trim(),c=e.match(/^ä¸(.+?)çš„èŠå¤©$/);if(c)o=c[1].trim(),r=l,s=i,r.includes('{{user}}')||r.includes('<user>')?(a='{{user}}',r=r.replace(/{{user}}|<user>/gi,'').trim()):a=o;else{if('{{user}}'===e||'<user>'===e)continue;o=e,a=o,r=l,s=i,n.add(o)}}else t=e.match(/^ä¸(.+?)çš„èŠå¤©\|(.+?)\|(.+)$/),t&&(o=t[1].trim(),r=t[2].trim(),s=t[3].trim(),a='{{user}}');o&&r&&s&&a&&(l.has(o)||l.set(o,[]),l.get(o).push({speaker:a,content:r,time:s}))}for(const[e,o]of l.entries()){const n=`ä¸${e}çš„èŠå¤©è®°å½•`;let a=t.find(e=>e.name===n);a||(a={name:n,content:'',comment:'',priority:100,enabled:!0,insertion_order:0,case_sensitive:!1,name_regex:!1,content_regex:!1,exclude_recursion:!1,display_index:0,probability:100,delay:0,delay_on:0,delay_off:0,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},position:{before:[],after:[],order:0},disable:!1,exclude:!1,uid:Date.now().toString()},t.push(a));const l=a.content||'',r=o.map(e=>`${e.speaker}ï¼š${e.content}|${e.time}`),s=l?`${l}\n${r.join('\n')}`:r.join('\n');a.content=s}}t.length>0&&(await updateWorldbookWith(e,()=>t),console.info(`å·²æ›´æ–°ä¸–ç•Œä¹¦ ${e} ä¸­çš„èŠå¤©è®°å½•æ¡ç›®`)),n.size>0&&n.forEach(e=>{ye.value.add(e)})}catch(e){console.error('è§£æ phone æ ‡ç­¾å¹¶æ›´æ–°ä¸–ç•Œä¹¦å¤±è´¥:',e)}}(t)}}catch(e){console.warn('è§£æ phone æ ‡ç­¾å¤±è´¥:',e)}await re(),Number.isNaN(t)||O.value!==t||(F.value=!1,W.value='',O.value=null)});e&&ve.push(()=>e.stop());const t=eventOn(tavern_events.MESSAGE_UPDATED,async()=>{if(await re(),null!==O.value){const e=i.value.find(e=>e.message_id===O.value);e&&e.text===W.value&&(F.value=!1,W.value='',O.value=null)}});t&&ve.push(()=>t.stop());const o=eventOn(tavern_events.CHAT_CHANGED,()=>{re(),c.value=0,F.value=!1,W.value='',O.value=null});o&&ve.push(()=>o.stop());const n=eventOn(tavern_events.STREAM_TOKEN_RECEIVED,e=>{!function(e){if(!F.value||null===O.value)return;W.value=e}(e)});n&&ve.push(()=>n.stop())}}),(0,n.onUnmounted)(()=>{document.removeEventListener('fullscreenchange',ue),window.removeEventListener('resize',pe),window.removeEventListener('orientationchange',pe),s.value&&(clearTimeout(s.value),s.value=null),ve.forEach(e=>e()),ve.length=0});const ye=(0,n.ref)(new Set),xe=(0,n.computed)(()=>{if('undefined'!=typeof window&&window.getUnreadContacts){const e=window.getUnreadContacts();return e&&e.length>0}return!1});async function be(e){const t=j.value&&'function'==typeof j.value.getPendingMessages?j.value.getPendingMessages():'',o=t?`${e}\n\n${t}`:e;await createChatMessages([{role:'user',message:o}],{refresh:'all'})}function ke(e){const t=e.indexOf('<content>');if(-1!==t)return e.substring(t);const o=e.indexOf('</content>');return-1!==o?e.substring(o):e}async function we(e){try{const t=getCurrentMessageId(),o=getChatMessages(t)[0];if(!o)return void console.warn('æ— æ³•è·å–å½“å‰æ¶ˆæ¯');const n=u.value?.scene||'{{scene}}',a=o.message+'\n\n[[user||åœºæ™¯ï¼š'+n+'||å°è¯ï¼š'+e+']]';await setChatMessages([{message_id:t,message:a}],{refresh:'none'});const l=getLastMessageId()+1,r=i.value.length,s={unitId:`msg_${l}_unit_${r}`,unitIndex:r,character:'ä½ ',text:e,type:'user',isEditable:!0,message_id:l,role:'user'},d=[...i.value];d.splice(c.value+1,0,s),i.value=d,c.value=c.value+1,console.info('å·²ä¿å­˜åˆ°æ­£æ–‡ï¼ˆä¸åˆ·æ–°ç•Œé¢ï¼‰:',e)}catch(e){console.error('ä¿å­˜åˆ°æ­£æ–‡å¤±è´¥:',e)}}async function Ce(e,t){console.info('é€‰æ‹©é€‰é¡¹:',e,t);const o=u.value?.message_id;if(void 0===o)return console.warn('å½“å‰å¯¹è¯æ²¡æœ‰æ¶ˆæ¯IDï¼Œæ— æ³•å‘é€æ¶ˆæ¯'),void ie();try{const n=getLastMessageId(),a=c.value>=i.value.length-1;let l,r='';if('custom'===e&&t?r=t.trim():(l=u.value?.options?.find(t=>t.id===e),r=l?.text||''),!r)return console.warn('æ¶ˆæ¯æ–‡æœ¬ä¸ºç©ºï¼Œå–æ¶ˆå‘é€'),void ie();await async function(e,t){try{const o=getChatMessages(e);if(0===o.length)return;const n=o[0].message||'',a=n.match(/<content>([\s\S]*?)<\/content>/i);if(!a)return void console.warn('æ¶ˆæ¯ä¸­æ²¡æœ‰æ‰¾åˆ° <content> æ ‡ç­¾ï¼Œè·³è¿‡è£å‰ª');let l=a[1],r=!1;const s=/\[\[choice\|\|([^\]]+)\]\]/g,i=[];let c;for(;null!==(c=s.exec(l));)i.push({block:c[0],content:c[1]});console.info(`æ‰¾åˆ° ${i.length} ä¸ªé€‰é¡¹å—`);for(const e of i){const o={},n=e.content.split('||');for(const e of n){const t=e.match(/^([^ï¼š:]+)[ï¼š:]\s*(.*)$/);if(t){const e=t[1].trim(),n=t[2].trim();o[e]=n}}const a=o['è§’è‰²å']||o.character||o['å°è¯']||o.response||o.text||o['æ—ç™½']||o.narration,s=[];for(const e in o)if(e.match(/^é€‰é¡¹\d+$/)){const t=e.replace(/^é€‰é¡¹(\d+)$/,'$1');s.push(t)}if(1===s.length&&a){const n=o[`é€‰é¡¹${s[0]}`];n!==t?(l=l.replace(e.block,''),r=!0,console.info('å·²åˆ é™¤æœªé€‰ä¸­çš„æ ¼å¼1é€‰é¡¹å—:',n)):console.info('ä¿ç•™é€‰ä¸­çš„æ ¼å¼1é€‰é¡¹å—:',n)}else if(s.length>1){let n='',a=!1;for(const e of s){const l=o[`é€‰é¡¹${e}`];if(l===t){n=`é€‰é¡¹${e}ï¼š${l}`,a=!0;break}}if(a){const o=`[[choice||${n}]]`;l=l.replace(e.block,o),r=!0,console.info('å·²è£å‰ªæ ¼å¼2é€‰é¡¹å—ï¼Œåªä¿ç•™é€‰ä¸­çš„é€‰é¡¹:',t)}}}if(r){l=l.replace(/\n{3,}/g,'\n\n').trim();const t=n.replace(a[0],`<content>${l}</content>`);t!==n&&(await setChatMessages([{message_id:e,message:t}],{refresh:'none'}),console.info('å·²æ›´æ–°æ¶ˆæ¯æ–‡æœ¬ï¼ˆåˆ é™¤æœªé€‰ä¸­çš„é€‰é¡¹å—ï¼‰'))}}catch(e){console.error('è£å‰ªé€‰é¡¹æ–‡æœ¬å¤±è´¥:',e)}}(o,r);if(l&&l.character&&l.response){const e=u.value?.unitId,t=i.value.findIndex(t=>t.isChoiceResponse&&t.choiceParentId===e&&'user'===t.type),n=i.value.findIndex(t=>t.isChoiceResponse&&t.choiceParentId===e&&'user'!==t.type&&'choice'!==t.type),a=u.value,s=a?.scene,d=a?.sceneImageUrl,m=a?.sprite,p=a?.motion,v=a?.expression,h=a?.isCG,f=a?.cgImageUrl;if(-1!==t)i.value[t].text=r,s&&(i.value[t].scene=s),d&&(i.value[t].sceneImageUrl=d);else{const t={unitId:void 0!==o?`msg_${o}_unit_choice_user`:'temp_unit_choice_user',unitIndex:c.value+1,character:'ä½ ',text:r,type:'user',message_id:o,role:'user',isChoiceResponse:!0,choiceParentId:e,scene:s,sceneImageUrl:d},n=[...i.value];n.splice(c.value+1,0,t),i.value=n,c.value++}const g=l?.character||'',y=l?.response||'';if(-1!==n)i.value[n].character=g,i.value[n].text=y,s&&(i.value[n].scene=s),d&&(i.value[n].sceneImageUrl=d),m&&(i.value[n].sprite={...m}),p&&(i.value[n].motion=p),v&&(i.value[n].expression=v),void 0!==h&&(i.value[n].isCG=h),f&&(i.value[n].cgImageUrl=f);else{const n={unitId:void 0!==o?`msg_${o}_unit_choice_response`:'temp_unit_choice_response',unitIndex:c.value+1,character:g,text:y,type:void 0,message_id:o,role:'assistant',isChoiceResponse:!0,choiceParentId:e,scene:s,sceneImageUrl:d,sprite:m?{...m}:void 0,motion:p,expression:v,isCG:h,cgImageUrl:f},a=[...i.value],l=-1!==t?t+1:c.value+1;a.splice(l,0,n),i.value=a}}if(a){if(void 0!==o)try{const e=getChatMessages(o);if(e.length>0){const t=e[0].message||'',n=ke(t);n!==t&&(await setChatMessages([{message_id:o,message:n}],{refresh:'none'}),console.info('å·²è£å‰ªæ¶ˆæ¯æ–‡æœ¬ï¼Œä¿ç•™ <content>...</content> æ ‡ç­¾å—åŠå…¶ä¹‹åçš„æ‰€æœ‰å†…å®¹'))}}catch(e){console.error('è£å‰ªæ¶ˆæ¯æ–‡æœ¬å¤±è´¥:',e)}if(void 0!==o&&o<n){const e=[];for(let t=o+1;t<=n;t++)e.push(t);e.length>0&&(await deleteChatMessages(e,{refresh:'all'}),console.info(`å·²åˆ é™¤ ${e.length} æ¡åç»­æ¶ˆæ¯`))}await be(r),console.info('å·²å‘é€ç”¨æˆ·æ¶ˆæ¯:',r);const e=getLastMessageId()+1;F.value=!0,W.value='',O.value=e,await triggerSlash('/trigger'),console.info('å·²è§¦å‘ AI ç”Ÿæˆ'),await re()}if(!a&&'custom'===e&&t){if(void 0!==o)try{const e=getChatMessages(o);if(e.length>0){const t=e[0].message||'',n=ke(t);n!==t&&(await setChatMessages([{message_id:o,message:n}],{refresh:'none'}),console.info('å·²è£å‰ªæ¶ˆæ¯æ–‡æœ¬ï¼ˆåœ¨ </content> æ ‡ç­¾ä¹‹å‰åœæ­¢ï¼‰'))}}catch(e){console.error('è£å‰ªæ¶ˆæ¯æ–‡æœ¬å¤±è´¥:',e)}if(void 0!==o&&o<n){const e=[];for(let t=o+1;t<=n;t++)e.push(t);e.length>0&&(await deleteChatMessages(e,{refresh:'all'}),console.info(`å·²åˆ é™¤ ${e.length} æ¡åç»­æ¶ˆæ¯`))}await createChatMessages([{role:'user',message:r}],{refresh:'all'}),console.info('å·²å‘é€ç”¨æˆ·æ¶ˆæ¯ï¼ˆè‡ªå®šä¹‰è¾“å…¥ï¼‰:',r);const e=getLastMessageId()+1;F.value=!0,W.value='',O.value=e,await triggerSlash('/trigger'),console.info('å·²è§¦å‘ AI ç”Ÿæˆï¼ˆè‡ªå®šä¹‰è¾“å…¥ï¼‰'),await re()}else a||ie()}catch(e){console.error('å¤„ç†é€‰æ‹©æ—¶å‡ºé”™:',e),F.value=!1,W.value='',O.value=null,ie()}}function Ne(){const e=u.value;if(!e)return'';const t=e.text||'';return t?(F.value&&(O.value,e.message_id),t):''}const Ve=(0,n.ref)(!1),Ee=(0,n.ref)([]);async function Se(){V.value=!1,Ve.value=!0;try{const e=getLastMessageId(),t=[];for(let o=0;o<=e;o++)try{const e=getChatMessages(o);if(e.length>0){const n=e[0],a=n.message||'',l=await w(a),r=[];for(const e of l)if('character'===e.type&&e.character&&e.text)r.push({type:'character',character:e.character,text:e.text});else if('user'===e.type){const t='message'in e?e.message:e.text;t&&r.push({type:'user',character:'ä½ ',text:t})}else if('narration'===e.type){const t='message'in e?e.message:e.text;t&&r.push({type:'narration',text:t})}else if('blacktext'===e.type){const t='message'in e?e.message:e.text;t&&r.push({type:'blacktext',text:t})}else'choice'===e.type&&(e.choiceText||e.text)&&r.push({type:'choice',text:e.choiceText||e.text||''});if(0===r.length){const e=a.replace(/\[\[[^\]]+\]\]/g,'').replace(/<[^>]+>/g,'').trim();e&&r.push({type:'user'===n.role?'user':'character',character:'user'===n.role?'ä½ ':'AI',text:e})}r.length>0&&t.push({id:o,role:n.role||'user',items:r})}}catch(e){console.warn(`è·å–æ¶ˆæ¯ ${o} å¤±è´¥:`,e)}Ee.value=t.reverse(),console.info(`å·²åŠ è½½ ${Ee.value.length} æ¡å†å²æ¶ˆæ¯`)}catch(e){console.error('åŠ è½½å†å²æ¶ˆæ¯å¤±è´¥:',e)}}function Me(){G.value={...q.value}}function Be(){V.value?(P.value||(q.value={...G.value}),y.value=!0,V.value=!1):V.value=!0}function Ie(){E.value?(S.value=!0,E.value=!1):E.value=!0}function $e(){M.value=!0,E.value=!1}function Le(){M.value=!0,E.value=!1,(0,n.nextTick)(()=>{})}function _e(){R.value=!0,E.value=!1,(0,n.nextTick)(()=>{U.value?.focus()})}async function De(){if(!T.value.trim())return;const e=T.value.trim();T.value='',R.value=!1;const t=c.value>=i.value.length-1,o=u.value?.message_id,n=getLastMessageId();if(!t&&void 0!==o)try{const e=getChatMessages(o);if(e.length>0){const t=e[0].message||'',n=ke(t);n!==t&&(await setChatMessages([{message_id:o,message:n}],{refresh:'none'}),console.info('å·²è£å‰ªæ¶ˆæ¯æ–‡æœ¬ï¼Œä¿ç•™ <content>...</content> æ ‡ç­¾å—åŠå…¶ä¹‹åçš„æ‰€æœ‰å†…å®¹'))}if(o<n){const e=[];for(let t=o+1;t<=n;t++)e.push(t);e.length>0&&(await deleteChatMessages(e,{refresh:'all'}),console.info(`å·²åˆ é™¤ ${e.length} æ¡åç»­æ¶ˆæ¯`))}}catch(e){console.error('è£å‰ªå’Œåˆ é™¤åç»­æ¶ˆæ¯å¤±è´¥:',e)}const a=getLastMessageId()+1,l=i.value.length,r={unitId:`msg_${a}_unit_${l}`,unitIndex:l,character:'ä½ ',text:e,type:'user',isEditable:!0,message_id:a,role:'user'},s=[...i.value];s.splice(c.value+1,0,r),i.value=s,c.value=c.value+1;try{await async function(){if(0===le.value.size)return;try{for(const[e,t]of le.value.entries())t.deleted?(await deleteChatMessages([e],{refresh:'none'}),console.info('å·²åº”ç”¨åˆ é™¤ï¼ˆä¸åˆ·æ–°ç•Œé¢ï¼‰:',e)):t.text&&(await Te(e,t.text),console.info('å·²åº”ç”¨ç¼–è¾‘ï¼ˆä¸åˆ·æ–°ç•Œé¢ï¼‰:',e));le.value.clear()}catch(e){console.error('åº”ç”¨ç”¨æˆ·æ¶ˆæ¯ç¼–è¾‘å¤±è´¥:',e)}}();const t=`[[user||åœºæ™¯ï¼š${u.value?.scene||'{{scene}}'}||å°è¯ï¼š${e}]]`;await be(t),console.info('å·²å‘é€ç”¨æˆ·æ¶ˆæ¯:',e);const o=getLastMessageId()+1;F.value=!0,W.value='',O.value=o,await triggerSlash('/trigger'),console.info('å·²è§¦å‘ AI ç”Ÿæˆ'),await re()}catch(e){console.error('å‘é€æ¶ˆæ¯å¤±è´¥:',e),F.value=!1,W.value='',O.value=null}}async function Pe(){if(!T.value.trim())return;const e=T.value.trim();T.value='',R.value=!1,await we(e)}async function ze(e,t){try{await Te(e,t),le.value.set(e,{text:t});const o=i.value.findIndex(t=>t.message_id===e);if(-1!==o){const e=[...i.value];e[o]={...e[o],text:t},i.value=e}console.info('å·²åŒæ­¥ç¼–è¾‘åˆ°æ¥¼å±‚æ¶ˆæ¯ï¼ˆä¸åˆ·æ–°ç•Œé¢ï¼‰:',e,t)}catch(e){console.error('ç¼–è¾‘ç”¨æˆ·æ¶ˆæ¯å¤±è´¥:',e)}}async function Re(e){try{le.value.set(e,{deleted:!0});const t=i.value.findIndex(t=>t.message_id===e);if(-1!==t){const e=[...i.value];e.splice(t,1),i.value=e,c.value>=e.length&&(c.value=Math.max(0,e.length-1))}console.info('å·²æš‚å­˜åˆ é™¤ï¼ˆå†…å­˜ä¸­ï¼‰:',e)}catch(e){console.error('åˆ é™¤ç”¨æˆ·æ¶ˆæ¯å¤±è´¥:',e)}}async function Te(e,t){try{const o=getChatMessages(e);if(o.length>0){const n=o[0].message||'',a=n.match(/<content>([\s\S]*?)<\/content>/i),l=a?a[1]:n,r=/\[\[user\|\|([^\]]+)\]\]/g;let s,i=n,c=!1;for(;null!==(s=r.exec(l));){const e=s[1],o={},r=e.split('||').map(e=>e.trim()).filter(e=>e);for(const e of r){const t=e.match(/^([^ï¼š:]+)[ï¼š:]\s*(.+)$/);if(t){const e=t[1].trim(),n=t[2].trim();e&&n&&(o[e]=n)}}if(o['åœºæ™¯']||o.scene||o['å°è¯']||o['ç”¨æˆ·æ¶ˆæ¯']||o['æ¶ˆæ¯']||o.text){const e=o['åœºæ™¯']||o.scene||'{{scene}}',r=s[0],d=`[[user||åœºæ™¯ï¼š${e}||å°è¯ï¼š${t}]]`;if(a){const e=l.replace(r,d);i=n.replace(a[0],`<content>${e}</content>`)}else i=n.replace(r,d);c=!0;break}}if(!c)if(a){const e=l+`\n[[user||åœºæ™¯ï¼š{{scene}}||å°è¯ï¼š${t}]]`;i=n.replace(a[0],`<content>${e}</content>`)}else i=n+`\n[[user||åœºæ™¯ï¼š{{scene}}||å°è¯ï¼š${t}]]`;await setChatMessages([{message_id:e,message:i}],{refresh:'none'}),console.info('å·²åŒæ­¥ç¼–è¾‘åˆ°æ¥¼å±‚æ¶ˆæ¯ï¼ˆä¸åˆ·æ–°ç•Œé¢ï¼‰:',e,t)}}catch(e){console.error('åŒæ­¥ç¼–è¾‘åˆ°æ¥¼å±‚æ¶ˆæ¯å¤±è´¥:',e)}}return(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{ref_key:'containerRef',ref:r,class:'relative w-full overflow-hidden select-none',style:(0,n.normalizeStyle)([ee.value,{background:'transparent'}])},[(0,n.createCommentVNode)(' èƒŒæ™¯ '),(0,n.createElementVNode)('div',{class:'absolute inset-0 bg-center bg-no-repeat',style:(0,n.normalizeStyle)({backgroundImage:te.value?`url('${te.value}')`:void 0,backgroundColor:'transparent',backgroundSize:te.value?'cover':void 0,backgroundPosition:'center',backgroundRepeat:'no-repeat',objectFit:'cover'})},null,4),(0,n.createCommentVNode)(' ç»¿è‰²æ¸…æ–°æ»¤é•œå åŠ  '),t[23]||(t[23]=(0,n.createElementVNode)('div',{class:'bg-primary/5 absolute inset-0'},null,-1)),(0,n.createCommentVNode)(' è§’è‰²ç«‹ç»˜ '),(0,n.createVNode)(I,{'sprite-scale':A.value.scale,'sprite-position-x':A.value.positionX,'sprite-position-y':A.value.positionY,'live2d-scale':H.value.scale,'live2d-position-x':H.value.positionX,'live2d-position-y':H.value.positionY,'sprite-type':oe.value,'image-url':ne.value,'live2d-model-id':ae.value,'live2d-models':X.value,motion:u.value?.motion,expression:u.value?.expression},null,8,['sprite-scale','sprite-position-x','sprite-position-y','live2d-scale','live2d-position-x','live2d-position-y','sprite-type','image-url','live2d-model-id','live2d-models','motion','expression']),(0,n.createCommentVNode)(' CGå›¾ç‰‡ï¼ˆCGæ¨¡å¼ï¼‰ '),u.value?.isCG&&u.value.cgImageUrl?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,class:'absolute inset-0 z-5 bg-cover bg-center',style:(0,n.normalizeStyle)({backgroundImage:`url('${u.value.cgImageUrl}')`})},null,4)):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' å·¦ä¸Šè§’è§’è‰²æŒ‰é’® '),(0,n.createElementVNode)('div',Mo,[(0,n.createCommentVNode)(' è§’è‰²æŒ‰é’® '),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['bg-card/80 text-foreground flex items-center gap-2 rounded-full p-2 shadow-lg backdrop-blur-sm transition-all hover:bg-card',E.value?'pr-4':'']),'aria-label':'è§’è‰²',onClick:(0,n.withModifiers)(Ie,['stop'])},[(0,n.createCommentVNode)(' å°äººå›¾æ ‡ SVG '),t[8]||(t[8]=(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z'})],-1)),E.value?((0,n.openBlock)(),(0,n.createElementBlock)('span',Bo,'è§’è‰²')):(0,n.createCommentVNode)('v-if',!0)],2),(0,n.createCommentVNode)(' å±•å¼€çš„è¾“å…¥æŒ‰é’® '),E.value?((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card',style:{'animation-delay':'25ms'},'aria-label':'æ‰‹æœº',onClick:(0,n.withModifiers)($e,['stop'])},[...t[9]||(t[9]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M7 4h10a1 1 0 011 1v14a1 1 0 01-1 1H7a1 1 0 01-1-1V5a1 1 0 011-1z'}),(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M11 5h2m-2 14h2'})],-1),(0,n.createElementVNode)('span',{class:'text-sm'},'æ‰‹æœº',-1)])])):(0,n.createCommentVNode)('v-if',!0),E.value?((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:1,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card',style:{'animation-delay':'75ms'},'aria-label':'è¾“å…¥',onClick:(0,n.withModifiers)(_e,['stop'])},[...t[10]||(t[10]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z'})],-1),(0,n.createElementVNode)('span',{class:'text-sm'},'è¾“å…¥',-1)])])):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' æ‰‹æœºå›¾æ ‡æç¤ºï¼ˆæœ‰æœªè¯»æ¶ˆæ¯æ—¶æ˜¾ç¤ºï¼‰ '),xe.value?((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:2,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center justify-center rounded-full p-2 shadow-lg backdrop-blur-sm transition-all duration-200 hover:bg-card hover:scale-110',style:{'animation-delay':'100ms'},'aria-label':'æŸ¥çœ‹æœªè¯»æ¶ˆæ¯',onClick:(0,n.withModifiers)(Le,['stop'])},[...t[11]||(t[11]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M7 4h10a1 1 0 011 1v14a1 1 0 01-1 1H7a1 1 0 01-1-1V5a1 1 0 011-1z'}),(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M11 5h2m-2 14h2'})],-1)])])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createCommentVNode)(' å³ä¸Šè§’èœå•æŒ‰é’® '),(0,n.createElementVNode)('div',Io,[(0,n.createCommentVNode)(' é½¿è½®æŒ‰é’® '),(0,n.createElementVNode)('button',{class:(0,n.normalizeClass)(['bg-card/80 text-foreground flex items-center gap-2 rounded-full p-2 shadow-lg backdrop-blur-sm transition-all hover:bg-card',V.value?'pr-4':'']),'aria-label':'è®¾ç½®',onClick:Be},[t[12]||(t[12]=(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z'}),(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M15 12a3 3 0 11-6 0 3 3 0 016 0z'})],-1)),V.value?((0,n.openBlock)(),(0,n.createElementBlock)('span',$o,'è®¾ç½®')):(0,n.createCommentVNode)('v-if',!0)],2),(0,n.createCommentVNode)(' å±•å¼€çš„å…¨å±æŒ‰é’® '),V.value?((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card','aria-label':x.value?'é€€å‡ºå…¨å±':'å…¨å±',onClick:de},[x.value?((0,n.openBlock)(),(0,n.createElementBlock)('svg',_o,[...t[13]||(t[13]=[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25'},null,-1)])])):((0,n.openBlock)(),(0,n.createElementBlock)('svg',Do,[...t[14]||(t[14]=[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4'},null,-1)])])),(0,n.createElementVNode)('span',Po,(0,n.toDisplayString)(x.value?'é€€å‡ºå…¨å±':'å…¨å±'),1)],8,Lo)):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' å†å²æŒ‰é’® '),V.value?((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:1,class:'bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card',style:{'animation-delay':'50ms'},'aria-label':'å†å²',onClick:Se},[...t[15]||(t[15]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z'})],-1),(0,n.createElementVNode)('span',{class:'text-sm'},'å†å²',-1)])])):(0,n.createCommentVNode)('v-if',!0)]),(0,n.createCommentVNode)(' ç‚¹å‡»åŒºåŸŸ '),(0,n.createElementVNode)('div',{class:'absolute inset-0 z-10 cursor-pointer',onClick:fe}),(0,n.createCommentVNode)(' ç‚¹å‡»å…¶ä»–åŒºåŸŸæ”¶èµ·èœå• '),V.value||E.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:1,class:'absolute inset-0 z-40',onClick:t[0]||(t[0]=e=>{V.value=!1,E.value=!1})})):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' é»‘å±è½¬åœº '),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['absolute inset-0 z-30 flex items-center justify-center bg-black transition-opacity duration-1000',B.value?'opacity-100':'pointer-events-none opacity-0']),onClick:he},[(0,n.createElementVNode)('p',zo,(0,n.toDisplayString)(L.value),1),(0,n.createCommentVNode)(' å·¦å³ç®­å¤´æŒ‡ç¤ºåŒºåŸŸ '),B.value?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:0},[t[16]||(t[16]=(0,n.createStaticVNode)('<div class="absolute top-1/2 left-6 -translate-y-1/2 text-white/40 transition-colors hover:text-white/60" data-v-7c5875d8><svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-7c5875d8><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" data-v-7c5875d8></path></svg></div><div class="absolute top-1/2 right-6 -translate-y-1/2 text-white/40 transition-colors hover:text-white/60" data-v-7c5875d8><svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-7c5875d8><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" data-v-7c5875d8></path></svg></div>',2))],64)):(0,n.createCommentVNode)('v-if',!0)],2),(0,n.createCommentVNode)(' é€‰é¡¹æ¡† '),D.value&&u.value?.options?((0,n.openBlock)(),(0,n.createBlock)(Q,{key:2,options:u.value.options,'custom-style':G.value,'on-select':Ce,'on-prev':ce,'on-next':()=>ie(),'on-save':we},null,8,['options','custom-style','on-next'])):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' å°çº¸æ¡ï¼ˆä½äºå¯¹è¯æ¡†ä¸Šæ–¹ï¼Œç•Œé¢ä¸­é—´åå³ï¼‰ '),!B.value&&!D.value&&u.value&&p.value&&'blackscreen'!==u.value.type&&'choice'!==u.value.type?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ro,[(0,n.createVNode)(ge,{content:p.value,'note-unit-id':v.value,'initial-position':f.value,onPositionChange:g},null,8,['content','note-unit-id','initial-position'])])):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' å¯¹è¯æ¡† '),!B.value&&!D.value&&u.value&&'blackscreen'!==u.value.type&&'choice'!==u.value.type&&Ne()?((0,n.openBlock)(),(0,n.createBlock)(me,{key:4,character:u.value.character||'',text:Ne(),'is-last-dialogue':c.value>=i.value.length-1,'is-first-dialogue':0===c.value,'on-prev':ce,'on-next':ie,'dialog-key':c.value,'custom-style':G.value,'is-loading':F.value&&O.value===u.value.message_id,'streaming-text':F.value&&O.value===u.value.message_id?W.value:void 0,'is-through':u.value.isThrough,'is-editable':u.value.isEditable,'message-id':u.value.message_id,'on-edit':ze,'on-delete':Re},null,8,['character','text','is-last-dialogue','is-first-dialogue','dialog-key','custom-style','is-loading','streaming-text','is-through','is-editable','message-id'])):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' è®¾ç½®é¢æ¿ '),y.value?((0,n.openBlock)(),(0,n.createBlock)(So,{key:5,'on-close':()=>y.value=!1,'sprite-settings':A.value,'on-sprite-settings-change':e=>A.value=e,'live2d-settings':H.value,'on-live2d-settings-change':e=>H.value=e,'auto-play':k.value,'on-auto-play-change':e=>k.value=e,'auto-play-speed':N.value,'on-auto-play-speed-change':e=>N.value=e,'dialog-style':q.value,'on-dialog-style-change':e=>q.value=e,'on-save-style':Me,'current-applied-style':G.value,'custom-mode-enabled':P.value,'on-custom-mode-change':e=>P.value=e},null,8,['on-close','sprite-settings','on-sprite-settings-change','live2d-settings','on-live2d-settings-change','auto-play','on-auto-play-change','auto-play-speed','on-auto-play-speed-change','dialog-style','on-dialog-style-change','current-applied-style','custom-mode-enabled','on-custom-mode-change'])):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' è§’è‰²çŠ¶æ€æ  '),(0,n.createVNode)(Y,{show:S.value,'message-id':u.value?.message_id,'status-block':u.value?.statusBlock,'on-close':()=>S.value=!1},null,8,['show','message-id','status-block','on-close']),(0,n.createCommentVNode)(' æ‰‹æœºé¢æ¿ï¼ˆå°å‰§åœº + æ‰‹æœºæ¶ˆæ¯ï¼‰ '),(0,n.createVNode)(We,{ref_key:'phonePanelRef',ref:j,show:M.value,'message-id':u.value?.message_id,'status-block':u.value?.statusBlock,'on-close':()=>M.value=!1},null,8,['show','message-id','status-block','on-close']),(0,n.createCommentVNode)(' å†å²å¯¹è¯æ¡† '),Ve.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:6,class:'fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm',onClick:t[2]||(t[2]=(0,n.withModifiers)(e=>Ve.value=!1,['self']))},[(0,n.createElementVNode)('div',To,[(0,n.createCommentVNode)(' æ ‡é¢˜æ  '),(0,n.createElementVNode)('div',Uo,[t[18]||(t[18]=(0,n.createElementVNode)('h2',{class:'text-lg font-medium'},'å¯¹è¯å†å²',-1)),(0,n.createElementVNode)('button',{class:'hover:bg-muted rounded-full p-1 transition-colors','aria-label':'å…³é—­',onClick:t[1]||(t[1]=e=>Ve.value=!1)},[...t[17]||(t[17]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])])]),(0,n.createCommentVNode)(' å†å²æ¶ˆæ¯åˆ—è¡¨ '),(0,n.createElementVNode)('div',jo,[0===Ee.value.length?((0,n.openBlock)(),(0,n.createElementBlock)('div',Fo,' æš‚æ— å†å²æ¶ˆæ¯ ')):(0,n.createCommentVNode)('v-if',!0),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(Ee.value,(e,o)=>((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:e.id},[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.items,(a,l)=>{return(0,n.openBlock)(),(0,n.createElementBlock)('div',{key:`${e.id}-${l}`,class:'history-message-item group relative cursor-pointer rounded px-3 py-2 transition-all',onClick:t=>async function(e){try{Ve.value=!1;const t=c.value;m.value=!0,await re(),await(0,n.nextTick)();let o=-1;if(o=i.value.findIndex(t=>t.message_id===e),o<0){const t=i.value.map((e,t)=>({dialogue:e,index:t})).filter(({dialogue:t})=>t.message_id===e);t.length>0&&(o=t[0].index)}o>=0?(c.value=o,await(0,n.nextTick)(),console.info(`å·²è·³è½¬åˆ°æ¶ˆæ¯ ${e}ï¼ˆç´¢å¼• ${o}ï¼Œæ€»å¯¹è¯æ•°: ${i.value.length}ï¼‰`)):(console.warn(`æœªæ‰¾åˆ°æ¶ˆæ¯ ${e} å¯¹åº”çš„å¯¹è¯ï¼Œå½“å‰å¯¹è¯æ•°é‡: ${i.value.length}`,'å¯¹è¯ message_id åˆ—è¡¨:',i.value.map((e,t)=>({index:t,message_id:e.message_id})).slice(0,10)),t>=0&&t<i.value.length?(c.value=t,console.info(`ä¿æŒå½“å‰ä½ç½®ï¼ˆç´¢å¼• ${t}ï¼‰`)):i.value.length>0&&(c.value=0,console.info('å·²è·³è½¬åˆ°ç¬¬ä¸€æ¡å¯¹è¯')))}catch(e){console.error('è·³è½¬åˆ°å†å²æ¶ˆæ¯å¤±è´¥:',e),m.value=!1}}(e.id)},[(0,n.createCommentVNode)(' è§’è‰²å¯¹è¯ '),'character'===a.type||'user'===a.type?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:0,class:'leading-relaxed',style:(0,n.normalizeStyle)({color:G.value.colors.dialogText,fontSize:`${G.value.fontSize}px`})},[(0,n.createElementVNode)('span',Oo,(0,n.toDisplayString)(a.character)+'ï¼š',1),(0,n.createElementVNode)('span',{innerHTML:(r=a.text,r?r.replace(/\*([^*]+)\*/g,(e,t)=>'through'===t.trim()?e:` <span style="color: #9ca3af; font-style: italic;">${t}</span> `):'')},null,8,Ao)],4)):'narration'===a.type?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:1},[(0,n.createCommentVNode)(' æ—ç™½ '),(0,n.createElementVNode)('div',{class:'ml-6 leading-relaxed italic',style:(0,n.normalizeStyle)({color:G.value.colors.narrationText,fontSize:`${G.value.fontSize}px`})},(0,n.toDisplayString)(a.text),5)],2112)):'blacktext'===a.type?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:2},[(0,n.createCommentVNode)(' é»‘å±æ–‡å­— '),(0,n.createElementVNode)('div',{class:'ml-6 leading-relaxed italic opacity-70',style:(0,n.normalizeStyle)({color:G.value.colors.narrationText,fontSize:`${G.value.fontSize}px`})},(0,n.toDisplayString)(a.text),5)],2112)):'choice'===a.type?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:3},[(0,n.createCommentVNode)(' é€‰é¡¹ï¼ˆä»¥ç”¨æˆ·å‘è¨€æ ¼å¼æ˜¾ç¤ºï¼‰ '),(0,n.createElementVNode)('div',{class:'leading-relaxed',style:(0,n.normalizeStyle)({color:G.value.colors.dialogText,fontSize:`${G.value.fontSize}px`})},[t[19]||(t[19]=(0,n.createElementVNode)('span',{class:'font-medium'},'ä½ ï¼š',-1)),(0,n.createElementVNode)('span',null,(0,n.toDisplayString)(a.text),1)],4)],2112)):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' åˆ†éš”çº¿ï¼ˆåªåœ¨hoveræ—¶æ˜¾ç¤ºï¼‰ '),l<e.items.length-1||o<Ee.value.length-1?((0,n.openBlock)(),(0,n.createElementBlock)('div',Ho)):(0,n.createCommentVNode)('v-if',!0)],8,Wo);var r}),128))],64))),128))])])])):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' è¾“å…¥æ¡†ï¼ˆå±å¹•ä¸­å¤®ï¼‰ '),R.value?((0,n.openBlock)(),(0,n.createElementBlock)('div',{key:7,class:'absolute inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm',onClick:t[7]||(t[7]=()=>R.value=!1)},[(0,n.createElementVNode)('div',{class:'relative mx-4 w-full max-w-lg p-4',style:(0,n.normalizeStyle)({backgroundColor:'pill'===G.value.boxShape?'rgba(255, 255, 255, 0.85)':G.value.colors.boxBackground,borderRadius:'16px',borderWidth:'1px',borderStyle:'solid',borderColor:G.value.colors.boxBorder,boxShadow:'0 8px 32px rgba(0,0,0,0.15)',backdropFilter:'pill'===G.value.boxShape?'blur(12px)':void 0}),onClick:t[6]||(t[6]=(0,n.withModifiers)(()=>{},['stop']))},[(0,n.createCommentVNode)(' å…³é—­æŒ‰é’® '),(0,n.createElementVNode)('button',{class:'absolute top-2 right-2 rounded-full p-1 transition-colors hover:bg-black/5',onClick:t[3]||(t[3]=()=>R.value=!1)},[...t[20]||(t[20]=[(0,n.createElementVNode)('svg',{class:'text-muted-foreground h-4 w-4',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M6 18L18 6M6 6l12 12'})],-1)])]),(0,n.createCommentVNode)(' è§’è‰²åæ ‡ç­¾ '),(0,n.createElementVNode)('div',{class:'mb-3 inline-block px-3 py-1 text-sm font-medium',style:(0,n.normalizeStyle)({backgroundColor:G.value.colors.nameBackground,color:G.value.colors.nameText,borderRadius:'6px'})},' ä½  ',4),(0,n.createCommentVNode)(' è¾“å…¥åŒºåŸŸ '),(0,n.createElementVNode)('div',Go,[(0,n.withDirectives)((0,n.createElementVNode)('input',{ref_key:'inputRef',ref:U,'onUpdate:modelValue':t[4]||(t[4]=e=>T.value=e),type:'text',placeholder:'è¾“å…¥ä½ æƒ³è¯´çš„è¯...',class:'flex-1 bg-transparent text-base outline-none',style:(0,n.normalizeStyle)({color:G.value.colors.dialogText}),onKeydown:[(0,n.withKeys)(De,['enter']),t[5]||(t[5]=(0,n.withKeys)(()=>R.value=!1,['escape']))]},null,36),[[n.vModelText,T.value]]),(0,n.createCommentVNode)(' ä¿å­˜æŒ‰é’® '),T.value.trim()?((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:0,class:'p-1 transition-colors hover:opacity-80',style:(0,n.normalizeStyle)({color:G.value.colors.nameText}),'aria-label':'ä¿å­˜åˆ°æ­£æ–‡',title:'ä¿å­˜åˆ°æ­£æ–‡ï¼ˆä¸å‘é€ï¼‰',onClick:(0,n.withModifiers)(Pe,['stop'])},[...t[21]||(t[21]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12'})],-1)])],4)):(0,n.createCommentVNode)('v-if',!0),(0,n.createCommentVNode)(' å‘é€æŒ‰é’® '),T.value.trim()?((0,n.openBlock)(),(0,n.createElementBlock)('button',{key:1,class:'p-1 transition-colors hover:opacity-80',style:(0,n.normalizeStyle)({color:G.value.colors.nameText}),'aria-label':'å‘é€',onClick:(0,n.withModifiers)(De,['stop'])},[...t[22]||(t[22]=[(0,n.createElementVNode)('svg',{class:'h-5 w-5',fill:'none',stroke:'currentColor',viewBox:'0 0 24 24'},[(0,n.createElementVNode)('path',{'stroke-linecap':'round','stroke-linejoin':'round','stroke-width':'2',d:'M5 12h14M12 5l7 7-7 7'})],-1)])],4)):(0,n.createCommentVNode)('v-if',!0)])],4)])):(0,n.createCommentVNode)('v-if',!0)],4))}}),Xo=(0,B.A)(qo,[['__scopeId','data-v-7c5875d8']])},455(e,t){t.A=(e,t)=>{const o=e.__vccOpts||e;for(const[e,n]of t)o[e]=n;return o}},521(t,o,n){n.d(o,{live2dModelManager:()=>l});class a{static instance=null;modelCache=new Map;loadingPromises=new Map;maxCacheSize=5;constructor(){console.info('[Live2Dç®¡ç†å™¨] åˆå§‹åŒ–æ¨¡å‹ç®¡ç†å™¨')}static getInstance(){return a.instance||(a.instance=new a),a.instance}async preloadModel(e){const t=e.id;if(this.modelCache.has(t)){return this.modelCache.get(t).lastUsed=Date.now(),void console.info(`[Live2Dç®¡ç†å™¨] æ¨¡å‹ "${e.name}" å·²åœ¨ç¼“å­˜ä¸­`)}if(this.loadingPromises.has(t))return console.info(`[Live2Dç®¡ç†å™¨] æ¨¡å‹ "${e.name}" æ­£åœ¨åŠ è½½ä¸­ï¼Œç­‰å¾…...`),void await this.loadingPromises.get(t);console.info(`[Live2Dç®¡ç†å™¨] å¼€å§‹é¢„åŠ è½½æ¨¡å‹: "${e.name}"`);const o=this.loadModelInternal(e);this.loadingPromises.set(t,o);try{const n=await o;this.cleanupCache(),this.modelCache.set(t,{model:n,config:e,lastUsed:Date.now()}),console.info(`[Live2Dç®¡ç†å™¨] æ¨¡å‹ "${e.name}" é¢„åŠ è½½å®Œæˆå¹¶å·²ç¼“å­˜`)}catch(t){throw console.error(`[Live2Dç®¡ç†å™¨] æ¨¡å‹ "${e.name}" é¢„åŠ è½½å¤±è´¥:`,t),t}finally{this.loadingPromises.delete(t)}}async preloadModels(e){console.info(`[Live2Dç®¡ç†å™¨] å¼€å§‹æ‰¹é‡é¢„åŠ è½½ ${e.length} ä¸ªæ¨¡å‹`);const t=e.map(e=>this.preloadModel(e).catch(t=>{console.warn(`[Live2Dç®¡ç†å™¨] æ¨¡å‹ "${e.name}" é¢„åŠ è½½å¤±è´¥:`,t)}));Promise.all(t).then(()=>{console.info('[Live2Dç®¡ç†å™¨] æ‰€æœ‰æ¨¡å‹é¢„åŠ è½½å®Œæˆ')})}getCachedModel(e){const t=this.modelCache.get(e);return t?(t.lastUsed=Date.now(),console.info(`[Live2Dç®¡ç†å™¨] ä»ç¼“å­˜è·å–æ¨¡å‹: ${t.config.name}`),t.model):null}async getOrLoadModel(e){const t=e.id,o=this.getCachedModel(t);return o||(this.loadingPromises.has(t)?(console.info(`[Live2Dç®¡ç†å™¨] æ¨¡å‹ "${e.name}" æ­£åœ¨åŠ è½½ä¸­ï¼Œç­‰å¾…...`),await this.loadingPromises.get(t)):(console.info(`[Live2Dç®¡ç†å™¨] æ¨¡å‹ "${e.name}" ä¸åœ¨ç¼“å­˜ä¸­ï¼Œå¼€å§‹åŠ è½½...`),await this.preloadModel(e),this.getCachedModel(t)))}async loadModelInternal(t){try{let o=t.modelPath;o.startsWith('http://')||o.startsWith('https://')||(o=t.basePath?`${t.basePath}${o}`:o),console.info(`[Live2Dç®¡ç†å™¨] åŠ è½½æ¨¡å‹æ–‡ä»¶: ${o}`);const n=await e.from(o,{autoInteract:!1,autoUpdate:!0});return console.info(`[Live2Dç®¡ç†å™¨] æ¨¡å‹ "${t.name}" åŠ è½½æˆåŠŸ`),n}catch(e){throw console.error(`[Live2Dç®¡ç†å™¨] åŠ è½½æ¨¡å‹ "${t.name}" å¤±è´¥:`,e),e}}cleanupCache(){if(this.modelCache.size<this.maxCacheSize)return;console.info(`[Live2Dç®¡ç†å™¨] ç¼“å­˜å·²æ»¡ (${this.modelCache.size}/${this.maxCacheSize})ï¼Œå¼€å§‹æ¸…ç†...`);let e=null,t=1/0;for(const[o,n]of this.modelCache.entries())n.lastUsed<t&&(t=n.lastUsed,e=o);if(e){const t=this.modelCache.get(e);console.info(`[Live2Dç®¡ç†å™¨] ç§»é™¤æœ€ä¹…æœªä½¿ç”¨çš„æ¨¡å‹: "${t.config.name}"`);try{t.model.destroy()}catch(e){console.warn('[Live2Dç®¡ç†å™¨] é”€æ¯æ¨¡å‹å¤±è´¥:',e)}this.modelCache.delete(e)}}clearCache(){console.info(`[Live2Dç®¡ç†å™¨] æ¸…ç©ºæ‰€æœ‰ç¼“å­˜ (${this.modelCache.size} ä¸ªæ¨¡å‹)`);for(const e of this.modelCache.values())try{e.model.destroy()}catch(t){console.warn(`[Live2Dç®¡ç†å™¨] é”€æ¯æ¨¡å‹ "${e.config.name}" å¤±è´¥:`,t)}this.modelCache.clear(),this.loadingPromises.clear()}getCacheStats(){return{cached:this.modelCache.size,loading:this.loadingPromises.size,maxSize:this.maxCacheSize,models:Array.from(this.modelCache.entries()).map(([e,t])=>({id:e,name:t.config.name,lastUsed:t.lastUsed}))}}setMaxCacheSize(e){this.maxCacheSize=Math.max(1,e),console.info(`[Live2Dç®¡ç†å™¨] è®¾ç½®æœ€å¤§ç¼“å­˜å¤§å°: ${this.maxCacheSize}`),this.cleanupCache()}}const l=a.getInstance()}},o={};function n(e){var a=o[e];if(void 0!==a)return a.exports;var l=o[e]={exports:{}};return t[e](l,l.exports,n),l.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a=n(315),l=n(61);function r(e,t){return new Promise((o,n)=>{if(t&&window[t])return void o();const a=document.createElement('script');a.src=e,a.async=!1,a.onload=()=>o(),a.onerror=()=>n(new Error(`Failed to load script: ${e}`)),document.head.appendChild(a)})}window.PIXI=a,$(()=>{(async function(){try{void 0===window.Live2D?(console.info('[Live2D] å¼€å§‹åŠ è½½ Cubism 2.1 è¿è¡Œæ—¶...'),await r('https://cdn.jsdelivr.net/gh/dylanNew/live2d/webgl/Live2D/lib/live2d.min.js','Live2D'),console.info('[Live2D] Cubism 2.1 è¿è¡Œæ—¶åŠ è½½æˆåŠŸ')):console.info('[Live2D] Cubism 2.1 è¿è¡Œæ—¶å·²ä» HTML é¢„åŠ è½½'),void 0===window.Live2DCubismCore?(console.info('[Live2D] å¼€å§‹åŠ è½½ Cubism 4 è¿è¡Œæ—¶...'),await r('https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js','Live2DCubismCore'),console.info('[Live2D] Cubism 4 è¿è¡Œæ—¶åŠ è½½æˆåŠŸ')):console.info('[Live2D] Cubism 4 è¿è¡Œæ—¶å·²ä» HTML é¢„åŠ è½½'),console.info('[Live2D] æ‰€æœ‰è¿è¡Œæ—¶å·²å°±ç»ªï¼Œæ”¯æŒ Cubism 2/3/4 æ¨¡å‹')}catch(e){throw console.error('[Live2D] è¿è¡Œæ—¶åŠ è½½å¤±è´¥:',e),e}})().then(async()=>{const{default:e}=await Promise.resolve().then(n.bind(n,407));(0,l.createApp)(e).mount('#app'),console.info('[åº”ç”¨] Vue åº”ç”¨å·²æŒ‚è½½')}).catch(e=>{console.error('[åº”ç”¨] å¯åŠ¨å¤±è´¥:',e),toastr.error('åº”ç”¨å¯åŠ¨å¤±è´¥ï¼šLive2D è¿è¡Œæ—¶åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•')})});
//# sourceMappingURL=index.js.map</script><style>@import url(https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;500;700&family=Zen+Maru+Gothic:wght@400;700&display=swap);
/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */@layer properties;@layer theme,base,components,utilities;@layer theme{:root,:host{--font-sans:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--color-red-500:oklch(63.7% 0.237 25.331);--color-gray-200:oklch(92.8% 0.006 264.531);--color-black:#000;--color-white:#fff;--spacing:0.25rem;--container-md:28rem;--container-lg:32rem;--container-2xl:42rem;--container-3xl:48rem;--container-4xl:56rem;--text-xs:0.75rem;--text-xs--line-height:calc(1 / 0.75);--text-sm:0.875rem;--text-sm--line-height:calc(1.25 / 0.875);--text-base:1rem;--text-base--line-height:calc(1.5 / 1);--text-lg:1.125rem;--text-lg--line-height:calc(1.75 / 1.125);--text-xl:1.25rem;--text-xl--line-height:calc(1.75 / 1.25);--text-2xl:1.5rem;--text-2xl--line-height:calc(2 / 1.5);--font-weight-medium:500;--font-weight-semibold:600;--font-weight-bold:700;--leading-relaxed:1.625;--radius-2xl:1rem;--drop-shadow-2xl:0 25px 25px rgb(0 0 0/0.15);--ease-in-out:cubic-bezier(0.4,0,0.2,1);--animate-pulse:pulse 2s cubic-bezier(0.4,0,0.6,1) infinite;--blur-sm:8px;--blur-md:12px;--default-transition-duration:150ms;--default-transition-timing-function:cubic-bezier(0.4,0,0.2,1);--default-font-family:var(--font-sans);--default-mono-font-family:var(--font-mono)}}@layer base{*,::after,::before,::backdrop,::file-selector-button{box-sizing:border-box;margin:0;padding:0;border:0 solid}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:var(--default-font-family,ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji");font-feature-settings:var(--default-font-feature-settings,normal);font-variation-settings:var(--default-font-variation-settings,normal);-webkit-tap-highlight-color:transparent}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:var(--default-mono-font-family,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace);font-feature-settings:var(--default-mono-font-feature-settings,normal);font-variation-settings:var(--default-mono-font-variation-settings,normal);font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}:-moz-focusring{outline:auto}progress{vertical-align:baseline}summary{display:list-item}ol,ul,menu{list-style:none}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}button,input,select,optgroup,textarea,::file-selector-button{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;border-radius:0;background-color:transparent;opacity:1}:where(select:is([multiple],[size])) optgroup{font-weight:bolder}:where(select:is([multiple],[size])) optgroup option{padding-inline-start:20px}::file-selector-button{margin-inline-end:4px}::placeholder{opacity:1}@supports (not (-webkit-appearance:-apple-pay-button)) or (contain-intrinsic-size:1px){::placeholder{color:currentcolor;@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,currentcolor 50%,transparent)}}}textarea{resize:vertical}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-date-and-time-value{min-height:1lh;text-align:inherit}::-webkit-datetime-edit{display:inline-flex}::-webkit-datetime-edit-fields-wrapper{padding:0}::-webkit-datetime-edit,::-webkit-datetime-edit-year-field,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute-field,::-webkit-datetime-edit-second-field,::-webkit-datetime-edit-millisecond-field,::-webkit-datetime-edit-meridiem-field{padding-block:0}::-webkit-calendar-picker-indicator{line-height:1}:-moz-ui-invalid{box-shadow:none}button,input:where([type="button"],[type="reset"],[type="submit"]),::file-selector-button{-webkit-appearance:button;appearance:button}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[hidden]:where(:not([hidden="until-found"])){display:none !important}}@layer utilities{.pointer-events-none{pointer-events:none}.visible{visibility:visible}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip-path:inset(50%);white-space:nowrap;border-width:0}.absolute{position:absolute}.fixed{position:fixed}.relative{position:relative}.static{position:static}.sticky{position:sticky}.inset-0{inset:calc(var(--spacing) * 0)}.inset-y-2{inset-block:calc(var(--spacing) * 2)}.top-0{top:calc(var(--spacing) * 0)}.top-1\/2{top:calc(1/2 * 100%)}.top-2{top:calc(var(--spacing) * 2)}.top-4{top:calc(var(--spacing) * 4)}.right-0{right:calc(var(--spacing) * 0)}.right-1{right:calc(var(--spacing) * 1)}.right-2{right:calc(var(--spacing) * 2)}.right-3{right:calc(var(--spacing) * 3)}.right-4{right:calc(var(--spacing) * 4)}.right-6{right:calc(var(--spacing) * 6)}.bottom-0{bottom:calc(var(--spacing) * 0)}.bottom-1\.5{bottom:calc(var(--spacing) * 1.5)}.bottom-3{bottom:calc(var(--spacing) * 3)}.left-0{left:calc(var(--spacing) * 0)}.left-1{left:calc(var(--spacing) * 1)}.left-2{left:calc(var(--spacing) * 2)}.left-3{left:calc(var(--spacing) * 3)}.left-4{left:calc(var(--spacing) * 4)}.left-6{left:calc(var(--spacing) * 6)}.z-5{z-index:5}.z-10{z-index:10}.z-20{z-index:20}.z-25{z-index:25}.z-30{z-index:30}.z-40{z-index:40}.z-50{z-index:50}.container{width:100%;@media (width >= 40rem){max-width:40rem}@media (width >= 48rem){max-width:48rem}@media (width >= 64rem){max-width:64rem}@media (width >= 80rem){max-width:80rem}@media (width >= 96rem){max-width:96rem}}.mx-4{margin-inline:calc(var(--spacing) * 4)}.mx-auto{margin-inline:auto}.mt-4{margin-top:calc(var(--spacing) * 4)}.mb-1{margin-bottom:calc(var(--spacing) * 1)}.mb-2{margin-bottom:calc(var(--spacing) * 2)}.mb-3{margin-bottom:calc(var(--spacing) * 3)}.mb-4{margin-bottom:calc(var(--spacing) * 4)}.ml-6{margin-left:calc(var(--spacing) * 6)}.ml-auto{margin-left:auto}.block{display:block}.contents{display:contents}.flex{display:flex}.grid{display:grid}.hidden{display:none}.inline{display:inline}.inline-block{display:inline-block}.inline-flex{display:inline-flex}.h-1{height:calc(var(--spacing) * 1)}.h-1\.5{height:calc(var(--spacing) * 1.5)}.h-2{height:calc(var(--spacing) * 2)}.h-3{height:calc(var(--spacing) * 3)}.h-4{height:calc(var(--spacing) * 4)}.h-5{height:calc(var(--spacing) * 5)}.h-6{height:calc(var(--spacing) * 6)}.h-7{height:calc(var(--spacing) * 7)}.h-8{height:calc(var(--spacing) * 8)}.h-9{height:calc(var(--spacing) * 9)}.h-\[1\.15rem\]{height:1.15rem}.h-\[70vh\]{height:70vh}.h-\[calc\(100\%-1px\)\]{height:calc(100% - 1px)}.h-px{height:1px}.max-h-\[85vh\]{max-height:85vh}.max-h-\[calc\(85vh-100px\)\]{max-height:calc(85vh - 100px)}.max-h-\[calc\(85vh-120px\)\]{max-height:calc(85vh - 120px)}.min-h-\[60px\]{min-height:60px}.min-h-\[120px\]{min-height:120px}.w-1{width:calc(var(--spacing) * 1)}.w-1\.5{width:calc(var(--spacing) * 1.5)}.w-2{width:calc(var(--spacing) * 2)}.w-2\/3{width:calc(2/3 * 100%)}.w-3{width:calc(var(--spacing) * 3)}.w-4{width:calc(var(--spacing) * 4)}.w-5{width:calc(var(--spacing) * 5)}.w-6{width:calc(var(--spacing) * 6)}.w-8{width:calc(var(--spacing) * 8)}.w-9{width:calc(var(--spacing) * 9)}.w-20{width:calc(var(--spacing) * 20)}.w-\[90\%\]{width:90%}.w-auto{width:auto}.w-full{width:100%}.max-w-2xl{max-width:var(--container-2xl)}.max-w-3xl{max-width:var(--container-3xl)}.max-w-4xl{max-width:var(--container-4xl)}.max-w-lg{max-width:var(--container-lg)}.max-w-md{max-width:var(--container-md)}.flex-1{flex:1}.flex-shrink{flex-shrink:1}.flex-shrink-0{flex-shrink:0}.-translate-y-1\/2{--tw-translate-y:calc(calc(1/2 * 100%) * -1);translate:var(--tw-translate-x) var(--tw-translate-y)}.transform{transform:var(--tw-rotate-x,) var(--tw-rotate-y,) var(--tw-rotate-z,) var(--tw-skew-x,) var(--tw-skew-y,)}.animate-pulse{animation:var(--animate-pulse)}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.touch-none{touch-action:none}.resize{resize:both}.resize-none{resize:none}.grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.grid-cols-6{grid-template-columns:repeat(6,minmax(0,1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.items-end{align-items:flex-end}.items-start{align-items:flex-start}.justify-between{justify-content:space-between}.justify-center{justify-content:center}.justify-end{justify-content:flex-end}.justify-start{justify-content:flex-start}.gap-0\.5{gap:calc(var(--spacing) * 0.5)}.gap-1{gap:calc(var(--spacing) * 1)}.gap-1\.5{gap:calc(var(--spacing) * 1.5)}.gap-2{gap:calc(var(--spacing) * 2)}.gap-3{gap:calc(var(--spacing) * 3)}.space-y-1\.5{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 1.5) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 1.5) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-2{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 2) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 2) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-3{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 3) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 3) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-4{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 4) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 4) * calc(1 - var(--tw-space-y-reverse)))}}.space-y-6{:where(&>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing) * 6) * var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing) * 6) * calc(1 - var(--tw-space-y-reverse)))}}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.rounded{border-radius:0.25rem}.rounded-2xl{border-radius:var(--radius-2xl)}.rounded-full{border-radius:calc(infinity * 1px)}.rounded-lg{border-radius:var(--radius)}.rounded-md{border-radius:calc(var(--radius) - 2px)}.rounded-xl{border-radius:calc(var(--radius) + 4px)}.border{border-style:var(--tw-border-style);border-width:1px}.border-2{border-style:var(--tw-border-style);border-width:2px}.border-b{border-bottom-style:var(--tw-border-style);border-bottom-width:1px}.border-border{border-color:oklch(0.85 0.04 145)}.border-border\/30{border-color:color-mix(in oklab,oklch(0.85 0.04 145) 30%,transparent)}.border-gray-200{border-color:var(--color-gray-200)}.border-input{border-color:oklch(0.9 0.03 145)}.border-primary{border-color:oklch(0.55 0.15 145)}.border-transparent{border-color:transparent}.border-white{border-color:var(--color-white)}.bg-background{background-color:oklch(0.97 0.02 145)}.bg-black{background-color:var(--color-black)}.bg-black\/30{background-color:color-mix(in srgb,#000 30%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 30%,transparent)}}.bg-black\/40{background-color:color-mix(in srgb,#000 40%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 40%,transparent)}}.bg-black\/50{background-color:color-mix(in srgb,#000 50%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 50%,transparent)}}.bg-border\/30{background-color:color-mix(in oklab,oklch(0.85 0.04 145) 30%,transparent)}.bg-card{background-color:oklch(0.99 0.01 145)}.bg-card\/80{background-color:color-mix(in oklab,oklch(0.99 0.01 145) 80%,transparent)}.bg-card\/95{background-color:color-mix(in oklab,oklch(0.99 0.01 145) 95%,transparent)}.bg-input{background-color:oklch(0.9 0.03 145)}.bg-muted{background-color:oklch(0.94 0.02 145)}.bg-muted\/30{background-color:color-mix(in oklab,oklch(0.94 0.02 145) 30%,transparent)}.bg-primary{background-color:oklch(0.55 0.15 145)}.bg-primary\/5{background-color:color-mix(in oklab,oklch(0.55 0.15 145) 5%,transparent)}.bg-primary\/10{background-color:color-mix(in oklab,oklch(0.55 0.15 145) 10%,transparent)}.bg-transparent{background-color:transparent}.bg-cover{background-size:cover}.bg-center{background-position:center}.bg-no-repeat{background-repeat:no-repeat}.object-contain{object-fit:contain}.p-1{padding:calc(var(--spacing) * 1)}.p-2{padding:calc(var(--spacing) * 2)}.p-3{padding:calc(var(--spacing) * 3)}.p-4{padding:calc(var(--spacing) * 4)}.p-6{padding:calc(var(--spacing) * 6)}.p-\[3px\]{padding:3px}.px-2{padding-inline:calc(var(--spacing) * 2)}.px-3{padding-inline:calc(var(--spacing) * 3)}.px-4{padding-inline:calc(var(--spacing) * 4)}.px-6{padding-inline:calc(var(--spacing) * 6)}.px-8{padding-inline:calc(var(--spacing) * 8)}.py-0\.5{padding-block:calc(var(--spacing) * 0.5)}.py-1{padding-block:calc(var(--spacing) * 1)}.py-2{padding-block:calc(var(--spacing) * 2)}.py-3{padding-block:calc(var(--spacing) * 3)}.py-4{padding-block:calc(var(--spacing) * 4)}.py-12{padding-block:calc(var(--spacing) * 12)}.pr-4{padding-right:calc(var(--spacing) * 4)}.pb-4{padding-bottom:calc(var(--spacing) * 4)}.text-center{text-align:center}.text-left{text-align:left}.text-right{text-align:right}.font-mono{font-family:var(--font-mono)}.text-base{font-size:var(--text-base);line-height:var(--tw-leading,var(--text-base--line-height))}.text-lg{font-size:var(--text-lg);line-height:var(--tw-leading,var(--text-lg--line-height))}.text-sm{font-size:var(--text-sm);line-height:var(--tw-leading,var(--text-sm--line-height))}.text-xl{font-size:var(--text-xl);line-height:var(--tw-leading,var(--text-xl--line-height))}.text-xs{font-size:var(--text-xs);line-height:var(--tw-leading,var(--text-xs--line-height))}.text-\[10px\]{font-size:10px}.leading-relaxed{--tw-leading:var(--leading-relaxed);line-height:var(--leading-relaxed)}.font-bold{--tw-font-weight:var(--font-weight-bold);font-weight:var(--font-weight-bold)}.font-medium{--tw-font-weight:var(--font-weight-medium);font-weight:var(--font-weight-medium)}.font-semibold{--tw-font-weight:var(--font-weight-semibold);font-weight:var(--font-weight-semibold)}.whitespace-nowrap{white-space:nowrap}.text-foreground{color:oklch(0.25 0.05 145)}.text-muted-foreground{color:oklch(0.5 0.05 145)}.text-primary{color:oklch(0.55 0.15 145)}.text-primary-foreground{color:oklch(0.99 0.01 145)}.text-red-500{color:var(--color-red-500)}.text-white{color:var(--color-white)}.text-white\/40{color:color-mix(in srgb,#fff 40%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-white) 40%,transparent)}}.italic{font-style:italic}.underline{text-decoration-line:underline}.opacity-0{opacity:0%}.opacity-40{opacity:40%}.opacity-50{opacity:50%}.opacity-70{opacity:70%}.opacity-100{opacity:100%}.shadow{--tw-shadow:0 1px 3px 0 var(--tw-shadow-color,rgb(0 0 0/0.1)),0 1px 2px -1px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-2xl{--tw-shadow:0 25px 50px -12px var(--tw-shadow-color,rgb(0 0 0/0.25));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 4px 6px -4px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 2px 4px -2px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 3px 0 var(--tw-shadow-color,rgb(0 0 0/0.1)),0 1px 2px -1px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px var(--tw-shadow-color,rgb(0 0 0/0.1)),0 8px 10px -6px var(--tw-shadow-color,rgb(0 0 0/0.1));box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring-2{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.ring-primary{--tw-ring-color:oklch(0.55 0.15 145)}.outline{outline-style:var(--tw-outline-style);outline-width:1px}.blur{--tw-blur:blur(8px);filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.drop-shadow-2xl{--tw-drop-shadow-size:drop-shadow(0 25px 25px var(--tw-drop-shadow-color,rgb(0 0 0/0.15)));--tw-drop-shadow:drop-shadow(var(--drop-shadow-2xl));filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.filter{filter:var(--tw-blur,) var(--tw-brightness,) var(--tw-contrast,) var(--tw-grayscale,) var(--tw-hue-rotate,) var(--tw-invert,) var(--tw-saturate,) var(--tw-sepia,) var(--tw-drop-shadow,)}.backdrop-blur-md{--tw-backdrop-blur:blur(var(--blur-md));backdrop-filter:var(--tw-backdrop-blur,) var(--tw-backdrop-brightness,) var(--tw-backdrop-contrast,) var(--tw-backdrop-grayscale,) var(--tw-backdrop-hue-rotate,) var(--tw-backdrop-invert,) var(--tw-backdrop-opacity,) var(--tw-backdrop-saturate,) var(--tw-backdrop-sepia,)}.backdrop-blur-sm{--tw-backdrop-blur:blur(var(--blur-sm));backdrop-filter:var(--tw-backdrop-blur,) var(--tw-backdrop-brightness,) var(--tw-backdrop-contrast,) var(--tw-backdrop-grayscale,) var(--tw-backdrop-hue-rotate,) var(--tw-backdrop-invert,) var(--tw-backdrop-opacity,) var(--tw-backdrop-saturate,) var(--tw-backdrop-sepia,)}.backdrop-filter{backdrop-filter:var(--tw-backdrop-blur,) var(--tw-backdrop-brightness,) var(--tw-backdrop-contrast,) var(--tw-backdrop-grayscale,) var(--tw-backdrop-hue-rotate,) var(--tw-backdrop-invert,) var(--tw-backdrop-opacity,) var(--tw-backdrop-saturate,) var(--tw-backdrop-sepia,)}.transition{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to,opacity,box-shadow,transform,translate,scale,rotate,filter,backdrop-filter,display,content-visibility,overlay,pointer-events;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-all{transition-property:all;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-colors{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-opacity{transition-property:opacity;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-transform{transition-property:transform,translate,scale,rotate;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.duration-200{--tw-duration:200ms;transition-duration:200ms}.duration-300{--tw-duration:300ms;transition-duration:300ms}.duration-500{--tw-duration:500ms;transition-duration:500ms}.duration-1000{--tw-duration:1000ms;transition-duration:1000ms}.ease-in-out{--tw-ease:var(--ease-in-out);transition-timing-function:var(--ease-in-out)}.outline-none{--tw-outline-style:none;outline-style:none}.select-none{-webkit-user-select:none;user-select:none}.group-hover\:opacity-100{&:is(:where(.group):hover *){@media (hover:hover){opacity:100%}}}.peer-checked\:translate-x-\[calc\(100\%-2px\)\]{&:is(:where(.peer):checked~*){--tw-translate-x:calc(100% - 2px);translate:var(--tw-translate-x) var(--tw-translate-y)}}.peer-checked\:bg-primary{&:is(:where(.peer):checked~*){background-color:oklch(0.55 0.15 145)}}.placeholder\:text-muted-foreground{&::placeholder{color:oklch(0.5 0.05 145)}}.hover\:scale-105{&:hover{@media (hover:hover){--tw-scale-x:105%;--tw-scale-y:105%;--tw-scale-z:105%;scale:var(--tw-scale-x) var(--tw-scale-y)}}}.hover\:scale-110{&:hover{@media (hover:hover){--tw-scale-x:110%;--tw-scale-y:110%;--tw-scale-z:110%;scale:var(--tw-scale-x) var(--tw-scale-y)}}}.hover\:scale-\[1\.02\]{&:hover{@media (hover:hover){scale:1.02}}}.hover\:border-primary\/50{&:hover{@media (hover:hover){border-color:color-mix(in oklab,oklch(0.55 0.15 145) 50%,transparent)}}}.hover\:bg-black\/5{&:hover{@media (hover:hover){background-color:color-mix(in srgb,#000 5%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 5%,transparent)}}}}.hover\:bg-black\/10{&:hover{@media (hover:hover){background-color:color-mix(in srgb,#000 10%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-black) 10%,transparent)}}}}.hover\:bg-card{&:hover{@media (hover:hover){background-color:oklch(0.99 0.01 145)}}}.hover\:bg-muted{&:hover{@media (hover:hover){background-color:oklch(0.94 0.02 145)}}}.hover\:bg-primary\/90{&:hover{@media (hover:hover){background-color:color-mix(in oklab,oklch(0.55 0.15 145) 90%,transparent)}}}.hover\:bg-red-500\/20{&:hover{@media (hover:hover){background-color:color-mix(in srgb,oklch(63.7% 0.237 25.331) 20%,transparent);@supports (color:color-mix(in lab,red,red)){background-color:color-mix(in oklab,var(--color-red-500) 20%,transparent)}}}}.hover\:text-foreground{&:hover{@media (hover:hover){color:oklch(0.25 0.05 145)}}}.hover\:text-white\/60{&:hover{@media (hover:hover){color:color-mix(in srgb,#fff 60%,transparent);@supports (color:color-mix(in lab,red,red)){color:color-mix(in oklab,var(--color-white) 60%,transparent)}}}}.hover\:opacity-80{&:hover{@media (hover:hover){opacity:80%}}}.focus\:border-primary{&:focus{border-color:oklch(0.55 0.15 145)}}.focus\:ring-1{&:focus{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.focus\:ring-2{&:focus{--tw-ring-shadow:var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color,currentcolor);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}}.focus\:ring-primary{&:focus{--tw-ring-color:oklch(0.55 0.15 145)}}.focus\:outline-none{&:focus{--tw-outline-style:none;outline-style:none}}.active\:scale-\[0\.98\]{&:active{scale:0.98}}.md\:gap-4{@media (width >= 48rem){gap:calc(var(--spacing) * 4)}}.md\:p-5{@media (width >= 48rem){padding:calc(var(--spacing) * 5)}}.md\:px-8{@media (width >= 48rem){padding-inline:calc(var(--spacing) * 8)}}.md\:pb-6{@media (width >= 48rem){padding-bottom:calc(var(--spacing) * 6)}}.md\:text-2xl{@media (width >= 48rem){font-size:var(--text-2xl);line-height:var(--tw-leading,var(--text-2xl--line-height))}}}html,body{width:100%;margin:0;padding:0;overflow:hidden;background:transparent}#app{width:100%;aspect-ratio:16/9;margin:0 auto;position:relative;background:transparent;overflow:hidden}@layer base{*{border-color:oklch(0.85 0.04 145);outline-color:color-mix(in oklab,oklch(0.55 0.15 145) 50%,transparent)}body{background-color:oklch(0.97 0.02 145);color:oklch(0.25 0.05 145)}}:root{--background:oklch(0.97 0.02 145);--foreground:oklch(0.25 0.05 145);--card:oklch(0.99 0.01 145);--card-foreground:oklch(0.25 0.05 145);--popover:oklch(0.99 0.01 145);--popover-foreground:oklch(0.25 0.05 145);--primary:oklch(0.55 0.15 145);--primary-foreground:oklch(0.99 0.01 145);--secondary:oklch(0.92 0.03 145);--secondary-foreground:oklch(0.35 0.08 145);--muted:oklch(0.94 0.02 145);--muted-foreground:oklch(0.5 0.05 145);--accent:oklch(0.75 0.12 90);--accent-foreground:oklch(0.25 0.05 145);--destructive:oklch(0.577 0.245 27.325);--destructive-foreground:oklch(0.577 0.245 27.325);--border:oklch(0.85 0.04 145);--input:oklch(0.9 0.03 145);--ring:oklch(0.55 0.15 145)}.dark{--background:oklch(0.145 0 0);--foreground:oklch(0.985 0 0);--card:oklch(0.145 0 0);--card-foreground:oklch(0.985 0 0);--popover:oklch(0.145 0 0);--popover-foreground:oklch(0.985 0 0);--primary:oklch(0.985 0 0);--primary-foreground:oklch(0.205 0 0);--secondary:oklch(0.269 0 0);--secondary-foreground:oklch(0.985 0 0);--muted:oklch(0.269 0 0);--muted-foreground:oklch(0.708 0 0);--accent:oklch(0.269 0 0);--accent-foreground:oklch(0.985 0 0);--destructive:oklch(0.396 0.141 25.723);--destructive-foreground:oklch(0.637 0.237 25.331);--border:oklch(0.269 0 0);--input:oklch(0.269 0 0);--ring:oklch(0.439 0 0)}*{border-color:var(--border)}body{background-color:var(--background);color:var(--foreground)}@keyframes fade-in{from{opacity:0}to{opacity:1}}@keyframes slide-in-from-left-2{from{transform:translateX(-8px);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes slide-in-from-top-2{from{transform:translateY(-8px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes slide-in-from-bottom-2{from{transform:translateY(8px);opacity:0}to{transform:translateY(0);opacity:1}}.animate-in{animation-duration:0.3s;animation-timing-function:ease-out;animation-fill-mode:both}.fade-in{animation-name:fade-in}.slide-in-from-left-2{animation-name:slide-in-from-left-2}.slide-in-from-top-2{animation-name:slide-in-from-top-2}.slide-in-from-bottom-2{animation-name:slide-in-from-bottom-2}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}@property --tw-rotate-x{syntax:"*";inherits:false}@property --tw-rotate-y{syntax:"*";inherits:false}@property --tw-rotate-z{syntax:"*";inherits:false}@property --tw-skew-x{syntax:"*";inherits:false}@property --tw-skew-y{syntax:"*";inherits:false}@property --tw-space-y-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-leading{syntax:"*";inherits:false}@property --tw-font-weight{syntax:"*";inherits:false}@property --tw-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-shadow-color{syntax:"*";inherits:false}@property --tw-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-inset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-shadow-color{syntax:"*";inherits:false}@property --tw-inset-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-ring-color{syntax:"*";inherits:false}@property --tw-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-ring-color{syntax:"*";inherits:false}@property --tw-inset-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-ring-inset{syntax:"*";inherits:false}@property --tw-ring-offset-width{syntax:"<length>";inherits:false;initial-value:0px}@property --tw-ring-offset-color{syntax:"*";inherits:false;initial-value:#fff}@property --tw-ring-offset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-outline-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-blur{syntax:"*";inherits:false}@property --tw-brightness{syntax:"*";inherits:false}@property --tw-contrast{syntax:"*";inherits:false}@property --tw-grayscale{syntax:"*";inherits:false}@property --tw-hue-rotate{syntax:"*";inherits:false}@property --tw-invert{syntax:"*";inherits:false}@property --tw-opacity{syntax:"*";inherits:false}@property --tw-saturate{syntax:"*";inherits:false}@property --tw-sepia{syntax:"*";inherits:false}@property --tw-drop-shadow{syntax:"*";inherits:false}@property --tw-drop-shadow-color{syntax:"*";inherits:false}@property --tw-drop-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-drop-shadow-size{syntax:"*";inherits:false}@property --tw-backdrop-blur{syntax:"*";inherits:false}@property --tw-backdrop-brightness{syntax:"*";inherits:false}@property --tw-backdrop-contrast{syntax:"*";inherits:false}@property --tw-backdrop-grayscale{syntax:"*";inherits:false}@property --tw-backdrop-hue-rotate{syntax:"*";inherits:false}@property --tw-backdrop-invert{syntax:"*";inherits:false}@property --tw-backdrop-opacity{syntax:"*";inherits:false}@property --tw-backdrop-saturate{syntax:"*";inherits:false}@property --tw-backdrop-sepia{syntax:"*";inherits:false}@property --tw-duration{syntax:"*";inherits:false}@property --tw-ease{syntax:"*";inherits:false}@property --tw-scale-x{syntax:"*";inherits:false;initial-value:1}@property --tw-scale-y{syntax:"*";inherits:false;initial-value:1}@property --tw-scale-z{syntax:"*";inherits:false;initial-value:1}@keyframes pulse{50%{opacity:0.5}}@layer properties{@supports ((-webkit-hyphens:none) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,::before,::after,::backdrop{--tw-translate-x:0;--tw-translate-y:0;--tw-translate-z:0;--tw-rotate-x:initial;--tw-rotate-y:initial;--tw-rotate-z:initial;--tw-skew-x:initial;--tw-skew-y:initial;--tw-space-y-reverse:0;--tw-border-style:solid;--tw-leading:initial;--tw-font-weight:initial;--tw-shadow:0 0 #0000;--tw-shadow-color:initial;--tw-shadow-alpha:100%;--tw-inset-shadow:0 0 #0000;--tw-inset-shadow-color:initial;--tw-inset-shadow-alpha:100%;--tw-ring-color:initial;--tw-ring-shadow:0 0 #0000;--tw-inset-ring-color:initial;--tw-inset-ring-shadow:0 0 #0000;--tw-ring-inset:initial;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-offset-shadow:0 0 #0000;--tw-outline-style:solid;--tw-blur:initial;--tw-brightness:initial;--tw-contrast:initial;--tw-grayscale:initial;--tw-hue-rotate:initial;--tw-invert:initial;--tw-opacity:initial;--tw-saturate:initial;--tw-sepia:initial;--tw-drop-shadow:initial;--tw-drop-shadow-color:initial;--tw-drop-shadow-alpha:100%;--tw-drop-shadow-size:initial;--tw-backdrop-blur:initial;--tw-backdrop-brightness:initial;--tw-backdrop-contrast:initial;--tw-backdrop-grayscale:initial;--tw-backdrop-hue-rotate:initial;--tw-backdrop-invert:initial;--tw-backdrop-opacity:initial;--tw-backdrop-saturate:initial;--tw-backdrop-sepia:initial;--tw-duration:initial;--tw-ease:initial;--tw-scale-x:1;--tw-scale-y:1;--tw-scale-z:1}}}

.live2d-canvas[data-v-00af568a]{width:100%;height:70vh;min-height:400px;display:block}

.status-container-wrapper[data-v-330f15ce]{width:90%;max-width:32rem;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;font-size:14px}.status-container[data-v-330f15ce]{background:linear-gradient(rgba(255,255,255,0.3),rgba(255,255,255,0.3)),url('https://pic.imgdd.cc/item/691e765bc828c4c6def97018.jpg') center center /cover no-repeat;background-color:#f4f8f2;border:1px solid #d1e5d9;border-radius:16px;overflow:hidden;box-shadow:0 4px 12px rgba(168,216,195,0.2);transition:all 0.3s ease-in-out;max-height:85vh;overflow-y:auto;scrollbar-width:none;-ms-overflow-style:none}.status-container[data-v-330f15ce]::-webkit-scrollbar{display:none}.status-header[data-v-330f15ce]{display:flex;align-items:center;padding:12px 20px;color:#5a6e65;font-weight:600;background-color:rgba(231,244,238,0.87);border-bottom:1px solid #d1e5d9;position:relative}.summary-icon[data-v-330f15ce]{margin-right:10px;font-size:1.2em;color:#a8d8c3}.status-title[data-v-330f15ce]{flex:1}.status-close[data-v-330f15ce]{background:transparent;border:none;color:#5a6e65;cursor:pointer;padding:4px;display:flex;align-items:center;justify-content:center;transition:opacity 0.2s;opacity:0.7}.status-close[data-v-330f15ce]:hover{opacity:1}.status-main-content[data-v-330f15ce]{padding:20px;display:flex;flex-direction:column;gap:16px}.status-info-bar[data-v-330f15ce]{display:flex;justify-content:space-between;background:rgba(224,242,233,0.8);padding:10px 15px;border-radius:10px;color:#5a6e65}.info-item[data-v-330f15ce]{display:flex;align-items:center;gap:8px}.status-values-grid[data-v-330f15ce]{display:grid;grid-template-columns:1fr 1fr;gap:12px}.value-card[data-v-330f15ce]{background:rgba(255,255,255,0.85);padding:12px;border-radius:8px;border:1px solid #d1e5d9;text-align:center}.value-name[data-v-330f15ce]{font-weight:600;color:#5a6e65}.value-number[data-v-330f15ce]{font-size:1.5em;color:#a8d8c3;font-weight:bold}.status-text-card[data-v-330f15ce]{background:rgba(255,255,255,0.85);padding:15px;border-radius:10px;border:1px solid #d1e5d9}.text-card-row[data-v-330f15ce]{margin-bottom:8px}.text-card-row[data-v-330f15ce]:last-child{margin-bottom:0}.text-card-label[data-v-330f15ce]{font-weight:600;color:#5a6e65;margin-right:8px;display:inline-block;background-color:rgba(224,242,233,0.9);padding:2px 8px;border-radius:12px}.text-card-content[data-v-330f15ce]{color:#788a82;white-space:pre-wrap}@media (max-width:600px){.status-info-bar[data-v-330f15ce]{flex-direction:column;gap:8px;align-items:flex-start}}

@keyframes pulse-7ebdc071{0%,100%{opacity:1}50%{opacity:0.5}}@keyframes diamondPulse-7ebdc071{0%,100%{opacity:1;transform:rotate(45deg) scale(1)}50%{opacity:0.6;transform:rotate(45deg) scale(0.8)}}@keyframes ping-7ebdc071{75%,100%{transform:scale(2);opacity:0}}@keyframes arrowBounce-7ebdc071{0%,100%{transform:translateX(0)}50%{transform:translateX(3px)}}

.note-card[data-v-68f5f8e2]{position:relative;width:100%;max-width:280px;aspect-ratio:1;background:white;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);overflow:hidden;-webkit-user-select:none;user-select:none;transition:box-shadow 0.2s}.note-card[data-v-68f5f8e2]:hover{box-shadow:0 6px 16px rgba(0,0,0,0.15)}.note-close-btn[data-v-68f5f8e2]{position:absolute;top:8px;right:8px;z-index:20;width:24px;height:24px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.9);border:1px solid rgba(16,185,129,0.2);border-radius:50%;color:#10b981;cursor:pointer;transition:all 0.2s;opacity:0.7}.note-close-btn[data-v-68f5f8e2]:hover{opacity:1;background:rgba(255,255,255,1);border-color:rgba(16,185,129,0.4);transform:scale(1.1)}.note-border[data-v-68f5f8e2]{position:absolute;inset:0;border:2px solid rgba(16,185,129,0.15);border-radius:12px;pointer-events:none}.note-dots[data-v-68f5f8e2]{position:absolute;top:12px;left:0;right:0;display:flex;justify-content:center;gap:8px;pointer-events:none;z-index:10}.note-dot[data-v-68f5f8e2]{width:6px;height:6px;border-radius:50%;background:rgba(16,185,129,0.3)}.note-lines[data-v-68f5f8e2]{position:absolute;inset:0;pointer-events:none;margin-top:48px;z-index:1}.note-line[data-v-68f5f8e2]{height:32px;border-bottom:1px solid rgba(16,185,129,0.08)}.note-binding[data-v-68f5f8e2]{position:absolute;left:16px;top:0;bottom:0;width:1px;background:linear-gradient(to bottom,transparent,rgba(16,185,129,0.2) 20%,rgba(16,185,129,0.2) 80%,transparent);pointer-events:none;z-index:2}.note-content[data-v-68f5f8e2]{position:relative;z-index:10;height:100%;padding:48px 24px 24px;overflow-y:auto}.note-content[data-v-68f5f8e2]::-webkit-scrollbar{width:4px}.note-content[data-v-68f5f8e2]::-webkit-scrollbar-thumb{background:rgba(16,185,129,0.2);border-radius:2px}.note-text[data-v-68f5f8e2]{font-size:14px;line-height:1.6;color:#374151;white-space:pre-wrap;word-break:break-word}.note-flower[data-v-68f5f8e2]{position:absolute;bottom:12px;right:12px;pointer-events:none;z-index:5;color:rgba(16,185,129,0.25)}

.theater-window[data-v-eef7e62c]{width:90%;max-width:28rem;max-height:85vh;background:linear-gradient(to bottom,#fafffe 0%,#f0fdf4 100%);border:2px solid rgba(129,199,132,0.3);border-radius:16px;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(76,175,80,0.15);overflow:hidden}.theater-window-fullscreen[data-v-eef7e62c]{width:90%;max-width:32rem;max-height:none;aspect-ratio:32/23}.title-bar[data-v-eef7e62c]{height:32px;background:linear-gradient(to right,#81c784 0%,#a5d6a7 100%);display:flex;align-items:center;justify-content:space-between;padding:0 12px;color:#ffffff;font-weight:500;font-size:13px;letter-spacing:2px;-webkit-user-select:none;user-select:none;flex-shrink:0;font-family:'Zen Maru Gothic',sans-serif;box-shadow:0 2px 8px rgba(76,175,80,0.15)}.title-group[data-v-eef7e62c]{display:flex;align-items:center;gap:8px}.icon-charm[data-v-eef7e62c]{width:12px;height:12px;background:#ffffff;border-radius:50%;box-shadow:0 0 0 2px #66bb6a inset}.win-controls[data-v-eef7e62c]{display:flex;gap:6px}.win-btn[data-v-eef7e62c]{width:20px;height:20px;border-radius:50%;cursor:pointer;border:1px solid rgba(255,255,255,0.4);transition:all 0.2s;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.8);color:#4caf50;padding:0}.win-btn[data-v-eef7e62c]:hover{transform:scale(1.1);filter:brightness(1.1);box-shadow:0 2px 4px rgba(76,175,80,0.2)}.win-btn .icon[data-v-eef7e62c]{width:12px;height:12px}.menu-bar[data-v-eef7e62c]{height:32px;background:rgba(232,245,233,0.5);backdrop-filter:blur(10px);border-bottom:1px solid rgba(129,199,132,0.2);display:flex;align-items:center;padding:0 16px;gap:20px;font-size:14px;color:#4caf50;flex-shrink:0;font-family:'SimSun',serif}.menu-item[data-v-eef7e62c]{position:relative;transition:color 0.2s;cursor:pointer}.menu-item[data-v-eef7e62c]:hover{color:#2e7d32}.menu-item[data-v-eef7e62c]::after{content:'';position:absolute;bottom:-2px;left:0;width:0;height:2px;background:#66bb6a;transition:width 0.3s}.menu-item[data-v-eef7e62c]:hover::after{width:100%}.menu-item-badge[data-v-eef7e62c]{position:absolute;top:4px;right:4px;width:8px;height:8px;background:#f44336;border-radius:50%;border:1px solid rgba(255,255,255,0.8)}.contacts-sidebar[data-v-eef7e62c]{width:200px;background:rgba(255,255,255,0.5);backdrop-filter:blur(20px);border-right:1px solid rgba(129,199,132,0.3);display:flex;flex-direction:column;overflow:hidden}.contacts-header[data-v-eef7e62c]{padding:12px;border-bottom:1px solid rgba(129,199,132,0.2);font-size:13px;color:#4caf50;font-weight:500}.contacts-list[data-v-eef7e62c]{flex:1;overflow-y:auto;padding:8px}.contacts-list[data-v-eef7e62c]::-webkit-scrollbar{width:4px;background:transparent}.contacts-list[data-v-eef7e62c]::-webkit-scrollbar-thumb{background:rgba(129,199,132,0.3);border-radius:2px}.contact-item[data-v-eef7e62c]{display:flex;align-items:center;gap:10px;padding:10px;cursor:pointer;border-radius:8px;transition:all 0.2s;position:relative;margin-bottom:4px}.contact-item[data-v-eef7e62c]:hover{background:rgba(129,199,132,0.15)}.contact-item.active[data-v-eef7e62c]{background:rgba(129,199,132,0.25)}.contact-avatar[data-v-eef7e62c]{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#81c784,#66bb6a);display:flex;align-items:center;justify-content:center;color:white;font-size:14px;font-weight:500;flex-shrink:0;position:relative}.contact-info[data-v-eef7e62c]{flex:1;min-width:0}.contact-name[data-v-eef7e62c]{font-size:13px;color:#2e7d32;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.contact-badge[data-v-eef7e62c]{position:absolute;top:8px;right:8px;width:8px;height:8px;background:#f44336;border-radius:50%;display:none}.contact-item.has-unread .contact-badge[data-v-eef7e62c]{display:block}.avatar-unread-dot[data-v-eef7e62c]{position:absolute;top:0;right:0;width:10px;height:10px;background:#f44336;border-radius:50%;border:2px solid rgba(255,255,255,0.9);z-index:1}.chat-area[data-v-eef7e62c]{flex:1;display:flex;flex-direction:column;min-width:0}.panel-body[data-v-eef7e62c]{height:auto;max-height:400px}.display-wrapper[data-v-eef7e62c]{flex:1;border:1px solid rgba(165,214,167,0.3);margin:8px 8px 0 8px;position:relative;background:rgba(255,255,255,0.4);backdrop-filter:blur(20px);overflow:hidden;box-shadow:inset 0 0 30px rgba(76,175,80,0.05);border-radius:8px}.bg-image[data-v-eef7e62c]{position:absolute;top:0;left:0;width:100%;height:100%;background-image:url('https://files.catbox.moe/2td8l0.jpg');background-position:center center;background-repeat:no-repeat;background-size:contain;opacity:0.06;filter:sepia(0.2) hue-rotate(80deg) saturate(1.5) brightness(1.2);z-index:0;mix-blend-mode:multiply}.watermark-xi[data-v-eef7e62c]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:160px;color:#81c784;font-weight:normal;-webkit-user-select:none;user-select:none;pointer-events:none;opacity:0.04;z-index:1;font-family:'Songti SC',serif;writing-mode:vertical-rl;text-shadow:none;border:4px double #a5d6a7;padding:20px}.scroll-container[data-v-eef7e62c]{position:absolute;top:0;left:0;width:100%;height:100%;overflow-y:scroll;overflow-x:hidden;z-index:5;scroll-behavior:smooth}.scroll-container[data-v-eef7e62c]::-webkit-scrollbar{width:6px;background:transparent}.scroll-container[data-v-eef7e62c]::-webkit-scrollbar-thumb{background:rgba(129,199,132,0.3);border-radius:3px}.scroll-container[data-v-eef7e62c]::-webkit-scrollbar-thumb:hover{background:rgba(129,199,132,0.6)}.chat-log[data-v-eef7e62c]{display:flex;flex-direction:column;gap:24px;padding:30px 24px}.message-container[data-v-eef7e62c]{display:flex;flex-direction:column;margin-bottom:16px}.message-container.message-left[data-v-eef7e62c]{align-items:flex-start}.message-container.message-right[data-v-eef7e62c]{align-items:flex-end}.speaker-label[data-v-eef7e62c]{font-size:0.75em;color:#788a82;margin-bottom:4px;padding:0 8px}.timestamp[data-v-eef7e62c]{font-size:0.75em;color:#aaa;margin-top:4px;padding:0 8px}.bubble[data-v-eef7e62c]{max-width:80%;padding:10px 15px;border-radius:18px;position:relative;line-height:1.5;white-space:pre-wrap;word-break:break-all}.bubble-left[data-v-eef7e62c]{background-color:rgba(224,242,233,0.9);color:#5a6e65;border-bottom-left-radius:4px;align-self:flex-start}.bubble-right[data-v-eef7e62c]{background-color:rgba(255,255,255,0.85);color:#788a82;border:1px solid #d1e5d9;border-bottom-right-radius:4px;align-self:flex-end}.sub-text[data-v-eef7e62c]{font-family:'KaiTi','æ¥·ä½“',serif;font-size:0.9em;color:#66bb6a;margin:0 2px}.cursor[data-v-eef7e62c]{display:inline-block;width:6px;height:6px;background:#4caf50;border-radius:50%;animation:blink-eef7e62c 1s infinite;margin-left:4px;vertical-align:middle}.cmd-bar[data-v-eef7e62c]{height:48px;background:rgba(232,245,233,0.5);backdrop-filter:blur(10px);padding:8px 16px;display:flex;align-items:center;gap:10px;flex-shrink:0;border-top:1px solid rgba(165,214,167,0.3)}.cmd-input[data-v-eef7e62c]{flex:1;height:32px;background:rgba(255,255,255,0.7);border:1px solid rgba(129,199,132,0.3);border-radius:16px;font-family:'Noto Serif SC',sans-serif;font-size:14px;color:#2e7d32;padding:0 12px;outline:none;transition:all 0.3s}.cmd-input[data-v-eef7e62c]:focus{border-color:#66bb6a;background:rgba(255,255,255,0.9)}.cmd-input[data-v-eef7e62c]:disabled{opacity:0.6;cursor:not-allowed}.cmd-send-btn[data-v-eef7e62c]{padding:6px 16px;height:32px;background:rgba(129,199,132,0.8);border:1px solid rgba(129,199,132,0.5);border-radius:16px;color:white;font-size:13px;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;min-width:40px}.cmd-send-btn[data-v-eef7e62c]:hover:not(:disabled){background:rgba(129,199,132,1);transform:translateY(-1px);box-shadow:0 2px 8px rgba(76,175,80,0.3)}.cmd-send-btn[data-v-eef7e62c]:disabled{opacity:0.5;cursor:not-allowed}.cmd-send-btn .icon[data-v-eef7e62c]{width:16px;height:16px}.status-bar[data-v-eef7e62c]{height:48px;background:rgba(240,253,244,0.8);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;gap:24px;padding:0 10px;flex-shrink:0;z-index:20}.jade-btn[data-v-eef7e62c]{padding:6px 18px;background:rgba(255,255,255,0.6);backdrop-filter:blur(10px);border:1.5px solid rgba(129,199,132,0.4);border-radius:20px;font-family:'Zen Maru Gothic',sans-serif;font-size:11px;color:#4caf50;cursor:pointer;outline:none;transition:all 0.3s;display:flex;align-items:center;gap:4px}.jade-btn[data-v-eef7e62c]:hover{background:rgba(129,199,132,0.2);color:#2e7d32;border-color:#66bb6a;transform:translateY(-2px);box-shadow:0 4px 12px rgba(76,175,80,0.15)}.jade-btn-red[data-v-eef7e62c]:hover{border-color:#81c784;color:#43a047;background:rgba(165,214,167,0.2)}.refresh-indicator[data-v-eef7e62c]{position:absolute;top:10px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.9);backdrop-filter:blur(10px);padding:8px 16px;border-radius:20px;border:1px solid rgba(129,199,132,0.3);box-shadow:0 2px 8px rgba(76,175,80,0.2);z-index:10;font-size:12px;color:#2e7d32}.refresh-spinner[data-v-eef7e62c]{width:16px;height:16px;border:2px solid rgba(129,199,132,0.3);border-top-color:#4caf50;border-radius:50%;animation:spin-eef7e62c 1s linear infinite}@keyframes spin-eef7e62c{to{transform:rotate(360deg)}}.settings-overlay[data-v-eef7e62c]{position:absolute;inset:0;z-index:100;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);backdrop-filter:blur(4px)}.settings-panel[data-v-eef7e62c]{background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border-radius:12px;border:2px solid rgba(129,199,132,0.3);box-shadow:0 10px 40px rgba(76,175,80,0.2);width:90%;max-width:400px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column}.settings-header[data-v-eef7e62c]{background:linear-gradient(to right,#66bb6a 0%,#81c784 100%);color:white;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(129,199,132,0.3)}.settings-header h3[data-v-eef7e62c]{margin:0;font-size:16px;font-weight:500}.settings-close[data-v-eef7e62c]{background:transparent;border:none;color:white;font-size:24px;line-height:1;cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;transition:opacity 0.2s}.settings-close[data-v-eef7e62c]:hover{opacity:0.8}.settings-body[data-v-eef7e62c]{padding:20px;overflow-y:auto}.settings-item[data-v-eef7e62c]{margin-bottom:20px}.settings-item label[data-v-eef7e62c]{display:block;margin-bottom:8px;font-size:14px;color:#2e7d32;font-weight:500}.settings-input[data-v-eef7e62c]{width:100%;padding:8px 12px;border:1px solid rgba(129,199,132,0.3);border-radius:8px;font-size:14px;color:#2e7d32;background:rgba(255,255,255,0.8);outline:none;transition:all 0.3s;box-sizing:border-box}.settings-input[data-v-eef7e62c]:focus{border-color:#66bb6a;background:rgba(255,255,255,1)}.settings-btn[data-v-eef7e62c]{margin-top:8px;padding:6px 16px;background:rgba(129,199,132,0.8);border:1px solid rgba(129,199,132,0.5);border-radius:8px;color:white;font-size:12px;cursor:pointer;transition:all 0.2s}.settings-btn[data-v-eef7e62c]:hover{background:rgba(129,199,132,1);transform:translateY(-1px);box-shadow:0 2px 8px rgba(76,175,80,0.3)}@keyframes blink-eef7e62c{0%{opacity:0.2;transform:scale(0.8)}50%{opacity:1;transform:scale(1.2)}100%{opacity:0.2;transform:scale(0.8)}}@media (max-width:800px){.theater-window[data-v-eef7e62c]:not(.theater-window-fullscreen){width:95%;max-width:28rem}.theater-window[data-v-eef7e62c]{max-height:none;height:auto}.theater-window-fullscreen[data-v-eef7e62c]{width:90%;max-width:28rem;border-radius:12px;height:auto;max-height:none}.panel-body[data-v-eef7e62c]{height:auto;max-height:none}}

input[type='text'][data-v-6137eb39]{font-family:monospace}

.settings-scroll-container[data-v-783ad584]{scrollbar-width:none;-ms-overflow-style:none}.settings-scroll-container[data-v-783ad584]::-webkit-scrollbar{display:none}input[type='range'][data-v-783ad584]{-webkit-appearance:none;appearance:none;height:6px;background:var(--muted);border-radius:9999px;outline:none}input[type='range'][data-v-783ad584]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:var(--primary);border-radius:9999px;cursor:pointer}input[type='range'][data-v-783ad584]::-moz-range-thumb{width:16px;height:16px;background:var(--primary);border-radius:9999px;cursor:pointer;border:none}

.history-scroll-container[data-v-7c5875d8]{scrollbar-width:none;-ms-overflow-style:none}.history-scroll-container[data-v-7c5875d8]::-webkit-scrollbar{display:none}.history-message-item[data-v-7c5875d8]{position:relative;margin-bottom:0}.history-message-item[data-v-7c5875d8]:hover{background-color:rgba(0,0,0,0.04)}


/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div></body>