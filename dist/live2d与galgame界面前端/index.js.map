{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_53ff6257bd8fdf8315af10a81f7e3da1/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src//utils/worldbookFormat.ts","src://tavern_helper_template/src/live2dgalgame/lib/messageParser.ts","src://tavern_helper_template/src/live2dgalgame/types/galgame.ts","src://tavern_helper_template/src/live2dgalgame/utils/indexedDB.ts","src://tavern_helper_template/src/live2dgalgame/Live2DRenderer.ts","webpack://tavern_helper_template/./src/live2dgalgame/components/CharacterSprite.vue?b200","webpack://tavern_helper_template/src/live2dgalgame/components/CharacterSprite.vue?fcd2","src://tavern_helper_template/external var \"_\"","webpack://tavern_helper_template/./src/live2dgalgame/components/CharacterStatusPanel.vue?7bbb","webpack://tavern_helper_template/src/live2dgalgame/components/CharacterStatusPanel.vue?fc70","src://tavern_helper_template/src/live2dgalgame/components/ChoiceBox.vue","webpack://tavern_helper_template/src/live2dgalgame/components/ChoiceBox.vue?fea7","webpack://tavern_helper_template/./src/live2dgalgame/components/DialogBox.vue?d7ff","webpack://tavern_helper_template/src/live2dgalgame/components/DialogBox.vue?0ac1","webpack://tavern_helper_template/./src/live2dgalgame/components/ColorSlider.vue?3ac9","webpack://tavern_helper_template/src/live2dgalgame/components/ColorSlider.vue?4d52","src://tavern_helper_template/src/live2dgalgame/components/DialogPreview.vue","webpack://tavern_helper_template/src/live2dgalgame/components/DialogPreview.vue?7105","webpack://tavern_helper_template/./src/live2dgalgame/components/SettingsPanel.vue?2a81","webpack://tavern_helper_template/src/live2dgalgame/components/SettingsPanel.vue?3168","webpack://tavern_helper_template/./src/live2dgalgame/components/GalgamePlayer.vue?5934","webpack://tavern_helper_template/src/live2dgalgame/components/GalgamePlayer.vue?6bdf","src://tavern_helper_template/src/live2dgalgame/index.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","/**\n * \n *  JSON \n */\n\nimport type { PartialDeep } from 'type-fest';\nimport type { WorldbookEntry } from '../../@types/function/worldbook';\n\n/**\n *  JSON \n */\nexport interface ModelResourceWorldbookData {\n  type: 'live2d_model';\n  modelName: string;\n  files: {\n    model3?: string;\n    moc3?: string;\n    textures: string[];\n    cdi3?: string;\n    physics3?: string;\n  };\n  motions: Array<{ name: string; file: string; group: string }>;\n  expressions: Array<{ name: string; file: string }>;\n  defaultAnimation?: {\n    expression?: string;\n    motion?: string;\n    autoLoop?: boolean;\n  };\n  textMappings?: {\n    expression?: Record<string, string>; // { \"happy.exp3.json\": \"\" }\n    motion?: Record<string, string>; // { \"idle.motion3.json\": \"\" }\n  };\n}\n\n/**\n *  JSON \n */\nexport interface SpriteResourceWorldbookData {\n  type: 'sprite';\n  characterName?: string;\n  sprites: Array<{\n    name: string;\n    file: string;\n    textMappings?: string[]; // \n  }>;\n}\n\n/**\n *  JSON \n */\nexport interface BackgroundResourceWorldbookData {\n  type: 'background';\n  backgrounds: Array<{\n    name: string;\n    file: string;\n    textMappings?: string[]; // \n  }>;\n}\n\n/**\n * CG JSON \n */\nexport interface CGResourceWorldbookData {\n  type: 'cg';\n  cgs: Array<{\n    name: string;\n    file: string;\n    textMappings?: string[]; // \n  }>;\n}\n\n/**\n *  JSON \n */\nexport function createModelResourceWorldbookEntry(\n  modelName: string,\n  data: ModelResourceWorldbookData,\n): PartialDeep<WorldbookEntry> {\n  const neverMatchKey = `__MODEL_RESOURCE_${modelName}_${Date.now()}__`;\n\n  return {\n    name: `[] ${modelName}`,\n    enabled: true,\n    strategy: {\n      type: 'selective',\n      keys: [neverMatchKey],\n      keys_secondary: { logic: 'and_any', keys: [] },\n      scan_depth: 'same_as_global',\n    },\n    position: {\n      type: 'after_character_definition',\n      role: 'system',\n      depth: 0,\n      order: 0,\n    },\n    content: `\\`\\`\\`json\n${JSON.stringify(data, null, 2)}\n\\`\\`\\`\n`,\n    probability: 100,\n    recursion: {\n      prevent_incoming: true,\n      prevent_outgoing: true,\n      delay_until: null,\n    },\n    effect: {\n      sticky: null,\n      cooldown: null,\n      delay: null,\n    },\n  };\n}\n\n/**\n *  JSON \n */\nexport function createSpriteResourceWorldbookEntry(\n  characterName: string,\n  data: SpriteResourceWorldbookData,\n): PartialDeep<WorldbookEntry> {\n  const entryName = characterName ? `[] ${characterName}` : '[]';\n  const keys = characterName ? [characterName, `${characterName}`] : ['', ''];\n\n  return {\n    name: entryName,\n    enabled: true,\n    strategy: {\n      type: 'selective',\n      keys,\n      keys_secondary: { logic: 'and_any', keys: [] },\n      scan_depth: 'same_as_global',\n    },\n    position: {\n      type: 'after_character_definition',\n      role: 'system',\n      depth: 0,\n      order: 1,\n    },\n    content: `\\`\\`\\`json\n${JSON.stringify(data, null, 2)}\n\\`\\`\\`\n`,\n    probability: 100,\n    recursion: {\n      prevent_incoming: false,\n      prevent_outgoing: false,\n      delay_until: null,\n    },\n    effect: {\n      sticky: null,\n      cooldown: null,\n      delay: null,\n    },\n  };\n}\n\n/**\n *  JSON \n */\nexport function createBackgroundResourceWorldbookEntry(\n  data: BackgroundResourceWorldbookData,\n): PartialDeep<WorldbookEntry> {\n  // \n  const keys: string[] = ['', ''];\n  for (const bg of data.backgrounds) {\n    if (bg.textMappings) {\n      keys.push(...bg.textMappings);\n    }\n    keys.push(bg.name);\n  }\n\n  return {\n    name: '[]',\n    enabled: true,\n    strategy: {\n      type: 'selective',\n      keys: [...new Set(keys)],\n      keys_secondary: { logic: 'and_any', keys: [] },\n      scan_depth: 'same_as_global',\n    },\n    position: {\n      type: 'after_character_definition',\n      role: 'system',\n      depth: 0,\n      order: 2,\n    },\n    content: `\\`\\`\\`json\n${JSON.stringify(data, null, 2)}\n\\`\\`\\`\n`,\n    probability: 100,\n    recursion: {\n      prevent_incoming: false,\n      prevent_outgoing: false,\n      delay_until: null,\n    },\n    effect: {\n      sticky: null,\n      cooldown: null,\n      delay: null,\n    },\n  };\n}\n\n/**\n * CG JSON \n */\nexport function createCGResourceWorldbookEntry(data: CGResourceWorldbookData): PartialDeep<WorldbookEntry> {\n  // \n  const keys: string[] = ['CG', 'cg'];\n  for (const cg of data.cgs) {\n    if (cg.textMappings) {\n      keys.push(...cg.textMappings);\n    }\n    keys.push(cg.name);\n  }\n\n  return {\n    name: '[CG]',\n    enabled: true,\n    strategy: {\n      type: 'selective',\n      keys: [...new Set(keys)],\n      keys_secondary: { logic: 'and_any', keys: [] },\n      scan_depth: 'same_as_global',\n    },\n    position: {\n      type: 'after_character_definition',\n      role: 'system',\n      depth: 0,\n      order: 3,\n    },\n    content: `\\`\\`\\`json\n${JSON.stringify(data, null, 2)}\n\\`\\`\\`\n`,\n    probability: 100,\n    recursion: {\n      prevent_incoming: false,\n      prevent_outgoing: false,\n      delay_until: null,\n    },\n    effect: {\n      sticky: null,\n      cooldown: null,\n      delay: null,\n    },\n  };\n}\n\n/**\n *  JSON \n */\nexport function parseWorldbookJsonData(content: string): any {\n  //  markdown  JSON\n  const jsonMatch = content.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n  if (jsonMatch) {\n    try {\n      return JSON.parse(jsonMatch[1]);\n    } catch (error) {\n      console.warn(' JSON :', error);\n    }\n  }\n\n  // \n  try {\n    return JSON.parse(content.trim());\n  } catch (error) {\n    console.warn(' JSON :', error);\n    return null;\n  }\n}\n","/**\n * \n *  [[character||...]][[narration||...]] \n */\n\nimport type {\n  BackgroundResourceWorldbookData,\n  CGResourceWorldbookData,\n  ModelResourceWorldbookData,\n  SpriteResourceWorldbookData,\n} from '../..//utils/worldbookFormat';\nimport { parseWorldbookJsonData } from '../..//utils/worldbookFormat';\n\nexport interface StatusBlockData {\n  ?: string;\n  ?: string;\n  ?: string;\n  ?: string;\n  ?: string;\n  ?: string;\n  [key: string]: any;\n}\n\nexport interface MessageBlock {\n  type: 'character' | 'narration' | 'blacktext' | 'user' | 'choice';\n  character?: string;\n  scene?: string;\n  motion?: string;\n  expression?: string;\n  text?: string;\n  message?: string;\n  isThrough?: boolean;\n  isCG?: boolean;\n  choices?: string[]; // [[choice||1||2||3]]\n  choiceText?: string; //  [[choice||1||||]]\n  choiceCharacter?: string; // \n  choiceResponse?: string; // \n  // \n  sceneImageUrl?: string; // URL\n  cgImageUrl?: string; // CGURL\n  spriteImageUrl?: string; // URL\n  motionFile?: string; // \n  expressionFile?: string; // \n}\n\n/**\n * \n */\ninterface WorldbookResourceCache {\n  models: Map<string, ModelResourceWorldbookData>; //  -> \n  sprites: Map<string, SpriteResourceWorldbookData>; //  -> \n  backgrounds: BackgroundResourceWorldbookData | null;\n  cgs: CGResourceWorldbookData | null;\n}\n\nlet worldbookCache: WorldbookResourceCache | null = null;\nlet worldbookCacheTimestamp = 0;\nlet worldbookCacheSource = ''; // \nconst WORLDBOOK_NAME = '-';\nconst CACHE_DURATION = 5000; // 5\n\n/**\n * \n * \n *\n * @returns \n */\nexport async function loadWorldbookResources(): Promise<WorldbookResourceCache> {\n  const now = Date.now();\n\n  // \n  let currentCharacterName = '';\n  try {\n    const rawChar = new RawCharacter(RawCharacter.find({ name: 'current' }));\n    currentCharacterName = rawChar.getCardData().name || '';\n  } catch (error) {\n    console.warn(':', error);\n  }\n\n  // \n  if (\n    worldbookCache &&\n    now - worldbookCacheTimestamp < CACHE_DURATION &&\n    worldbookCacheSource === currentCharacterName\n  ) {\n    return worldbookCache;\n  }\n\n  const cache: WorldbookResourceCache = {\n    models: new Map(),\n    sprites: new Map(),\n    backgrounds: null,\n    cgs: null,\n  };\n\n  // \n  const worldbookNames: string[] = [];\n  try {\n    const charWorldbooks = getCharWorldbookNames('current');\n    if (charWorldbooks.primary) {\n      worldbookNames.push(charWorldbooks.primary);\n    }\n    worldbookNames.push(...charWorldbooks.additional);\n  } catch (error) {\n    console.warn(':', error);\n  }\n\n  // \n  if (worldbookNames.length === 0) {\n    worldbookNames.push(WORLDBOOK_NAME);\n  }\n\n  // \n  for (const worldbookName of worldbookNames) {\n    try {\n      const entries = await getWorldbook(worldbookName);\n      for (const entry of entries) {\n        if (!entry.enabled) continue;\n\n        const data = parseWorldbookJsonData(entry.content);\n        if (!data) continue;\n\n        if (data.type === 'live2d_model') {\n          const modelData = data as ModelResourceWorldbookData;\n          // \n          if (!cache.models.has(modelData.modelName)) {\n            cache.models.set(modelData.modelName, modelData);\n          }\n        } else if (data.type === 'sprite') {\n          const spriteData = data as SpriteResourceWorldbookData;\n          if (spriteData.characterName) {\n            // \n            if (!cache.sprites.has(spriteData.characterName)) {\n              cache.sprites.set(spriteData.characterName, spriteData);\n            }\n          }\n        } else if (data.type === 'background') {\n          // \n          if (!cache.backgrounds) {\n            cache.backgrounds = data as BackgroundResourceWorldbookData;\n          } else {\n            const existing = cache.backgrounds;\n            const newData = data as BackgroundResourceWorldbookData;\n            existing.backgrounds.push(...newData.backgrounds);\n          }\n        } else if (data.type === 'cg') {\n          // CG\n          if (!cache.cgs) {\n            cache.cgs = data as CGResourceWorldbookData;\n          } else {\n            const existing = cache.cgs;\n            const newData = data as CGResourceWorldbookData;\n            existing.cgs.push(...newData.cgs);\n          }\n        }\n      }\n    } catch (error) {\n      console.warn(` ${worldbookName} :`, error);\n    }\n  }\n\n  worldbookCache = cache;\n  worldbookCacheTimestamp = now;\n  worldbookCacheSource = currentCharacterName;\n  return cache;\n}\n\n/**\n * \n */\nfunction normalizeText(text: string): string {\n  return text\n    .replace(/[-/\\\\_.\\s]/g, '') //  - / \\ _ . \n    .toLowerCase();\n}\n\n/**\n * \n */\nfunction fuzzyMatch(source: string, target: string): boolean {\n  const normalizedSource = normalizeText(source);\n  const normalizedTarget = normalizeText(target);\n  return (\n    normalizedSource === normalizedTarget ||\n    normalizedSource.includes(normalizedTarget) ||\n    normalizedTarget.includes(normalizedSource)\n  );\n}\n\n/**\n * \n * \n */\nfunction parseKeyValuePairs(text: string): Record<string, string> {\n  const result: Record<string, string> = {};\n\n  //  || \n  const parts = text\n    .split('||')\n    .map(p => p.trim())\n    .filter(p => p);\n\n  // \n  for (const part of parts) {\n    //  \"\"  \":\" \n    //  +  + \n    const kvMatch = part.match(/^([^:]+)[:]\\s*(.+)$/);\n    if (kvMatch) {\n      const key = kvMatch[1].trim();\n      const value = kvMatch[2].trim();\n      if (key && value) {\n        result[key] = value;\n      }\n    }\n  }\n\n  return result;\n}\n\n/**\n * \n */\nasync function matchWorldbookResources(\n  characterName: string | undefined,\n  sceneText: string | undefined,\n  motionText: string | undefined,\n  expressionText: string | undefined,\n  cgSceneText: string | undefined,\n): Promise<{\n  sceneImageUrl?: string;\n  cgImageUrl?: string;\n  spriteImageUrl?: string;\n  motionFile?: string;\n  expressionFile?: string;\n}> {\n  const result: {\n    sceneImageUrl?: string;\n    cgImageUrl?: string;\n    spriteImageUrl?: string;\n    motionFile?: string;\n    expressionFile?: string;\n  } = {};\n\n  try {\n    const resources = await loadWorldbookResources();\n\n    // \n    if (sceneText && resources.backgrounds) {\n      for (const bg of resources.backgrounds.backgrounds) {\n        // \n        const matchText = sceneText;\n        if (fuzzyMatch(bg.name, matchText) || bg.textMappings?.some(mapping => fuzzyMatch(mapping, matchText))) {\n          result.sceneImageUrl = bg.file;\n          break;\n        }\n      }\n    }\n\n    // CG\n    if (cgSceneText && resources.cgs) {\n      for (const cg of resources.cgs.cgs) {\n        const matchText = cgSceneText;\n        if (fuzzyMatch(cg.name, matchText) || cg.textMappings?.some(mapping => fuzzyMatch(mapping, matchText))) {\n          result.cgImageUrl = cg.file;\n          break;\n        }\n      }\n    }\n\n    // \n    if (characterName && resources.sprites.has(characterName)) {\n      const spriteData = resources.sprites.get(characterName)!;\n      // \n      const matchTexts = [motionText, expressionText].filter(Boolean) as string[];\n      for (const sprite of spriteData.sprites) {\n        if (\n          sprite.textMappings?.some(mapping => matchTexts.some(text => fuzzyMatch(mapping, text))) ||\n          matchTexts.some(text => fuzzyMatch(sprite.name, text))\n        ) {\n          result.spriteImageUrl = sprite.file;\n          break;\n        }\n      }\n    }\n\n    // \n    if (characterName && resources.models.has(characterName)) {\n      const modelData = resources.models.get(characterName)!;\n\n      // \n      if (motionText) {\n        // \n        if (modelData.textMappings?.motion) {\n          for (const [file, mappingText] of Object.entries(modelData.textMappings.motion)) {\n            if (fuzzyMatch(mappingText, motionText)) {\n              // \n              const motion = (modelData.motions || []).find(m => m.file === file || m.name === file);\n              if (motion) {\n                result.motionFile = motion.file;\n                break;\n              }\n            }\n          }\n        }\n        // \n        if (!result.motionFile) {\n          for (const motion of modelData.motions || []) {\n            if (fuzzyMatch(motion.name, motionText) || fuzzyMatch(motion.file, motionText)) {\n              result.motionFile = motion.file;\n              break;\n            }\n          }\n        }\n      }\n\n      // \n      if (expressionText) {\n        // \n        if (modelData.textMappings?.expression) {\n          for (const [file, mappingText] of Object.entries(modelData.textMappings.expression)) {\n            if (fuzzyMatch(mappingText, expressionText)) {\n              // \n              const expression = (modelData.expressions || []).find(e => e.file === file || e.name === file);\n              if (expression) {\n                result.expressionFile = expression.file;\n                break;\n              }\n            }\n          }\n        }\n        // \n        if (!result.expressionFile) {\n          for (const expression of modelData.expressions || []) {\n            if (fuzzyMatch(expression.name, expressionText) || fuzzyMatch(expression.file, expressionText)) {\n              result.expressionFile = expression.file;\n              break;\n            }\n          }\n        }\n      }\n    }\n  } catch (error) {\n    console.warn(':', error);\n  }\n\n  return result;\n}\n\n/**\n *  StatusBlock \n * : <StatusBlock>...</StatusBlock>\n */\nexport function parseStatusBlock(message: string): StatusBlockData | null {\n  const statusBlockRegex = /<StatusBlock>([\\s\\S]*?)<\\/StatusBlock>/i;\n  const match = message.match(statusBlockRegex);\n\n  if (!match) {\n    return null;\n  }\n\n  const content = match[1].trim();\n  const statusData: StatusBlockData = {};\n\n  // : \n  const fieldRegex = /(\\S+?):\\s*(.+?)(?=\\n\\S+?:|\\n*$)/g;\n  let fieldMatch;\n\n  while ((fieldMatch = fieldRegex.exec(content)) !== null) {\n    const key = fieldMatch[1].trim();\n    const value = fieldMatch[2].trim();\n    statusData[key] = value;\n  }\n\n  // \n  if (Object.keys(statusData).length === 0) {\n    const lines = content.split('\\n').filter(line => line.trim());\n    for (const line of lines) {\n      const colonIndex = line.indexOf(':');\n      if (colonIndex > 0) {\n        const key = line.substring(0, colonIndex).trim();\n        const value = line.substring(colonIndex + 1).trim();\n        if (key && value) {\n          statusData[key] = value;\n        }\n      }\n    }\n  }\n\n  return Object.keys(statusData).length > 0 ? statusData : null;\n}\n\n/**\n * \n * \n * - [[character||||||||||]]\n * - [[character||||CG||]]\n * - [[narration||||]]\n * - [[blacktext||]]\n * - [[user||||]]\n * - [[choice||1||||]] - \n * - [[choice||1||2||3]] - AI\n *\n * \n *  <content>...</content> \n */\nexport async function parseMessageBlocks(message: string, lastScene?: string): Promise<MessageBlock[]> {\n  const blocks: MessageBlock[] = [];\n  let currentScene = lastScene; // \n\n  //  <content>...</content> \n  const contentMatch = message.match(/<content>([\\s\\S]*?)<\\/content>/i);\n  const contentText = contentMatch ? contentMatch[1] : message;\n\n  //  [[type||...]] \n  const blockRegex = /\\[\\[(\\w+)\\|\\|([^\\]]*)\\]\\]/g;\n  let match;\n\n  while ((match = blockRegex.exec(contentText)) !== null) {\n    const type = match[1] as MessageBlock['type'];\n    const content = match[2];\n\n    if (type === 'character') {\n      // \n      const kvPairs = parseKeyValuePairs(content);\n\n      const block: MessageBlock = {\n        type: 'character',\n      };\n\n      // [[character||||||||||]]\n      block.character = kvPairs[''] || kvPairs['character'] || '';\n\n      // CG\n      const cgScene = kvPairs['CG'] || kvPairs['cg'] || kvPairs['CG'] || kvPairs['cg'];\n      if (cgScene) {\n        block.scene = cgScene;\n        block.text = kvPairs[''] || kvPairs['text'] || '';\n        block.isCG = true;\n      } else {\n        // \n        block.scene = kvPairs[''] || kvPairs['scene'] || currentScene;\n        block.motion = kvPairs[''] || kvPairs['motion'] || '';\n        block.expression = kvPairs[''] || kvPairs['expression'] || '';\n        block.text = kvPairs[''] || kvPairs['text'] || '';\n\n        // CG\n        if (!block.motion && !block.expression) {\n          block.isCG = true;\n        }\n      }\n\n      // \n      if (!block.scene && currentScene) {\n        block.scene = currentScene;\n      }\n\n      // \n      if (block.scene) {\n        currentScene = block.scene;\n      }\n\n      //  isThrough**\n      //  ** \n\n      // \n      const resources = await matchWorldbookResources(\n        block.character,\n        block.isCG ? undefined : block.scene, // CGCG\n        block.motion,\n        block.expression,\n        block.isCG ? block.scene : undefined, // CGCG\n      );\n      Object.assign(block, resources);\n\n      blocks.push(block);\n    } else if (type === 'narration') {\n      // [[narration||||]]\n      const kvPairs = parseKeyValuePairs(content);\n\n      const scene = kvPairs[''] || kvPairs['scene'] || currentScene;\n      const messageText = kvPairs[''] || kvPairs[''] || kvPairs['text'] || kvPairs[''] || content;\n\n      // \n      if (scene) {\n        currentScene = scene;\n      }\n\n      const block: MessageBlock = {\n        type: 'narration',\n        scene,\n        message: messageText,\n      };\n\n      // \n      if (scene) {\n        const resources = await matchWorldbookResources(undefined, scene, undefined, undefined, undefined);\n        if (resources.sceneImageUrl) {\n          block.sceneImageUrl = resources.sceneImageUrl;\n        }\n      }\n\n      blocks.push(block);\n    } else if (type === 'blacktext') {\n      // [[blacktext||]]\n      const kvPairs = parseKeyValuePairs(content);\n      const messageText = kvPairs[''] || kvPairs['text'] || kvPairs[''] || content;\n\n      blocks.push({\n        type: 'blacktext',\n        message: messageText,\n      });\n    } else if (type === 'user') {\n      // [[user||||]]\n      const kvPairs = parseKeyValuePairs(content);\n\n      const scene = kvPairs[''] || kvPairs['scene'] || currentScene;\n      let messageText = kvPairs[''] || kvPairs[''] || kvPairs[''] || kvPairs['text'] || content;\n\n      // \n      // ** \n      //  \n      const thoughtRegex = /\\*([^*]+)\\*/g;\n      const narrationRegex = /([^]+)/g;\n\n      // \n      const narrationMatches: string[] = [];\n      let narrationMatch;\n      while ((narrationMatch = narrationRegex.exec(messageText)) !== null) {\n        narrationMatches.push(narrationMatch[1]);\n      }\n\n      // \n      messageText = messageText.replace(narrationRegex, '').trim();\n\n      //  **  *through*\n\n      // \n      if (scene) {\n        currentScene = scene;\n      }\n\n      // \n      for (const narrationText of narrationMatches) {\n        const narrationBlock: MessageBlock = {\n          type: 'narration',\n          scene,\n          message: narrationText,\n        };\n\n        // \n        if (scene) {\n          const resources = await matchWorldbookResources(undefined, scene, undefined, undefined, undefined);\n          if (resources.sceneImageUrl) {\n            narrationBlock.sceneImageUrl = resources.sceneImageUrl;\n          }\n        }\n\n        blocks.push(narrationBlock);\n      }\n\n      // \n      //  isThrough**\n      const block: MessageBlock = {\n        type: 'user',\n        scene,\n        message: messageText,\n      };\n\n      // \n      if (scene) {\n        const resources = await matchWorldbookResources(undefined, scene, undefined, undefined, undefined);\n        if (resources.sceneImageUrl) {\n          block.sceneImageUrl = resources.sceneImageUrl;\n        }\n      }\n\n      blocks.push(block);\n    } else if (type === 'choice') {\n      // \n      // 1. [[choice||1||||]] - \n      // 2. [[choice||1||2||3]] - AI\n      const kvPairs = parseKeyValuePairs(content);\n\n      // 1\n      const choiceCharacter = kvPairs[''] || kvPairs['character'];\n      const choiceResponse = kvPairs[''] || kvPairs['response'] || kvPairs['text'];\n\n      if (choiceCharacter && choiceResponse) {\n        // 1\n        const choiceText = kvPairs['1'] || kvPairs['1'] || kvPairs['choice1'];\n        if (choiceText) {\n          blocks.push({\n            type: 'choice',\n            choiceText,\n            choiceCharacter,\n            choiceResponse,\n          });\n        }\n      } else {\n        // 2AI\n        const choices: string[] = [];\n        let i = 1;\n        while (kvPairs[`${i}`] || kvPairs[`${i}`] || kvPairs[`choice${i}`]) {\n          const choice = kvPairs[`${i}`] || kvPairs[`${i}`] || kvPairs[`choice${i}`];\n          if (choice) {\n            choices.push(choice);\n          }\n          i++;\n        }\n\n        if (choices.length > 0) {\n          blocks.push({\n            type: 'choice',\n            choices,\n          });\n        }\n      }\n    }\n  }\n\n  return blocks;\n}\n\n/**\n * \n */\nexport function hasMotionAndExpression(\n  characterName: string,\n  motion?: string,\n  expression?: string,\n  live2dModels?: any[],\n): boolean {\n  if (!characterName || !live2dModels || live2dModels.length === 0) {\n    return false;\n  }\n\n  const model = live2dModels.find(m => m.name === characterName);\n  if (!model) {\n    return false;\n  }\n\n  // \n  if (motion) {\n    const hasMotion = model.motions?.some((m: any) => {\n      const motionName = typeof m === 'string' ? m : m.name || m.file;\n      return motionName === motion || motionName === `${motion}.motion3.json`;\n    });\n    if (!hasMotion) {\n      return false;\n    }\n  }\n\n  // \n  if (expression) {\n    const hasExpression = model.expressions?.some((e: any) => {\n      const exprName = typeof e === 'string' ? e : e.name || e.file;\n      return exprName === expression || exprName === `${expression}.exp3.json`;\n    });\n    if (!hasExpression) {\n      return false;\n    }\n  }\n\n  return true;\n}\n","/**\n * Galgame \n */\n\nexport interface DialogueItem {\n  character?: string;\n  text: string;\n  type?: 'blackscreen' | 'choice' | 'narration' | 'user' | 'cg';\n  options?: ChoiceOption[];\n  message_id?: number; // ID\n  role?: 'system' | 'assistant' | 'user'; // \n  sprite?: {\n    type: 'live2d' | 'image' | 'none'; // noneCG\n    live2dModelId?: string; // Live2D ID\n    imageUrl?: string; // URL\n  };\n  // \n  scene?: string; // \n  sceneImageUrl?: string; // URL\n  motion?: string; // \n  expression?: string; // \n  isThrough?: boolean; // through\n  isCG?: boolean; // CG\n  cgImageUrl?: string; // CGURL\n  statusBlock?: {\n    ?: string;\n    ?: string;\n    ?: string;\n    ?: string;\n    ?: string;\n    ?: string;\n  };\n  isEditable?: boolean; // \n  editedText?: string; // \n  isDeleted?: boolean; // \n}\n\nexport interface ChoiceOption {\n  id: string;\n  text: string;\n  character?: string; // \n  response?: string; // \n  onClick?: () => void;\n}\n\nexport interface BoxShapePreset {\n  id: string;\n  name: string;\n  borderRadius: string;\n  borderWidth: string;\n  shadow: string;\n}\n\nexport interface NameShapePreset {\n  id: string;\n  name: string;\n  borderRadius: string;\n  style: 'tag' | 'pill' | 'square' | 'underline' | 'floating';\n}\n\nexport interface ArrowShapePreset {\n  id: string;\n  name: string;\n  type: 'circle' | 'square' | 'pill' | 'minimal' | 'inner-round' | 'inner-square';\n  isInner: boolean;\n}\n\nexport interface IndicatorShapePreset {\n  id: string;\n  name: string;\n  type: 'dots' | 'diamonds' | 'pulse' | 'arrow' | 'none';\n}\n\nexport interface BackgroundPatternPreset {\n  id: string;\n  name: string;\n  pattern: string;\n}\n\nexport interface DialogBoxStyle {\n  boxShape: string;\n  nameShape: string;\n  arrowShape: string;\n  indicatorShape: string;\n  backgroundPattern: string;\n  borderWidth: string;\n  colors: {\n    boxBackground: string;\n    boxBorder: string;\n    nameBackground: string;\n    nameText: string;\n    nameBorder: string;\n    dialogText: string;\n    narrationText: string;\n    arrowBackground: string;\n    arrowIcon: string;\n    indicatorColor: string;\n  };\n  fontSize: number;\n}\n\nexport const backgroundPatternPresets: BackgroundPatternPreset[] = [\n  { id: 'none', name: '', pattern: '' },\n  {\n    id: 'grid',\n    name: '',\n    pattern:\n      'linear-gradient(to right, VAR_BORDER_COLOR 1px, transparent 1px), linear-gradient(to bottom, VAR_BORDER_COLOR 1px, transparent 1px)',\n  },\n  { id: 'dots', name: '', pattern: 'radial-gradient(circle, VAR_BORDER_COLOR 1px, transparent 1px)' },\n  {\n    id: 'diamonds',\n    name: '',\n    pattern:\n      'linear-gradient(45deg, VAR_BORDER_COLOR 25%, transparent 25%), linear-gradient(-45deg, VAR_BORDER_COLOR 25%, transparent 25%), linear-gradient(45deg, transparent 75%, VAR_BORDER_COLOR 75%), linear-gradient(-45deg, transparent 75%, VAR_BORDER_COLOR 75%)',\n  },\n  {\n    id: 'stripes',\n    name: '',\n    pattern:\n      'repeating-linear-gradient(45deg, transparent, transparent 10px, VAR_BORDER_COLOR 10px, VAR_BORDER_COLOR 20px)',\n  },\n  {\n    id: 'gradient-soft',\n    name: '',\n    pattern: 'linear-gradient(135deg, rgba(255,255,255,0.15) 0%, transparent 50%, VAR_BORDER_COLOR 100%)',\n  },\n];\n\nexport const boxShapePresets: BoxShapePreset[] = [\n  { id: 'rounded', name: '', borderRadius: '12px', borderWidth: '1px', shadow: '0 4px 20px rgba(0,0,0,0.08)' },\n  { id: 'pill', name: '', borderRadius: '24px', borderWidth: '1px', shadow: '0 4px 24px rgba(0,0,0,0.1)' },\n  { id: 'sharp', name: '', borderRadius: '0px', borderWidth: '2px', shadow: '4px 4px 0 rgba(0,0,0,0.1)' },\n  { id: 'soft', name: '', borderRadius: '16px', borderWidth: '0px', shadow: '0 8px 32px rgba(0,0,0,0.12)' },\n  { id: 'frame', name: '', borderRadius: '4px', borderWidth: '3px', shadow: 'inset 0 0 0 1px rgba(0,0,0,0.05)' },\n];\n\nexport const borderWidthPresets = [\n  { id: 'none', name: '', width: '0px' },\n  { id: 'thin', name: '', width: '1px' },\n  { id: 'medium', name: '', width: '2px' },\n  { id: 'thick', name: '', width: '3px' },\n  { id: 'bold', name: '', width: '4px' },\n];\n\nexport const nameShapePresets: NameShapePreset[] = [\n  { id: 'tag', name: '', borderRadius: '6px 6px 0 0', style: 'tag' },\n  { id: 'pill', name: '', borderRadius: '999px', style: 'pill' },\n  { id: 'square', name: '', borderRadius: '0px', style: 'square' },\n  { id: 'underline', name: '', borderRadius: '0px', style: 'underline' },\n  { id: 'floating', name: '', borderRadius: '8px', style: 'floating' },\n];\n\nexport const arrowShapePresets: ArrowShapePreset[] = [\n  { id: 'circle', name: '', type: 'circle', isInner: false },\n  { id: 'square', name: '', type: 'square', isInner: false },\n  { id: 'pill', name: '', type: 'pill', isInner: false },\n  { id: 'minimal', name: '', type: 'minimal', isInner: false },\n  { id: 'inner-round', name: '', type: 'inner-round', isInner: true },\n  { id: 'inner-square', name: '', type: 'inner-square', isInner: true },\n];\n\nexport const indicatorShapePresets: IndicatorShapePreset[] = [\n  { id: 'dots', name: '', type: 'dots' },\n  { id: 'diamonds', name: '', type: 'diamonds' },\n  { id: 'pulse', name: '', type: 'pulse' },\n  { id: 'arrow', name: '', type: 'arrow' },\n  { id: 'none', name: '', type: 'none' },\n];\n\nexport const defaultDialogStyle: DialogBoxStyle = {\n  boxShape: 'rounded',\n  nameShape: 'tag',\n  arrowShape: 'circle',\n  indicatorShape: 'dots',\n  backgroundPattern: 'none',\n  borderWidth: 'thin',\n  colors: {\n    boxBackground: 'rgba(255, 255, 255, 0.9)',\n    boxBorder: 'rgba(16, 185, 129, 0.3)',\n    nameBackground: 'rgba(236, 253, 245, 0.9)',\n    nameText: '#059669',\n    nameBorder: 'rgba(16, 185, 129, 0.3)',\n    dialogText: '#374151',\n    narrationText: '#6b7280',\n    arrowBackground: 'rgba(255, 255, 255, 0.85)',\n    arrowIcon: '#10b981',\n    indicatorColor: '#10b981',\n  },\n  fontSize: 16,\n};\n","/**\n * IndexedDB \n *  IndexedDB  Live2D \n */\n\nconst DB_NAME = 'live2d-models-db';\nconst DB_VERSION = 1;\nconst STORE_NAME = 'model-files';\n\n/**\n * \n */\nfunction openDB(): Promise<IDBDatabase> {\n  return new Promise((resolve, reject) => {\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n    request.onerror = () => reject(request.error);\n    request.onsuccess = () => resolve(request.result);\n\n    request.onupgradeneeded = event => {\n      const db = (event.target as IDBOpenDBRequest).result;\n      if (!db.objectStoreNames.contains(STORE_NAME)) {\n        db.createObjectStore(STORE_NAME, { keyPath: 'id' });\n      }\n    };\n  });\n}\n\n/**\n *  IndexedDB \n */\nexport async function getFile(fileId: string): Promise<File | null> {\n  const db = await openDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction([STORE_NAME], 'readonly');\n    const store = transaction.objectStore(STORE_NAME);\n    const request = store.get(fileId);\n\n    request.onsuccess = () => {\n      const fileData = request.result;\n      if (!fileData) {\n        resolve(null);\n        return;\n      }\n\n      //  ArrayBuffer  File\n      const blob = new Blob([fileData.data], { type: fileData.type });\n      const file = new File([blob], fileData.filename, {\n        type: fileData.type,\n        lastModified: fileData.lastModified,\n      });\n\n      resolve(file);\n    };\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n *  IndexedDB  Blob URL\n */\nexport async function getFileBlobUrl(fileId: string): Promise<string | null> {\n  const file = await getFile(fileId);\n  if (!file) return null;\n\n  return URL.createObjectURL(file);\n}\n\n/**\n * \n */\nexport async function fileExists(fileId: string): Promise<boolean> {\n  const db = await openDB();\n\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction([STORE_NAME], 'readonly');\n    const store = transaction.objectStore(STORE_NAME);\n    const request = store.get(fileId);\n\n    request.onsuccess = () => {\n      resolve(request.result !== undefined);\n    };\n    request.onerror = () => reject(request.error);\n  });\n}\n\n/**\n *  indexeddb://  URL  ID\n */\nexport function parseIndexedDbUrl(url: string): { modelName: string; filename: string } | null {\n  // indexeddb:///\n  const match = url.match(/^indexeddb:\\/\\/([^/]+)\\/(.+)$/);\n  if (!match) return null;\n\n  return {\n    modelName: match[1],\n    filename: match[2],\n  };\n}\n\n/**\n *  ID\n */\nexport function generateFileId(modelName: string, filename: string): string {\n  return `${modelName}::${filename}`;\n}\n\n/**\n *  indexeddb:// URL  Blob URL\n */\nexport async function getIndexedDbFileUrl(\n  indexedDbUrl: string,\n  fileIds?: Record<string, string>,\n): Promise<string | null> {\n  const parsed = parseIndexedDbUrl(indexedDbUrl);\n  if (!parsed) return null;\n\n  //  fileIds \n  if (fileIds && fileIds[parsed.filename]) {\n    return getFileBlobUrl(fileIds[parsed.filename]);\n  }\n\n  //  fileId\n  const fileId = generateFileId(parsed.modelName, parsed.filename);\n  return getFileBlobUrl(fileId);\n}\n","/**\n * Live2D\n *  pixi-live2d-display\n *\n * \n * - \n * - Live2D Cubism Core  CDN \n * - \n * -  IndexedDB \n */\n\nimport { getIndexedDbFileUrl } from './utils/indexedDB';\n\n// Live2D \nexport interface Live2DModelConfig {\n  id: string;\n  name: string;\n  modelPath: string;\n  basePath: string;\n  version: number;\n  motions: Array<{ group: string; name: string; file: string }>;\n  expressions: string[];\n  textures: string[];\n  physics?: string;\n  pose?: string;\n  /**  fileId  IndexedDB  */\n  _fileIds?: Record<string, string>;\n  /**  */\n  defaultAnimation?: {\n    motion?: string;\n    expression?: string;\n    autoLoop?: boolean;\n  };\n}\n\n// \ndeclare global {\n  interface Window {\n    PIXI: typeof import('pixi.js');\n    Live2DModel: any;\n  }\n}\n\n// \nfunction loadScript(src: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    // \n    if (document.querySelector(`script[src=\"${src}\"]`)) {\n      resolve();\n      return;\n    }\n\n    const script = document.createElement('script');\n    script.src = src;\n    script.onload = () => resolve();\n    script.onerror = () => reject(new Error(`: ${src}`));\n    document.head.appendChild(script);\n  });\n}\n\n//  Live2D \nlet live2dInitPromise: Promise<void> | null = null;\n\nasync function initLive2DDependencies(): Promise<void> {\n  if (live2dInitPromise) return live2dInitPromise;\n\n  live2dInitPromise = (async () => {\n    try {\n      //  pixi.js v6 pixi-live2d-display\n      await loadScript('https://cdn.jsdelivr.net/npm/pixi.js@6.5.10/dist/browser/pixi.min.js');\n\n      //  pixi-live2d-display\n      await loadScript('https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.4.0/dist/index.min.js');\n\n      //  Live2D ticker\n      if (window.PIXI && window.Live2DModel) {\n        window.Live2DModel.registerTicker(window.PIXI.Ticker.shared);\n        console.info('Live2D ');\n      } else {\n        throw new Error('Live2D ');\n      }\n    } catch (error) {\n      live2dInitPromise = null;\n      throw error;\n    }\n  })();\n\n  return live2dInitPromise;\n}\n\nexport class Live2DRenderer {\n  private app: any = null;\n  private currentModel: any = null;\n  private modelConfig: Live2DModelConfig | null = null;\n  private isInitialized = false;\n  private currentMotionGroup: string | null = null;\n  private currentMotionIndex: number = 0;\n  private isLoopingDefaultMotion = false; // \n  private defaultMotionLoopTimer: ReturnType<typeof setInterval> | null = null; // \n\n  /**\n   * \n   */\n  async init(canvas: HTMLCanvasElement): Promise<void> {\n    if (this.isInitialized) return;\n\n    try {\n      //  Live2D \n      await initLive2DDependencies();\n\n      //  PixiJS \n      const canvasElement = canvas;\n      this.app = new window.PIXI.Application({\n        view: canvasElement,\n        autoStart: true,\n        backgroundAlpha: 0, // \n        resizeTo: canvasElement.parentElement || canvasElement,\n        antialias: true,\n      });\n\n      this.isInitialized = true;\n      console.info('Live2D');\n    } catch (error) {\n      console.error('Live2D:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \n   */\n  async loadModel(config: Live2DModelConfig): Promise<void> {\n    if (!this.isInitialized || !this.app) {\n      throw new Error('');\n    }\n\n    try {\n      // \n      if (this.currentModel) {\n        this.unloadModel();\n      }\n\n      this.modelConfig = config;\n\n      // \n      let modelUrl = config.modelPath;\n      if (!modelUrl.startsWith('http://') && !modelUrl.startsWith('https://')) {\n        modelUrl = config.basePath ? `${config.basePath}${modelUrl}` : modelUrl;\n      }\n\n      //  IndexedDB \n      if (modelUrl.startsWith('indexeddb://')) {\n        console.info(`[Live2DRenderer]  IndexedDB : ${modelUrl}`);\n\n        //  IndexedDB  model3.json \n        const blobUrl = await getIndexedDbFileUrl(modelUrl, config._fileIds);\n        if (!blobUrl) {\n          throw new Error(` IndexedDB : ${modelUrl}`);\n        }\n\n        //  model3.json IndexedDB Blob URL\n        try {\n          const response = await fetch(blobUrl);\n          const modelJson = await response.json();\n\n          //  FileReferences  IndexedDB Blob URL\n          if (modelJson.FileReferences && config.basePath?.startsWith('indexeddb://') && config._fileIds) {\n            const basePath = config.basePath;\n\n            //  MOC \n            if (modelJson.FileReferences.Moc && typeof modelJson.FileReferences.Moc === 'string') {\n              const mocPath = modelJson.FileReferences.Moc;\n              if (!mocPath.startsWith('http') && !mocPath.startsWith('blob:')) {\n                const indexedDbUrl = `${basePath}${mocPath}`;\n                const mocBlobUrl = await getIndexedDbFileUrl(indexedDbUrl, config._fileIds);\n                if (mocBlobUrl) {\n                  modelJson.FileReferences.Moc = mocBlobUrl;\n                  console.info(`[Live2DRenderer]  MOC : ${mocPath} -> IndexedDB Blob URL`);\n                }\n              }\n            }\n\n            // \n            if (Array.isArray(modelJson.FileReferences.Textures)) {\n              for (let i = 0; i < modelJson.FileReferences.Textures.length; i++) {\n                const texturePath = modelJson.FileReferences.Textures[i];\n                if (\n                  typeof texturePath === 'string' &&\n                  !texturePath.startsWith('http') &&\n                  !texturePath.startsWith('blob:')\n                ) {\n                  const indexedDbUrl = `${basePath}${texturePath}`;\n                  const textureBlobUrl = await getIndexedDbFileUrl(indexedDbUrl, config._fileIds);\n                  if (textureBlobUrl) {\n                    modelJson.FileReferences.Textures[i] = textureBlobUrl;\n                    console.info(`[Live2DRenderer] : ${texturePath} -> IndexedDB Blob URL`);\n                  }\n                }\n              }\n            }\n\n            // \n            if (modelJson.FileReferences.Physics && typeof modelJson.FileReferences.Physics === 'string') {\n              const physicsPath = modelJson.FileReferences.Physics;\n              if (!physicsPath.startsWith('http') && !physicsPath.startsWith('blob:')) {\n                const indexedDbUrl = `${basePath}${physicsPath}`;\n                const physicsBlobUrl = await getIndexedDbFileUrl(indexedDbUrl, config._fileIds);\n                if (physicsBlobUrl) {\n                  modelJson.FileReferences.Physics = physicsBlobUrl;\n                  console.info(`[Live2DRenderer] : ${physicsPath} -> IndexedDB Blob URL`);\n                }\n              }\n            }\n\n            // \n            if (modelJson.FileReferences.DisplayInfo && typeof modelJson.FileReferences.DisplayInfo === 'string') {\n              const displayPath = modelJson.FileReferences.DisplayInfo;\n              if (!displayPath.startsWith('http') && !displayPath.startsWith('blob:')) {\n                const indexedDbUrl = `${basePath}${displayPath}`;\n                const displayBlobUrl = await getIndexedDbFileUrl(indexedDbUrl, config._fileIds);\n                if (displayBlobUrl) {\n                  modelJson.FileReferences.DisplayInfo = displayBlobUrl;\n                  console.info(`[Live2DRenderer] : ${displayPath} -> IndexedDB Blob URL`);\n                }\n              }\n            }\n\n            //  Groups \n            if (Array.isArray(modelJson.FileReferences.Groups)) {\n              for (const group of modelJson.FileReferences.Groups) {\n                if (\n                  group.File &&\n                  typeof group.File === 'string' &&\n                  !group.File.startsWith('http') &&\n                  !group.File.startsWith('blob:')\n                ) {\n                  const indexedDbUrl = `${basePath}${group.File}`;\n                  const groupBlobUrl = await getIndexedDbFileUrl(indexedDbUrl, config._fileIds);\n                  if (groupBlobUrl) {\n                    group.File = groupBlobUrl;\n                    console.info(`[Live2DRenderer] : ${group.File} -> IndexedDB Blob URL`);\n                  }\n                }\n                if (Array.isArray(group.Files)) {\n                  for (let i = 0; i < group.Files.length; i++) {\n                    const filePath = group.Files[i];\n                    if (typeof filePath === 'string' && !filePath.startsWith('http') && !filePath.startsWith('blob:')) {\n                      const indexedDbUrl = `${basePath}${filePath}`;\n                      const fileBlobUrl = await getIndexedDbFileUrl(indexedDbUrl, config._fileIds);\n                      if (fileBlobUrl) {\n                        group.Files[i] = fileBlobUrl;\n                        console.info(`[Live2DRenderer] : ${filePath} -> IndexedDB Blob URL`);\n                      }\n                    }\n                  }\n                }\n              }\n            }\n\n            //  model3.json  Blob URL\n            const modifiedJsonBlob = new Blob([JSON.stringify(modelJson)], { type: 'application/json' });\n            const modifiedJsonUrl = URL.createObjectURL(modifiedJsonBlob);\n            modelUrl = modifiedJsonUrl;\n            console.info(`[Live2DRenderer]  model3.json Blob URL`);\n          } else {\n            //  Blob URL\n            modelUrl = blobUrl;\n          }\n        } catch (error) {\n          console.warn(`[Live2DRenderer]  model3.json :`, error);\n          modelUrl = blobUrl;\n        }\n\n        console.info(`[Live2DRenderer]  IndexedDB Blob URL: ${modelUrl.substring(0, 50)}...`);\n      }\n\n      console.info(`: ${modelUrl}`);\n\n      //  pixi-live2d-display \n      const model = await window.Live2DModel.from(modelUrl, {\n        requestIdle: false,\n      });\n\n      // \n      model.anchor.set(0.5, 0.5);\n      model.x = this.app.screen.width / 2;\n      model.y = this.app.screen.height / 2;\n\n      // \n      const scale = Math.min(\n        (this.app.screen.width * 0.8) / model.width,\n        (this.app.screen.height * 0.8) / model.height,\n        1,\n      );\n      model.scale.set(scale);\n\n      // \n      this.app.stage.addChild(model);\n      this.currentModel = model;\n      this.modelConfig = config;\n\n      // \n      if (config.defaultAnimation?.expression && config.expressions) {\n        const expressionIndex = config.expressions.findIndex((e: string) => {\n          // expressions  string[]\n          return e === config.defaultAnimation?.expression || e === `${config.defaultAnimation?.expression}.exp3.json`;\n        });\n        if (expressionIndex !== undefined && expressionIndex >= 0) {\n          model.expression(expressionIndex);\n          console.info(`: ${config.defaultAnimation.expression}`);\n        }\n      }\n\n      // IDLE\n      if (config.defaultAnimation?.motion && config.defaultAnimation?.autoLoop) {\n        this.startDefaultMotionLoop(config.defaultAnimation.motion);\n      } else if (config.defaultAnimation?.motion && !config.defaultAnimation?.autoLoop) {\n        // NORMAL\n        const motionConfig = config.motions?.find((m: any) => {\n          const name = typeof m === 'string' ? m : m.name || m.file;\n          return name === config.defaultAnimation?.motion || name === `${config.defaultAnimation?.motion}.motion3.json`;\n        });\n        if (motionConfig) {\n          const group = typeof motionConfig === 'string' ? 'idle' : motionConfig.group || 'idle';\n          const normalizedGroup = group === 'default' ? 'idle' : group; // 'default'\n          const groupMotions =\n            config.motions?.filter((m: any) => {\n              const mGroup = typeof m === 'string' ? 'idle' : m.group || 'idle';\n              const normalizedMGroup = mGroup === 'default' ? 'idle' : mGroup;\n              return normalizedMGroup === normalizedGroup || mGroup === group;\n            }) || [];\n          const motionIndex = groupMotions.findIndex((m: any) => {\n            const name = typeof m === 'string' ? m : m.name || m.file;\n            return (\n              name === config.defaultAnimation?.motion || name === `${config.defaultAnimation?.motion}.motion3.json`\n            );\n          });\n          if (motionIndex >= 0) {\n            //  NORMAL \n            const MotionPriority = window.Live2DModel?.MotionPriority || { NORMAL: 2 };\n            model.motion(normalizedGroup, motionIndex, MotionPriority.NORMAL);\n            console.info(`: ${config.defaultAnimation.motion}`);\n          }\n        }\n      }\n\n      console.info(` \"${config.name}\" `);\n    } catch (error) {\n      console.error(':', error);\n      throw new Error(`: ${error instanceof Error ? error.message : String(error)}`);\n    }\n  }\n\n  /**\n   * \n   *  MotionPriority.IDLE  NORMAL  FORCE \n   * \n   */\n  private startDefaultMotionLoop(motionName: string): void {\n    // \n    this.stopDefaultMotionLoop();\n\n    if (!this.currentModel || !this.modelConfig) {\n      return;\n    }\n\n    //  MotionPriority \n    const MotionPriority = window.Live2DModel?.MotionPriority || {\n      NONE: 0,\n      IDLE: 1,\n      NORMAL: 2,\n      FORCE: 3,\n    };\n\n    // \n    const motionConfig = this.modelConfig.motions?.find((m: any) => {\n      const name = typeof m === 'string' ? m : m.name || m.file;\n      return name === motionName || name === `${motionName}.motion3.json`;\n    });\n\n    if (!motionConfig) {\n      console.warn(`: ${motionName}`);\n      return;\n    }\n\n    const group = typeof motionConfig === 'string' ? 'idle' : motionConfig.group || 'idle';\n    // group'default''idle'pixi-live2d-display'idle'\n    const normalizedGroup = group === 'default' ? 'idle' : group;\n\n    // 'default'\n    const groupMotions =\n      this.modelConfig.motions?.filter((m: any) => {\n        const mGroup = typeof m === 'string' ? 'idle' : m.group || 'idle';\n        const normalizedMGroup = mGroup === 'default' ? 'idle' : mGroup;\n        return normalizedMGroup === normalizedGroup || mGroup === group; // \n      }) || [];\n\n    if (groupMotions.length === 0) {\n      console.warn(` ${group} `);\n      return;\n    }\n\n    // \n    const motionIndex = groupMotions.findIndex((m: any) => {\n      const name = typeof m === 'string' ? m : m.name || m.file;\n      return name === motionName || name === `${motionName}.motion3.json`;\n    });\n\n    if (motionIndex === -1) {\n      console.warn(` ${group}  ${motionName}`);\n      return;\n    }\n\n    this.currentMotionGroup = normalizedGroup;\n    this.currentMotionIndex = motionIndex;\n    this.isLoopingDefaultMotion = true;\n\n    // \n    const playDefaultMotionLoop = async () => {\n      if (!this.isLoopingDefaultMotion || !this.currentModel || this.currentMotionGroup === null) {\n        return;\n      }\n\n      try {\n        // \n        const motionManager = this.currentModel.motionManager;\n        if (motionManager && motionManager.state) {\n          const state = motionManager.state;\n          //  NORMAL  FORCE \n          if (state.currentPriority === MotionPriority.NORMAL || state.currentPriority === MotionPriority.FORCE) {\n            // \n            const waitInterval = setInterval(() => {\n              if (!this.isLoopingDefaultMotion || !this.currentModel || this.currentMotionGroup === null) {\n                clearInterval(waitInterval);\n                return;\n              }\n\n              const currentState = this.currentModel.motionManager?.state;\n              if (\n                !currentState ||\n                (currentState.currentPriority !== MotionPriority.NORMAL &&\n                  currentState.currentPriority !== MotionPriority.FORCE)\n              ) {\n                // \n                clearInterval(waitInterval);\n                playDefaultMotionLoop();\n              }\n            }, 100); // 100ms\n\n            return;\n          }\n        }\n\n        //  IDLE \n        // IDLE  NORMAL  FORCE \n        const success = await this.currentModel.motion(\n          this.currentMotionGroup,\n          this.currentMotionIndex,\n          MotionPriority.IDLE,\n        );\n\n        if (!success) {\n          console.warn(`: ${motionName}`);\n          // \n          setTimeout(() => {\n            if (this.isLoopingDefaultMotion && this.currentModel && this.currentMotionGroup !== null) {\n              playDefaultMotionLoop();\n            }\n          }, 2000);\n          return;\n        }\n\n        console.info(\n          `IDLE: ${motionName} (=${this.currentMotionGroup}, =${this.currentMotionIndex})`,\n        );\n\n        // \n        //  2-4 100ms\n        let checkCount = 0;\n        const maxChecks = 50; // 550 * 100ms\n\n        const checkInterval = setInterval(() => {\n          checkCount++;\n          if (!this.isLoopingDefaultMotion || !this.currentModel || this.currentMotionGroup === null) {\n            clearInterval(checkInterval);\n            return;\n          }\n\n          try {\n            const motionManager = this.currentModel.motionManager;\n            if (motionManager && motionManager.state) {\n              const state = motionManager.state;\n\n              // \n              const isOurDefaultMotion =\n                state.currentGroup === this.currentMotionGroup &&\n                state.currentIndex === this.currentMotionIndex &&\n                state.currentPriority === MotionPriority.IDLE;\n\n              if (isOurDefaultMotion) {\n                // \n                if (checkCount >= maxChecks) {\n                  // \n                  clearInterval(checkInterval);\n                  playDefaultMotionLoop();\n                }\n                return;\n              } else {\n                // \n                clearInterval(checkInterval);\n\n                // \n                if (state.currentPriority === MotionPriority.NORMAL || state.currentPriority === MotionPriority.FORCE) {\n                  // \n                  const waitHighPriority = setInterval(() => {\n                    if (!this.isLoopingDefaultMotion || !this.currentModel || this.currentMotionGroup === null) {\n                      clearInterval(waitHighPriority);\n                      return;\n                    }\n\n                    const currentState = this.currentModel.motionManager?.state;\n                    if (\n                      !currentState ||\n                      (currentState.currentPriority !== MotionPriority.NORMAL &&\n                        currentState.currentPriority !== MotionPriority.FORCE)\n                    ) {\n                      // \n                      clearInterval(waitHighPriority);\n                      playDefaultMotionLoop();\n                    }\n                  }, 100);\n                } else {\n                  // \n                  playDefaultMotionLoop();\n                }\n              }\n            }\n\n            //  MotionManager\n            if (checkCount >= 30) {\n              // 3\n              clearInterval(checkInterval);\n              playDefaultMotionLoop();\n            }\n          } catch (error) {\n            console.warn(':', error);\n            clearInterval(checkInterval);\n            // \n            setTimeout(() => {\n              if (this.isLoopingDefaultMotion && this.currentModel && this.currentMotionGroup !== null) {\n                playDefaultMotionLoop();\n              }\n            }, 3000);\n          }\n        }, 100); // 100ms\n\n        // \n        this.defaultMotionLoopTimer = checkInterval as any;\n      } catch (error) {\n        console.warn(':', error);\n        this.stopDefaultMotionLoop();\n      }\n    };\n\n    // \n    playDefaultMotionLoop();\n    console.info(`: ${motionName} (=${normalizedGroup}, =${motionIndex}, =IDLE)`);\n  }\n\n  /**\n   * \n   */\n  private stopDefaultMotionLoop(): void {\n    // \n    this.isLoopingDefaultMotion = false;\n    this.currentMotionGroup = null;\n    this.currentMotionIndex = 0;\n\n    // \n    if (this.defaultMotionLoopTimer) {\n      clearInterval(this.defaultMotionLoopTimer);\n      this.defaultMotionLoopTimer = null;\n    }\n  }\n\n  /**\n   * \n   *  NORMAL  IDLE \n   * \n   */\n  playMotion(group: string, index: number, priority?: number): void {\n    if (!this.currentModel) {\n      console.warn('');\n      return;\n    }\n\n    try {\n      //  MotionPriority \n      const MotionPriority = window.Live2DModel?.MotionPriority || {\n        NONE: 0,\n        IDLE: 1,\n        NORMAL: 2,\n        FORCE: 3,\n      };\n\n      //  NORMAL  IDLE \n      // \n      const motionPriority = priority !== undefined ? priority : MotionPriority.NORMAL;\n      this.currentModel.motion(group || '', index, motionPriority);\n      console.info(`: =\"${group}\", =${index}, =${motionPriority}`);\n\n      // pixi-live2d-display \n      // NORMAL  IDLE \n      //  NORMAL \n    } catch (error) {\n      console.error(':', error);\n    }\n  }\n\n  /**\n   * \n   */\n  playExpression(expressionIndex: number): void {\n    if (!this.currentModel) {\n      console.warn('');\n      return;\n    }\n\n    try {\n      this.currentModel.expression(expressionIndex);\n      console.info(`: =${expressionIndex}`);\n    } catch (error) {\n      console.error(':', error);\n    }\n  }\n\n  /**\n   * \n   */\n  setPosition(x: number, y: number): void {\n    if (this.currentModel) {\n      this.currentModel.x = x;\n      this.currentModel.y = y;\n    }\n  }\n\n  /**\n   * \n   */\n  setScale(scale: number): void {\n    if (this.currentModel) {\n      this.currentModel.scale.set(scale);\n    }\n  }\n\n  /**\n   * \n   */\n  getModel(): any {\n    return this.currentModel;\n  }\n\n  /**\n   * \n   */\n  isReady(): boolean {\n    return this.isInitialized;\n  }\n\n  /**\n   * \n   */\n  unloadModel(): void {\n    // \n    this.stopDefaultMotionLoop();\n\n    if (this.currentModel && this.app) {\n      this.app.stage.removeChild(this.currentModel);\n      this.currentModel.destroy();\n      this.currentModel = null;\n      this.modelConfig = null;\n    }\n  }\n\n  /**\n   * \n   */\n  destroy(): void {\n    // \n    this.stopDefaultMotionLoop();\n    this.unloadModel();\n\n    if (this.app) {\n      this.app.destroy(true, {\n        children: true,\n        texture: true,\n        baseTexture: true,\n      });\n      this.app = null;\n    }\n\n    this.isInitialized = false;\n  }\n\n  /**\n   * \n   */\n  resize(width: number, height: number): void {\n    if (this.app) {\n      this.app.renderer.resize(width, height);\n\n      if (this.currentModel) {\n        this.currentModel.x = width / 2;\n        this.currentModel.y = height / 2;\n      }\n    }\n  }\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = [\"src\"];\nimport { computed, onMounted, onUnmounted, ref, watch } from 'vue';\nimport { Live2DRenderer } from '../Live2DRenderer';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'CharacterSprite',\n    props: {\n        scale: {},\n        positionX: {},\n        positionY: {},\n        spriteType: {},\n        imageUrl: {},\n        live2dModelId: {},\n        live2dModels: {},\n        motion: {},\n        expression: {}\n    },\n    setup(__props) {\n        const props = __props;\n        const spriteContainerRef = ref(null);\n        const live2dCanvasRef = ref(null);\n        let live2dRenderer = null;\n        // \n        const containerStyle = computed(() => {\n            return {\n                left: `${props.positionX}%`,\n                bottom: `${100 - props.positionY}%`,\n                transform: `translateX(-50%) scale(${props.scale})`,\n                transformOrigin: 'bottom center',\n            };\n        });\n        //  Live2D \n        async function loadLive2dModel() {\n            if (props.spriteType !== 'live2d' || !props.live2dModelId || !props.live2dModels || !live2dCanvasRef.value) {\n                return;\n            }\n            // \n            const modelConfig = props.live2dModels.find(m => m.id === props.live2dModelId);\n            if (!modelConfig) {\n                console.warn(` Live2D : ${props.live2dModelId}`);\n                return;\n            }\n            try {\n                // \n                if (live2dRenderer) {\n                    live2dRenderer.destroy();\n                    live2dRenderer = null;\n                }\n                // \n                live2dRenderer = new Live2DRenderer();\n                await live2dRenderer.init(live2dCanvasRef.value);\n                await live2dRenderer.loadModel(modelConfig);\n                // \n                //  defaultAnimationLive2DRenderer \n                // \n                if (props.motion) {\n                    // \n                    const motionConfig = modelConfig.motions?.find((m) => {\n                        const name = typeof m === 'string' ? m : m.name || m.file;\n                        return name === props.motion || name === `${props.motion}.motion3.json`;\n                    });\n                    if (motionConfig) {\n                        const group = typeof motionConfig === 'string' ? 'idle' : motionConfig.group || 'idle';\n                        const normalizedGroup = group === 'default' ? 'idle' : group; // 'default'\n                        // 'default''idle'\n                        const groupMotions = modelConfig.motions?.filter((m) => {\n                            const mGroup = typeof m === 'string' ? 'idle' : m.group || 'idle';\n                            const normalizedMGroup = mGroup === 'default' ? 'idle' : mGroup;\n                            return normalizedMGroup === normalizedGroup || mGroup === group;\n                        }) || [];\n                        const index = groupMotions.findIndex((m) => {\n                            const name = typeof m === 'string' ? m : m.name || m.file;\n                            return name === props.motion || name === `${props.motion}.motion3.json`;\n                        });\n                        if (index >= 0) {\n                            live2dRenderer.playMotion(normalizedGroup, index);\n                        }\n                    }\n                }\n                // Live2DRenderer \n                if (props.expression) {\n                    // \n                    const expressionIndex = modelConfig.expressions?.findIndex((e) => {\n                        const name = typeof e === 'string' ? e : e.name || e.file;\n                        return name === props.expression || name === `${props.expression}.exp3.json`;\n                    });\n                    if (expressionIndex !== undefined && expressionIndex >= 0) {\n                        live2dRenderer.playExpression(expressionIndex);\n                    }\n                }\n                // Live2DRenderer \n            }\n            catch (error) {\n                console.error(' Live2D :', error);\n            }\n        }\n        // \n        watch(() => [props.spriteType, props.live2dModelId, props.live2dModels, props.motion, props.expression], () => {\n            if (props.spriteType === 'live2d') {\n                loadLive2dModel();\n            }\n            else {\n                //  Live2D \n                if (live2dRenderer) {\n                    live2dRenderer.destroy();\n                    live2dRenderer = null;\n                }\n            }\n        }, { immediate: true });\n        onMounted(() => {\n            if (props.spriteType === 'live2d') {\n                loadLive2dModel();\n            }\n        });\n        onUnmounted(() => {\n            if (live2dRenderer) {\n                live2dRenderer.destroy();\n                live2dRenderer = null;\n            }\n        });\n        return (_ctx, _cache) => {\n            return (__props.spriteType !== 'none')\n                ? (_openBlock(), _createElementBlock(\"div\", {\n                    key: 0,\n                    ref_key: \"spriteContainerRef\",\n                    ref: spriteContainerRef,\n                    class: \"absolute z-5 transition-all duration-300 pointer-events-none\",\n                    style: _normalizeStyle(containerStyle.value)\n                }, [\n                    _createCommentVNode(\"  \"),\n                    (__props.spriteType === 'image')\n                        ? (_openBlock(), _createElementBlock(\"img\", {\n                            key: 0,\n                            src: __props.imageUrl,\n                            alt: \"\",\n                            class: \"h-[70vh] w-auto object-contain drop-shadow-2xl\",\n                            draggable: \"false\"\n                        }, null, 8 /* PROPS */, _hoisted_1))\n                        : _createCommentVNode(\"v-if\", true),\n                    _createCommentVNode(\" Live2D  \"),\n                    (__props.spriteType === 'live2d')\n                        ? (_openBlock(), _createElementBlock(\"canvas\", {\n                            key: 1,\n                            ref_key: \"live2dCanvasRef\",\n                            ref: live2dCanvasRef,\n                            class: \"live2d-canvas\"\n                        }, null, 512 /* NEED_PATCH */))\n                        : _createCommentVNode(\"v-if\", true)\n                ], 4 /* STYLE */))\n                : _createCommentVNode(\"v-if\", true);\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./CharacterSprite.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./CharacterSprite.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./CharacterSprite.vue?vue&type=style&index=0&id=4ef60220&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_53ff6257bd8fdf8315af10a81f7e3da1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4ef60220\"]])\n\nexport default __exports__","const __WEBPACK_NAMESPACE_OBJECT__ = _;","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, normalizeClass as _normalizeClass, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = { class: \"border-gray-200 flex items-center justify-between border-b px-4 py-3\" };\nconst _hoisted_2 = { class: \"max-h-[calc(85vh-60px)] overflow-y-auto p-4\" };\nconst _hoisted_3 = { class: \"space-y-4\" };\nconst _hoisted_4 = { class: \"flex border-b border-gray-200\" };\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = {\n    key: 0,\n    class: \"absolute bottom-0 left-0 right-0 h-1 bg-primary\",\n    style: { \"height\": \"3px\" }\n};\nconst _hoisted_7 = {\n    key: 0,\n    class: \"animate-in fade-in space-y-4 duration-200\"\n};\nconst _hoisted_8 = { class: \"status-info-bar\" };\nconst _hoisted_9 = { class: \"info-item\" };\nconst _hoisted_10 = { class: \"info-item\" };\nconst _hoisted_11 = {\n    key: 0,\n    class: \"status-values-grid\"\n};\nconst _hoisted_12 = { class: \"value-name\" };\nconst _hoisted_13 = { class: \"value-number\" };\nconst _hoisted_14 = { class: \"status-text-card\" };\nconst _hoisted_15 = { class: \"text-card-row\" };\nconst _hoisted_16 = { class: \"text-card-content\" };\nconst _hoisted_17 = { class: \"text-card-row\" };\nconst _hoisted_18 = { class: \"text-card-content\" };\nconst _hoisted_19 = { class: \"text-card-row\" };\nconst _hoisted_20 = { class: \"text-card-content\" };\nconst _hoisted_21 = { class: \"text-card-row\" };\nconst _hoisted_22 = { class: \"text-card-content\" };\nconst _hoisted_23 = {\n    key: 1,\n    class: \"animate-in fade-in space-y-4 duration-200\"\n};\nimport _ from 'lodash';\nimport { nextTick, onMounted, ref, watch } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'CharacterStatusPanel',\n    props: {\n        show: { type: Boolean },\n        messageId: {},\n        statusBlock: {},\n        onClose: { type: Function }\n    },\n    setup(__props) {\n        const props = __props;\n        const activeTab = ref('status');\n        const theaterExpanded = ref(false);\n        const theaterContainer = ref(null);\n        const theaterRendered = ref(false);\n        const isLoading = ref(false);\n        // Tab\n        const tabs = [\n            { id: 'status', name: '' },\n            { id: 'theater', name: '' },\n        ];\n        // \n        const statusData = ref({\n            : '',\n            : '',\n            : '',\n            : '',\n            : '',\n            : '',\n        });\n        // MVU\n        const statusValues = ref({});\n        // MVU \n        async function getMvuStatData() {\n            try {\n                // MVU\n                if (typeof window !== 'undefined' && window.waitGlobalInitialized) {\n                    await window.waitGlobalInitialized('Mvu');\n                }\n                // MVU\n                if (typeof window !== 'undefined' && window.Mvu) {\n                    const mvuData = window.Mvu.getMvuData({\n                        type: 'message',\n                        message_id: props.messageId || 'latest',\n                    });\n                    if (mvuData?.stat_data) {\n                        return mvuData.stat_data;\n                    }\n                }\n            }\n            catch (error) {\n                console.warn('MVU:', error);\n            }\n            return null;\n        }\n        // MVU\n        async function loadStatusFromMvu() {\n            const statData = await getMvuStatData();\n            if (!statData)\n                return false;\n            // \n            const fields = ['', '', '', '', '', '', ''];\n            fields.forEach(field => {\n                const value = _.get(statData, field);\n                if (value !== undefined) {\n                    statusData.value[field] = String(value);\n                }\n            });\n            return true;\n        }\n        // StatusBlock\n        function loadStatusFromBlock() {\n            if (props.statusBlock) {\n                statusData.value = {\n                    ...statusData.value,\n                    ...props.statusBlock,\n                };\n            }\n        }\n        // MVU\n        async function extractStatusValues() {\n            const statData = await getMvuStatData();\n            if (!statData)\n                return;\n            // stat_data..\n            if (statData. && typeof statData. === 'object') {\n                const newValues = {};\n                // \n                Object.keys(statData.).forEach(characterName => {\n                    const characterData = statData.[characterName];\n                    if (characterData && typeof characterData === 'object') {\n                        // \n                        Object.keys(characterData).forEach(attrName => {\n                            const attrValue = characterData[attrName];\n                            if (typeof attrValue === 'number' || (typeof attrValue === 'string' && !isNaN(Number(attrValue)))) {\n                                newValues[attrName] = attrValue;\n                            }\n                        });\n                    }\n                });\n                statusValues.value = newValues;\n            }\n        }\n        // /\n        function toggleTheater() {\n            theaterExpanded.value = !theaterExpanded.value;\n            if (theaterExpanded.value) {\n                // nextTickDOM\n                nextTick(() => {\n                    if (!theaterRendered.value) {\n                        renderTheater();\n                    }\n                });\n            }\n        }\n        // \n        watch(activeTab, newTab => {\n            if (newTab === 'theater') {\n                // \n                theaterExpanded.value = true;\n                nextTick(() => {\n                    renderTheater();\n                });\n            }\n        }, { immediate: true });\n        // \n        function renderTheater() {\n            if (!theaterContainer.value || !statusData.value.) {\n                return;\n            }\n            const rawText = statusData.value.;\n            const container = theaterContainer.value;\n            // \n            container.innerHTML = '';\n            //  :  \n            const matches = [...rawText.matchAll(/([^:]+)[:](.*?)/g)];\n            if (matches.length === 0) {\n                // \n                const emptyMsg = document.createElement('div');\n                emptyMsg.textContent = '';\n                emptyMsg.style.textAlign = 'center';\n                emptyMsg.style.color = '#788a82';\n                emptyMsg.style.padding = '20px';\n                container.appendChild(emptyMsg);\n                theaterRendered.value = true;\n                return;\n            }\n            // \n            // \"\"/\"\"\n            const firstSpeaker = matches[0]?.[1]?.trim() || '';\n            const mainCharacterName = firstSpeaker.split('')[0].split('(')[0]; // \n            matches.forEach(match => {\n                const fullSpeaker = match[1]?.trim(); // OS\n                const content = match[2]?.trim();\n                if (!fullSpeaker || !content)\n                    return;\n                // \n                // {{user}}user - \n                // \n                const speakerName = fullSpeaker.split('')[0].split('(')[0].trim();\n                const isUser = speakerName === '{{user}}' ||\n                    speakerName.toLowerCase() === 'user' ||\n                    speakerName === '' ||\n                    fullSpeaker.includes('{{user}}') ||\n                    fullSpeaker.toLowerCase().includes('user') ||\n                    fullSpeaker.includes('');\n                const bubbleSide = isUser ? 'right' : 'left'; // \n                // \n                const bubbleWrapper = document.createElement('div');\n                bubbleWrapper.style.display = 'flex';\n                bubbleWrapper.style.flexDirection = 'column';\n                bubbleWrapper.style.marginBottom = '16px';\n                bubbleWrapper.style.alignItems = isUser ? 'flex-end' : 'flex-start';\n                // \n                const speakerLabel = document.createElement('div');\n                speakerLabel.textContent = speakerName; // \n                speakerLabel.style.fontSize = '0.75em';\n                speakerLabel.style.color = '#788a82';\n                speakerLabel.style.marginBottom = '4px';\n                speakerLabel.style.padding = '0 8px';\n                // \n                const bubble = document.createElement('div');\n                bubble.classList.add('bubble', bubbleSide);\n                bubble.textContent = content;\n                // \n                bubbleWrapper.appendChild(speakerLabel);\n                bubbleWrapper.appendChild(bubble);\n                container.appendChild(bubbleWrapper);\n            });\n            theaterRendered.value = true;\n        }\n        // \n        async function loadStatusData() {\n            if (isLoading.value)\n                return;\n            isLoading.value = true;\n            try {\n                // \n                statusValues.value = {};\n                theaterRendered.value = false;\n                // MVU\n                const mvuLoaded = await loadStatusFromMvu();\n                // MVU\n                await extractStatusValues();\n                // MVUStatusBlock\n                if (!mvuLoaded) {\n                    loadStatusFromBlock();\n                }\n            }\n            finally {\n                isLoading.value = false;\n            }\n        }\n        // props\n        watch(() => [props.show, props.messageId, props.statusBlock], () => {\n            if (props.show) {\n                loadStatusData();\n            }\n        }, { immediate: true });\n        onMounted(() => {\n            if (props.show) {\n                loadStatusData();\n            }\n        });\n        return (_ctx, _cache) => {\n            return (__props.show)\n                ? (_openBlock(), _createElementBlock(\"div\", {\n                    key: 0,\n                    class: \"absolute inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\",\n                    onClick: _cache[2] || (_cache[2] =\n                        //@ts-ignore\n                        (...args) => (__props.onClose && __props.onClose(...args)))\n                }, [\n                    _createElementVNode(\"div\", {\n                        class: \"bg-card max-h-[85vh] w-[90%] max-w-md overflow-hidden rounded-xl shadow-2xl\",\n                        onClick: _cache[1] || (_cache[1] = _withModifiers(() => { }, [\"stop\"]))\n                    }, [\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"div\", _hoisted_1, [\n                            _cache[4] || (_cache[4] = _createElementVNode(\"h2\", { class: \"text-foreground text-lg font-semibold\" }, \"\", -1 /* CACHED */)),\n                            _createElementVNode(\"button\", {\n                                class: \"hover:bg-muted rounded-full p-1 transition-colors\",\n                                \"aria-label\": \"\",\n                                onClick: _cache[0] || (_cache[0] =\n                                    //@ts-ignore\n                                    (...args) => (__props.onClose && __props.onClose(...args)))\n                            }, [...(_cache[3] || (_cache[3] = [\n                                    _createElementVNode(\"svg\", {\n                                        class: \"h-5 w-5\",\n                                        fill: \"none\",\n                                        stroke: \"currentColor\",\n                                        viewBox: \"0 0 24 24\"\n                                    }, [\n                                        _createElementVNode(\"path\", {\n                                            \"stroke-linecap\": \"round\",\n                                            \"stroke-linejoin\": \"round\",\n                                            \"stroke-width\": \"2\",\n                                            d: \"M6 18L18 6M6 6l12 12\"\n                                        })\n                                    ], -1 /* CACHED */)\n                                ]))])\n                        ]),\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"div\", _hoisted_2, [\n                            _createElementVNode(\"div\", _hoisted_3, [\n                                _createCommentVNode(\" Tab  -  \"),\n                                _createElementVNode(\"div\", _hoisted_4, [\n                                    (_openBlock(), _createElementBlock(_Fragment, null, _renderList(tabs, (tab) => {\n                                        return _createElementVNode(\"button\", {\n                                            key: tab.id,\n                                            class: _normalizeClass([\n                                                'flex-1 px-4 py-3 text-sm font-medium transition-all relative',\n                                                activeTab.value === tab.id ? 'text-primary' : 'text-muted-foreground hover:text-foreground',\n                                            ]),\n                                            onClick: ($event) => (activeTab.value = tab.id)\n                                        }, [\n                                            _createTextVNode(_toDisplayString(tab.name) + \" \", 1 /* TEXT */),\n                                            _createCommentVNode(\"  \"),\n                                            (activeTab.value === tab.id)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6))\n                                                : _createCommentVNode(\"v-if\", true)\n                                        ], 10 /* CLASS, PROPS */, _hoisted_5);\n                                    }), 64 /* STABLE_FRAGMENT */))\n                                ]),\n                                _createCommentVNode(\"  \"),\n                                (activeTab.value === 'status')\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [\n                                        _createCommentVNode(\"  \"),\n                                        _createElementVNode(\"div\", _hoisted_8, [\n                                            _createElementVNode(\"div\", _hoisted_9, [\n                                                _cache[5] || (_cache[5] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                                _createElementVNode(\"span\", null, _toDisplayString(statusData.value. || ''), 1 /* TEXT */)\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_10, [\n                                                _cache[6] || (_cache[6] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                                _createElementVNode(\"span\", null, _toDisplayString(statusData.value. || ''), 1 /* TEXT */)\n                                            ])\n                                        ]),\n                                        _createCommentVNode(\"  \"),\n                                        (Object.keys(statusValues.value).length > 0)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(statusValues.value, (value, key) => {\n                                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                                        key: key,\n                                                        class: \"value-card\"\n                                                    }, [\n                                                        _createElementVNode(\"div\", _hoisted_12, _toDisplayString(key), 1 /* TEXT */),\n                                                        _createElementVNode(\"div\", _hoisted_13, _toDisplayString(value), 1 /* TEXT */)\n                                                    ]));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ]))\n                                            : _createCommentVNode(\"v-if\", true),\n                                        _createCommentVNode(\"  \"),\n                                        _createElementVNode(\"div\", _hoisted_14, [\n                                            _createElementVNode(\"div\", _hoisted_15, [\n                                                _cache[7] || (_cache[7] = _createElementVNode(\"span\", { class: \"text-card-label\" }, \"\", -1 /* CACHED */)),\n                                                _createElementVNode(\"span\", _hoisted_16, _toDisplayString(statusData.value. || ''), 1 /* TEXT */)\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_17, [\n                                                _cache[8] || (_cache[8] = _createElementVNode(\"span\", { class: \"text-card-label\" }, \"\", -1 /* CACHED */)),\n                                                _createElementVNode(\"span\", _hoisted_18, _toDisplayString(statusData.value. || ''), 1 /* TEXT */)\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_19, [\n                                                _cache[9] || (_cache[9] = _createElementVNode(\"span\", { class: \"text-card-label\" }, \"\", -1 /* CACHED */)),\n                                                _createElementVNode(\"span\", _hoisted_20, _toDisplayString(statusData.value. || ''), 1 /* TEXT */)\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_21, [\n                                                _cache[10] || (_cache[10] = _createElementVNode(\"span\", { class: \"text-card-label\" }, \"\", -1 /* CACHED */)),\n                                                _createElementVNode(\"span\", _hoisted_22, _toDisplayString(statusData.value. || ''), 1 /* TEXT */)\n                                            ])\n                                        ])\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true),\n                                _createCommentVNode(\"  \"),\n                                (activeTab.value === 'theater')\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_23, [\n                                        _cache[11] || (_cache[11] = _createElementVNode(\"div\", { class: \"theater-title\" }, \"    \", -1 /* CACHED */)),\n                                        _createElementVNode(\"div\", {\n                                            ref_key: \"theaterContainer\",\n                                            ref: theaterContainer,\n                                            class: \"theater-bubbles-container overflow-y-auto max-h-[calc(85vh-200px)]\"\n                                        }, null, 512 /* NEED_PATCH */)\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ])\n                        ])\n                    ])\n                ]))\n                : _createCommentVNode(\"v-if\", true);\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./CharacterStatusPanel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./CharacterStatusPanel.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./CharacterStatusPanel.vue?vue&type=style&index=0&id=68497338&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_53ff6257bd8fdf8315af10a81f7e3da1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-68497338\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeStyle as _normalizeStyle, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, vModelText as _vModelText, withModifiers as _withModifiers, withKeys as _withKeys, withDirectives as _withDirectives, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = [\"onClick\"];\nconst _hoisted_2 = {\n    key: 1,\n    class: \"flex items-center gap-2\"\n};\nimport { computed, nextTick, ref, watch } from 'vue';\nimport { borderWidthPresets, boxShapePresets, defaultDialogStyle } from '../types/galgame';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ChoiceBox',\n    props: {\n        options: {},\n        customStyle: {},\n        onSelect: { type: Function },\n        onPrev: { type: Function },\n        onNext: { type: Function },\n        onSave: { type: Function }\n    },\n    setup(__props) {\n        const props = __props;\n        const isInputting = ref(false);\n        const inputText = ref('');\n        const selectedCustom = ref(false);\n        const inputRef = ref(null);\n        function handleOptionClick(id) {\n            if (selectedCustom.value) {\n                selectedCustom.value = false;\n            }\n            props.onSelect(id);\n        }\n        function handleCustomClick() {\n            if (!isInputting.value) {\n                isInputting.value = true;\n                nextTick(() => {\n                    inputRef.value?.focus();\n                });\n            }\n            else if (inputText.value.trim() && !selectedCustom.value) {\n                selectedCustom.value = true;\n            }\n            else if (selectedCustom.value) {\n                props.onSelect('custom', inputText.value);\n            }\n        }\n        function handleInputConfirm() {\n            if (inputText.value.trim()) {\n                if (!selectedCustom.value) {\n                    selectedCustom.value = true;\n                }\n                else {\n                    props.onSelect('custom', inputText.value);\n                }\n            }\n        }\n        function handleSave() {\n            if (inputText.value.trim() && props.onSave) {\n                props.onSave(inputText.value.trim());\n                // \n                inputText.value = '';\n                isInputting.value = false;\n                selectedCustom.value = false;\n            }\n        }\n        watch(() => props.options, () => {\n            // \n            isInputting.value = false;\n            inputText.value = '';\n            selectedCustom.value = false;\n        });\n        const dialogStyle = computed(() => props.customStyle || defaultDialogStyle);\n        const boxShape = computed(() => boxShapePresets.find(p => p.id === dialogStyle.value.boxShape) || boxShapePresets[0]);\n        const borderWidthPreset = computed(() => borderWidthPresets.find(p => p.id === dialogStyle.value.borderWidth) || borderWidthPresets[1]);\n        const isPillShape = computed(() => dialogStyle.value.boxShape === 'pill');\n        function handleBackgroundClick(e) {\n            const rect = e.currentTarget.getBoundingClientRect();\n            const clickX = e.clientX - rect.left;\n            const halfWidth = rect.width / 2;\n            if (clickX < halfWidth) {\n                // \n                props.onPrev?.();\n            }\n            else {\n                // \n                props.onNext?.();\n            }\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: \"absolute inset-0 z-25 flex items-center justify-center bg-black/30 backdrop-blur-sm\",\n                onClick: handleBackgroundClick\n            }, [\n                _createElementVNode(\"div\", {\n                    class: \"flex w-full max-w-md flex-col gap-3 px-6\",\n                    onClick: _cache[2] || (_cache[2] = _withModifiers(() => { }, [\"stop\"]))\n                }, [\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.options, (option, index) => {\n                        return (_openBlock(), _createElementBlock(\"button\", {\n                            key: option.id,\n                            class: \"w-full p-4 text-left transition-all hover:scale-[1.02] active:scale-[0.98]\",\n                            style: _normalizeStyle({\n                                backgroundColor: isPillShape.value ? 'rgba(255, 255, 255, 0.7)' : dialogStyle.value.colors.boxBackground,\n                                borderRadius: boxShape.value.borderRadius,\n                                borderTopWidth: borderWidthPreset.value.width,\n                                borderLeftWidth: borderWidthPreset.value.width,\n                                borderRightWidth: borderWidthPreset.value.width,\n                                borderBottomWidth: borderWidthPreset.value.width,\n                                borderStyle: 'solid',\n                                borderColor: dialogStyle.value.colors.boxBorder,\n                                boxShadow: boxShape.value.shadow,\n                                color: dialogStyle.value.colors.dialogText,\n                                fontSize: `${dialogStyle.value.fontSize}px`,\n                                backdropFilter: isPillShape.value ? 'blur(12px)' : undefined,\n                                WebkitBackdropFilter: isPillShape.value ? 'blur(12px)' : undefined,\n                            }),\n                            onClick: () => handleOptionClick(option.id)\n                        }, _toDisplayString(option.text), 13 /* TEXT, STYLE, PROPS */, _hoisted_1));\n                    }), 128 /* KEYED_FRAGMENT */)),\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", {\n                        class: _normalizeClass(['w-full p-4 transition-all cursor-pointer', selectedCustom.value ? 'ring-2 ring-primary' : '']),\n                        style: _normalizeStyle({\n                            backgroundColor: isPillShape.value ? 'rgba(255, 255, 255, 0.7)' : dialogStyle.value.colors.boxBackground,\n                            borderRadius: boxShape.value.borderRadius,\n                            borderTopWidth: borderWidthPreset.value.width,\n                            borderLeftWidth: borderWidthPreset.value.width,\n                            borderRightWidth: borderWidthPreset.value.width,\n                            borderBottomWidth: borderWidthPreset.value.width,\n                            borderStyle: 'solid',\n                            borderColor: dialogStyle.value.colors.boxBorder,\n                            boxShadow: boxShape.value.shadow,\n                            fontSize: `${dialogStyle.value.fontSize}px`,\n                            backdropFilter: isPillShape.value ? 'blur(12px)' : undefined,\n                            WebkitBackdropFilter: isPillShape.value ? 'blur(12px)' : undefined,\n                        }),\n                        onClick: handleCustomClick\n                    }, [\n                        (!isInputting.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", {\n                                key: 0,\n                                class: \"flex items-center gap-2\",\n                                style: _normalizeStyle({ color: dialogStyle.value.colors.narrationText })\n                            }, [...(_cache[3] || (_cache[3] = [\n                                    _createElementVNode(\"svg\", {\n                                        class: \"h-4 w-4\",\n                                        fill: \"none\",\n                                        stroke: \"currentColor\",\n                                        viewBox: \"0 0 24 24\"\n                                    }, [\n                                        _createElementVNode(\"path\", {\n                                            \"stroke-linecap\": \"round\",\n                                            \"stroke-linejoin\": \"round\",\n                                            \"stroke-width\": \"2\",\n                                            d: \"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"\n                                        })\n                                    ], -1 /* CACHED */),\n                                    _createElementVNode(\"span\", null, \"...\", -1 /* CACHED */)\n                                ]))], 4 /* STYLE */))\n                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    ref_key: \"inputRef\",\n                                    ref: inputRef,\n                                    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((inputText).value = $event)),\n                                    type: \"text\",\n                                    placeholder: \"...\",\n                                    class: \"flex-1 bg-transparent outline-none\",\n                                    style: _normalizeStyle({ color: dialogStyle.value.colors.dialogText }),\n                                    onClick: _cache[1] || (_cache[1] = _withModifiers(() => { }, [\"stop\"])),\n                                    onKeydown: _withKeys(handleInputConfirm, [\"enter\"]),\n                                    autofocus: \"\"\n                                }, null, 36 /* STYLE, NEED_HYDRATION */), [\n                                    [_vModelText, inputText.value]\n                                ]),\n                                _createCommentVNode(\" / \"),\n                                (inputText.value.trim())\n                                    ? (_openBlock(), _createElementBlock(\"svg\", {\n                                        key: 0,\n                                        class: \"h-5 w-5 transition-colors cursor-pointer\",\n                                        style: _normalizeStyle({ color: selectedCustom.value ? dialogStyle.value.colors.nameText : dialogStyle.value.colors.narrationText }),\n                                        fill: \"none\",\n                                        stroke: \"currentColor\",\n                                        viewBox: \"0 0 24 24\",\n                                        onClick: _withModifiers(handleInputConfirm, [\"stop\"])\n                                    }, [...(_cache[4] || (_cache[4] = [\n                                            _createElementVNode(\"path\", {\n                                                \"stroke-linecap\": \"round\",\n                                                \"stroke-linejoin\": \"round\",\n                                                \"stroke-width\": \"2\",\n                                                d: \"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\n                                            }, null, -1 /* CACHED */)\n                                        ]))], 4 /* STYLE */))\n                                    : _createCommentVNode(\"v-if\", true),\n                                _createCommentVNode(\"  \"),\n                                (inputText.value.trim())\n                                    ? (_openBlock(), _createElementBlock(\"button\", {\n                                        key: 1,\n                                        class: \"p-1 transition-colors hover:opacity-80\",\n                                        style: _normalizeStyle({ color: dialogStyle.value.colors.nameText }),\n                                        \"aria-label\": \"\",\n                                        title: \"\",\n                                        onClick: _withModifiers(handleSave, [\"stop\"])\n                                    }, [...(_cache[5] || (_cache[5] = [\n                                            _createElementVNode(\"svg\", {\n                                                class: \"h-5 w-5\",\n                                                fill: \"none\",\n                                                stroke: \"currentColor\",\n                                                viewBox: \"0 0 24 24\"\n                                            }, [\n                                                _createElementVNode(\"path\", {\n                                                    \"stroke-linecap\": \"round\",\n                                                    \"stroke-linejoin\": \"round\",\n                                                    \"stroke-width\": \"2\",\n                                                    d: \"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12\"\n                                                })\n                                            ], -1 /* CACHED */)\n                                        ]))], 4 /* STYLE */))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]))\n                    ], 6 /* CLASS, STYLE */)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./ChoiceBox.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ChoiceBox.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, withModifiers as _withModifiers, normalizeClass as _normalizeClass, normalizeStyle as _normalizeStyle, toDisplayString as _toDisplayString, resolveDynamicComponent as _resolveDynamicComponent, createBlock as _createBlock, vModelText as _vModelText, withDirectives as _withDirectives, Fragment as _Fragment } from \"vue\";\nconst _hoisted_1 = { class: \"absolute bottom-0 left-0 right-0 z-20 px-4 md:px-8 pb-4 md:pb-6\" };\nconst _hoisted_2 = { class: \"flex items-center gap-2 md:gap-4 max-w-4xl mx-auto\" };\nconst _hoisted_3 = [\"disabled\"];\nconst _hoisted_4 = {\n    key: 0,\n    class: \"absolute left-2 top-1/2 -translate-y-1/2 z-10\"\n};\nconst _hoisted_5 = [\"disabled\"];\nconst _hoisted_6 = {\n    key: 1,\n    class: \"ml-auto flex gap-2\"\n};\nconst _hoisted_7 = [\"innerHTML\"];\nconst _hoisted_8 = {\n    key: 0,\n    class: \"animate-pulse ml-0.5\"\n};\nconst _hoisted_9 = { class: \"absolute bottom-3 right-4\" };\nconst _hoisted_10 = {\n    key: 1,\n    class: \"absolute right-2 top-1/2 -translate-y-1/2 z-10\"\n};\nconst _hoisted_11 = [\"disabled\"];\nconst _hoisted_12 = [\"disabled\"];\nconst _hoisted_13 = { class: \"flex gap-3 mt-4 justify-end\" };\nimport { computed, h, onMounted, onUnmounted, ref, watch } from 'vue';\nimport { arrowShapePresets, backgroundPatternPresets, borderWidthPresets, boxShapePresets, defaultDialogStyle, indicatorShapePresets, nameShapePresets, } from '../types/galgame';\nconst TYPING_SPEED = 50;\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'DialogBox',\n    props: {\n        character: {},\n        text: {},\n        isLastDialogue: { type: Boolean },\n        isFirstDialogue: { type: Boolean },\n        onPrev: { type: Function },\n        onNext: { type: Function },\n        dialogKey: {},\n        customStyle: {},\n        isLoading: { type: Boolean },\n        streamingText: {},\n        isThrough: { type: Boolean },\n        isEditable: { type: Boolean },\n        messageId: {},\n        onEdit: { type: Function },\n        onDelete: { type: Function }\n    },\n    setup(__props) {\n        const props = __props;\n        const displayedText = ref('');\n        const isTyping = ref(true);\n        let typingTimer = null;\n        const dialogStyle = computed(() => props.customStyle || defaultDialogStyle);\n        const boxShape = computed(() => boxShapePresets.find(p => p.id === dialogStyle.value.boxShape) || boxShapePresets[0]);\n        const nameShape = computed(() => nameShapePresets.find(p => p.id === dialogStyle.value.nameShape) || nameShapePresets[0]);\n        const arrowShape = computed(() => arrowShapePresets.find(p => p.id === dialogStyle.value.arrowShape) || arrowShapePresets[0]);\n        const indicatorShape = computed(() => indicatorShapePresets.find(p => p.id === dialogStyle.value.indicatorShape) || indicatorShapePresets[0]);\n        const borderWidth = computed(() => borderWidthPresets.find(p => p.id === dialogStyle.value.borderWidth) || borderWidthPresets[1]);\n        const bgPattern = computed(() => backgroundPatternPresets.find(p => p.id === dialogStyle.value.backgroundPattern));\n        const isNarration = computed(() => !props.character || props.character.trim() === '');\n        const isInnerArrow = computed(() => arrowShape.value.isInner);\n        const isMinimalArrow = computed(() => arrowShape.value.type === 'minimal');\n        const isPillShape = computed(() => dialogStyle.value.boxShape === 'pill');\n        // \n        const getPatternStyle = computed(() => {\n            if (!bgPattern.value?.pattern)\n                return {};\n            const borderColorForPattern = dialogStyle.value.colors.boxBorder.replace(/[\\d.]+\\)$/, '0.08)');\n            const patternWithColor = bgPattern.value.pattern.replace(/VAR_BORDER_COLOR/g, borderColorForPattern);\n            let backgroundSize = '20px 20px';\n            if (bgPattern.value.id === 'dots')\n                backgroundSize = '16px 16px';\n            if (bgPattern.value.id === 'diamonds')\n                backgroundSize = '16px 16px';\n            if (bgPattern.value.id === 'stripes')\n                backgroundSize = '28px 28px';\n            return {\n                backgroundImage: patternWithColor,\n                backgroundSize,\n            };\n        });\n        const boxStyle = computed(() => {\n            const style = {\n                backgroundColor: isPillShape.value ? 'rgba(255, 255, 255, 0.7)' : dialogStyle.value.colors.boxBackground,\n                borderRadius: boxShape.value.borderRadius,\n                borderTopWidth: borderWidth.value.width,\n                borderLeftWidth: borderWidth.value.width,\n                borderRightWidth: borderWidth.value.width,\n                borderBottomWidth: borderWidth.value.width,\n                borderStyle: 'solid',\n                borderColor: dialogStyle.value.colors.boxBorder,\n                boxShadow: boxShape.value.shadow,\n                ...(isPillShape.value ? { backdropFilter: 'blur(12px)', WebkitBackdropFilter: 'blur(12px)' } : {}),\n                ...getPatternStyle.value,\n            };\n            return style;\n        });\n        const outerArrowStyle = computed(() => {\n            const isDisabled = props.isFirstDialogue || props.isLastDialogue;\n            const iconColor = isDisabled ? `${dialogStyle.value.colors.arrowIcon}66` : dialogStyle.value.colors.arrowIcon;\n            if (isMinimalArrow.value) {\n                return {\n                    color: iconColor,\n                };\n            }\n            const bgColor = dialogStyle.value.colors.arrowBackground;\n            let borderRadius = '9999px';\n            if (arrowShape.value.type === 'square' || arrowShape.value.type === 'inner-square')\n                borderRadius = '6px';\n            if (arrowShape.value.type === 'pill')\n                borderRadius = '16px';\n            return {\n                backgroundColor: bgColor,\n                borderRadius,\n                color: iconColor,\n            };\n        });\n        const innerLeftArrowStyle = computed(() => {\n            const isDisabled = props.isFirstDialogue;\n            const iconColor = isDisabled ? `${dialogStyle.value.colors.arrowIcon}66` : dialogStyle.value.colors.arrowIcon;\n            const isRound = arrowShape.value.type === 'inner-round';\n            return {\n                background: isRound ? dialogStyle.value.colors.arrowBackground : 'transparent',\n                color: iconColor,\n            };\n        });\n        const innerRightArrowStyle = computed(() => {\n            const isDisabled = props.isLastDialogue;\n            const iconColor = isDisabled ? `${dialogStyle.value.colors.arrowIcon}66` : dialogStyle.value.colors.arrowIcon;\n            const isRound = arrowShape.value.type === 'inner-round';\n            return {\n                background: isRound ? dialogStyle.value.colors.arrowBackground : 'transparent',\n                color: iconColor,\n            };\n        });\n        // \n        const indicatorComponent = computed(() => {\n            const { type } = indicatorShape.value;\n            const { indicatorColor } = dialogStyle.value.colors;\n            if (type === 'none')\n                return null;\n            // \n            const isStreaming = props.isLoading || false;\n            if (type === 'dots') {\n                return h('div', { class: 'flex gap-1 items-center' }, [0, 1, 2].map(i => h('span', {\n                    key: i,\n                    class: 'w-1.5 h-1.5 rounded-full transition-opacity duration-500',\n                    style: {\n                        backgroundColor: indicatorColor,\n                        opacity: isStreaming ? (i === 2 ? 1 : 0.4) : 0.6,\n                        animation: isStreaming && i === 2 ? 'pulse 1s ease-in-out infinite' : undefined,\n                    },\n                })));\n            }\n            if (type === 'diamonds') {\n                return h('div', { class: 'flex gap-1 items-center' }, [0, 1, 2].map(i => h('span', {\n                    key: i,\n                    class: 'transition-all duration-300',\n                    style: {\n                        width: '8px',\n                        height: '8px',\n                        backgroundColor: indicatorColor,\n                        opacity: isStreaming ? (i === 2 ? 1 : 0.3 + i * 0.15) : 0.5,\n                        transform: `rotate(45deg) scale(${isStreaming && i === 2 ? 1.1 : 0.9})`,\n                        animation: isStreaming && i === 2 ? 'diamondPulse 1.2s ease-in-out infinite' : undefined,\n                        display: 'inline-block',\n                    },\n                })));\n            }\n            if (type === 'pulse') {\n                return h('div', { class: 'relative w-3 h-3' }, [\n                    h('span', {\n                        class: 'absolute inset-0 rounded-full',\n                        style: {\n                            backgroundColor: indicatorColor,\n                            opacity: 0.4,\n                            animation: isStreaming ? 'ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite' : undefined,\n                        },\n                    }),\n                    h('span', {\n                        class: 'absolute inset-0 rounded-full',\n                        style: {\n                            backgroundColor: indicatorColor,\n                            animation: isStreaming ? 'pulse 2s ease-in-out infinite' : undefined,\n                        },\n                    }),\n                ]);\n            }\n            if (type === 'arrow') {\n                return h('svg', {\n                    class: 'w-4 h-4 transition-transform duration-300',\n                    style: {\n                        color: indicatorColor,\n                        animation: isStreaming ? 'arrowBounce 0.8s ease-in-out infinite' : undefined,\n                    },\n                    fill: 'none',\n                    stroke: 'currentColor',\n                    viewBox: '0 0 24 24',\n                }, [\n                    h('path', {\n                        'stroke-linecap': 'round',\n                        'stroke-linejoin': 'round',\n                        'stroke-width': '2',\n                        d: 'M9 5l7 7-7 7',\n                    }),\n                ]);\n            }\n            return null;\n        });\n        function handlePrev() {\n            if (!props.isFirstDialogue) {\n                props.onPrev();\n            }\n        }\n        function handleNext() {\n            if (!props.isLastDialogue) {\n                props.onNext();\n            }\n        }\n        //  ** \n        function formatTextWithThoughts(text) {\n            if (!text)\n                return '';\n            //  ** \n            //  **  *through* \n            return text.replace(/\\*([^*]+)\\*/g, (match, content) => {\n                //  *through* \n                if (content.trim() === 'through')\n                    return match;\n                // \n                return ` <span style=\"color: #9ca3af; font-style: italic;\">${content}</span> `;\n            });\n        }\n        function clearTypingTimer() {\n            if (typingTimer) {\n                clearInterval(typingTimer);\n                typingTimer = null;\n            }\n        }\n        function startTyping() {\n            clearTypingTimer();\n            if (props.isLoading) {\n                displayedText.value = props.text;\n                isTyping.value = true;\n                return;\n            }\n            if (!props.text) {\n                displayedText.value = '';\n                isTyping.value = false;\n                return;\n            }\n            displayedText.value = '';\n            isTyping.value = true;\n            let index = 0;\n            typingTimer = setInterval(() => {\n                if (index < props.text.length) {\n                    displayedText.value = props.text.slice(0, index + 1);\n                    index++;\n                }\n                else {\n                    isTyping.value = false;\n                    clearTypingTimer();\n                }\n            }, TYPING_SPEED);\n        }\n        watch(() => [props.text, props.dialogKey, props.isLoading], () => {\n            startTyping();\n        }, { immediate: true });\n        onMounted(() => {\n            startTyping();\n        });\n        onUnmounted(() => {\n            clearTypingTimer();\n        });\n        // /\n        const showEditDialog = ref(false);\n        const editText = ref('');\n        function handleEdit() {\n            if (props.messageId === undefined)\n                return;\n            editText.value = props.text;\n            showEditDialog.value = true;\n        }\n        function handleDelete() {\n            if (props.messageId === undefined || !props.onDelete)\n                return;\n            if (confirm('')) {\n                props.onDelete(props.messageId);\n            }\n        }\n        function confirmEdit() {\n            if (props.messageId === undefined || !props.onEdit)\n                return;\n            if (editText.value.trim()) {\n                props.onEdit(props.messageId, editText.value.trim());\n                showEditDialog.value = false;\n            }\n        }\n        function cancelEdit() {\n            showEditDialog.value = false;\n            editText.value = '';\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(_Fragment, null, [\n                _createElementVNode(\"div\", _hoisted_1, [\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _createCommentVNode(\"  \"),\n                        (!isInnerArrow.value)\n                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                key: 0,\n                                disabled: __props.isFirstDialogue,\n                                class: _normalizeClass([\n                                    'flex flex-shrink-0 items-center justify-center transition-all duration-200',\n                                    __props.isFirstDialogue ? 'cursor-not-allowed opacity-40' : 'hover:scale-105',\n                                ]),\n                                style: _normalizeStyle(outerArrowStyle.value),\n                                \"aria-label\": \"\",\n                                onClick: _withModifiers(handlePrev, [\"stop\"])\n                            }, [...(_cache[2] || (_cache[2] = [\n                                    _createElementVNode(\"svg\", {\n                                        class: \"h-5 w-5\",\n                                        fill: \"none\",\n                                        stroke: \"currentColor\",\n                                        viewBox: \"0 0 24 24\"\n                                    }, [\n                                        _createElementVNode(\"path\", {\n                                            \"stroke-linecap\": \"round\",\n                                            \"stroke-linejoin\": \"round\",\n                                            \"stroke-width\": \"2\",\n                                            d: \"M15 19l-7-7 7-7\"\n                                        })\n                                    ], -1 /* CACHED */)\n                                ]))], 14 /* CLASS, STYLE, PROPS */, _hoisted_3))\n                            : _createCommentVNode(\"v-if\", true),\n                        _createCommentVNode(\"  \"),\n                        _createElementVNode(\"div\", {\n                            class: \"flex-1 relative p-4 md:p-5 min-h-[120px]\",\n                            style: _normalizeStyle(boxStyle.value)\n                        }, [\n                            _createCommentVNode(\"  \"),\n                            (isInnerArrow.value)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [\n                                    _createElementVNode(\"button\", {\n                                        disabled: __props.isFirstDialogue,\n                                        class: _normalizeClass([\n                                            'flex items-center justify-center transition-all duration-200',\n                                            __props.isFirstDialogue ? 'cursor-not-allowed opacity-40' : 'hover:bg-opacity-100',\n                                        ]),\n                                        style: _normalizeStyle(innerLeftArrowStyle.value),\n                                        \"aria-label\": \"\",\n                                        onClick: _withModifiers(handlePrev, [\"stop\"])\n                                    }, [...(_cache[3] || (_cache[3] = [\n                                            _createElementVNode(\"svg\", {\n                                                class: \"h-5 w-5\",\n                                                fill: \"none\",\n                                                stroke: \"currentColor\",\n                                                viewBox: \"0 0 24 24\"\n                                            }, [\n                                                _createElementVNode(\"path\", {\n                                                    \"stroke-linecap\": \"round\",\n                                                    \"stroke-linejoin\": \"round\",\n                                                    \"stroke-width\": \"2\",\n                                                    d: \"M15 19l-7-7 7-7\"\n                                                })\n                                            ], -1 /* CACHED */)\n                                        ]))], 14 /* CLASS, STYLE, PROPS */, _hoisted_5)\n                                ]))\n                                : _createCommentVNode(\"v-if\", true),\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", {\n                                class: \"h-6 mb-2 flex items-start\",\n                                style: _normalizeStyle({\n                                    paddingLeft: isInnerArrow.value ? '48px' : 0,\n                                    paddingRight: isInnerArrow.value ? '48px' : 0,\n                                })\n                            }, [\n                                (!isNarration.value)\n                                    ? (_openBlock(), _createElementBlock(\"div\", {\n                                        key: 0,\n                                        class: \"px-3 py-1 text-sm font-medium\",\n                                        style: _normalizeStyle({\n                                            backgroundColor: dialogStyle.value.colors.nameBackground,\n                                            color: dialogStyle.value.colors.nameText,\n                                            borderRadius: nameShape.value.borderRadius,\n                                            borderBottom: nameShape.value.style === 'underline' ? `2px solid ${dialogStyle.value.colors.nameText}` : undefined,\n                                            boxShadow: nameShape.value.style === 'floating' ? '0 2px 8px rgba(0,0,0,0.1)' : undefined,\n                                        })\n                                    }, _toDisplayString(__props.character), 5 /* TEXT, STYLE */))\n                                    : _createCommentVNode(\"v-if\", true),\n                                _createCommentVNode(\" /user \"),\n                                (props.isEditable && props.messageId !== undefined)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [\n                                        _createElementVNode(\"button\", {\n                                            onClick: _withModifiers(handleEdit, [\"stop\"]),\n                                            class: \"p-1 rounded transition-colors hover:bg-black/10\",\n                                            \"aria-label\": \"\",\n                                            title: \"\"\n                                        }, [...(_cache[4] || (_cache[4] = [\n                                                _createElementVNode(\"svg\", {\n                                                    class: \"h-4 w-4\",\n                                                    fill: \"none\",\n                                                    stroke: \"currentColor\",\n                                                    viewBox: \"0 0 24 24\"\n                                                }, [\n                                                    _createElementVNode(\"path\", {\n                                                        \"stroke-linecap\": \"round\",\n                                                        \"stroke-linejoin\": \"round\",\n                                                        \"stroke-width\": \"2\",\n                                                        d: \"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"\n                                                    })\n                                                ], -1 /* CACHED */)\n                                            ]))]),\n                                        _createElementVNode(\"button\", {\n                                            onClick: _withModifiers(handleDelete, [\"stop\"]),\n                                            class: \"p-1 rounded transition-colors hover:bg-red-500/20\",\n                                            \"aria-label\": \"\",\n                                            title: \"\"\n                                        }, [...(_cache[5] || (_cache[5] = [\n                                                _createElementVNode(\"svg\", {\n                                                    class: \"h-4 w-4 text-red-500\",\n                                                    fill: \"none\",\n                                                    stroke: \"currentColor\",\n                                                    viewBox: \"0 0 24 24\"\n                                                }, [\n                                                    _createElementVNode(\"path\", {\n                                                        \"stroke-linecap\": \"round\",\n                                                        \"stroke-linejoin\": \"round\",\n                                                        \"stroke-width\": \"2\",\n                                                        d: \"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"\n                                                    })\n                                                ], -1 /* CACHED */)\n                                            ]))])\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ], 4 /* STYLE */),\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", {\n                                class: _normalizeClass(['leading-relaxed', isNarration.value ? 'italic text-center' : '']),\n                                style: _normalizeStyle({\n                                    color: isNarration.value ? dialogStyle.value.colors.narrationText : dialogStyle.value.colors.dialogText,\n                                    fontSize: `${dialogStyle.value.fontSize}px`,\n                                    paddingLeft: isInnerArrow.value ? '48px' : 0,\n                                    paddingRight: isInnerArrow.value ? '48px' : 0,\n                                })\n                            }, [\n                                _createElementVNode(\"span\", {\n                                    innerHTML: formatTextWithThoughts(displayedText.value)\n                                }, null, 8 /* PROPS */, _hoisted_7),\n                                (isTyping.value)\n                                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_8, \"|\"))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ], 6 /* CLASS, STYLE */),\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", _hoisted_9, [\n                                (_openBlock(), _createBlock(_resolveDynamicComponent(indicatorComponent.value)))\n                            ]),\n                            _createCommentVNode(\"  \"),\n                            (isInnerArrow.value)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [\n                                    _createElementVNode(\"button\", {\n                                        disabled: __props.isLastDialogue,\n                                        class: _normalizeClass([\n                                            'flex items-center justify-center transition-all duration-200',\n                                            __props.isLastDialogue ? 'cursor-not-allowed opacity-40' : 'hover:bg-opacity-100',\n                                        ]),\n                                        style: _normalizeStyle(innerRightArrowStyle.value),\n                                        \"aria-label\": \"\",\n                                        onClick: _withModifiers(handleNext, [\"stop\"])\n                                    }, [...(_cache[6] || (_cache[6] = [\n                                            _createElementVNode(\"svg\", {\n                                                class: \"h-5 w-5\",\n                                                fill: \"none\",\n                                                stroke: \"currentColor\",\n                                                viewBox: \"0 0 24 24\"\n                                            }, [\n                                                _createElementVNode(\"path\", {\n                                                    \"stroke-linecap\": \"round\",\n                                                    \"stroke-linejoin\": \"round\",\n                                                    \"stroke-width\": \"2\",\n                                                    d: \"M9 5l7 7-7 7\"\n                                                })\n                                            ], -1 /* CACHED */)\n                                        ]))], 14 /* CLASS, STYLE, PROPS */, _hoisted_11)\n                                ]))\n                                : _createCommentVNode(\"v-if\", true)\n                        ], 4 /* STYLE */),\n                        _createCommentVNode(\"  \"),\n                        (!isInnerArrow.value)\n                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                key: 1,\n                                disabled: __props.isLastDialogue,\n                                class: _normalizeClass([\n                                    'flex flex-shrink-0 items-center justify-center transition-all duration-200',\n                                    __props.isLastDialogue ? 'cursor-not-allowed opacity-40' : 'hover:scale-105',\n                                ]),\n                                style: _normalizeStyle(outerArrowStyle.value),\n                                \"aria-label\": \"\",\n                                onClick: _withModifiers(handleNext, [\"stop\"])\n                            }, [...(_cache[7] || (_cache[7] = [\n                                    _createElementVNode(\"svg\", {\n                                        class: \"h-5 w-5\",\n                                        fill: \"none\",\n                                        stroke: \"currentColor\",\n                                        viewBox: \"0 0 24 24\"\n                                    }, [\n                                        _createElementVNode(\"path\", {\n                                            \"stroke-linecap\": \"round\",\n                                            \"stroke-linejoin\": \"round\",\n                                            \"stroke-width\": \"2\",\n                                            d: \"M9 5l7 7-7 7\"\n                                        })\n                                    ], -1 /* CACHED */)\n                                ]))], 14 /* CLASS, STYLE, PROPS */, _hoisted_12))\n                            : _createCommentVNode(\"v-if\", true)\n                    ])\n                ]),\n                _createCommentVNode(\"  \"),\n                (showEditDialog.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\",\n                        onClick: cancelEdit\n                    }, [\n                        _createElementVNode(\"div\", {\n                            class: \"bg-card rounded-lg p-6 shadow-xl max-w-md w-full mx-4\",\n                            onClick: _cache[1] || (_cache[1] = _withModifiers(() => { }, [\"stop\"])),\n                            style: _normalizeStyle({\n                                backgroundColor: dialogStyle.value.colors.boxBackground,\n                                borderColor: dialogStyle.value.colors.boxBorder,\n                                borderWidth: '1px',\n                                borderStyle: 'solid',\n                            })\n                        }, [\n                            _createElementVNode(\"h3\", {\n                                class: \"text-lg font-semibold mb-4\",\n                                style: _normalizeStyle({ color: dialogStyle.value.colors.dialogText })\n                            }, \"\", 4 /* STYLE */),\n                            _withDirectives(_createElementVNode(\"textarea\", {\n                                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((editText).value = $event)),\n                                class: \"w-full p-3 rounded border resize-none focus:outline-none focus:ring-2\",\n                                style: _normalizeStyle({\n                                    backgroundColor: dialogStyle.value.colors.boxBackground,\n                                    borderColor: dialogStyle.value.colors.boxBorder,\n                                    color: dialogStyle.value.colors.dialogText,\n                                }),\n                                rows: \"4\",\n                                placeholder: \"...\"\n                            }, null, 4 /* STYLE */), [\n                                [_vModelText, editText.value]\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_13, [\n                                _createElementVNode(\"button\", {\n                                    onClick: cancelEdit,\n                                    class: \"px-4 py-2 rounded transition-colors\",\n                                    style: _normalizeStyle({\n                                        backgroundColor: dialogStyle.value.colors.boxBorder + '40',\n                                        color: dialogStyle.value.colors.dialogText,\n                                    })\n                                }, \"  \", 4 /* STYLE */),\n                                _createElementVNode(\"button\", {\n                                    onClick: confirmEdit,\n                                    class: \"px-4 py-2 rounded transition-colors\",\n                                    style: _normalizeStyle({\n                                        backgroundColor: dialogStyle.value.colors.nameBackground,\n                                        color: dialogStyle.value.colors.nameText,\n                                    })\n                                }, \"  \", 4 /* STYLE */)\n                            ])\n                        ], 4 /* STYLE */)\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 64 /* STABLE_FRAGMENT */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./DialogBox.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./DialogBox.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./DialogBox.vue?vue&type=style&index=0&id=e28cdea0&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_53ff6257bd8fdf8315af10a81f7e3da1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-e28cdea0\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, normalizeStyle as _normalizeStyle, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"space-y-1.5\" };\nconst _hoisted_2 = { class: \"flex items-center justify-between\" };\nconst _hoisted_3 = { class: \"text-muted-foreground text-xs\" };\nconst _hoisted_4 = { class: \"flex items-center gap-2\" };\nconst _hoisted_5 = { class: \"text-muted-foreground w-5 text-[10px]\" };\nconst _hoisted_6 = [\"onPointerdown\", \"onPointermove\", \"onPointerup\"];\nconst _hoisted_7 = { class: \"text-muted-foreground w-9 text-right text-[10px]\" };\nimport { computed, ref, watch } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ColorSlider',\n    props: {\n        label: {},\n        value: {},\n        showAlpha: { type: Boolean, default: true }\n    },\n    emits: [\"update:value\"],\n    setup(__props, { emit: __emit }) {\n        const props = __props;\n        const emit = __emit;\n        // HSL \n        function hexToHsl(hex) {\n            let r = 0, g = 0, b = 0, a = 1;\n            if (hex.startsWith('rgba')) {\n                const match = hex.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*([\\d.]+))?\\)/);\n                if (match) {\n                    r = Number.parseInt(match[1]) / 255;\n                    g = Number.parseInt(match[2]) / 255;\n                    b = Number.parseInt(match[3]) / 255;\n                    a = match[4] ? Number.parseFloat(match[4]) : 1;\n                }\n            }\n            else if (hex.startsWith('rgb')) {\n                const match = hex.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\n                if (match) {\n                    r = Number.parseInt(match[1]) / 255;\n                    g = Number.parseInt(match[2]) / 255;\n                    b = Number.parseInt(match[3]) / 255;\n                }\n            }\n            else if (hex.startsWith('#')) {\n                const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})?$/i.exec(hex);\n                if (result) {\n                    r = Number.parseInt(result[1], 16) / 255;\n                    g = Number.parseInt(result[2], 16) / 255;\n                    b = Number.parseInt(result[3], 16) / 255;\n                    a = result[4] ? Number.parseInt(result[4], 16) / 255 : 1;\n                }\n            }\n            const max = Math.max(r, g, b);\n            const min = Math.min(r, g, b);\n            let h = 0;\n            let s = 0;\n            const l = (max + min) / 2;\n            if (max !== min) {\n                const d = max - min;\n                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n                switch (max) {\n                    case r:\n                        h = ((g - b) / d + (g < b ? 6 : 0)) / 6;\n                        break;\n                    case g:\n                        h = ((b - r) / d + 2) / 6;\n                        break;\n                    case b:\n                        h = ((r - g) / d + 4) / 6;\n                        break;\n                }\n            }\n            return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100), a };\n        }\n        function hslToRgba(h, s, l, a) {\n            s /= 100;\n            l /= 100;\n            const k = (n) => (n + h / 30) % 12;\n            const f = (n) => l - s * Math.min(l, 1 - l) * Math.max(-1, Math.min(k(n) - 3, Math.min(9 - k(n), 1)));\n            const r = Math.round(255 * f(0));\n            const g = Math.round(255 * f(8));\n            const b = Math.round(255 * f(4));\n            return a < 1\n                ? `rgba(${r}, ${g}, ${b}, ${a.toFixed(2)})`\n                : `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;\n        }\n        function rgbaToHex(rgba) {\n            if (rgba.startsWith('#'))\n                return rgba.slice(0, 7).toUpperCase();\n            const match = rgba.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)/);\n            if (match) {\n                const r = Number.parseInt(match[1]).toString(16).padStart(2, '0');\n                const g = Number.parseInt(match[2]).toString(16).padStart(2, '0');\n                const b = Number.parseInt(match[3]).toString(16).padStart(2, '0');\n                return `#${r}${g}${b}`.toUpperCase();\n            }\n            return '#000000';\n        }\n        const hsl = computed(() => hexToHsl(props.value));\n        const hexDisplay = computed(() => rgbaToHex(props.value));\n        const hexInput = ref(hexDisplay.value);\n        const localHsl = ref(hsl.value);\n        const isDraggingRef = ref(false);\n        const trackRefs = {};\n        const draggingSlider = ref(null);\n        const globalMoveHandler = ref(null);\n        const globalUpHandler = ref(null);\n        // \n        watch(() => props.value, () => {\n            if (!isDraggingRef.value) {\n                const newHsl = hexToHsl(props.value);\n                localHsl.value = newHsl;\n                hexInput.value = hexDisplay.value;\n            }\n        });\n        const sliders = computed(() => {\n            const result = [\n                {\n                    key: 'h',\n                    label: 'H',\n                    min: 0,\n                    max: 360,\n                    currentValue: localHsl.value.h,\n                    gradient: 'linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000)',\n                    step: 1,\n                    thumbColor: `hsl(${localHsl.value.h}, 100%, 50%)`,\n                    displayValue: `${Math.round(localHsl.value.h)}`,\n                },\n                {\n                    key: 's',\n                    label: 'S',\n                    min: 0,\n                    max: 100,\n                    currentValue: localHsl.value.s,\n                    gradient: `linear-gradient(to right, hsl(${localHsl.value.h}, 0%, ${localHsl.value.l}%), hsl(${localHsl.value.h}, 100%, ${localHsl.value.l}%))`,\n                    step: 1,\n                    thumbColor: hslToRgba(localHsl.value.h, localHsl.value.s, localHsl.value.l, 1),\n                    displayValue: `${Math.round(localHsl.value.s)}%`,\n                },\n                {\n                    key: 'l',\n                    label: 'L',\n                    min: 0,\n                    max: 100,\n                    currentValue: localHsl.value.l,\n                    gradient: `linear-gradient(to right, #000, hsl(${localHsl.value.h}, ${localHsl.value.s}%, 50%), #fff)`,\n                    step: 1,\n                    thumbColor: hslToRgba(localHsl.value.h, localHsl.value.s, localHsl.value.l, 1),\n                    displayValue: `${Math.round(localHsl.value.l)}%`,\n                },\n            ];\n            if (props.showAlpha) {\n                result.push({\n                    key: 'a',\n                    label: 'A',\n                    min: 0,\n                    max: 1,\n                    currentValue: localHsl.value.a,\n                    gradient: `linear-gradient(to right, transparent, ${hslToRgba(localHsl.value.h, localHsl.value.s, localHsl.value.l, 1)})`,\n                    step: 0.01,\n                    thumbColor: hslToRgba(localHsl.value.h, localHsl.value.s, localHsl.value.l, localHsl.value.a),\n                    displayValue: `${Math.round(localHsl.value.a * 100)}%`,\n                });\n            }\n            return result;\n        });\n        // HSL\n        function updateLocalValue(e, slider) {\n            const track = trackRefs[slider.key];\n            if (!track)\n                return;\n            const rect = track.getBoundingClientRect();\n            const x = Math.max(0, Math.min(e.clientX - rect.left, rect.width));\n            const ratio = x / rect.width;\n            const val = slider.min + ratio * (slider.max - slider.min);\n            const finalVal = slider.step < 1 ? Math.round(val * 100) / 100 : Math.round(val);\n            // \n            localHsl.value = { ...localHsl.value, [slider.key]: finalVal };\n            // \n            const newValue = hslToRgba(localHsl.value.h, localHsl.value.s, localHsl.value.l, localHsl.value.a);\n            emit('update:value', newValue);\n        }\n        // \n        function commitChange() {\n            if (isDraggingRef.value) {\n                // \n                const finalValue = hslToRgba(localHsl.value.h, localHsl.value.s, localHsl.value.l, localHsl.value.a);\n                emit('update:value', finalValue);\n                isDraggingRef.value = false;\n            }\n        }\n        function handlePointerDown(e, slider) {\n            isDraggingRef.value = true;\n            draggingSlider.value = slider.key;\n            //  setPointerCapture \n            e.currentTarget.setPointerCapture(e.pointerId);\n            // \n            updateLocalValue(e, slider);\n            // \n            const handleGlobalMove = (ev) => {\n                if (draggingSlider.value === slider.key && isDraggingRef.value) {\n                    updateLocalValue(ev, slider);\n                }\n            };\n            const handleGlobalUp = () => {\n                if (draggingSlider.value === slider.key) {\n                    commitChange();\n                    draggingSlider.value = null;\n                    // \n                    if (globalMoveHandler.value) {\n                        document.removeEventListener('pointermove', globalMoveHandler.value);\n                    }\n                    if (globalUpHandler.value) {\n                        document.removeEventListener('pointerup', globalUpHandler.value);\n                    }\n                    // \n                    if (e.currentTarget instanceof HTMLElement) {\n                        e.currentTarget.releasePointerCapture(e.pointerId);\n                    }\n                }\n            };\n            globalMoveHandler.value = handleGlobalMove;\n            globalUpHandler.value = handleGlobalUp;\n            document.addEventListener('pointermove', handleGlobalMove);\n            document.addEventListener('pointerup', handleGlobalUp);\n        }\n        function handlePointerMove(e, slider) {\n            if (draggingSlider.value === slider.key && isDraggingRef.value) {\n                updateLocalValue(e, slider);\n            }\n        }\n        function handlePointerUp(e, slider) {\n            if (draggingSlider.value === slider.key) {\n                commitChange();\n                draggingSlider.value = null;\n                // \n                if (e.currentTarget instanceof HTMLElement) {\n                    e.currentTarget.releasePointerCapture(e.pointerId);\n                }\n            }\n        }\n        function handleHexInput(e) {\n            const input = e.target.value.toUpperCase();\n            hexInput.value = input;\n            if (/^#[0-9A-F]{6}$/.test(input)) {\n                const newHsl = hexToHsl(input);\n                newHsl.a = localHsl.value.a;\n                localHsl.value = newHsl;\n                emit('update:value', hslToRgba(newHsl.h, newHsl.s, newHsl.l, newHsl.a));\n            }\n        }\n        function handleHexBlur() {\n            hexInput.value = rgbaToHex(props.value);\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"label\", _hoisted_3, _toDisplayString(__props.label), 1 /* TEXT */),\n                    _createElementVNode(\"div\", _hoisted_4, [\n                        _withDirectives(_createElementVNode(\"input\", {\n                            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((hexInput).value = $event)),\n                            type: \"text\",\n                            class: \"bg-background text-foreground w-20 rounded border px-2 py-0.5 font-mono text-xs\",\n                            placeholder: \"#000000\",\n                            onInput: handleHexInput,\n                            onBlur: handleHexBlur\n                        }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                            [_vModelText, hexInput.value]\n                        ]),\n                        _createElementVNode(\"div\", {\n                            class: \"border-border h-6 w-6 rounded border shadow-sm\",\n                            style: _normalizeStyle({ backgroundColor: __props.value })\n                        }, null, 4 /* STYLE */)\n                    ])\n                ]),\n                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(sliders.value, (slider) => {\n                    return (_openBlock(), _createElementBlock(\"div\", {\n                        key: slider.key,\n                        class: \"flex items-center gap-2\"\n                    }, [\n                        _createElementVNode(\"span\", _hoisted_5, _toDisplayString(slider.label), 1 /* TEXT */),\n                        _createElementVNode(\"div\", {\n                            ref_for: true,\n                            ref: el => (trackRefs[slider.key] = el),\n                            class: \"relative flex h-6 flex-1 cursor-pointer touch-none items-center\",\n                            onPointerdown: e => handlePointerDown(e, slider),\n                            onPointermove: e => handlePointerMove(e, slider),\n                            onPointerup: e => handlePointerUp(e, slider)\n                        }, [\n                            _createElementVNode(\"div\", {\n                                class: \"absolute inset-y-2 right-0 left-0 rounded-full\",\n                                style: _normalizeStyle({ background: slider.gradient })\n                            }, null, 4 /* STYLE */),\n                            _createElementVNode(\"div\", {\n                                class: \"pointer-events-none absolute top-1/2 h-4 w-4 -translate-y-1/2 rounded-full border-2 border-white shadow-md\",\n                                style: _normalizeStyle({\n                                    left: `calc(${((slider.currentValue - slider.min) / (slider.max - slider.min)) * 100}% - 8px)`,\n                                    background: slider.thumbColor,\n                                })\n                            }, null, 4 /* STYLE */)\n                        ], 40 /* PROPS, NEED_HYDRATION */, _hoisted_6),\n                        _createElementVNode(\"span\", _hoisted_7, _toDisplayString(slider.displayValue), 1 /* TEXT */)\n                    ]));\n                }), 128 /* KEYED_FRAGMENT */))\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./ColorSlider.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ColorSlider.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./ColorSlider.vue?vue&type=style&index=0&id=6137eb39&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_53ff6257bd8fdf8315af10a81f7e3da1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6137eb39\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, normalizeStyle as _normalizeStyle, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, resolveDynamicComponent as _resolveDynamicComponent, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = { class: \"flex items-center gap-1\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"p-1\"\n};\nconst _hoisted_3 = {\n    key: 0,\n    class: \"absolute left-1 top-1/2 -translate-y-1/2\"\n};\nconst _hoisted_4 = { class: \"absolute bottom-1.5 right-2\" };\nconst _hoisted_5 = {\n    key: 1,\n    class: \"absolute right-1 top-1/2 -translate-y-1/2\"\n};\nconst _hoisted_6 = {\n    key: 1,\n    class: \"p-1\"\n};\nimport { computed, h } from 'vue';\nimport { arrowShapePresets, backgroundPatternPresets, borderWidthPresets, boxShapePresets, indicatorShapePresets, nameShapePresets, } from '../types/galgame';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'DialogPreview',\n    props: {\n        style: {}\n    },\n    setup(__props) {\n        function hslToRgba(h, s, l, a) {\n            s /= 100;\n            l /= 100;\n            const k = (n) => (n + h / 30) % 12;\n            const f = (n) => l - s * Math.min(l, 1 - l) * Math.max(-1, Math.min(k(n) - 3, Math.min(9 - k(n), 1)));\n            const r = Math.round(255 * f(0));\n            const g = Math.round(255 * f(8));\n            const b = Math.round(255 * f(4));\n            return a < 1\n                ? `rgba(${r}, ${g}, ${b}, ${a.toFixed(2)})`\n                : `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;\n        }\n        const props = __props;\n        //  computed \n        const dialogStyle = computed(() => props.style);\n        const boxShape = computed(() => boxShapePresets.find(p => p.id === dialogStyle.value.boxShape) || boxShapePresets[0]);\n        const nameShape = computed(() => nameShapePresets.find(p => p.id === dialogStyle.value.nameShape) || nameShapePresets[0]);\n        const arrowShape = computed(() => arrowShapePresets.find(p => p.id === dialogStyle.value.arrowShape) || arrowShapePresets[0]);\n        const indicatorShape = computed(() => indicatorShapePresets.find(p => p.id === dialogStyle.value.indicatorShape) || indicatorShapePresets[0]);\n        const borderWidth = computed(() => borderWidthPresets.find(p => p.id === dialogStyle.value.borderWidth) || borderWidthPresets[1]);\n        const bgPattern = computed(() => backgroundPatternPresets.find(p => p.id === dialogStyle.value.backgroundPattern));\n        const isInnerArrow = computed(() => arrowShape.value.isInner);\n        const isMinimalArrow = computed(() => arrowShape.value.type === 'minimal');\n        const isPillShape = computed(() => dialogStyle.value.boxShape === 'pill');\n        const arrowBorderRadius = computed(() => {\n            if (arrowShape.value.type === 'square' || arrowShape.value.type === 'inner-square')\n                return '4px';\n            if (arrowShape.value.type === 'pill')\n                return '12px';\n            return '9999px';\n        });\n        const getPatternStyle = computed(() => {\n            if (!bgPattern.value?.pattern)\n                return {};\n            const borderColorForPattern = dialogStyle.value.colors.boxBorder.replace(/[\\d.]+\\)$/, '0.08)');\n            const patternWithColor = bgPattern.value.pattern.replace(/VAR_BORDER_COLOR/g, borderColorForPattern);\n            let backgroundSize = '20px 20px';\n            if (bgPattern.value.id === 'dots')\n                backgroundSize = '16px 16px';\n            if (bgPattern.value.id === 'diamonds')\n                backgroundSize = '16px 16px';\n            if (bgPattern.value.id === 'stripes')\n                backgroundSize = '28px 28px';\n            return {\n                backgroundImage: patternWithColor,\n                backgroundSize,\n            };\n        });\n        const boxStyle = computed(() => {\n            return {\n                backgroundColor: isPillShape.value ? 'rgba(255,255,255,0.7)' : dialogStyle.value.colors.boxBackground,\n                borderRadius: boxShape.value.borderRadius,\n                borderTopWidth: borderWidth.value.width,\n                borderLeftWidth: borderWidth.value.width,\n                borderRightWidth: borderWidth.value.width,\n                borderBottomWidth: borderWidth.value.width,\n                borderStyle: 'solid',\n                borderColor: dialogStyle.value.colors.boxBorder,\n                boxShadow: boxShape.value.shadow,\n                ...(isPillShape.value ? { backdropFilter: 'blur(12px)', WebkitBackdropFilter: 'blur(12px)' } : {}),\n                ...getPatternStyle.value,\n            };\n        });\n        const indicatorComponent = computed(() => {\n            const { type } = indicatorShape.value;\n            const color = dialogStyle.value.colors.indicatorColor;\n            if (type === 'none')\n                return null;\n            if (type === 'dots') {\n                return h('div', { class: 'flex gap-0.5 items-center' }, [0, 1, 2].map(i => h('span', {\n                    key: i,\n                    class: 'w-1 h-1 rounded-full',\n                    style: { backgroundColor: color, opacity: i === 2 ? 1 : 0.4 },\n                })));\n            }\n            if (type === 'diamonds') {\n                return h('div', { class: 'flex gap-0.5 items-center' }, [0, 1, 2].map(i => h('span', {\n                    key: i,\n                    style: {\n                        width: '8px',\n                        height: '8px',\n                        backgroundColor: color,\n                        opacity: i === 2 ? 1 : 0.3 + i * 0.15,\n                        transform: 'rotate(45deg)',\n                        display: 'inline-block',\n                    },\n                })));\n            }\n            if (type === 'pulse') {\n                return h('div', { class: 'relative w-2 h-2' }, [\n                    h('span', {\n                        class: 'absolute inset-0 rounded-full',\n                        style: { backgroundColor: color },\n                    }),\n                ]);\n            }\n            if (type === 'arrow') {\n                return h('svg', {\n                    class: 'w-3 h-3',\n                    style: { color },\n                    fill: 'none',\n                    stroke: 'currentColor',\n                    viewBox: '0 0 24 24',\n                }, [\n                    h('path', {\n                        'stroke-linecap': 'round',\n                        'stroke-linejoin': 'round',\n                        'stroke-width': '2',\n                        d: 'M9 5l7 7-7 7',\n                    }),\n                ]);\n            }\n            return null;\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                (!isInnerArrow.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [\n                        _createElementVNode(\"div\", {\n                            class: \"p-1 backdrop-blur-sm shadow\",\n                            style: _normalizeStyle({\n                                backgroundColor: dialogStyle.value.colors.arrowBackground,\n                                borderRadius: arrowBorderRadius.value.value,\n                            })\n                        }, [\n                            (_openBlock(), _createElementBlock(\"svg\", {\n                                class: \"w-3 h-3\",\n                                fill: \"none\",\n                                stroke: \"currentColor\",\n                                viewBox: \"0 0 24 24\",\n                                style: _normalizeStyle({ color: dialogStyle.value.colors.arrowIcon })\n                            }, [...(_cache[0] || (_cache[0] = [\n                                    _createElementVNode(\"path\", {\n                                        \"stroke-linecap\": \"round\",\n                                        \"stroke-linejoin\": \"round\",\n                                        \"stroke-width\": \"2\",\n                                        d: \"M15 19l-7-7 7-7\"\n                                    }, null, -1 /* CACHED */)\n                                ]))], 4 /* STYLE */))\n                        ], 4 /* STYLE */)\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createElementVNode(\"div\", {\n                    class: \"flex-1 p-2 min-h-[60px] relative\",\n                    style: _normalizeStyle(boxStyle.value)\n                }, [\n                    (isInnerArrow.value)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [\n                            _createElementVNode(\"div\", {\n                                class: \"p-1 backdrop-blur-sm shadow\",\n                                style: _normalizeStyle({\n                                    backgroundColor: dialogStyle.value.colors.arrowBackground,\n                                    borderRadius: arrowBorderRadius.value,\n                                })\n                            }, [\n                                (_openBlock(), _createElementBlock(\"svg\", {\n                                    class: \"w-3 h-3\",\n                                    fill: \"none\",\n                                    stroke: \"currentColor\",\n                                    viewBox: \"0 0 24 24\",\n                                    style: _normalizeStyle({ color: dialogStyle.value.colors.arrowIcon })\n                                }, [...(_cache[1] || (_cache[1] = [\n                                        _createElementVNode(\"path\", {\n                                            \"stroke-linecap\": \"round\",\n                                            \"stroke-linejoin\": \"round\",\n                                            \"stroke-width\": \"2\",\n                                            d: \"M15 19l-7-7 7-7\"\n                                        }, null, -1 /* CACHED */)\n                                    ]))], 4 /* STYLE */))\n                            ], 4 /* STYLE */)\n                        ]))\n                        : _createCommentVNode(\"v-if\", true),\n                    _createElementVNode(\"div\", {\n                        class: \"h-4 mb-1 flex items-start\",\n                        style: _normalizeStyle({\n                            paddingLeft: isInnerArrow.value ? '24px' : 0,\n                            paddingRight: isInnerArrow.value ? '24px' : 0,\n                        })\n                    }, [\n                        _createElementVNode(\"div\", {\n                            class: \"px-2 py-0.5 text-[10px] font-medium\",\n                            style: _normalizeStyle({\n                                backgroundColor: dialogStyle.value.colors.nameBackground,\n                                color: dialogStyle.value.colors.nameText,\n                                borderRadius: nameShape.value.borderRadius,\n                                borderBottom: nameShape.value.style === 'underline' ? `2px solid ${dialogStyle.value.colors.nameText}` : undefined,\n                                boxShadow: nameShape.value.style === 'floating' ? '0 2px 8px rgba(0,0,0,0.1)' : undefined,\n                            })\n                        }, \"  \", 4 /* STYLE */)\n                    ], 4 /* STYLE */),\n                    _createElementVNode(\"p\", {\n                        class: \"text-[10px] leading-relaxed\",\n                        style: _normalizeStyle({\n                            color: dialogStyle.value.colors.dialogText,\n                            fontSize: `${dialogStyle.value.fontSize}px`,\n                            paddingLeft: isInnerArrow.value ? '24px' : 0,\n                            paddingRight: isInnerArrow.value ? '24px' : 0,\n                        })\n                    }, \" ... \", 4 /* STYLE */),\n                    _createElementVNode(\"div\", _hoisted_4, [\n                        (_openBlock(), _createBlock(_resolveDynamicComponent(indicatorComponent.value)))\n                    ]),\n                    (isInnerArrow.value)\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [\n                            _createElementVNode(\"div\", {\n                                class: \"p-1 backdrop-blur-sm shadow\",\n                                style: _normalizeStyle({\n                                    backgroundColor: dialogStyle.value.colors.arrowBackground,\n                                    borderRadius: arrowBorderRadius.value,\n                                })\n                            }, [\n                                (_openBlock(), _createElementBlock(\"svg\", {\n                                    class: \"w-3 h-3\",\n                                    fill: \"none\",\n                                    stroke: \"currentColor\",\n                                    viewBox: \"0 0 24 24\",\n                                    style: _normalizeStyle({ color: dialogStyle.value.colors.arrowIcon })\n                                }, [...(_cache[2] || (_cache[2] = [\n                                        _createElementVNode(\"path\", {\n                                            \"stroke-linecap\": \"round\",\n                                            \"stroke-linejoin\": \"round\",\n                                            \"stroke-width\": \"2\",\n                                            d: \"M9 5l7 7-7 7\"\n                                        }, null, -1 /* CACHED */)\n                                    ]))], 4 /* STYLE */))\n                            ], 4 /* STYLE */)\n                        ]))\n                        : _createCommentVNode(\"v-if\", true)\n                ], 4 /* STYLE */),\n                (!isInnerArrow.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [\n                        _createElementVNode(\"div\", {\n                            class: \"p-1 backdrop-blur-sm shadow\",\n                            style: _normalizeStyle({\n                                backgroundColor: dialogStyle.value.colors.arrowBackground,\n                                borderRadius: arrowBorderRadius.value.value,\n                            })\n                        }, [\n                            (_openBlock(), _createElementBlock(\"svg\", {\n                                class: \"w-3 h-3\",\n                                fill: \"none\",\n                                stroke: \"currentColor\",\n                                viewBox: \"0 0 24 24\",\n                                style: _normalizeStyle({ color: dialogStyle.value.colors.arrowIcon })\n                            }, [...(_cache[3] || (_cache[3] = [\n                                    _createElementVNode(\"path\", {\n                                        \"stroke-linecap\": \"round\",\n                                        \"stroke-linejoin\": \"round\",\n                                        \"stroke-width\": \"2\",\n                                        d: \"M9 5l7 7-7 7\"\n                                    }, null, -1 /* CACHED */)\n                                ]))], 4 /* STYLE */))\n                        ], 4 /* STYLE */)\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./DialogPreview.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./DialogPreview.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, normalizeClass as _normalizeClass, normalizeStyle as _normalizeStyle, createVNode as _createVNode, unref as _unref, renderList as _renderList, Fragment as _Fragment } from \"vue\";\nconst _hoisted_1 = { class: \"absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in duration-200\" };\nconst _hoisted_2 = { class: \"relative w-[90%] max-w-lg max-h-[85vh] bg-card rounded-xl shadow-2xl overflow-hidden\" };\nconst _hoisted_3 = { class: \"flex items-center justify-between p-4 border-b border-border\" };\nconst _hoisted_4 = { class: \"p-4 overflow-y-auto max-h-[calc(85vh-120px)]\" };\nconst _hoisted_5 = { class: \"space-y-6\" };\nconst _hoisted_6 = { class: \"space-y-4\" };\nconst _hoisted_7 = { class: \"space-y-3\" };\nconst _hoisted_8 = { class: \"space-y-2\" };\nconst _hoisted_9 = { class: \"text-xs text-muted-foreground\" };\nconst _hoisted_10 = [\"value\"];\nconst _hoisted_11 = { class: \"space-y-2\" };\nconst _hoisted_12 = { class: \"text-xs text-muted-foreground\" };\nconst _hoisted_13 = [\"value\"];\nconst _hoisted_14 = { class: \"space-y-2\" };\nconst _hoisted_15 = { class: \"text-xs text-muted-foreground\" };\nconst _hoisted_16 = [\"value\"];\nconst _hoisted_17 = { class: \"space-y-4\" };\nconst _hoisted_18 = { class: \"flex items-center justify-between\" };\nconst _hoisted_19 = { class: \"relative inline-flex items-center cursor-pointer\" };\nconst _hoisted_20 = [\"checked\"];\nconst _hoisted_21 = {\n    key: 0,\n    class: \"space-y-2 animate-in fade-in duration-200\"\n};\nconst _hoisted_22 = { class: \"text-xs text-muted-foreground\" };\nconst _hoisted_23 = [\"value\"];\nconst _hoisted_24 = { class: \"space-y-4\" };\nconst _hoisted_25 = { class: \"flex items-center justify-between\" };\nconst _hoisted_26 = { class: \"relative inline-flex items-center cursor-pointer\" };\nconst _hoisted_27 = [\"checked\"];\nconst _hoisted_28 = {\n    key: 0,\n    class: \"space-y-4 animate-in fade-in duration-200\"\n};\nconst _hoisted_29 = { class: \"p-3 bg-muted/30 rounded-lg\" };\nconst _hoisted_30 = { class: \"flex items-center justify-between mb-2\" };\nconst _hoisted_31 = [\"disabled\"];\nconst _hoisted_32 = {\n    key: 0,\n    class: \"w-3 h-3\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    viewBox: \"0 0 24 24\"\n};\nconst _hoisted_33 = {\n    key: 1,\n    class: \"w-3 h-3\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    viewBox: \"0 0 24 24\"\n};\nconst _hoisted_34 = { class: \"px-6\" };\nconst _hoisted_35 = { class: \"space-y-4\" };\nconst _hoisted_36 = { class: \"bg-muted text-muted-foreground inline-flex h-9 w-full items-center justify-center rounded-lg p-[3px]\" };\nconst _hoisted_37 = {\n    key: 0,\n    class: \"space-y-4\"\n};\nconst _hoisted_38 = { class: \"space-y-2\" };\nconst _hoisted_39 = { class: \"grid grid-cols-5 gap-2\" };\nconst _hoisted_40 = [\"onClick\"];\nconst _hoisted_41 = { class: \"space-y-2\" };\nconst _hoisted_42 = { class: \"grid grid-cols-6 gap-2\" };\nconst _hoisted_43 = [\"onClick\"];\nconst _hoisted_44 = { class: \"space-y-2\" };\nconst _hoisted_45 = { class: \"grid grid-cols-5 gap-2\" };\nconst _hoisted_46 = [\"onClick\"];\nconst _hoisted_47 = { class: \"space-y-2\" };\nconst _hoisted_48 = { class: \"grid grid-cols-5 gap-2\" };\nconst _hoisted_49 = [\"onClick\"];\nconst _hoisted_50 = { class: \"space-y-2\" };\nconst _hoisted_51 = { class: \"grid grid-cols-6 gap-2\" };\nconst _hoisted_52 = [\"onClick\"];\nconst _hoisted_53 = { class: \"space-y-2\" };\nconst _hoisted_54 = { class: \"grid grid-cols-5 gap-2\" };\nconst _hoisted_55 = [\"onClick\"];\nconst _hoisted_56 = { class: \"space-y-2\" };\nconst _hoisted_57 = { class: \"text-xs text-muted-foreground\" };\nconst _hoisted_58 = [\"value\"];\nconst _hoisted_59 = {\n    key: 1,\n    class: \"space-y-4\"\n};\nimport { computed, ref } from 'vue';\nimport { arrowShapePresets, backgroundPatternPresets, borderWidthPresets, boxShapePresets, indicatorShapePresets, nameShapePresets, } from '../types/galgame';\nimport ColorSlider from './ColorSlider.vue';\nimport DialogPreview from './DialogPreview.vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'SettingsPanel',\n    props: {\n        onClose: { type: Function },\n        spriteSettings: {},\n        onSpriteSettingsChange: { type: Function },\n        autoPlay: { type: Boolean },\n        onAutoPlayChange: { type: Function },\n        autoPlaySpeed: {},\n        onAutoPlaySpeedChange: { type: Function },\n        dialogStyle: {},\n        onDialogStyleChange: { type: Function },\n        onSaveStyle: { type: Function },\n        currentAppliedStyle: {},\n        customModeEnabled: { type: Boolean },\n        onCustomModeChange: { type: Function }\n    },\n    setup(__props) {\n        const props = __props;\n        const activeTab = ref('shapes');\n        const hasChanges = computed(() => {\n            return JSON.stringify(props.dialogStyle) !== JSON.stringify(props.currentAppliedStyle);\n        });\n        function updateSpriteSettings(settings) {\n            props.onSpriteSettingsChange(settings);\n        }\n        function updateShape(key, value) {\n            props.onDialogStyleChange({ ...props.dialogStyle, [key]: value });\n        }\n        function updateColor(key, value) {\n            props.onDialogStyleChange({\n                ...props.dialogStyle,\n                colors: { ...props.dialogStyle.colors, [key]: value },\n            });\n        }\n        function handleEnableCustomMode(enabled) {\n            props.onCustomModeChange(enabled);\n            if (enabled) {\n                // \n                props.onDialogStyleChange(props.currentAppliedStyle);\n            }\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _cache[21] || (_cache[21] = _createElementVNode(\"h2\", { class: \"text-lg font-semibold text-foreground\" }, \"\", -1 /* CACHED */)),\n                        _createElementVNode(\"button\", {\n                            onClick: _cache[0] || (_cache[0] =\n                                //@ts-ignore\n                                (...args) => (__props.onClose && __props.onClose(...args))),\n                            class: \"p-1 rounded-full hover:bg-muted transition-colors\",\n                            \"aria-label\": \"\"\n                        }, [...(_cache[20] || (_cache[20] = [\n                                _createElementVNode(\"svg\", {\n                                    class: \"w-5 h-5\",\n                                    fill: \"none\",\n                                    stroke: \"currentColor\",\n                                    viewBox: \"0 0 24 24\"\n                                }, [\n                                    _createElementVNode(\"path\", {\n                                        \"stroke-linecap\": \"round\",\n                                        \"stroke-linejoin\": \"round\",\n                                        \"stroke-width\": \"2\",\n                                        d: \"M6 18L18 6M6 6l12 12\"\n                                    })\n                                ], -1 /* CACHED */)\n                            ]))])\n                    ]),\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"div\", _hoisted_4, [\n                        _createElementVNode(\"div\", _hoisted_5, [\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", _hoisted_6, [\n                                _cache[22] || (_cache[22] = _createElementVNode(\"h3\", { class: \"text-sm font-medium text-foreground\" }, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_7, [\n                                    _createElementVNode(\"div\", _hoisted_8, [\n                                        _createElementVNode(\"label\", _hoisted_9, \" (\" + _toDisplayString(Math.round(__props.spriteSettings.scale * 100)) + \"%)\", 1 /* TEXT */),\n                                        _createElementVNode(\"input\", {\n                                            type: \"range\",\n                                            value: __props.spriteSettings.scale,\n                                            onInput: _cache[1] || (_cache[1] =\n                                                e => updateSpriteSettings({\n                                                    ...__props.spriteSettings,\n                                                    scale: parseFloat(e.target.value),\n                                                })),\n                                            min: \"0.5\",\n                                            max: \"1.5\",\n                                            step: \"0.05\",\n                                            class: \"w-full\"\n                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_10)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_11, [\n                                        _createElementVNode(\"label\", _hoisted_12, \" (\" + _toDisplayString(__props.spriteSettings.positionX) + \"%)\", 1 /* TEXT */),\n                                        _createElementVNode(\"input\", {\n                                            type: \"range\",\n                                            value: __props.spriteSettings.positionX,\n                                            onInput: _cache[2] || (_cache[2] =\n                                                e => updateSpriteSettings({\n                                                    ...__props.spriteSettings,\n                                                    positionX: parseInt(e.target.value),\n                                                })),\n                                            min: \"0\",\n                                            max: \"100\",\n                                            step: \"1\",\n                                            class: \"w-full\"\n                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_13)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_14, [\n                                        _createElementVNode(\"label\", _hoisted_15, \" (\" + _toDisplayString(__props.spriteSettings.positionY) + \"%)\", 1 /* TEXT */),\n                                        _createElementVNode(\"input\", {\n                                            type: \"range\",\n                                            value: __props.spriteSettings.positionY,\n                                            onInput: _cache[3] || (_cache[3] =\n                                                e => updateSpriteSettings({\n                                                    ...__props.spriteSettings,\n                                                    positionY: parseInt(e.target.value),\n                                                })),\n                                            min: \"0\",\n                                            max: \"100\",\n                                            step: \"1\",\n                                            class: \"w-full\"\n                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_16)\n                                    ])\n                                ])\n                            ]),\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", _hoisted_17, [\n                                _cache[25] || (_cache[25] = _createElementVNode(\"h3\", { class: \"text-sm font-medium text-foreground\" }, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_18, [\n                                    _cache[24] || (_cache[24] = _createElementVNode(\"label\", { class: \"text-xs text-muted-foreground\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"label\", _hoisted_19, [\n                                        _createElementVNode(\"input\", {\n                                            type: \"checkbox\",\n                                            checked: __props.autoPlay,\n                                            onChange: _cache[4] || (_cache[4] = e => __props.onAutoPlayChange(e.target.checked)),\n                                            class: \"sr-only peer\"\n                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_20),\n                                        _cache[23] || (_cache[23] = _createElementVNode(\"div\", { class: \"w-8 h-[1.15rem] bg-input rounded-full peer peer-checked:bg-primary transition-colors relative\" }, [\n                                            _createElementVNode(\"div\", { class: \"absolute top-0 left-0 w-4 h-4 bg-background rounded-full transition-transform peer-checked:translate-x-[calc(100%-2px)]\" })\n                                        ], -1 /* CACHED */))\n                                    ])\n                                ]),\n                                (__props.autoPlay)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_21, [\n                                        _createElementVNode(\"label\", _hoisted_22, \" (\" + _toDisplayString(__props.autoPlaySpeed / 1000) + \")\", 1 /* TEXT */),\n                                        _createElementVNode(\"input\", {\n                                            type: \"range\",\n                                            value: __props.autoPlaySpeed,\n                                            onInput: _cache[5] || (_cache[5] = e => __props.onAutoPlaySpeedChange(parseInt(e.target.value))),\n                                            min: \"1000\",\n                                            max: \"8000\",\n                                            step: \"500\",\n                                            class: \"w-full\"\n                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_23)\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]),\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", _hoisted_24, [\n                                _createElementVNode(\"div\", _hoisted_25, [\n                                    _cache[27] || (_cache[27] = _createElementVNode(\"h3\", { class: \"text-sm font-medium text-foreground\" }, \"\", -1 /* CACHED */)),\n                                    _createElementVNode(\"label\", _hoisted_26, [\n                                        _createElementVNode(\"input\", {\n                                            type: \"checkbox\",\n                                            checked: __props.customModeEnabled,\n                                            onChange: _cache[6] || (_cache[6] = e => handleEnableCustomMode(e.target.checked)),\n                                            class: \"sr-only peer\"\n                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_27),\n                                        _cache[26] || (_cache[26] = _createElementVNode(\"div\", { class: \"w-8 h-[1.15rem] bg-input rounded-full peer peer-checked:bg-primary transition-colors relative\" }, [\n                                            _createElementVNode(\"div\", { class: \"absolute top-0 left-0 w-4 h-4 bg-background rounded-full transition-transform peer-checked:translate-x-[calc(100%-2px)]\" })\n                                        ], -1 /* CACHED */))\n                                    ])\n                                ]),\n                                (__props.customModeEnabled)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_28, [\n                                        _createCommentVNode(\"  \"),\n                                        _createElementVNode(\"div\", _hoisted_29, [\n                                            _createElementVNode(\"div\", _hoisted_30, [\n                                                _cache[30] || (_cache[30] = _createElementVNode(\"span\", { class: \"text-xs text-muted-foreground\" }, \"\", -1 /* CACHED */)),\n                                                _createElementVNode(\"button\", {\n                                                    disabled: !hasChanges.value,\n                                                    class: _normalizeClass([\n                                                        'h-7 px-3 text-xs rounded-md border transition-colors gap-1 flex items-center',\n                                                        hasChanges.value\n                                                            ? 'bg-primary text-primary-foreground border-primary hover:bg-primary/90'\n                                                            : 'bg-background border-gray-200 opacity-50 cursor-not-allowed',\n                                                    ]),\n                                                    onClick: _cache[7] || (_cache[7] =\n                                                        //@ts-ignore\n                                                        (...args) => (__props.onSaveStyle && __props.onSaveStyle(...args)))\n                                                }, [\n                                                    (hasChanges.value)\n                                                        ? (_openBlock(), _createElementBlock(\"svg\", _hoisted_32, [...(_cache[28] || (_cache[28] = [\n                                                                _createElementVNode(\"path\", {\n                                                                    \"stroke-linecap\": \"round\",\n                                                                    \"stroke-linejoin\": \"round\",\n                                                                    \"stroke-width\": \"2\",\n                                                                    d: \"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12\"\n                                                                }, null, -1 /* CACHED */)\n                                                            ]))]))\n                                                        : (_openBlock(), _createElementBlock(\"svg\", _hoisted_33, [...(_cache[29] || (_cache[29] = [\n                                                                _createElementVNode(\"path\", {\n                                                                    \"stroke-linecap\": \"round\",\n                                                                    \"stroke-linejoin\": \"round\",\n                                                                    \"stroke-width\": \"2\",\n                                                                    d: \"M5 13l4 4L19 7\"\n                                                                }, null, -1 /* CACHED */)\n                                                            ]))])),\n                                                    _createTextVNode(\" \" + _toDisplayString(hasChanges.value ? '' : ''), 1 /* TEXT */)\n                                                ], 10 /* CLASS, PROPS */, _hoisted_31)\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_34, [\n                                                _createVNode(DialogPreview, {\n                                                    style: _normalizeStyle(__props.dialogStyle)\n                                                }, null, 8 /* PROPS */, [\"style\"])\n                                            ])\n                                        ]),\n                                        _createCommentVNode(\"  \"),\n                                        _createElementVNode(\"div\", _hoisted_35, [\n                                            _createElementVNode(\"div\", _hoisted_36, [\n                                                _createElementVNode(\"button\", {\n                                                    onClick: _cache[8] || (_cache[8] = ($event) => (activeTab.value = 'shapes')),\n                                                    class: _normalizeClass([\n                                                        'inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all',\n                                                        activeTab.value === 'shapes'\n                                                            ? 'bg-background text-foreground shadow-sm border-input'\n                                                            : 'text-muted-foreground hover:text-foreground',\n                                                    ])\n                                                }, \"  \", 2 /* CLASS */),\n                                                _createElementVNode(\"button\", {\n                                                    onClick: _cache[9] || (_cache[9] = ($event) => (activeTab.value = 'colors')),\n                                                    class: _normalizeClass([\n                                                        'inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all',\n                                                        activeTab.value === 'colors'\n                                                            ? 'bg-background text-foreground shadow-sm border-input'\n                                                            : 'text-muted-foreground hover:text-foreground',\n                                                    ])\n                                                }, \"  \", 2 /* CLASS */)\n                                            ]),\n                                            _createCommentVNode(\"  \"),\n                                            (activeTab.value === 'shapes')\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_37, [\n                                                    _createCommentVNode(\"  \"),\n                                                    _createElementVNode(\"div\", _hoisted_38, [\n                                                        _cache[31] || (_cache[31] = _createElementVNode(\"label\", { class: \"text-xs text-muted-foreground\" }, \"\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"div\", _hoisted_39, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(boxShapePresets), (preset) => {\n                                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: preset.id,\n                                                                    onClick: ($event) => (updateShape('boxShape', preset.id)),\n                                                                    class: _normalizeClass([\n                                                                        'p-2 text-[10px] rounded-lg border transition-all',\n                                                                        __props.dialogStyle.boxShape === preset.id\n                                                                            ? 'border-primary bg-primary/10 text-primary'\n                                                                            : 'border-border hover:border-primary/50',\n                                                                    ])\n                                                                }, _toDisplayString(preset.name), 11 /* TEXT, CLASS, PROPS */, _hoisted_40));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ])\n                                                    ]),\n                                                    _createCommentVNode(\"  \"),\n                                                    _createElementVNode(\"div\", _hoisted_41, [\n                                                        _cache[32] || (_cache[32] = _createElementVNode(\"label\", { class: \"text-xs text-muted-foreground\" }, \"\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"div\", _hoisted_42, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(backgroundPatternPresets), (preset) => {\n                                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: preset.id,\n                                                                    onClick: ($event) => (updateShape('backgroundPattern', preset.id)),\n                                                                    class: _normalizeClass([\n                                                                        'p-2 text-[10px] rounded-lg border transition-all',\n                                                                        __props.dialogStyle.backgroundPattern === preset.id\n                                                                            ? 'border-primary bg-primary/10 text-primary'\n                                                                            : 'border-border hover:border-primary/50',\n                                                                    ])\n                                                                }, _toDisplayString(preset.name), 11 /* TEXT, CLASS, PROPS */, _hoisted_43));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ])\n                                                    ]),\n                                                    _createCommentVNode(\"  \"),\n                                                    _createElementVNode(\"div\", _hoisted_44, [\n                                                        _cache[33] || (_cache[33] = _createElementVNode(\"label\", { class: \"text-xs text-muted-foreground\" }, \"\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"div\", _hoisted_45, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(borderWidthPresets), (preset) => {\n                                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: preset.id,\n                                                                    onClick: ($event) => (updateShape('borderWidth', preset.id)),\n                                                                    class: _normalizeClass([\n                                                                        'p-2 text-[10px] rounded-lg border transition-all',\n                                                                        __props.dialogStyle.borderWidth === preset.id\n                                                                            ? 'border-primary bg-primary/10 text-primary'\n                                                                            : 'border-border hover:border-primary/50',\n                                                                    ])\n                                                                }, _toDisplayString(preset.name), 11 /* TEXT, CLASS, PROPS */, _hoisted_46));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ])\n                                                    ]),\n                                                    _createCommentVNode(\"  \"),\n                                                    _createElementVNode(\"div\", _hoisted_47, [\n                                                        _cache[34] || (_cache[34] = _createElementVNode(\"label\", { class: \"text-xs text-muted-foreground\" }, \"\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"div\", _hoisted_48, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(nameShapePresets), (preset) => {\n                                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: preset.id,\n                                                                    onClick: ($event) => (updateShape('nameShape', preset.id)),\n                                                                    class: _normalizeClass([\n                                                                        'p-2 text-[10px] rounded-lg border transition-all',\n                                                                        __props.dialogStyle.nameShape === preset.id\n                                                                            ? 'border-primary bg-primary/10 text-primary'\n                                                                            : 'border-border hover:border-primary/50',\n                                                                    ])\n                                                                }, _toDisplayString(preset.name), 11 /* TEXT, CLASS, PROPS */, _hoisted_49));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ])\n                                                    ]),\n                                                    _createCommentVNode(\"  \"),\n                                                    _createElementVNode(\"div\", _hoisted_50, [\n                                                        _cache[35] || (_cache[35] = _createElementVNode(\"label\", { class: \"text-xs text-muted-foreground\" }, \"\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"div\", _hoisted_51, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(arrowShapePresets), (preset) => {\n                                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: preset.id,\n                                                                    onClick: ($event) => (updateShape('arrowShape', preset.id)),\n                                                                    class: _normalizeClass([\n                                                                        'p-2 text-[10px] rounded-lg border transition-all',\n                                                                        __props.dialogStyle.arrowShape === preset.id\n                                                                            ? 'border-primary bg-primary/10 text-primary'\n                                                                            : 'border-border hover:border-primary/50',\n                                                                    ])\n                                                                }, _toDisplayString(preset.name), 11 /* TEXT, CLASS, PROPS */, _hoisted_52));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ])\n                                                    ]),\n                                                    _createCommentVNode(\"  \"),\n                                                    _createElementVNode(\"div\", _hoisted_53, [\n                                                        _cache[36] || (_cache[36] = _createElementVNode(\"label\", { class: \"text-xs text-muted-foreground\" }, \"\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"div\", _hoisted_54, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(indicatorShapePresets), (preset) => {\n                                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: preset.id,\n                                                                    onClick: ($event) => (updateShape('indicatorShape', preset.id)),\n                                                                    class: _normalizeClass([\n                                                                        'p-2 text-[10px] rounded-lg border transition-all',\n                                                                        __props.dialogStyle.indicatorShape === preset.id\n                                                                            ? 'border-primary bg-primary/10 text-primary'\n                                                                            : 'border-border hover:border-primary/50',\n                                                                    ])\n                                                                }, _toDisplayString(preset.name), 11 /* TEXT, CLASS, PROPS */, _hoisted_55));\n                                                            }), 128 /* KEYED_FRAGMENT */))\n                                                        ])\n                                                    ]),\n                                                    _createCommentVNode(\"  \"),\n                                                    _createElementVNode(\"div\", _hoisted_56, [\n                                                        _createElementVNode(\"label\", _hoisted_57, \" (\" + _toDisplayString(__props.dialogStyle.fontSize) + \"px)\", 1 /* TEXT */),\n                                                        _createElementVNode(\"input\", {\n                                                            type: \"range\",\n                                                            value: __props.dialogStyle.fontSize,\n                                                            onInput: _cache[10] || (_cache[10] =\n                                                                e => __props.onDialogStyleChange({\n                                                                    ...__props.dialogStyle,\n                                                                    fontSize: parseInt(e.target.value),\n                                                                })),\n                                                            min: \"12\",\n                                                            max: \"24\",\n                                                            step: \"1\",\n                                                            class: \"w-full\"\n                                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_58)\n                                                    ])\n                                                ]))\n                                                : _createCommentVNode(\"v-if\", true),\n                                            _createCommentVNode(\"  \"),\n                                            (activeTab.value === 'colors')\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_59, [\n                                                    _createVNode(ColorSlider, {\n                                                        label: \"\",\n                                                        value: __props.dialogStyle.colors.boxBackground,\n                                                        \"onUpdate:value\": _cache[11] || (_cache[11] = v => updateColor('boxBackground', v))\n                                                    }, null, 8 /* PROPS */, [\"value\"]),\n                                                    _createVNode(ColorSlider, {\n                                                        label: \"\",\n                                                        value: __props.dialogStyle.colors.boxBorder,\n                                                        \"onUpdate:value\": _cache[12] || (_cache[12] = v => updateColor('boxBorder', v))\n                                                    }, null, 8 /* PROPS */, [\"value\"]),\n                                                    _createVNode(ColorSlider, {\n                                                        label: \"\",\n                                                        value: __props.dialogStyle.colors.nameBackground,\n                                                        \"onUpdate:value\": _cache[13] || (_cache[13] = v => updateColor('nameBackground', v))\n                                                    }, null, 8 /* PROPS */, [\"value\"]),\n                                                    _createVNode(ColorSlider, {\n                                                        label: \"\",\n                                                        value: __props.dialogStyle.colors.nameText,\n                                                        \"show-alpha\": false,\n                                                        \"onUpdate:value\": _cache[14] || (_cache[14] = v => updateColor('nameText', v))\n                                                    }, null, 8 /* PROPS */, [\"value\"]),\n                                                    _createVNode(ColorSlider, {\n                                                        label: \"\",\n                                                        value: __props.dialogStyle.colors.dialogText,\n                                                        \"show-alpha\": false,\n                                                        \"onUpdate:value\": _cache[15] || (_cache[15] = v => updateColor('dialogText', v))\n                                                    }, null, 8 /* PROPS */, [\"value\"]),\n                                                    _createVNode(ColorSlider, {\n                                                        label: \"\",\n                                                        value: __props.dialogStyle.colors.narrationText,\n                                                        \"show-alpha\": false,\n                                                        \"onUpdate:value\": _cache[16] || (_cache[16] = v => updateColor('narrationText', v))\n                                                    }, null, 8 /* PROPS */, [\"value\"]),\n                                                    _createVNode(ColorSlider, {\n                                                        label: \"\",\n                                                        value: __props.dialogStyle.colors.arrowBackground,\n                                                        \"onUpdate:value\": _cache[17] || (_cache[17] = v => updateColor('arrowBackground', v))\n                                                    }, null, 8 /* PROPS */, [\"value\"]),\n                                                    _createVNode(ColorSlider, {\n                                                        label: \"\",\n                                                        value: __props.dialogStyle.colors.arrowIcon,\n                                                        \"show-alpha\": false,\n                                                        \"onUpdate:value\": _cache[18] || (_cache[18] = v => updateColor('arrowIcon', v))\n                                                    }, null, 8 /* PROPS */, [\"value\"]),\n                                                    _createVNode(ColorSlider, {\n                                                        label: \"\",\n                                                        value: __props.dialogStyle.colors.indicatorColor,\n                                                        \"onUpdate:value\": _cache[19] || (_cache[19] = v => updateColor('indicatorColor', v))\n                                                    }, null, 8 /* PROPS */, [\"value\"])\n                                                ]))\n                                                : _createCommentVNode(\"v-if\", true)\n                                        ])\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ])\n                        ])\n                    ])\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./SettingsPanel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./SettingsPanel.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./SettingsPanel.vue?vue&type=style&index=0&id=d28e4382&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_53ff6257bd8fdf8315af10a81f7e3da1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-d28e4382\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, normalizeStyle as _normalizeStyle, createElementVNode as _createElementVNode, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, withModifiers as _withModifiers, normalizeClass as _normalizeClass, toDisplayString as _toDisplayString, Fragment as _Fragment, createBlock as _createBlock, renderList as _renderList, vModelText as _vModelText, withKeys as _withKeys, withDirectives as _withDirectives, createStaticVNode as _createStaticVNode } from \"vue\";\nconst _hoisted_1 = { class: \"absolute top-4 left-4 z-50 flex flex-col items-start gap-2\" };\nconst _hoisted_2 = {\n    key: 0,\n    class: \"animate-in fade-in slide-in-from-left-2 text-sm duration-200\"\n};\nconst _hoisted_3 = { class: \"absolute top-4 right-4 z-50 flex flex-col items-end gap-2\" };\nconst _hoisted_4 = {\n    key: 0,\n    class: \"animate-in fade-in slide-in-from-left-2 text-sm duration-200\"\n};\nconst _hoisted_5 = [\"aria-label\"];\nconst _hoisted_6 = {\n    key: 0,\n    class: \"h-5 w-5\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    viewBox: \"0 0 24 24\"\n};\nconst _hoisted_7 = {\n    key: 1,\n    class: \"h-5 w-5\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    viewBox: \"0 0 24 24\"\n};\nconst _hoisted_8 = { class: \"text-sm\" };\nconst _hoisted_9 = { class: \"animate-in fade-in px-8 text-center text-xl leading-relaxed text-white duration-1000 md:text-2xl\" };\nconst _hoisted_10 = { class: \"bg-card/95 text-foreground relative max-h-[85vh] w-[90%] max-w-3xl rounded-lg shadow-2xl backdrop-blur-md\" };\nconst _hoisted_11 = { class: \"border-border/30 flex items-center justify-between border-b px-6 py-3\" };\nconst _hoisted_12 = { class: \"history-scroll-container max-h-[calc(85vh-100px)] overflow-y-auto px-6 py-2\" };\nconst _hoisted_13 = {\n    key: 0,\n    class: \"text-muted-foreground py-12 text-center text-sm\"\n};\nconst _hoisted_14 = [\"onClick\"];\nconst _hoisted_15 = { class: \"font-medium\" };\nconst _hoisted_16 = [\"innerHTML\"];\nconst _hoisted_17 = {\n    key: 4,\n    class: \"bg-border/30 absolute right-3 bottom-0 left-3 h-px opacity-0 transition-opacity group-hover:opacity-100\"\n};\nconst _hoisted_18 = { class: \"flex items-center gap-3\" };\nimport { computed, nextTick, onMounted, onUnmounted, ref, shallowRef, watch } from 'vue';\nimport { hasMotionAndExpression, loadWorldbookResources, parseMessageBlocks, parseStatusBlock, } from '../lib/messageParser';\nimport { defaultDialogStyle } from '../types/galgame';\nimport CharacterSprite from './CharacterSprite.vue';\nimport CharacterStatusPanel from './CharacterStatusPanel.vue';\nimport ChoiceBox from './ChoiceBox.vue';\nimport DialogBox from './DialogBox.vue';\nimport SettingsPanel from './SettingsPanel.vue';\n// localStorage \nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'GalgamePlayer',\n    setup(__props) {\n        const STORAGE_KEYS = {\n            DIALOG_STYLE: 'galgame_dialog_style',\n            SPRITE_SETTINGS: 'galgame_sprite_settings',\n        };\n        const containerRef = ref(null);\n        const autoPlayTimerRef = ref(null);\n        //  -  shallowRef \n        const dialogues = shallowRef([]);\n        const currentDialogIndex = ref(0);\n        const currentDialogue = computed(() => dialogues.value[currentDialogIndex.value] || null);\n        // UI \n        const showSettings = ref(false);\n        const isFullscreen = ref(false);\n        const autoPlay = ref(false);\n        const autoPlaySpeed = ref(3000);\n        const menuExpanded = ref(false);\n        const characterMenuExpanded = ref(false);\n        const showCharacterPanel = ref(false);\n        const blackScreen = ref(false);\n        const blackScreenText = ref('');\n        const showChoices = ref(false);\n        const customModeEnabled = ref(false);\n        const showInputBox = ref(false);\n        const inputText = ref('');\n        const inputRef = ref(null);\n        // \n        const isStreaming = ref(false);\n        const streamingText = ref('');\n        const streamingMessageId = ref(null);\n        //  -  localStorage \n        const spriteSettings = ref(loadFromStorage(STORAGE_KEYS.SPRITE_SETTINGS, {\n            scale: 1,\n            positionX: 50,\n            positionY: 50,\n        }));\n        const dialogStyle = ref(loadFromStorage(STORAGE_KEYS.DIALOG_STYLE, defaultDialogStyle));\n        const previewStyle = ref({ ...dialogStyle.value });\n        // Live2D  -  shallowRef\n        const live2dModels = shallowRef([]);\n        //  localStorage \n        function loadFromStorage(key, defaultValue) {\n            try {\n                const stored = localStorage.getItem(key);\n                if (stored) {\n                    return JSON.parse(stored);\n                }\n            }\n            catch (e) {\n                console.warn(` localStorage  ${key} :`, e);\n            }\n            return defaultValue;\n        }\n        //  localStorage\n        function saveToStorage(key, value) {\n            try {\n                localStorage.setItem(key, JSON.stringify(value));\n            }\n            catch (e) {\n                console.warn(` localStorage ${key} :`, e);\n            }\n        }\n        //  localStorage\n        watch(dialogStyle, newStyle => {\n            saveToStorage(STORAGE_KEYS.DIALOG_STYLE, newStyle);\n        }, { deep: true });\n        watch(spriteSettings, newSettings => {\n            saveToStorage(STORAGE_KEYS.SPRITE_SETTINGS, newSettings);\n        }, { deep: true });\n        //  - iframe\n        //  width  aspect-ratio vh \n        const containerStyle = computed(() => {\n            const isPortrait = window.innerHeight > window.innerWidth;\n            const isFullscreen = !!document.fullscreenElement;\n            const targetAspectRatio = 16 / 9;\n            if (isPortrait && isFullscreen) {\n                // 90\n                // 16:9\n                //  width  aspect-ratio iframe\n                const screenHeight = window.innerHeight; // \n                return {\n                    width: `${screenHeight}px`,\n                    aspectRatio: '16 / 9',\n                    transform: 'rotate(90deg)',\n                    transformOrigin: 'center center',\n                    position: 'absolute',\n                    left: '50%',\n                    top: '50%',\n                    marginLeft: `-${screenHeight / 2}px`,\n                    marginTop: `-${screenHeight / targetAspectRatio / 2}px`,\n                    background: 'transparent',\n                };\n            }\n            else if (isPortrait) {\n                // \n                //  width  aspect-ratio \n                // \n                const containerWidth = containerRef.value?.parentElement?.clientWidth || window.innerWidth;\n                const containerHeight = containerRef.value?.parentElement?.clientHeight || window.innerHeight;\n                // 16:9\n                const requiredHeight = containerWidth / targetAspectRatio;\n                // \n                const scale = containerHeight >= requiredHeight ? 1 : containerHeight / requiredHeight;\n                return {\n                    width: '100%',\n                    aspectRatio: '16 / 9',\n                    transform: `scale(${scale})`,\n                    transformOrigin: 'center center',\n                    margin: '0 auto',\n                    background: 'transparent',\n                };\n            }\n            //  width  aspect-ratio\n            return {\n                width: '100%',\n                aspectRatio: '16 / 9',\n                margin: '0 auto',\n                background: 'transparent',\n            };\n        });\n        // \n        const backgroundImage = computed(() => {\n            const dialogue = currentDialogue.value;\n            // URL\n            if (dialogue?.sceneImageUrl) {\n                return dialogue.sceneImageUrl;\n            }\n            // sceneURL\n            if (dialogue?.scene) {\n                // sceneURL\n                if (dialogue.scene.match(/^https?:\\/\\//) || dialogue.scene.match(/^\\//)) {\n                    return dialogue.scene;\n                }\n            }\n            // \n            return null;\n        });\n        // \n        const currentSpriteType = computed(() => {\n            const dialogue = currentDialogue.value;\n            if (dialogue?.sprite?.type) {\n                return dialogue.sprite.type;\n            }\n            // CG\n            if (dialogue?.isCG || dialogue?.type === 'cg') {\n                return 'none';\n            }\n            //  Live2D  Live2D\n            if (dialogue?.character) {\n                const hasLive2d = live2dModels.value.some(m => m.name === dialogue.character);\n                return hasLive2d ? 'live2d' : 'image';\n            }\n            return 'image';\n        });\n        const currentImageUrl = computed(() => {\n            const dialogue = currentDialogue.value;\n            return dialogue?.sprite?.imageUrl || '/placeholder-user.jpg';\n        });\n        const currentLive2dModelId = computed(() => {\n            const dialogue = currentDialogue.value;\n            if (dialogue?.sprite?.live2dModelId) {\n                return dialogue.sprite.live2dModelId;\n            }\n            // \n            if (dialogue?.character) {\n                const model = live2dModels.value.find(m => m.name === dialogue.character);\n                return model?.id;\n            }\n            return undefined;\n        });\n        // \n        const userMessageEdits = ref(new Map());\n        // \n        async function loadDialoguesFromTavern() {\n            try {\n                const messages = getChatMessages('0-{{lastMessageId}}');\n                const newDialogues = [];\n                let lastScene; // \n                // \n                for (const msg of messages) {\n                    const messageText = msg.message || '';\n                    // \n                    const blocks = await parseMessageBlocks(messageText, lastScene);\n                    // \n                    // StatusBlock  <content> \n                    if (blocks.length === 0) {\n                        continue;\n                    }\n                    // StatusBlock\n                    const statusBlock = parseStatusBlock(messageText);\n                    // [[choice||1||||]]\n                    const newFormatChoiceBlocks = [];\n                    const oldFormatChoiceBlocks = [];\n                    // \n                    for (const block of blocks) {\n                        if (block.type === 'choice') {\n                            if (block.choiceText && block.choiceCharacter && block.choiceResponse) {\n                                // \n                                newFormatChoiceBlocks.push({\n                                    choiceText: block.choiceText,\n                                    choiceCharacter: block.choiceCharacter,\n                                    choiceResponse: block.choiceResponse,\n                                });\n                            }\n                            else if (block.choices && block.choices.length > 0) {\n                                // \n                                oldFormatChoiceBlocks.push({ choices: block.choices });\n                            }\n                        }\n                    }\n                    // \n                    for (const block of blocks) {\n                        if (block.type === 'character') {\n                            // motionexpression\n                            const hasMotionExpr = hasMotionAndExpression(block.character || '', block.motion, block.expression, live2dModels.value);\n                            // CGmotion/expressionCG\n                            const isCGMode = block.isCG || !hasMotionExpr;\n                            const dialogue = {\n                                character: block.character,\n                                text: block.text || '',\n                                message_id: msg.message_id,\n                                role: 'assistant',\n                                type: isCGMode ? 'cg' : undefined,\n                                scene: block.scene,\n                                sceneImageUrl: block.sceneImageUrl, // URL\n                                motion: block.motion,\n                                expression: block.expression,\n                                //  isThrough**\n                                isCG: isCGMode,\n                                cgImageUrl: isCGMode ? block.cgImageUrl || block.scene : undefined, // CG URL\n                                statusBlock,\n                                sprite: isCGMode\n                                    ? { type: 'none' } // CG\n                                    : {\n                                        type: live2dModels.value.some(m => m.name === block.character) ? 'live2d' : 'image',\n                                        imageUrl: block.spriteImageUrl || msg.extra?.sprite_image || undefined,\n                                    },\n                            };\n                            // \n                            if (block.scene) {\n                                lastScene = block.scene;\n                            }\n                            newDialogues.push(dialogue);\n                        }\n                        else if (block.type === 'narration') {\n                            const dialogue = {\n                                character: '',\n                                text: block.message || '',\n                                type: 'narration',\n                                message_id: msg.message_id,\n                                role: 'system',\n                                scene: block.scene,\n                                sceneImageUrl: block.sceneImageUrl, // URL\n                                statusBlock,\n                            };\n                            // \n                            if (block.scene) {\n                                lastScene = block.scene;\n                            }\n                            newDialogues.push(dialogue);\n                        }\n                        else if (block.type === 'blacktext') {\n                            newDialogues.push({\n                                character: '',\n                                text: block.message || '',\n                                type: 'blackscreen',\n                                message_id: msg.message_id,\n                                role: 'system',\n                                statusBlock,\n                            });\n                        }\n                        else if (block.type === 'user') {\n                            const dialogue = {\n                                character: '',\n                                text: block.message || '',\n                                type: 'user',\n                                message_id: msg.message_id,\n                                role: 'user',\n                                scene: block.scene,\n                                sceneImageUrl: block.sceneImageUrl, // URL\n                                isEditable: true,\n                                //  isThrough**\n                                statusBlock,\n                            };\n                            // \n                            if (block.scene) {\n                                lastScene = block.scene;\n                            }\n                            // \n                            const edit = userMessageEdits.value.get(msg.message_id);\n                            if (edit) {\n                                if (edit.deleted) {\n                                    dialogue.isDeleted = true;\n                                }\n                                else if (edit.text !== undefined) {\n                                    dialogue.editedText = edit.text;\n                                    dialogue.text = edit.text;\n                                }\n                            }\n                            newDialogues.push(dialogue);\n                        }\n                        else if (block.type === 'choice') {\n                            // \n                        }\n                    }\n                    // \n                    if (newFormatChoiceBlocks.length > 0) {\n                        // 1\n                        //  choice \n                        newDialogues.push({\n                            character: '',\n                            text: '',\n                            type: 'choice',\n                            message_id: msg.message_id,\n                            role: 'system',\n                            options: newFormatChoiceBlocks.map((choiceBlock, index) => ({\n                                id: `choice_${index}`,\n                                text: choiceBlock.choiceText,\n                                character: choiceBlock.choiceCharacter,\n                                response: choiceBlock.choiceResponse,\n                            })),\n                            statusBlock,\n                        });\n                    }\n                    else if (oldFormatChoiceBlocks.length > 0) {\n                        // 2AI\n                        // \n                        const allChoices = [];\n                        for (const choiceBlock of oldFormatChoiceBlocks) {\n                            allChoices.push(...choiceBlock.choices);\n                        }\n                        newDialogues.push({\n                            character: '',\n                            text: '',\n                            type: 'choice',\n                            message_id: msg.message_id,\n                            role: 'system',\n                            options: allChoices.map((choice, index) => ({\n                                id: `choice_${index}`,\n                                text: choice,\n                            })),\n                            statusBlock,\n                        });\n                    }\n                }\n                // \n                const filteredDialogues = newDialogues.filter(d => !d.isDeleted);\n                dialogues.value = filteredDialogues;\n                // \n                if (filteredDialogues.length > 0 && currentDialogIndex.value < filteredDialogues.length - 1) {\n                    currentDialogIndex.value = filteredDialogues.length - 1;\n                }\n                console.info(` ${dialogues.value.length} `);\n                // \n                if (dialogues.value.length === 0) {\n                    loadTestDialogues();\n                }\n            }\n            catch (error) {\n                console.error(':', error);\n                // \n                loadTestDialogues();\n            }\n        }\n        // \n        function loadTestDialogues() {\n            console.info('');\n            dialogues.value = [\n                {\n                    character: '',\n                    text: ' Galgame ',\n                    type: undefined,\n                    scene: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=1920&h=1080&fit=crop',\n                    sprite: { type: 'image', imageUrl: '/placeholder-user.jpg' },\n                },\n                {\n                    character: '',\n                    text: '',\n                    isThrough: false,\n                },\n                {\n                    character: '',\n                    text: '',\n                    type: 'narration',\n                },\n                {\n                    character: '',\n                    text: '*through*  through ',\n                    isThrough: true,\n                },\n                {\n                    character: '',\n                    text: '...',\n                    type: 'blackscreen',\n                },\n                {\n                    character: '',\n                    text: '',\n                },\n                {\n                    character: '',\n                    text: '',\n                },\n                {\n                    character: '',\n                    text: '',\n                    type: 'choice',\n                    options: [\n                        { id: 'opt1', text: '' },\n                        { id: 'opt2', text: '' },\n                        { id: 'opt3', text: '' },\n                    ],\n                },\n                {\n                    character: '',\n                    text: ' Live2D ',\n                },\n                {\n                    character: '',\n                    text: '',\n                },\n                {\n                    character: '',\n                    text: '',\n                    type: 'narration',\n                },\n            ];\n        }\n        //  Live2D \n        async function loadLive2dModels() {\n            try {\n                const modelsMap = new Map();\n                // 1. \n                const variables = getVariables({ type: 'character' }) || {};\n                if (variables?.live2d_models && Array.isArray(variables.live2d_models)) {\n                    for (const model of variables.live2d_models) {\n                        if (model.name) {\n                            modelsMap.set(model.name, { ...model });\n                        }\n                    }\n                }\n                // 2.  defaultAnimation \n                try {\n                    const resources = await loadWorldbookResources();\n                    for (const [modelName, modelData] of resources.models.entries()) {\n                        const existingModel = modelsMap.get(modelName);\n                        if (existingModel) {\n                            //  defaultAnimation \n                            if (modelData.defaultAnimation) {\n                                existingModel.defaultAnimation = modelData.defaultAnimation;\n                            }\n                            // \n                            if (modelData.files) {\n                                // \n                                if (modelData.files.model3) {\n                                    existingModel.modelPath = modelData.files.model3.split('/').pop() || existingModel.modelPath;\n                                    //  basePath\n                                    const basePath = modelData.files.model3.substring(0, modelData.files.model3.lastIndexOf('/') + 1);\n                                    existingModel.basePath = basePath || existingModel.basePath;\n                                }\n                                if (modelData.files.textures) {\n                                    existingModel.textures = modelData.files.textures;\n                                }\n                            }\n                            //  motions  expressions\n                            if (modelData.motions && modelData.motions.length > 0) {\n                                existingModel.motions = modelData.motions.map(m => ({\n                                    group: m.group || 'idle',\n                                    name: m.name,\n                                    file: m.file,\n                                }));\n                            }\n                            if (modelData.expressions && modelData.expressions.length > 0) {\n                                existingModel.expressions = modelData.expressions.map(e => e.name || e.file);\n                            }\n                        }\n                        else {\n                            // \n                            // \n                            console.warn(` ${modelName}`);\n                        }\n                    }\n                }\n                catch (error) {\n                    console.warn(':', error);\n                }\n                live2dModels.value = Array.from(modelsMap.values());\n                console.info(` ${live2dModels.value.length}  Live2D `);\n            }\n            catch (error) {\n                console.error(' Live2D :', error);\n            }\n        }\n        function nextDialogue(skipBlackscreen = false) {\n            if (currentDialogIndex.value < dialogues.value.length - 1) {\n                const nextIndex = currentDialogIndex.value + 1;\n                currentDialogIndex.value = nextIndex;\n                if (skipBlackscreen) {\n                    blackScreen.value = false;\n                }\n                showChoices.value = false;\n            }\n        }\n        function prevDialogue() {\n            if (currentDialogIndex.value > 0) {\n                currentDialogIndex.value--;\n                showChoices.value = false;\n            }\n        }\n        // \n        watch(() => [currentDialogIndex.value, currentDialogue.value], () => {\n            const dialogue = currentDialogue.value;\n            if (!dialogue)\n                return;\n            // \n            if (streamingMessageId.value !== null && dialogue.message_id !== streamingMessageId.value) {\n                isStreaming.value = false;\n                streamingText.value = '';\n                streamingMessageId.value = null;\n            }\n            if (dialogue.type === 'blackscreen') {\n                blackScreenText.value = dialogue.text;\n                blackScreen.value = true;\n                showChoices.value = false;\n            }\n            else if (dialogue.type === 'choice') {\n                showChoices.value = true;\n                blackScreen.value = false;\n            }\n            else {\n                blackScreen.value = false;\n                showChoices.value = false;\n            }\n        }, { immediate: true });\n        // \n        watch(() => [autoPlay.value, autoPlaySpeed.value, currentDialogIndex.value, showChoices.value, currentDialogue.value], () => {\n            if (autoPlayTimerRef.value) {\n                clearTimeout(autoPlayTimerRef.value);\n                autoPlayTimerRef.value = null;\n            }\n            if (autoPlay.value && currentDialogIndex.value < dialogues.value.length - 1 && !showChoices.value) {\n                const dialogue = currentDialogue.value;\n                const delay = dialogue?.type === 'blackscreen' ? autoPlaySpeed.value + 2000 : autoPlaySpeed.value;\n                autoPlayTimerRef.value = setTimeout(() => {\n                    nextDialogue();\n                }, delay);\n            }\n        }, { immediate: true });\n        // \n        async function toggleFullscreen() {\n            try {\n                if (!document.fullscreenElement && containerRef.value) {\n                    // \n                    if (window.innerHeight > window.innerWidth) {\n                        // \n                        if (screen.orientation && screen.orientation.lock) {\n                            try {\n                                await screen.orientation.lock('landscape');\n                            }\n                            catch (e) {\n                                console.warn(':', e);\n                            }\n                        }\n                    }\n                    await containerRef.value.requestFullscreen();\n                    isFullscreen.value = true;\n                }\n                else {\n                    await document.exitFullscreen();\n                    isFullscreen.value = false;\n                    // \n                    if (screen.orientation && screen.orientation.unlock) {\n                        try {\n                            await screen.orientation.unlock();\n                        }\n                        catch (e) {\n                            // \n                        }\n                    }\n                }\n                menuExpanded.value = false;\n            }\n            catch (error) {\n                console.error(':', error);\n            }\n        }\n        // \n        const handleFullscreenChange = () => {\n            isFullscreen.value = !!document.fullscreenElement;\n            // \n            nextTick(() => {\n                // \n            });\n        };\n        // \n        const handleResize = () => {\n            // containerStyle  computed\n            //  nextTick  DOM \n            nextTick(() => {\n                //  computed \n                if (containerRef.value) {\n                    //  containerStyle \n                    const _ = containerStyle.value;\n                }\n            });\n        };\n        // \n        const eventCleanups = [];\n        onMounted(() => {\n            document.addEventListener('fullscreenchange', handleFullscreenChange);\n            window.addEventListener('resize', handleResize);\n            window.addEventListener('orientationchange', handleResize);\n            // \n            loadLive2dModels();\n            loadDialoguesFromTavern();\n            // \n            if (typeof eventOn === 'function' && typeof tavern_events !== 'undefined') {\n                // \n                const messageReceivedCleanup = eventOn(tavern_events.MESSAGE_RECEIVED, async (messageId) => {\n                    await loadDialoguesFromTavern();\n                    // \n                    if (autoPlay.value) {\n                        currentDialogIndex.value = dialogues.value.length - 1;\n                    }\n                    // IDID\n                    if (streamingMessageId.value === messageId) {\n                        isStreaming.value = false;\n                        streamingText.value = '';\n                        streamingMessageId.value = null;\n                    }\n                });\n                if (messageReceivedCleanup)\n                    eventCleanups.push(messageReceivedCleanup);\n                // \n                const messageUpdatedCleanup = eventOn(tavern_events.MESSAGE_UPDATED, async () => {\n                    await loadDialoguesFromTavern();\n                    // \n                    if (streamingMessageId.value !== null) {\n                        const updatedMessage = dialogues.value.find(d => d.message_id === streamingMessageId.value);\n                        if (updatedMessage && updatedMessage.text === streamingText.value) {\n                            isStreaming.value = false;\n                            streamingText.value = '';\n                            streamingMessageId.value = null;\n                        }\n                    }\n                });\n                if (messageUpdatedCleanup)\n                    eventCleanups.push(messageUpdatedCleanup);\n                // \n                const chatChangedCleanup = eventOn(tavern_events.CHAT_CHANGED, () => {\n                    loadDialoguesFromTavern();\n                    currentDialogIndex.value = 0;\n                    isStreaming.value = false;\n                    streamingText.value = '';\n                    streamingMessageId.value = null;\n                });\n                if (chatChangedCleanup)\n                    eventCleanups.push(chatChangedCleanup);\n                // token\n                const streamTokenCleanup = eventOn(tavern_events.STREAM_TOKEN_RECEIVED, (text) => {\n                    handleStreamToken(text);\n                });\n                if (streamTokenCleanup)\n                    eventCleanups.push(streamTokenCleanup);\n            }\n        });\n        onUnmounted(() => {\n            document.removeEventListener('fullscreenchange', handleFullscreenChange);\n            window.removeEventListener('resize', handleResize);\n            window.removeEventListener('orientationchange', handleResize);\n            if (autoPlayTimerRef.value) {\n                clearTimeout(autoPlayTimerRef.value);\n                autoPlayTimerRef.value = null;\n            }\n            // \n            eventCleanups.forEach(cleanup => cleanup());\n            eventCleanups.length = 0;\n        });\n        function handleBlackScreenClick(e) {\n            const rect = e.currentTarget.getBoundingClientRect();\n            const clickX = e.clientX - rect.left;\n            const halfWidth = rect.width / 2;\n            if (clickX < halfWidth) {\n                if (currentDialogIndex.value > 0) {\n                    currentDialogIndex.value--;\n                    blackScreen.value = false;\n                }\n            }\n            else {\n                nextDialogue(true);\n            }\n        }\n        function handleClick() {\n            if (!showSettings.value && !menuExpanded.value && !showChoices.value) {\n                if (!blackScreen.value) {\n                    nextDialogue();\n                }\n            }\n        }\n        /**\n         *  </content> \n         */\n        function trimMessageBeforeContentTag(messageText) {\n            //  </content> \n            const contentEndIndex = messageText.indexOf('</content>');\n            if (contentEndIndex !== -1) {\n                //  </content>  </content>\n                return messageText.substring(0, contentEndIndex + 10); // 10  '</content>' \n            }\n            //  </content>\n            return messageText;\n        }\n        // \n        async function handleSaveToStory(text) {\n            try {\n                // ID\n                const currentMessageId = getCurrentMessageId();\n                const chat_message = getChatMessages(currentMessageId)[0];\n                if (!chat_message) {\n                    console.warn('');\n                    return;\n                }\n                // \n                const currentScene = currentDialogue.value?.scene || '{{scene}}';\n                // \n                const newMessage = chat_message.message + '\\n\\n[[user||' + currentScene + '||' + text + ']]';\n                //  setChatMessages \n                await setChatMessages([\n                    {\n                        message_id: currentMessageId,\n                        message: newMessage,\n                    },\n                ], { refresh: 'none' });\n                // \n                const newDialogue = {\n                    character: '',\n                    text,\n                    type: 'user',\n                    isEditable: true,\n                    message_id: getLastMessageId() + 1, // ID\n                };\n                const newDialogues = [...dialogues.value];\n                newDialogues.splice(currentDialogIndex.value + 1, 0, newDialogue);\n                dialogues.value = newDialogues;\n                // \n                currentDialogIndex.value = currentDialogIndex.value + 1;\n                console.info(':', text);\n            }\n            catch (error) {\n                console.error(':', error);\n            }\n        }\n        // \n        async function trimChoiceText(messageId, selectedText) {\n            try {\n                const messages = getChatMessages(messageId);\n                if (messages.length === 0)\n                    return;\n                const originalMessage = messages[0];\n                const messageText = originalMessage.message || '';\n                // \n                const choiceBlockRegex = /\\[\\[choice\\|\\|([^\\]]+)\\]\\]/g;\n                let match;\n                let newMessageText = messageText;\n                const allChoiceBlocks = [];\n                // \n                while ((match = choiceBlockRegex.exec(messageText)) !== null) {\n                    const choiceBlock = match[0];\n                    const parts = match[1]\n                        .split('||')\n                        .map(c => c.trim())\n                        .filter(c => c);\n                    allChoiceBlocks.push({ block: choiceBlock, parts });\n                }\n                // [[choice||1||||]]\n                const newFormatBlocks = allChoiceBlocks.filter(cb => cb.parts.length >= 3);\n                if (newFormatBlocks.length > 0) {\n                    // \n                    for (const choiceBlock of newFormatBlocks) {\n                        const choiceText = choiceBlock.parts[0];\n                        if (choiceText !== selectedText) {\n                            // \n                            newMessageText = newMessageText.replace(choiceBlock.block, '');\n                            console.info(':', choiceText);\n                        }\n                    }\n                    // \n                    newMessageText = newMessageText.replace(/\\n\\s*\\n/g, '\\n').trim();\n                }\n                else {\n                    // [[choice||1||2||3]]\n                    const oldFormatBlocks = allChoiceBlocks.filter(cb => cb.parts.length < 3 && cb.parts.length > 0);\n                    for (const choiceBlock of oldFormatBlocks) {\n                        const selectedIndex = choiceBlock.parts.findIndex(c => c === selectedText);\n                        if (selectedIndex !== -1) {\n                            // \n                            const trimmedChoiceBlock = `[[choice||${selectedText}]]`;\n                            newMessageText = newMessageText.replace(choiceBlock.block, trimmedChoiceBlock);\n                            console.info(':', selectedText);\n                        }\n                    }\n                }\n                // \n                if (newMessageText !== messageText) {\n                    await setChatMessages([\n                        {\n                            message_id: messageId,\n                            message: newMessageText,\n                        },\n                    ], { refresh: 'none' });\n                    console.info('');\n                }\n            }\n            catch (error) {\n                console.error(':', error);\n            }\n        }\n        async function handleChoiceSelect(id, customText) {\n            console.info(':', id, customText);\n            // ID\n            const currentMessageId = currentDialogue.value?.message_id;\n            if (currentMessageId === undefined) {\n                console.warn('ID');\n                nextDialogue();\n                return;\n            }\n            try {\n                // ID\n                const lastMessageId = getLastMessageId();\n                // \n                const isAllDialoguesLoaded = currentDialogIndex.value >= dialogues.value.length - 1;\n                // \n                let messageText = '';\n                let selectedOption;\n                if (id === 'custom' && customText) {\n                    // \n                    messageText = customText.trim();\n                }\n                else {\n                    // \n                    selectedOption = currentDialogue.value?.options?.find(opt => opt.id === id);\n                    messageText = selectedOption?.text || '';\n                }\n                if (!messageText) {\n                    console.warn('');\n                    nextDialogue();\n                    return;\n                }\n                // 1. \n                await trimChoiceText(currentMessageId, messageText);\n                // 2. \n                if (selectedOption && selectedOption.character && selectedOption.response) {\n                    // \n                    const responseDialogue = {\n                        character: selectedOption.character,\n                        text: selectedOption.response,\n                        type: undefined,\n                        message_id: currentMessageId, // ID\n                        role: 'assistant',\n                    };\n                    // \n                    const newDialogues = [...dialogues.value];\n                    newDialogues.splice(currentDialogIndex.value + 1, 0, responseDialogue);\n                    dialogues.value = newDialogues;\n                    // \n                    currentDialogIndex.value = currentDialogIndex.value + 1;\n                }\n                // 3. \n                if (isAllDialoguesLoaded) {\n                    //  </content>  AI \n                    if (currentMessageId !== undefined) {\n                        try {\n                            //  </content> \n                            const messages = getChatMessages(currentMessageId);\n                            if (messages.length > 0) {\n                                const currentMessage = messages[0];\n                                const originalText = currentMessage.message || '';\n                                const trimmedText = trimMessageBeforeContentTag(originalText);\n                                if (trimmedText !== originalText) {\n                                    await setChatMessages([\n                                        {\n                                            message_id: currentMessageId,\n                                            message: trimmedText,\n                                        },\n                                    ], { refresh: 'none' });\n                                    console.info(' </content> ');\n                                }\n                            }\n                        }\n                        catch (error) {\n                            console.error(':', error);\n                        }\n                    }\n                    if (currentMessageId !== undefined && currentMessageId < lastMessageId) {\n                        const messagesToDelete = [];\n                        for (let i = currentMessageId + 1; i <= lastMessageId; i++) {\n                            messagesToDelete.push(i);\n                        }\n                        if (messagesToDelete.length > 0) {\n                            await deleteChatMessages(messagesToDelete, { refresh: 'all' });\n                            console.info(` ${messagesToDelete.length} `);\n                        }\n                    }\n                    // \n                    await createChatMessages([\n                        {\n                            role: 'user',\n                            message: messageText,\n                        },\n                    ], { refresh: 'all' });\n                    console.info(':', messageText);\n                    // token\n                    const expectedMessageId = getLastMessageId() + 1;\n                    isStreaming.value = true;\n                    streamingText.value = '';\n                    streamingMessageId.value = expectedMessageId;\n                    //  AI \n                    await triggerSlash('/trigger');\n                    console.info(' AI ');\n                    // \n                    await loadDialoguesFromTavern();\n                    // \n                    nextTick(() => {\n                        if (dialogues.value.length > 0) {\n                            const newMessage = dialogues.value.find(d => d.message_id === expectedMessageId);\n                            if (newMessage) {\n                                currentDialogIndex.value = dialogues.value.indexOf(newMessage);\n                            }\n                            else {\n                                currentDialogIndex.value = dialogues.value.length - 1;\n                            }\n                        }\n                    });\n                }\n                else {\n                    // 1 AI \n                    //  </content>  AI \n                    if (id === 'custom' && customText) {\n                        //  </content> \n                        if (currentMessageId !== undefined) {\n                            try {\n                                const messages = getChatMessages(currentMessageId);\n                                if (messages.length > 0) {\n                                    const currentMessage = messages[0];\n                                    const originalText = currentMessage.message || '';\n                                    const trimmedText = trimMessageBeforeContentTag(originalText);\n                                    if (trimmedText !== originalText) {\n                                        await setChatMessages([\n                                            {\n                                                message_id: currentMessageId,\n                                                message: trimmedText,\n                                            },\n                                        ], { refresh: 'none' });\n                                        console.info(' </content> ');\n                                    }\n                                }\n                            }\n                            catch (error) {\n                                console.error(':', error);\n                            }\n                        }\n                        //  AI \n                        if (currentMessageId !== undefined && currentMessageId < lastMessageId) {\n                            const messagesToDelete = [];\n                            for (let i = currentMessageId + 1; i <= lastMessageId; i++) {\n                                messagesToDelete.push(i);\n                            }\n                            if (messagesToDelete.length > 0) {\n                                await deleteChatMessages(messagesToDelete, { refresh: 'all' });\n                                console.info(` ${messagesToDelete.length} `);\n                            }\n                        }\n                        // \n                        await createChatMessages([\n                            {\n                                role: 'user',\n                                message: messageText,\n                            },\n                        ], { refresh: 'all' });\n                        console.info(':', messageText);\n                        // \n                        const expectedMessageId = getLastMessageId() + 1;\n                        isStreaming.value = true;\n                        streamingText.value = '';\n                        streamingMessageId.value = expectedMessageId;\n                        //  AI \n                        await triggerSlash('/trigger');\n                        console.info(' AI ');\n                        // \n                        await loadDialoguesFromTavern();\n                        // \n                        nextTick(() => {\n                            if (dialogues.value.length > 0) {\n                                const newMessage = dialogues.value.find(d => d.message_id === expectedMessageId);\n                                if (newMessage) {\n                                    currentDialogIndex.value = dialogues.value.indexOf(newMessage);\n                                }\n                                else {\n                                    currentDialogIndex.value = dialogues.value.length - 1;\n                                }\n                            }\n                        });\n                    }\n                    else {\n                        //  AI \n                        // \n                        nextDialogue();\n                    }\n                }\n            }\n            catch (error) {\n                console.error(':', error);\n                isStreaming.value = false;\n                streamingText.value = '';\n                streamingMessageId.value = null;\n                nextDialogue();\n            }\n        }\n        // \n        function getDisplayText() {\n            const dialogue = currentDialogue.value;\n            if (!dialogue)\n                return '';\n            // \n            const text = dialogue.text || dialogue.message || '';\n            if (!text)\n                return '';\n            // \n            if (isStreaming.value && streamingMessageId.value === dialogue.message_id) {\n                // \n                return text;\n            }\n            // \n            return text;\n        }\n        // token\n        function handleStreamToken(text) {\n            if (!isStreaming.value || streamingMessageId.value === null) {\n                return;\n            }\n            // \n            streamingText.value = text;\n        }\n        // \n        const showHistoryDialog = ref(false);\n        const historyMessages = ref([]);\n        async function handleHistory() {\n            menuExpanded.value = false;\n            showHistoryDialog.value = true;\n            try {\n                // \n                const lastMessageId = getLastMessageId();\n                const messages = [];\n                for (let i = 0; i <= lastMessageId; i++) {\n                    try {\n                        const chatMessages = getChatMessages(i);\n                        if (chatMessages.length > 0) {\n                            const msg = chatMessages[0];\n                            const messageText = msg.message || '';\n                            // \n                            const blocks = await parseMessageBlocks(messageText);\n                            const items = [];\n                            for (const block of blocks) {\n                                if (block.type === 'character' && block.character && block.text) {\n                                    items.push({\n                                        type: 'character',\n                                        character: block.character,\n                                        text: block.text,\n                                    });\n                                }\n                                else if (block.type === 'user') {\n                                    const userText = 'message' in block ? block.message : block.text;\n                                    if (userText) {\n                                        //  *through* \n                                        items.push({\n                                            type: 'user',\n                                            character: '',\n                                            text: userText,\n                                        });\n                                    }\n                                }\n                                else if (block.type === 'narration') {\n                                    const narrationText = 'message' in block ? block.message : block.text;\n                                    if (narrationText) {\n                                        items.push({\n                                            type: 'narration',\n                                            text: narrationText,\n                                        });\n                                    }\n                                }\n                                else if (block.type === 'blacktext') {\n                                    const blackText = 'message' in block ? block.message : block.text;\n                                    if (blackText) {\n                                        items.push({\n                                            type: 'blacktext',\n                                            text: blackText,\n                                        });\n                                    }\n                                }\n                                else if (block.type === 'choice' && (block.choiceText || block.text)) {\n                                    items.push({\n                                        type: 'choice',\n                                        text: block.choiceText || block.text || '',\n                                    });\n                                }\n                            }\n                            // \n                            if (items.length === 0) {\n                                const cleanText = messageText\n                                    .replace(/\\[\\[[^\\]]+\\]\\]/g, '')\n                                    .replace(/<[^>]+>/g, '')\n                                    .trim();\n                                if (cleanText) {\n                                    items.push({\n                                        type: msg.role === 'user' ? 'user' : 'character',\n                                        character: msg.role === 'user' ? '' : 'AI',\n                                        text: cleanText,\n                                    });\n                                }\n                            }\n                            if (items.length > 0) {\n                                messages.push({\n                                    id: i,\n                                    role: msg.role || 'user',\n                                    items,\n                                });\n                            }\n                        }\n                    }\n                    catch (error) {\n                        // \n                        console.warn(` ${i} :`, error);\n                    }\n                }\n                historyMessages.value = messages.reverse(); // \n                console.info(` ${historyMessages.value.length} `);\n            }\n            catch (error) {\n                console.error(':', error);\n            }\n        }\n        //  ** \n        function formatUserText(text) {\n            if (!text)\n                return '';\n            //  ** \n            //  **  *through* \n            return text.replace(/\\*([^*]+)\\*/g, (match, content) => {\n                //  *through* \n                if (content.trim() === 'through')\n                    return match;\n                // \n                return ` <span style=\"color: #9ca3af; font-style: italic;\">${content}</span> `;\n            });\n        }\n        // \n        async function jumpToHistoryMessage(messageId) {\n            try {\n                // \n                showHistoryDialog.value = false;\n                // \n                await loadDialoguesFromTavern();\n                // \n                const dialogueIndex = dialogues.value.findIndex(d => d.message_id === messageId);\n                if (dialogueIndex >= 0) {\n                    currentDialogIndex.value = dialogueIndex;\n                    console.info(` ${messageId} ${dialogueIndex}`);\n                }\n                else {\n                    console.warn(` ${messageId} `);\n                }\n            }\n            catch (error) {\n                console.error(':', error);\n            }\n        }\n        function handleSaveStyle() {\n            dialogStyle.value = { ...previewStyle.value };\n        }\n        function handleSettingsClick() {\n            if (menuExpanded.value) {\n                if (!customModeEnabled.value) {\n                    previewStyle.value = { ...dialogStyle.value };\n                }\n                showSettings.value = true;\n                menuExpanded.value = false;\n            }\n            else {\n                menuExpanded.value = true;\n            }\n        }\n        function handleCharacterClick() {\n            // \n            if (characterMenuExpanded.value) {\n                showCharacterPanel.value = true;\n                characterMenuExpanded.value = false;\n            }\n            else {\n                // \n                characterMenuExpanded.value = true;\n            }\n        }\n        function handleInputClick() {\n            showInputBox.value = true;\n            characterMenuExpanded.value = false;\n            // \n            nextTick(() => {\n                inputRef.value?.focus();\n            });\n        }\n        // \n        async function handleSendInput() {\n            if (!inputText.value.trim())\n                return;\n            const text = inputText.value.trim();\n            inputText.value = '';\n            showInputBox.value = false;\n            // \n            const isAllDialoguesLoaded = currentDialogIndex.value >= dialogues.value.length - 1;\n            const currentMessageId = currentDialogue.value?.message_id;\n            const lastMessageId = getLastMessageId();\n            //  </content> \n            if (!isAllDialoguesLoaded && currentMessageId !== undefined) {\n                try {\n                    // \n                    const messages = getChatMessages(currentMessageId);\n                    if (messages.length > 0) {\n                        const currentMessage = messages[0];\n                        const originalText = currentMessage.message || '';\n                        //  </content> \n                        const trimmedText = trimMessageBeforeContentTag(originalText);\n                        // \n                        if (trimmedText !== originalText) {\n                            await setChatMessages([\n                                {\n                                    message_id: currentMessageId,\n                                    message: trimmedText,\n                                },\n                            ], { refresh: 'none' });\n                            console.info(' </content> ');\n                        }\n                    }\n                    // \n                    if (currentMessageId < lastMessageId) {\n                        const messagesToDelete = [];\n                        for (let i = currentMessageId + 1; i <= lastMessageId; i++) {\n                            messagesToDelete.push(i);\n                        }\n                        if (messagesToDelete.length > 0) {\n                            await deleteChatMessages(messagesToDelete, { refresh: 'all' });\n                            console.info(` ${messagesToDelete.length} `);\n                        }\n                    }\n                }\n                catch (error) {\n                    console.error(':', error);\n                }\n            }\n            // \n            const newDialogue = {\n                character: '',\n                text,\n                type: 'user',\n                isEditable: true,\n                message_id: getLastMessageId() + 1, // ID\n            };\n            // \n            const newDialogues = [...dialogues.value];\n            newDialogues.splice(currentDialogIndex.value + 1, 0, newDialogue);\n            dialogues.value = newDialogues;\n            // \n            currentDialogIndex.value = currentDialogIndex.value + 1;\n            //  AI \n            try {\n                // \n                await applyUserMessageEdits();\n                // \n                const currentScene = currentDialogue.value?.scene || '{{scene}}';\n                // \n                const formattedMessage = `[[user||${currentScene}||${text}]]`;\n                await createChatMessages([\n                    {\n                        role: 'user',\n                        message: formattedMessage,\n                    },\n                ], { refresh: 'all' });\n                console.info(':', text);\n                // token\n                const expectedMessageId = getLastMessageId() + 1;\n                isStreaming.value = true;\n                streamingText.value = '';\n                streamingMessageId.value = expectedMessageId;\n                //  AI \n                await triggerSlash('/trigger');\n                console.info(' AI ');\n                // \n                await loadDialoguesFromTavern();\n                // \n                nextTick(() => {\n                    if (dialogues.value.length > 0) {\n                        const newMessage = dialogues.value.find(d => d.message_id === expectedMessageId);\n                        if (newMessage) {\n                            currentDialogIndex.value = dialogues.value.indexOf(newMessage);\n                        }\n                        else {\n                            currentDialogIndex.value = dialogues.value.length - 1;\n                        }\n                    }\n                });\n            }\n            catch (error) {\n                console.error(':', error);\n                isStreaming.value = false;\n                streamingText.value = '';\n                streamingMessageId.value = null;\n            }\n        }\n        // \n        async function handleSaveInput() {\n            if (!inputText.value.trim())\n                return;\n            const text = inputText.value.trim();\n            inputText.value = '';\n            showInputBox.value = false;\n            // \n            await handleSaveToStory(text);\n        }\n        // \n        async function handleEditUserMessage(messageId, newText) {\n            try {\n                // \n                await syncEditToMessage(messageId, newText);\n                // \n                userMessageEdits.value.set(messageId, { text: newText });\n                // UI\n                const dialogueIndex = dialogues.value.findIndex(d => d.message_id === messageId);\n                if (dialogueIndex !== -1) {\n                    const newDialogues = [...dialogues.value];\n                    newDialogues[dialogueIndex] = {\n                        ...newDialogues[dialogueIndex],\n                        text: newText,\n                    };\n                    dialogues.value = newDialogues;\n                }\n                console.info(':', messageId, newText);\n            }\n            catch (error) {\n                console.error(':', error);\n            }\n        }\n        // \n        async function handleDeleteUserMessage(messageId) {\n            try {\n                // \n                userMessageEdits.value.set(messageId, { deleted: true });\n                // UI\n                const dialogueIndex = dialogues.value.findIndex(d => d.message_id === messageId);\n                if (dialogueIndex !== -1) {\n                    const newDialogues = [...dialogues.value];\n                    newDialogues.splice(dialogueIndex, 1);\n                    dialogues.value = newDialogues;\n                    // \n                    if (currentDialogIndex.value >= newDialogues.length) {\n                        currentDialogIndex.value = Math.max(0, newDialogues.length - 1);\n                    }\n                }\n                console.info(':', messageId);\n            }\n            catch (error) {\n                console.error(':', error);\n            }\n        }\n        // \n        async function applyUserMessageEdits() {\n            if (userMessageEdits.value.size === 0)\n                return;\n            try {\n                // \n                for (const [messageId, edit] of userMessageEdits.value.entries()) {\n                    if (edit.deleted) {\n                        // \n                        await deleteChatMessages([messageId], { refresh: 'none' });\n                        console.info(':', messageId);\n                    }\n                    else if (edit.text) {\n                        // \n                        // \n                        await syncEditToMessage(messageId, edit.text);\n                        console.info(':', messageId);\n                    }\n                }\n                // \n                userMessageEdits.value.clear();\n                // \n            }\n            catch (error) {\n                console.error(':', error);\n            }\n        }\n        // \n        async function syncEditToMessage(messageId, newText) {\n            try {\n                const messages = getChatMessages(messageId);\n                if (messages.length > 0) {\n                    const originalMessage = messages[0];\n                    const messageText = originalMessage.message || '';\n                    //  <content> \n                    const contentMatch = messageText.match(/<content>([\\s\\S]*?)<\\/content>/i);\n                    const contentText = contentMatch ? contentMatch[1] : messageText;\n                    //  [[user||...]] \n                    const userBlockRegex = /\\[\\[user\\|\\|([^\\]]+)\\]\\]/g;\n                    let match;\n                    let newMessageText = messageText;\n                    let foundMatch = false;\n                    //  user \n                    while ((match = userBlockRegex.exec(contentText)) !== null) {\n                        const content = match[1];\n                        // \n                        const kvPairs = {};\n                        const parts = content\n                            .split('||')\n                            .map(p => p.trim())\n                            .filter(p => p);\n                        for (const part of parts) {\n                            const kvMatch = part.match(/^([^:]+)[:]\\s*(.+)$/);\n                            if (kvMatch) {\n                                const key = kvMatch[1].trim();\n                                const value = kvMatch[2].trim();\n                                if (key && value) {\n                                    kvPairs[key] = value;\n                                }\n                            }\n                        }\n                        //  user \n                        if (kvPairs[''] ||\n                            kvPairs['scene'] ||\n                            kvPairs[''] ||\n                            kvPairs[''] ||\n                            kvPairs[''] ||\n                            kvPairs['text']) {\n                            const scene = kvPairs[''] || kvPairs['scene'] || '{{scene}}';\n                            const oldBlock = match[0];\n                            // **\n                            const newBlock = `[[user||${scene}||${newText}]]`;\n                            //  <content>  contentText \n                            if (contentMatch) {\n                                const newContentText = contentText.replace(oldBlock, newBlock);\n                                newMessageText = messageText.replace(contentMatch[0], `<content>${newContentText}</content>`);\n                            }\n                            else {\n                                newMessageText = messageText.replace(oldBlock, newBlock);\n                            }\n                            foundMatch = true;\n                            break;\n                        }\n                    }\n                    //  <content> \n                    if (!foundMatch) {\n                        if (contentMatch) {\n                            const newContentText = contentText + `\\n[[user||{{scene}}||${newText}]]`;\n                            newMessageText = messageText.replace(contentMatch[0], `<content>${newContentText}</content>`);\n                        }\n                        else {\n                            newMessageText = messageText + `\\n[[user||{{scene}}||${newText}]]`;\n                        }\n                    }\n                    await setChatMessages([\n                        {\n                            message_id: messageId,\n                            message: newMessageText,\n                        },\n                    ], { refresh: 'none' });\n                    console.info(':', messageId, newText);\n                }\n            }\n            catch (error) {\n                console.error(':', error);\n            }\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                ref_key: \"containerRef\",\n                ref: containerRef,\n                class: \"relative w-full overflow-hidden select-none\",\n                style: _normalizeStyle([containerStyle.value, { \"background\": \"transparent\" }])\n            }, [\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", {\n                    class: \"absolute inset-0 bg-center bg-no-repeat\",\n                    style: _normalizeStyle({\n                        backgroundImage: backgroundImage.value ? `url('${backgroundImage.value}')` : undefined,\n                        backgroundColor: 'transparent',\n                        backgroundSize: backgroundImage.value ? 'cover' : undefined,\n                        backgroundPosition: 'center',\n                        backgroundRepeat: 'no-repeat',\n                        objectFit: 'cover',\n                    })\n                }, null, 4 /* STYLE */),\n                _createCommentVNode(\"  \"),\n                _cache[21] || (_cache[21] = _createElementVNode(\"div\", { class: \"bg-primary/5 absolute inset-0\" }, null, -1 /* CACHED */)),\n                _createCommentVNode(\"  \"),\n                _createVNode(CharacterSprite, {\n                    scale: spriteSettings.value.scale,\n                    \"position-x\": spriteSettings.value.positionX,\n                    \"position-y\": spriteSettings.value.positionY,\n                    \"sprite-type\": currentSpriteType.value,\n                    \"image-url\": currentImageUrl.value,\n                    \"live2d-model-id\": currentLive2dModelId.value,\n                    \"live2d-models\": live2dModels.value\n                }, null, 8 /* PROPS */, [\"scale\", \"position-x\", \"position-y\", \"sprite-type\", \"image-url\", \"live2d-model-id\", \"live2d-models\"]),\n                _createCommentVNode(\" CGCG \"),\n                (currentDialogue.value?.isCG && currentDialogue.value.cgImageUrl)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"absolute inset-0 z-5 bg-cover bg-center\",\n                        style: _normalizeStyle({\n                            backgroundImage: `url('${currentDialogue.value.cgImageUrl}')`,\n                        })\n                    }, null, 4 /* STYLE */))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_1, [\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"button\", {\n                        class: _normalizeClass([\n                            'bg-card/80 text-foreground flex items-center gap-2 rounded-full p-2 shadow-lg backdrop-blur-sm transition-all hover:bg-card',\n                            characterMenuExpanded.value ? 'pr-4' : '',\n                        ]),\n                        \"aria-label\": \"\",\n                        onClick: _withModifiers(handleCharacterClick, [\"stop\"])\n                    }, [\n                        _createCommentVNode(\"  SVG \"),\n                        _cache[8] || (_cache[8] = _createElementVNode(\"svg\", {\n                            class: \"h-5 w-5\",\n                            fill: \"none\",\n                            stroke: \"currentColor\",\n                            viewBox: \"0 0 24 24\"\n                        }, [\n                            _createElementVNode(\"path\", {\n                                \"stroke-linecap\": \"round\",\n                                \"stroke-linejoin\": \"round\",\n                                \"stroke-width\": \"2\",\n                                d: \"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"\n                            })\n                        ], -1 /* CACHED */)),\n                        (characterMenuExpanded.value)\n                            ? (_openBlock(), _createElementBlock(\"span\", _hoisted_2, \"\"))\n                            : _createCommentVNode(\"v-if\", true)\n                    ], 2 /* CLASS */),\n                    _createCommentVNode(\"  \"),\n                    (characterMenuExpanded.value)\n                        ? (_openBlock(), _createElementBlock(\"button\", {\n                            key: 0,\n                            class: \"bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card\",\n                            style: { \"animation-delay\": \"50ms\" },\n                            \"aria-label\": \"\",\n                            onClick: _withModifiers(handleInputClick, [\"stop\"])\n                        }, [...(_cache[9] || (_cache[9] = [\n                                _createElementVNode(\"svg\", {\n                                    class: \"h-5 w-5\",\n                                    fill: \"none\",\n                                    stroke: \"currentColor\",\n                                    viewBox: \"0 0 24 24\"\n                                }, [\n                                    _createElementVNode(\"path\", {\n                                        \"stroke-linecap\": \"round\",\n                                        \"stroke-linejoin\": \"round\",\n                                        \"stroke-width\": \"2\",\n                                        d: \"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"\n                                    })\n                                ], -1 /* CACHED */),\n                                _createElementVNode(\"span\", { class: \"text-sm\" }, \"\", -1 /* CACHED */)\n                            ]))]))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", _hoisted_3, [\n                    _createCommentVNode(\"  \"),\n                    _createElementVNode(\"button\", {\n                        class: _normalizeClass([\n                            'bg-card/80 text-foreground flex items-center gap-2 rounded-full p-2 shadow-lg backdrop-blur-sm transition-all hover:bg-card',\n                            menuExpanded.value ? 'pr-4' : '',\n                        ]),\n                        \"aria-label\": \"\",\n                        onClick: handleSettingsClick\n                    }, [\n                        _cache[10] || (_cache[10] = _createElementVNode(\"svg\", {\n                            class: \"h-5 w-5\",\n                            fill: \"none\",\n                            stroke: \"currentColor\",\n                            viewBox: \"0 0 24 24\"\n                        }, [\n                            _createElementVNode(\"path\", {\n                                \"stroke-linecap\": \"round\",\n                                \"stroke-linejoin\": \"round\",\n                                \"stroke-width\": \"2\",\n                                d: \"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"\n                            }),\n                            _createElementVNode(\"path\", {\n                                \"stroke-linecap\": \"round\",\n                                \"stroke-linejoin\": \"round\",\n                                \"stroke-width\": \"2\",\n                                d: \"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"\n                            })\n                        ], -1 /* CACHED */)),\n                        (menuExpanded.value)\n                            ? (_openBlock(), _createElementBlock(\"span\", _hoisted_4, \"\"))\n                            : _createCommentVNode(\"v-if\", true)\n                    ], 2 /* CLASS */),\n                    _createCommentVNode(\"  \"),\n                    (menuExpanded.value)\n                        ? (_openBlock(), _createElementBlock(\"button\", {\n                            key: 0,\n                            class: \"bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card\",\n                            \"aria-label\": isFullscreen.value ? '' : '',\n                            onClick: toggleFullscreen\n                        }, [\n                            (isFullscreen.value)\n                                ? (_openBlock(), _createElementBlock(\"svg\", _hoisted_6, [...(_cache[11] || (_cache[11] = [\n                                        _createElementVNode(\"path\", {\n                                            \"stroke-linecap\": \"round\",\n                                            \"stroke-linejoin\": \"round\",\n                                            \"stroke-width\": \"2\",\n                                            d: \"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25\"\n                                        }, null, -1 /* CACHED */)\n                                    ]))]))\n                                : (_openBlock(), _createElementBlock(\"svg\", _hoisted_7, [...(_cache[12] || (_cache[12] = [\n                                        _createElementVNode(\"path\", {\n                                            \"stroke-linecap\": \"round\",\n                                            \"stroke-linejoin\": \"round\",\n                                            \"stroke-width\": \"2\",\n                                            d: \"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4\"\n                                        }, null, -1 /* CACHED */)\n                                    ]))])),\n                            _createElementVNode(\"span\", _hoisted_8, _toDisplayString(isFullscreen.value ? '' : ''), 1 /* TEXT */)\n                        ], 8 /* PROPS */, _hoisted_5))\n                        : _createCommentVNode(\"v-if\", true),\n                    _createCommentVNode(\"  \"),\n                    (menuExpanded.value)\n                        ? (_openBlock(), _createElementBlock(\"button\", {\n                            key: 1,\n                            class: \"bg-card/80 text-foreground animate-in fade-in slide-in-from-top-2 flex items-center gap-2 rounded-full p-2 pr-4 shadow-lg backdrop-blur-sm transition-colors duration-200 hover:bg-card\",\n                            style: { \"animation-delay\": \"50ms\" },\n                            \"aria-label\": \"\",\n                            onClick: handleHistory\n                        }, [...(_cache[13] || (_cache[13] = [\n                                _createElementVNode(\"svg\", {\n                                    class: \"h-5 w-5\",\n                                    fill: \"none\",\n                                    stroke: \"currentColor\",\n                                    viewBox: \"0 0 24 24\"\n                                }, [\n                                    _createElementVNode(\"path\", {\n                                        \"stroke-linecap\": \"round\",\n                                        \"stroke-linejoin\": \"round\",\n                                        \"stroke-width\": \"2\",\n                                        d: \"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"\n                                    })\n                                ], -1 /* CACHED */),\n                                _createElementVNode(\"span\", { class: \"text-sm\" }, \"\", -1 /* CACHED */)\n                            ]))]))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", {\n                    class: \"absolute inset-0 z-10 cursor-pointer\",\n                    onClick: handleClick\n                }),\n                _createCommentVNode(\"  \"),\n                (menuExpanded.value || characterMenuExpanded.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 1,\n                        class: \"absolute inset-0 z-40\",\n                        onClick: _cache[0] || (_cache[0] = ($event) => {\n                            menuExpanded.value = false;\n                            characterMenuExpanded.value = false;\n                        })\n                    }))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                _createElementVNode(\"div\", {\n                    class: _normalizeClass([\n                        'absolute inset-0 z-30 flex items-center justify-center bg-black transition-opacity duration-1000',\n                        blackScreen.value ? 'opacity-100' : 'pointer-events-none opacity-0',\n                    ]),\n                    onClick: handleBlackScreenClick\n                }, [\n                    _createElementVNode(\"p\", _hoisted_9, _toDisplayString(blackScreenText.value), 1 /* TEXT */),\n                    _createCommentVNode(\"  \"),\n                    (blackScreen.value)\n                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                            _cache[14] || (_cache[14] = _createStaticVNode(\"<div class=\\\"absolute top-1/2 left-6 -translate-y-1/2 text-white/40 transition-colors hover:text-white/60\\\" data-v-291585f1><svg class=\\\"h-8 w-8\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" viewBox=\\\"0 0 24 24\\\" data-v-291585f1><path stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" stroke-width=\\\"2\\\" d=\\\"M15 19l-7-7 7-7\\\" data-v-291585f1></path></svg></div><div class=\\\"absolute top-1/2 right-6 -translate-y-1/2 text-white/40 transition-colors hover:text-white/60\\\" data-v-291585f1><svg class=\\\"h-8 w-8\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" viewBox=\\\"0 0 24 24\\\" data-v-291585f1><path stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" stroke-width=\\\"2\\\" d=\\\"M9 5l7 7-7 7\\\" data-v-291585f1></path></svg></div>\", 2))\n                        ], 64 /* STABLE_FRAGMENT */))\n                        : _createCommentVNode(\"v-if\", true)\n                ], 2 /* CLASS */),\n                _createCommentVNode(\"  \"),\n                (showChoices.value && currentDialogue.value?.options)\n                    ? (_openBlock(), _createBlock(ChoiceBox, {\n                        key: 2,\n                        options: currentDialogue.value.options,\n                        \"custom-style\": dialogStyle.value,\n                        \"on-select\": handleChoiceSelect,\n                        \"on-prev\": prevDialogue,\n                        \"on-next\": () => nextDialogue(),\n                        \"on-save\": handleSaveToStory\n                    }, null, 8 /* PROPS */, [\"options\", \"custom-style\", \"on-next\"]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (!blackScreen.value &&\n                    !showChoices.value &&\n                    currentDialogue.value &&\n                    currentDialogue.value.type !== 'blackscreen' &&\n                    currentDialogue.value.type !== 'choice' &&\n                    getDisplayText())\n                    ? (_openBlock(), _createBlock(DialogBox, {\n                        key: 3,\n                        character: currentDialogue.value.character || '',\n                        text: getDisplayText(),\n                        \"is-last-dialogue\": currentDialogIndex.value >= dialogues.value.length - 1,\n                        \"is-first-dialogue\": currentDialogIndex.value === 0,\n                        \"on-prev\": prevDialogue,\n                        \"on-next\": nextDialogue,\n                        \"dialog-key\": currentDialogIndex.value,\n                        \"custom-style\": dialogStyle.value,\n                        \"is-loading\": isStreaming.value && streamingMessageId.value === currentDialogue.value.message_id,\n                        \"streaming-text\": isStreaming.value && streamingMessageId.value === currentDialogue.value.message_id ? streamingText.value : undefined,\n                        \"is-through\": currentDialogue.value.isThrough,\n                        \"is-editable\": currentDialogue.value.isEditable,\n                        \"message-id\": currentDialogue.value.message_id,\n                        \"on-edit\": handleEditUserMessage,\n                        \"on-delete\": handleDeleteUserMessage\n                    }, null, 8 /* PROPS */, [\"character\", \"text\", \"is-last-dialogue\", \"is-first-dialogue\", \"dialog-key\", \"custom-style\", \"is-loading\", \"streaming-text\", \"is-through\", \"is-editable\", \"message-id\"]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showSettings.value)\n                    ? (_openBlock(), _createBlock(SettingsPanel, {\n                        key: 4,\n                        \"on-close\": () => (showSettings.value = false),\n                        \"sprite-settings\": spriteSettings.value,\n                        \"on-sprite-settings-change\": s => (spriteSettings.value = s),\n                        \"auto-play\": autoPlay.value,\n                        \"on-auto-play-change\": v => (autoPlay.value = v),\n                        \"auto-play-speed\": autoPlaySpeed.value,\n                        \"on-auto-play-speed-change\": v => (autoPlaySpeed.value = v),\n                        \"dialog-style\": previewStyle.value,\n                        \"on-dialog-style-change\": s => (previewStyle.value = s),\n                        \"on-save-style\": handleSaveStyle,\n                        \"current-applied-style\": dialogStyle.value,\n                        \"custom-mode-enabled\": customModeEnabled.value,\n                        \"on-custom-mode-change\": v => (customModeEnabled.value = v)\n                    }, null, 8 /* PROPS */, [\"on-close\", \"sprite-settings\", \"on-sprite-settings-change\", \"auto-play\", \"on-auto-play-change\", \"auto-play-speed\", \"on-auto-play-speed-change\", \"dialog-style\", \"on-dialog-style-change\", \"current-applied-style\", \"custom-mode-enabled\", \"on-custom-mode-change\"]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                _createVNode(CharacterStatusPanel, {\n                    show: showCharacterPanel.value,\n                    \"message-id\": currentDialogue.value?.message_id,\n                    \"status-block\": currentDialogue.value?.statusBlock,\n                    \"on-close\": () => (showCharacterPanel.value = false)\n                }, null, 8 /* PROPS */, [\"show\", \"message-id\", \"status-block\", \"on-close\"]),\n                _createCommentVNode(\"  \"),\n                (showHistoryDialog.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 5,\n                        class: \"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\",\n                        onClick: _cache[2] || (_cache[2] = _withModifiers(($event) => (showHistoryDialog.value = false), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_10, [\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", _hoisted_11, [\n                                _cache[16] || (_cache[16] = _createElementVNode(\"h2\", { class: \"text-lg font-medium\" }, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"button\", {\n                                    class: \"hover:bg-muted rounded-full p-1 transition-colors\",\n                                    \"aria-label\": \"\",\n                                    onClick: _cache[1] || (_cache[1] = ($event) => (showHistoryDialog.value = false))\n                                }, [...(_cache[15] || (_cache[15] = [\n                                        _createElementVNode(\"svg\", {\n                                            class: \"h-5 w-5\",\n                                            fill: \"none\",\n                                            stroke: \"currentColor\",\n                                            viewBox: \"0 0 24 24\"\n                                        }, [\n                                            _createElementVNode(\"path\", {\n                                                \"stroke-linecap\": \"round\",\n                                                \"stroke-linejoin\": \"round\",\n                                                \"stroke-width\": \"2\",\n                                                d: \"M6 18L18 6M6 6l12 12\"\n                                            })\n                                        ], -1 /* CACHED */)\n                                    ]))])\n                            ]),\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", _hoisted_12, [\n                                (historyMessages.value.length === 0)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, \"  \"))\n                                    : _createCommentVNode(\"v-if\", true),\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(historyMessages.value, (msg, msgIndex) => {\n                                    return (_openBlock(), _createElementBlock(_Fragment, {\n                                        key: msg.id\n                                    }, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(msg.items, (item, itemIndex) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: `${msg.id}-${itemIndex}`,\n                                                class: \"history-message-item group relative cursor-pointer rounded px-3 py-2 transition-all\",\n                                                onClick: ($event) => (jumpToHistoryMessage(msg.id))\n                                            }, [\n                                                _createCommentVNode(\"  \"),\n                                                (item.type === 'character' || item.type === 'user')\n                                                    ? (_openBlock(), _createElementBlock(\"div\", {\n                                                        key: 0,\n                                                        class: \"leading-relaxed\",\n                                                        style: _normalizeStyle({\n                                                            color: dialogStyle.value.colors.dialogText,\n                                                            fontSize: `${dialogStyle.value.fontSize}px`,\n                                                        })\n                                                    }, [\n                                                        _createElementVNode(\"span\", _hoisted_15, _toDisplayString(item.character) + \"\", 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", {\n                                                            innerHTML: formatUserText(item.text)\n                                                        }, null, 8 /* PROPS */, _hoisted_16)\n                                                    ], 4 /* STYLE */))\n                                                    : (item.type === 'narration')\n                                                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                                            _createCommentVNode(\"  \"),\n                                                            _createElementVNode(\"div\", {\n                                                                class: \"ml-6 leading-relaxed italic\",\n                                                                style: _normalizeStyle({\n                                                                    color: dialogStyle.value.colors.narrationText,\n                                                                    fontSize: `${dialogStyle.value.fontSize}px`,\n                                                                })\n                                                            }, _toDisplayString(item.text), 5 /* TEXT, STYLE */)\n                                                        ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                                                        : (item.type === 'blacktext')\n                                                            ? (_openBlock(), _createElementBlock(_Fragment, { key: 2 }, [\n                                                                _createCommentVNode(\"  \"),\n                                                                _createElementVNode(\"div\", {\n                                                                    class: \"ml-6 leading-relaxed italic opacity-70\",\n                                                                    style: _normalizeStyle({\n                                                                        color: dialogStyle.value.colors.narrationText,\n                                                                        fontSize: `${dialogStyle.value.fontSize}px`,\n                                                                    })\n                                                                }, _toDisplayString(item.text), 5 /* TEXT, STYLE */)\n                                                            ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                                                            : (item.type === 'choice')\n                                                                ? (_openBlock(), _createElementBlock(_Fragment, { key: 3 }, [\n                                                                    _createCommentVNode(\"  \"),\n                                                                    _createElementVNode(\"div\", {\n                                                                        class: \"leading-relaxed\",\n                                                                        style: _normalizeStyle({\n                                                                            color: dialogStyle.value.colors.dialogText,\n                                                                            fontSize: `${dialogStyle.value.fontSize}px`,\n                                                                        })\n                                                                    }, [\n                                                                        _cache[17] || (_cache[17] = _createElementVNode(\"span\", { class: \"font-medium\" }, \"\", -1 /* CACHED */)),\n                                                                        _createElementVNode(\"span\", null, _toDisplayString(item.text), 1 /* TEXT */)\n                                                                    ], 4 /* STYLE */)\n                                                                ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))\n                                                                : _createCommentVNode(\"v-if\", true),\n                                                _createCommentVNode(\" hover \"),\n                                                (itemIndex < msg.items.length - 1 || msgIndex < historyMessages.value.length - 1)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ], 8 /* PROPS */, _hoisted_14));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ], 64 /* STABLE_FRAGMENT */));\n                                }), 128 /* KEYED_FRAGMENT */))\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  \"),\n                (showInputBox.value)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 6,\n                        class: \"absolute inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm\",\n                        onClick: _cache[7] || (_cache[7] = () => (showInputBox.value = false))\n                    }, [\n                        _createElementVNode(\"div\", {\n                            class: \"relative mx-4 w-full max-w-lg p-4\",\n                            style: _normalizeStyle({\n                                backgroundColor: dialogStyle.value.boxShape === 'pill' ? 'rgba(255, 255, 255, 0.85)' : dialogStyle.value.colors.boxBackground,\n                                borderRadius: '16px',\n                                borderWidth: '1px',\n                                borderStyle: 'solid',\n                                borderColor: dialogStyle.value.colors.boxBorder,\n                                boxShadow: '0 8px 32px rgba(0,0,0,0.15)',\n                                backdropFilter: dialogStyle.value.boxShape === 'pill' ? 'blur(12px)' : undefined,\n                            }),\n                            onClick: _cache[6] || (_cache[6] = _withModifiers(() => { }, [\"stop\"]))\n                        }, [\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"button\", {\n                                class: \"absolute top-2 right-2 rounded-full p-1 transition-colors hover:bg-black/5\",\n                                onClick: _cache[3] || (_cache[3] = () => (showInputBox.value = false))\n                            }, [...(_cache[18] || (_cache[18] = [\n                                    _createElementVNode(\"svg\", {\n                                        class: \"text-muted-foreground h-4 w-4\",\n                                        fill: \"none\",\n                                        stroke: \"currentColor\",\n                                        viewBox: \"0 0 24 24\"\n                                    }, [\n                                        _createElementVNode(\"path\", {\n                                            \"stroke-linecap\": \"round\",\n                                            \"stroke-linejoin\": \"round\",\n                                            \"stroke-width\": \"2\",\n                                            d: \"M6 18L18 6M6 6l12 12\"\n                                        })\n                                    ], -1 /* CACHED */)\n                                ]))]),\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", {\n                                class: \"mb-3 inline-block px-3 py-1 text-sm font-medium\",\n                                style: _normalizeStyle({\n                                    backgroundColor: dialogStyle.value.colors.nameBackground,\n                                    color: dialogStyle.value.colors.nameText,\n                                    borderRadius: '6px',\n                                })\n                            }, \"  \", 4 /* STYLE */),\n                            _createCommentVNode(\"  \"),\n                            _createElementVNode(\"div\", _hoisted_18, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    ref_key: \"inputRef\",\n                                    ref: inputRef,\n                                    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => ((inputText).value = $event)),\n                                    type: \"text\",\n                                    placeholder: \"...\",\n                                    class: \"flex-1 bg-transparent text-base outline-none\",\n                                    style: _normalizeStyle({ color: dialogStyle.value.colors.dialogText }),\n                                    onKeydown: [\n                                        _withKeys(handleSendInput, [\"enter\"]),\n                                        _cache[5] || (_cache[5] = _withKeys(() => (showInputBox.value = false), [\"escape\"]))\n                                    ]\n                                }, null, 36 /* STYLE, NEED_HYDRATION */), [\n                                    [_vModelText, inputText.value]\n                                ]),\n                                _createCommentVNode(\"  \"),\n                                (inputText.value.trim())\n                                    ? (_openBlock(), _createElementBlock(\"button\", {\n                                        key: 0,\n                                        class: \"p-1 transition-colors hover:opacity-80\",\n                                        style: _normalizeStyle({ color: dialogStyle.value.colors.nameText }),\n                                        \"aria-label\": \"\",\n                                        title: \"\",\n                                        onClick: _withModifiers(handleSaveInput, [\"stop\"])\n                                    }, [...(_cache[19] || (_cache[19] = [\n                                            _createElementVNode(\"svg\", {\n                                                class: \"h-5 w-5\",\n                                                fill: \"none\",\n                                                stroke: \"currentColor\",\n                                                viewBox: \"0 0 24 24\"\n                                            }, [\n                                                _createElementVNode(\"path\", {\n                                                    \"stroke-linecap\": \"round\",\n                                                    \"stroke-linejoin\": \"round\",\n                                                    \"stroke-width\": \"2\",\n                                                    d: \"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12\"\n                                                })\n                                            ], -1 /* CACHED */)\n                                        ]))], 4 /* STYLE */))\n                                    : _createCommentVNode(\"v-if\", true),\n                                _createCommentVNode(\"  \"),\n                                (inputText.value.trim())\n                                    ? (_openBlock(), _createElementBlock(\"button\", {\n                                        key: 1,\n                                        class: \"p-1 transition-colors hover:opacity-80\",\n                                        style: _normalizeStyle({ color: dialogStyle.value.colors.nameText }),\n                                        \"aria-label\": \"\",\n                                        onClick: _withModifiers(handleSendInput, [\"stop\"])\n                                    }, [...(_cache[20] || (_cache[20] = [\n                                            _createElementVNode(\"svg\", {\n                                                class: \"h-5 w-5\",\n                                                fill: \"none\",\n                                                stroke: \"currentColor\",\n                                                viewBox: \"0 0 24 24\"\n                                            }, [\n                                                _createElementVNode(\"path\", {\n                                                    \"stroke-linecap\": \"round\",\n                                                    \"stroke-linejoin\": \"round\",\n                                                    \"stroke-width\": \"2\",\n                                                    d: \"M5 12h14M12 5l7 7-7 7\"\n                                                })\n                                            ], -1 /* CACHED */)\n                                        ]))], 4 /* STYLE */))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ])\n                        ], 4 /* STYLE */)\n                    ]))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 4 /* STYLE */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./GalgamePlayer.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./GalgamePlayer.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./GalgamePlayer.vue?vue&type=style&index=0&id=291585f1&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_53ff6257bd8fdf8315af10a81f7e3da1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-291585f1\"]])\n\nexport default __exports__","import { createApp } from 'vue';\nimport GalgamePlayer from './components/GalgamePlayer.vue';\nimport './styles/globals.css';\n\n$(() => {\n  createApp(GalgamePlayer).mount('#app');\n});\n"],"names":["exports","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","n","getter","__esModule","d","a","definition","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Vue","parseWorldbookJsonData","content","jsonMatch","match","JSON","parse","error","console","warn","trim","worldbookCache","worldbookCacheTimestamp","worldbookCacheSource","async","loadWorldbookResources","now","Date","currentCharacterName","RawCharacter","find","name","getCardData","cache","models","Map","sprites","backgrounds","cgs","worldbookNames","charWorldbooks","getCharWorldbookNames","primary","push","additional","length","worldbookName","entries","getWorldbook","entry","enabled","data","type","modelData","has","modelName","set","spriteData","characterName","existing","newData","normalizeText","text","replace","toLowerCase","fuzzyMatch","source","normalizedSource","normalizedTarget","includes","parseKeyValuePairs","result","parts","split","map","p","filter","part","kvMatch","value","matchWorldbookResources","sceneText","motionText","expressionText","cgSceneText","resources","bg","matchText","textMappings","some","mapping","sceneImageUrl","file","cg","cgImageUrl","matchTexts","Boolean","sprite","spriteImageUrl","motion","mappingText","motions","m","motionFile","expression","expressions","e","expressionFile","parseStatusBlock","message","statusData","fieldRegex","fieldMatch","exec","keys","lines","line","colonIndex","indexOf","substring","parseMessageBlocks","lastScene","blocks","currentScene","contentMatch","contentText","blockRegex","kvPairs","block","character","cgScene","scene","isCG","assign","messageText","narrationRegex","narrationMatches","narrationMatch","narrationText","narrationBlock","choiceCharacter","choiceResponse","choiceText","choices","i","choice","hasMotionAndExpression","live2dModels","model","hasMotion","motionName","hasExpression","exprName","backgroundPatternPresets","id","pattern","boxShapePresets","borderRadius","borderWidth","shadow","borderWidthPresets","width","nameShapePresets","style","arrowShapePresets","isInner","indicatorShapePresets","defaultDialogStyle","boxShape","nameShape","arrowShape","indicatorShape","backgroundPattern","colors","boxBackground","boxBorder","nameBackground","nameText","nameBorder","dialogText","arrowBackground","arrowIcon","indicatorColor","fontSize","STORE_NAME","openDB","Promise","resolve","reject","request","indexedDB","open","onerror","onsuccess","onupgradeneeded","event","db","objectStoreNames","contains","createObjectStore","keyPath","getFileBlobUrl","fileId","transaction","objectStore","fileData","blob","Blob","File","filename","lastModified","getFile","URL","createObjectURL","getIndexedDbFileUrl","indexedDbUrl","fileIds","parsed","url","parseIndexedDbUrl","loadScript","src","document","querySelector","script","createElement","onload","Error","head","appendChild","live2dInitPromise","Live2DRenderer","app","currentModel","modelConfig","isInitialized","currentMotionGroup","currentMotionIndex","isLoopingDefaultMotion","defaultMotionLoopTimer","init","canvas","this","window","PIXI","Live2DModel","registerTicker","Ticker","shared","info","initLive2DDependencies","canvasElement","Application","view","autoStart","backgroundAlpha","resizeTo","parentElement","antialias","loadModel","config","unloadModel","modelUrl","modelPath","startsWith","basePath","blobUrl","_fileIds","response","fetch","modelJson","json","FileReferences","Moc","mocPath","mocBlobUrl","Array","isArray","Textures","texturePath","textureBlobUrl","Physics","physicsPath","physicsBlobUrl","DisplayInfo","displayPath","displayBlobUrl","Groups","group","groupBlobUrl","Files","filePath","fileBlobUrl","modifiedJsonBlob","stringify","from","requestIdle","anchor","x","screen","y","height","scale","Math","min","stage","addChild","defaultAnimation","expressionIndex","findIndex","autoLoop","startDefaultMotionLoop","motionConfig","normalizedGroup","motionIndex","mGroup","MotionPriority","NORMAL","String","stopDefaultMotionLoop","NONE","IDLE","FORCE","groupMotions","playDefaultMotionLoop","motionManager","state","currentPriority","waitInterval","setInterval","clearInterval","currentState","setTimeout","checkCount","maxChecks","checkInterval","currentGroup","currentIndex","waitHighPriority","playMotion","index","priority","motionPriority","playExpression","setPosition","setScale","getModel","isReady","removeChild","destroy","children","texture","baseTexture","resize","renderer","_hoisted_1","__name","positionX","positionY","spriteType","imageUrl","live2dModelId","setup","__props","spriteContainerRef","ref","live2dCanvasRef","live2dRenderer","containerStyle","computed","left","bottom","transform","transformOrigin","loadLive2dModel","watch","immediate","onMounted","onUnmounted","_ctx","_cache","ref_key","class","alt","draggable","_","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","show","messageId","statusBlock","onClose","Function","activeTab","theaterExpanded","theaterContainer","theaterRendered","isLoading","tabs","statusValues","getMvuStatData","waitGlobalInitialized","Mvu","mvuData","getMvuData","message_id","stat_data","renderTheater","rawText","container","innerHTML","matches","matchAll","emptyMsg","textContent","textAlign","color","padding","forEach","fullSpeaker","speakerName","isUser","bubbleSide","bubbleWrapper","display","flexDirection","marginBottom","alignItems","speakerLabel","bubble","classList","add","loadStatusData","mvuLoaded","statData","field","loadStatusFromMvu","newValues","characterData","attrName","attrValue","isNaN","Number","extractStatusValues","newTab","nextTick","onClick","args","fill","stroke","viewBox","tab","$event","options","customStyle","onSelect","onPrev","onNext","onSave","isInputting","inputText","selectedCustom","inputRef","handleCustomClick","focus","handleInputConfirm","handleSave","dialogStyle","borderWidthPreset","isPillShape","handleBackgroundClick","rect","currentTarget","getBoundingClientRect","clientX","option","backgroundColor","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderStyle","borderColor","boxShadow","backdropFilter","WebkitBackdropFilter","handleOptionClick","placeholder","onKeydown","autofocus","title","isLastDialogue","isFirstDialogue","dialogKey","streamingText","isThrough","isEditable","onEdit","onDelete","displayedText","isTyping","typingTimer","bgPattern","isNarration","isInnerArrow","isMinimalArrow","getPatternStyle","borderColorForPattern","patternWithColor","backgroundSize","backgroundImage","boxStyle","outerArrowStyle","iconColor","bgColor","innerLeftArrowStyle","background","innerRightArrowStyle","indicatorComponent","isStreaming","h","opacity","animation","handlePrev","handleNext","clearTypingTimer","startTyping","slice","showEditDialog","editText","handleEdit","handleDelete","confirm","confirmEdit","cancelEdit","disabled","paddingLeft","paddingRight","borderBottom","rows","label","showAlpha","default","emits","emit","__emit","hexToHsl","hex","r","g","b","parseInt","parseFloat","max","s","l","round","hslToRgba","k","f","toFixed","toString","padStart","rgbaToHex","rgba","toUpperCase","hsl","hexDisplay","hexInput","localHsl","isDraggingRef","trackRefs","draggingSlider","globalMoveHandler","globalUpHandler","newHsl","sliders","currentValue","gradient","step","thumbColor","displayValue","updateLocalValue","slider","track","ratio","finalVal","newValue","commitChange","finalValue","handleHexInput","input","test","handleHexBlur","onInput","onBlur","ref_for","el","onPointerdown","setPointerCapture","pointerId","handleGlobalMove","ev","handleGlobalUp","removeEventListener","HTMLElement","releasePointerCapture","addEventListener","handlePointerDown","onPointermove","handlePointerMove","onPointerup","handlePointerUp","arrowBorderRadius","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","spriteSettings","onSpriteSettingsChange","autoPlay","onAutoPlayChange","autoPlaySpeed","onAutoPlaySpeedChange","onDialogStyleChange","onSaveStyle","currentAppliedStyle","customModeEnabled","onCustomModeChange","hasChanges","updateSpriteSettings","settings","updateShape","updateColor","checked","onChange","handleEnableCustomMode","DialogPreview","preset","ColorSlider","v","STORAGE_KEYS","containerRef","autoPlayTimerRef","dialogues","shallowRef","currentDialogIndex","currentDialogue","showSettings","isFullscreen","menuExpanded","characterMenuExpanded","showCharacterPanel","blackScreen","blackScreenText","showChoices","showInputBox","streamingMessageId","loadFromStorage","previewStyle","defaultValue","stored","localStorage","getItem","saveToStorage","setItem","newStyle","deep","newSettings","isPortrait","innerHeight","innerWidth","fullscreenElement","targetAspectRatio","screenHeight","aspectRatio","position","top","marginLeft","marginTop","containerWidth","clientWidth","containerHeight","clientHeight","requiredHeight","margin","dialogue","currentSpriteType","currentImageUrl","currentLive2dModelId","userMessageEdits","loadDialoguesFromTavern","messages","getChatMessages","newDialogues","msg","newFormatChoiceBlocks","oldFormatChoiceBlocks","hasMotionExpr","isCGMode","role","extra","sprite_image","edit","deleted","isDeleted","editedText","choiceBlock","allChoices","filteredDialogues","loadTestDialogues","nextDialogue","skipBlackscreen","nextIndex","prevDialogue","toggleFullscreen","orientation","lock","requestFullscreen","exitFullscreen","unlock","clearTimeout","delay","handleFullscreenChange","handleResize","eventCleanups","handleBlackScreenClick","handleClick","trimMessageBeforeContentTag","contentEndIndex","handleSaveToStory","currentMessageId","getCurrentMessageId","chat_message","newMessage","setChatMessages","refresh","newDialogue","getLastMessageId","splice","handleChoiceSelect","customText","lastMessageId","isAllDialoguesLoaded","selectedOption","opt","selectedText","choiceBlockRegex","newMessageText","allChoiceBlocks","c","newFormatBlocks","cb","oldFormatBlocks","trimmedChoiceBlock","trimChoiceText","responseDialogue","originalText","trimmedText","messagesToDelete","deleteChatMessages","createChatMessages","expectedMessageId","triggerSlash","getDisplayText","modelsMap","variables","getVariables","live2d_models","existingModel","files","model3","pop","lastIndexOf","textures","values","loadLive2dModels","eventOn","tavern_events","messageReceivedCleanup","MESSAGE_RECEIVED","messageUpdatedCleanup","MESSAGE_UPDATED","updatedMessage","chatChangedCleanup","CHAT_CHANGED","streamTokenCleanup","STREAM_TOKEN_RECEIVED","handleStreamToken","cleanup","showHistoryDialog","historyMessages","handleHistory","chatMessages","items","userText","blackText","cleanText","reverse","handleSaveStyle","handleSettingsClick","handleCharacterClick","handleInputClick","handleSendInput","size","syncEditToMessage","clear","applyUserMessageEdits","formattedMessage","handleSaveInput","handleEditUserMessage","newText","dialogueIndex","handleDeleteUserMessage","userBlockRegex","foundMatch","oldBlock","newBlock","newContentText","backgroundPosition","backgroundRepeat","objectFit","CharacterSprite","ChoiceBox","DialogBox","SettingsPanel","CharacterStatusPanel","msgIndex","item","itemIndex","$","createApp","GalgamePlayer","mount"],"ignoreList":[],"sourceRoot":""}